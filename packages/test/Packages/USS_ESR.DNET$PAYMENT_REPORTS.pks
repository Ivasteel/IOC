/* Formatted on 8/12/2025 5:48:27 PM (QP5 v5.417) */
CREATE OR REPLACE PACKAGE USS_ESR.DNET$PAYMENT_REPORTS
IS
    -- Author  : BOGDAN
    -- Created : 12.07.2021 11:45:29
    -- Purpose : «в≥ти дл€ "Cоц≥альне казначейство"

    -- info:   ќтриманн€ суми прописом
    -- params: p_sum - сума
    --         p_measure_unit1 - ц≥лочислова одиниц€ валюти (називний в≥дм≥нок)
    --         p_measure_unit2 - ц≥лочислова одиниц€ валюти в одиничному числ≥ (родовий в≥дм≥нок)
    --         p_measure_unit3 - ц≥лочислова одиниц€ валюти в множинному числ≥ (родовий в≥дм≥нок)
    --         p_fract_measure_unit - дробова одиниц€ валюти
    -- note:

    FUNCTION sum_in_words (p_sum                  IN NUMBER,
                           p_measure_unit1        IN VARCHAR2,
                           p_measure_unit2        IN VARCHAR2,
                           p_measure_unit3        IN VARCHAR2,
                           p_fract_measure_unit   IN VARCHAR2)
        RETURN VARCHAR2;

    FUNCTION sm_all (p_date    DATE,
                     p_sum1    NUMBER,
                     p_sum2    NUMBER,
                     p_sum3    NUMBER,
                     p_sum4    NUMBER,
                     p_sum5    NUMBER,
                     p_sum6    NUMBER,
                     p_sum7    NUMBER,
                     p_sum8    NUMBER,
                     p_sum9    NUMBER,
                     p_sum10   NUMBER,
                     p_sum11   NUMBER,
                     p_sum12   NUMBER)
        RETURN NUMBER;

    FUNCTION cnt_all (p_date DATE, p_period NUMBER, p_sum NUMBER)
        RETURN NUMBER;

    PROCEDURE RegisterReport (p_rt_id      IN     NUMBER,
                              p_start_dt   IN     DATE,
                              p_stop_dt    IN     DATE,
                              p_org_id     IN     NUMBER,
                              p_val_1      IN     VARCHAR2,
                              p_val_2      IN     VARCHAR2,
                              p_jbr_id        OUT DECIMAL);

    PROCEDURE GET_DBF_REPORT (P_NNF_ID      IN     NUMBER,
                              P_IDS         IN     VARCHAR2,
                              P_DT          IN     DATE,
                              P_FILE           OUT BLOB,
                              P_FILE_NAME      OUT VARCHAR2);

    -- info:   ≤н≥ц≥ал≥зац≥€ процесу п≥дготовки друкованоњ форми в≥домост≥
    -- params: p_pr_id - ≥дентиф≥катор в≥домост≥ на виплату
    -- note:   #70734, #71097
    PROCEDURE reg_payroll_report (p_pr_id IN NUMBER, p_jbr_id OUT DECIMAL);

    -- info:   формуванн€ друкованих форм документ≥в дл€ картки в≥домост≥
    -- params: p_rt_id - ≥дентиф≥катор шаблону зв≥ту
    --         p_pr_id - ≥дентиф≥катор в≥домост≥ на виплату
    -- note:
    PROCEDURE reg_payroll_rpt (p_rt_id    IN     rpt_templates.rt_id%TYPE,
                               p_pr_id    IN     payroll.pr_id%TYPE,
                               p_jbr_id      OUT DECIMAL);

    PROCEDURE SET_DS_KB2 (p_start_dt IN DATE, p_jbr_id IN DECIMAL);

    PROCEDURE SET_DS_ACD_VPO (p_start_dt   IN DATE,
                              p_org_id     IN NUMBER,
                              p_jbr_id     IN DECIMAL);

    PROCEDURE SET_DS_PDP_VPO (p_start_dt   IN DATE,
                              p_org_id     IN NUMBER,
                              p_jbr_id     IN DECIMAL);

    PROCEDURE SET_DS_PAID_VPO (p_start_dt   IN DATE,
                               p_org_id     IN NUMBER,
                               p_jbr_id     IN DECIMAL);

    PROCEDURE SET_DS_PAID2_VPO (p_start_dt   IN DATE,
                                p_org_id     IN NUMBER,
                                p_jbr_id     IN DECIMAL);

    PROCEDURE SET_DS_PAID3_VPO (p_start_dt   IN DATE,
                                p_org_id     IN NUMBER,
                                p_jbr_id     IN DECIMAL);

    PROCEDURE SET_DS_PAID_VPO_R4 (p_start_dt   IN DATE,
                                  p_org_id     IN NUMBER,
                                  p_jbr_id     IN DECIMAL);

    PROCEDURE SET_DS_DLK_VPO (p_start_dt   IN DATE,
                              p_org_id     IN NUMBER,
                              p_jbr_id     IN DECIMAL);

    PROCEDURE SET_DS_REG_6DOP (p_po_id IN NUMBER, p_jbr_id IN DECIMAL);

    PROCEDURE SET_DS_REG_DED (p_po_id IN NUMBER, p_jbr_id IN DECIMAL);

    PROCEDURE SET_CNT_RECIP_DOP (p_start_dt   IN DATE,
                                 p_nst_id     IN NUMBER := 664,
                                 p_org_id     IN NUMBER,
                                 p_jbr_id     IN DECIMAL);

    PROCEDURE SET_CNT_MCHILD_FML (p_start_dt   IN DATE,
                                  p_nst_id     IN NUMBER := 249,
                                  p_org_id     IN NUMBER,
                                  p_jbr_id     IN DECIMAL);

    PROCEDURE SET_CHILDREN_272 (p_start_dt   IN DATE,
                                p_org_id     IN NUMBER,
                                p_jbr_id     IN DECIMAL);

    PROCEDURE SET_PRSD_R1 (p_start_dt   IN DATE,
                           p_nst_id     IN NUMBER := 249,
                           p_org_id     IN NUMBER,
                           p_jbr_id     IN DECIMAL);

    PROCEDURE SET_PRSD_R2 (p_start_dt   IN DATE,
                           p_stop_dt    IN DATE,
                           p_nst_id     IN NUMBER,
                           p_org_id     IN NUMBER,
                           p_jbr_id     IN DECIMAL);

    PROCEDURE SET_DSDI_R1 (p_start_dt   IN DATE,
                           p_org_id     IN NUMBER,
                           p_jbr_id     IN DECIMAL);

    -- #91702: ƒан≥ щодо виплати допомоги ¬ѕќ (у розм≥р≥ 2000 грн ≥ 3000 грн)
    PROCEDURE SET_VPO_2000_3000_R1 (p_start_dt   IN DATE,
                                    p_org_id     IN NUMBER,
                                    p_curr_org   IN NUMBER,
                                    p_jbr_id     IN DECIMAL);

    -- IC #92714
    PROCEDURE SET_PAID_VPO_R5 (p_start_dt   IN DATE,
                               p_org_id     IN NUMBER,
                               p_jbr_id     IN DECIMAL);

    -- IC #94445
    PROCEDURE SET_REP_INCOM_R1 (p_start_dt   IN DATE,
                                p_org_id     IN NUMBER,
                                p_jbr_id     IN DECIMAL);

    -- IC #98585
    PROCEDURE SET_PAYROLL_AMOUNT_R1 (p_start_dt   IN DATE,
                                     p_org_id     IN NUMBER,
                                     p_nst_id     IN NUMBER,
                                     p_pay_type   IN VARCHAR2,
                                     p_jbr_id     IN DECIMAL);

    PROCEDURE SET_PFU_VPO_R1 (p_start_dt   IN DATE,
                              p_org_id     IN NUMBER,
                              p_jbr_id     IN DECIMAL);

    FUNCTION getMonthName (p_mnum NUMBER, p_vidm CHAR:= 'N' -- N,R,D,Z,O,M,K (називний, родовий, давальний...)
                                                           )
        RETURN VARCHAR2;

    FUNCTION getCntFMLbyPrsd (p_prsd NUMBER)
        RETURN NUMBER;

    FUNCTION getKaotCode (p_dh NUMBER)
        RETURN VARCHAR2;

    FUNCTION getCntDistr (p_sum   IN NUMBER,
                          p_cnt   IN NUMBER,
                          p_for   IN NUMBER := 2,
                          p_pd    IN NUMBER := NULL,
                          p_dt    IN DATE := NULL)
        RETURN NUMBER;

    FUNCTION getCharMF (                                          -- IC #87199
                        p_val    IN VARCHAR2,
                        p_type   IN VARCHAR2 := '0',
                        p_def    IN VARCHAR2 := NULL)
        RETURN VARCHAR2;

    /* serhii 12/09/2023 #91349:
       вар≥ант getCharMF п≥д в≥б≥рку дл€ ћ≥нф≥ну uss_ndi.ndi_rpt_queries.rq_id = 152 */
    FUNCTION getCharMF_q152 (p_val    IN VARCHAR2,
                             p_type   IN VARCHAR2 := '0',
                             p_def    IN VARCHAR2 := NULL)
        RETURN VARCHAR2;

    FUNCTION getFAddrMF (                                         -- IC #87199
                         p_app_id   IN NUMBER,
                         p_ndt_id   IN NUMBER := 605,
                         p_nda_id   IN NUMBER := NULL)
        RETURN VARCHAR;


    FUNCTION getRAddrMF (                                         -- IC #87199
                         p_app_id   IN NUMBER,
                         p_ndt_id   IN NUMBER := 605,
                         p_nda_id   IN NUMBER := NULL)
        RETURN VARCHAR;

    FUNCTION getCntFmlByPC (                                      -- IC #93401
                            p_pc_id      IN NUMBER,
                            p_nst_id     IN NUMBER := 0,
                            p_date       IN DATE := NULL,
                            p_type_rep   IN NUMBER := 0)
        RETURN NUMBER;

    -- IC ќтриманн€ текстового параметру документу по учаснику
    FUNCTION get_doc_string (p_app   ap_document.apd_app%TYPE,
                             p_ap    ap_document.apd_ap%TYPE,
                             p_ndt   ap_document.apd_ndt%TYPE,
                             p_nda   ap_document_attr.apda_nda%TYPE)
        RETURN VARCHAR2;

    -- IC ќтриманн€ ID параметру документу по учаснику
    FUNCTION get_doc_id (p_app   ap_document.apd_app%TYPE,
                         p_ap    ap_document.apd_ap%TYPE,
                         p_ndt   ap_document.apd_ndt%TYPE,
                         p_nda   ap_document_attr.apda_nda%TYPE)
        RETURN NUMBER;

    -- IC ќтриманн€ параметру дати документу по учаснику
    FUNCTION get_doc_dt (p_app   ap_document.apd_app%TYPE,
                         p_ap    ap_document.apd_ap%TYPE,
                         p_ndt   ap_document.apd_ndt%TYPE,
                         p_nda   ap_document_attr.apda_nda%TYPE)
        RETURN DATE;

    -- IC #116151
    FUNCTION phone_clear (p_text IN VARCHAR2)
        RETURN VARCHAR2;

    FUNCTION Get_Attr_Val_Dt (p_Nda_Id IN NUMBER, p_Dh_Id IN NUMBER)
        RETURN DATE;

    FUNCTION Get_Attr_Val_Str (p_Nda_Id IN NUMBER, p_Dh_Id IN NUMBER)
        RETURN VARCHAR2;

    FUNCTION Get_Attr_Val_Id (p_Nda_Id IN NUMBER, p_Dh_Id IN NUMBER)
        RETURN NUMBER;
END DNET$PAYMENT_REPORTS;
/


GRANT EXECUTE ON USS_ESR.DNET$PAYMENT_REPORTS TO DNET_PROXY
/

GRANT EXECUTE ON USS_ESR.DNET$PAYMENT_REPORTS TO II01RC_USS_ESR_RPT
/

GRANT EXECUTE ON USS_ESR.DNET$PAYMENT_REPORTS TO II01RC_USS_ESR_WEB
/

GRANT EXECUTE ON USS_ESR.DNET$PAYMENT_REPORTS TO USS_RPT
/


/* Formatted on 8/12/2025 5:49:40 PM (QP5 v5.417) */
CREATE OR REPLACE PACKAGE BODY USS_ESR.DNET$PAYMENT_REPORTS
IS
    -- info:   ќтриманн€ ≥дентиф≥катора шаблону по коду
    -- params: p_rt_code - код шаблону
    -- note:
    FUNCTION get_rt_by_code (p_rt_code IN rpt_templates.rt_code%TYPE)
        RETURN NUMBER
    IS
        v_rt_id   rpt_templates.rt_id%TYPE;
    BEGIN
        SELECT rt_id
          INTO v_rt_id
          FROM v_rpt_templates
         WHERE rt_code = p_rt_code;

        RETURN v_rt_id;
    EXCEPTION
        WHEN OTHERS
        THEN
            RETURN NULL;
    END;

    -- info:   ќтриманн€ коду шаблону по ≥дентиф≥катору
    -- params: p_rt_id - ≥дентиф≥катор шаблону
    -- note:
    FUNCTION get_rt_code (p_rt_id IN rpt_templates.rt_id%TYPE)
        RETURN VARCHAR2
    IS
        v_rt_code   rpt_templates.rt_code%TYPE;
    BEGIN
        SELECT rt_code
          INTO v_rt_code
          FROM v_rpt_templates
         WHERE rt_id = p_rt_id;

        RETURN v_rt_code;
    EXCEPTION
        WHEN OTHERS
        THEN
            RETURN NULL;
    END;

    -- info:   ќтриманн€ назви м≥с€ц€ по дат≥
    -- params: p_date - дата по €к≥й необх≥дно отримати назву м≥с€ц€
    -- note:
    FUNCTION get_month_name (p_date IN DATE)
        RETURN VARCHAR2
    IS
    BEGIN
        RETURN (CASE TO_NUMBER (TO_CHAR (p_date, 'MM'))
                    WHEN 1 THEN 'с≥чн€'
                    WHEN 2 THEN 'лютого'
                    WHEN 3 THEN 'березн€'
                    WHEN 4 THEN 'кв≥тн€'
                    WHEN 5 THEN 'травн€'
                    WHEN 6 THEN 'червн€'
                    WHEN 7 THEN 'липн€'
                    WHEN 8 THEN 'серпн€'
                    WHEN 9 THEN 'вересн€'
                    WHEN 10 THEN 'жовтн€'
                    WHEN 11 THEN 'листопада'
                    WHEN 12 THEN 'грудн€'
                    ELSE ''
                END);
    END;

    -- info:   ќтриманн€ суми прописом
    -- params: p_sum - сума
    --         p_measure_unit1 - ц≥лочислова одиниц€ валюти (називний в≥дм≥нок)
    --         p_measure_unit2 - ц≥лочислова одиниц€ валюти в одиничному числ≥ (родовий в≥дм≥нок)
    --         p_measure_unit3 - ц≥лочислова одиниц€ валюти в множинному числ≥ (родовий в≥дм≥нок)
    --         p_fract_measure_unit - дробова одиниц€ валюти
    -- note:
    FUNCTION sum_in_words (p_sum                  IN NUMBER,
                           p_measure_unit1        IN VARCHAR2,
                           p_measure_unit2        IN VARCHAR2,
                           p_measure_unit3        IN VARCHAR2,
                           p_fract_measure_unit   IN VARCHAR2)
        RETURN VARCHAR2
    IS
        RESULT   VARCHAR2 (300);
    BEGIN
        -- ‘орматуванн€ входного числа в необх≥дний строковий формат
        -- g - гривн≥, k - коп≥йки

        RESULT :=
               LTRIM (
                   TO_CHAR (p_sum,
                            '9,9,,9,,,,,,9,9,,9,,,,,9,9,,9,,,,9,9,,9,,,.99'))
            || 'k';
        RESULT := REPLACE (RESULT, '.', 'g');

        -- t - тис€ч≥; m - м≥льйони; M - м≥ль€рди;
        RESULT := REPLACE (RESULT, ',,,,,,', 'eM');
        RESULT := REPLACE (RESULT, ',,,,,', 'em');
        RESULT := REPLACE (RESULT, ',,,,', 'et');

        -- e - одиниц≥; d - дес€тки; c - сотн≥;
        RESULT := REPLACE (RESULT, ',,,', 'e');
        RESULT := REPLACE (RESULT, ',,', 'd');
        RESULT := REPLACE (RESULT, ',', 'c');

        --
        RESULT := REPLACE (RESULT, '0c0d0et', '');
        RESULT := REPLACE (RESULT, '0c0d0em', '');
        RESULT := REPLACE (RESULT, '0c0d0eM', '');

        -- «ам≥на прописним словом входженн€ форматованого представленн€ числа
        RESULT := REPLACE (RESULT, '0c', '');
        RESULT := REPLACE (RESULT, '1c', 'сто ');
        RESULT := REPLACE (RESULT, '2c', 'дв≥ст≥ ');
        RESULT := REPLACE (RESULT, '3c', 'триста ');
        RESULT := REPLACE (RESULT, '4c', 'чотириста ');
        RESULT := REPLACE (RESULT, '5c', 'п''€тсот ');
        RESULT := REPLACE (RESULT, '6c', 'ш≥стсот ');
        RESULT := REPLACE (RESULT, '7c', 'с≥мсот ');
        RESULT := REPLACE (RESULT, '8c', 'в≥с≥мсот ');
        RESULT := REPLACE (RESULT, '9c', 'дев''€тсот ');

        --
        RESULT := REPLACE (RESULT, '1d0e', 'дес€ть ');
        RESULT := REPLACE (RESULT, '1d1e', 'одинадц€ть ');
        RESULT := REPLACE (RESULT, '1d2e', 'дванадц€ть ');
        RESULT := REPLACE (RESULT, '1d3e', 'тринадц€ть ');
        RESULT := REPLACE (RESULT, '1d4e', 'чотирнадц€ть ');
        RESULT := REPLACE (RESULT, '1d5e', 'п''€тнадц€ть ');
        RESULT := REPLACE (RESULT, '1d6e', 'ш≥стнадц€ть ');
        RESULT := REPLACE (RESULT, '1d7e', 'с≥мнадц€ть ');
        RESULT := REPLACE (RESULT, '1d8e', 'в≥с≥мнадц€ть ');
        RESULT := REPLACE (RESULT, '1d9e', 'дев''€тнадц€ть ');

        --
        RESULT := REPLACE (RESULT, '0d', '');
        RESULT := REPLACE (RESULT, '2d', 'двадц€ть ');
        RESULT := REPLACE (RESULT, '3d', 'тридц€ть ');
        RESULT := REPLACE (RESULT, '4d', 'сорок ');
        RESULT := REPLACE (RESULT, '5d', 'п''€тдес€т ');
        RESULT := REPLACE (RESULT, '6d', 'ш≥стдес€т ');
        RESULT := REPLACE (RESULT, '7d', 'с≥мдес€т ');
        RESULT := REPLACE (RESULT, '8d', 'в≥с≥мдес€т ');
        RESULT := REPLACE (RESULT, '9d', 'дев''€носто ');

        --
        RESULT := REPLACE (RESULT, '1et', 'одна тис€ча ');
        RESULT := REPLACE (RESULT, '2et', 'дв≥ тис€ч≥ ');
        RESULT := REPLACE (RESULT, '3et', 'три тис€ч≥ ');
        RESULT := REPLACE (RESULT, '4et', 'чотири тис€ч≥ ');
        RESULT := REPLACE (RESULT, '1em', 'один м≥льйон ');
        RESULT := REPLACE (RESULT, '2em', 'два м≥льйона ');
        RESULT := REPLACE (RESULT, '3em', 'три м≥льйона ');
        RESULT := REPLACE (RESULT, '4em', 'чотири м≥льйона ');
        RESULT := REPLACE (RESULT, '1eM', 'один м≥ль€рд ');
        RESULT := REPLACE (RESULT, '2eM', 'два м≥ль€рда ');
        RESULT := REPLACE (RESULT, '3eM', 'три м≥ль€рда ');
        RESULT := REPLACE (RESULT, '4eM', 'чотири м≥ль€рда ');

        --
        RESULT := REPLACE (RESULT, '0et', 't');
        RESULT := REPLACE (RESULT, '0em', 'm');
        RESULT := REPLACE (RESULT, '0eM', 'M');
        RESULT := REPLACE (RESULT, '0er', 'g');

        --
        RESULT := REPLACE (RESULT, '1eg', 'одна ' || p_measure_unit1 || ' ');
        RESULT := REPLACE (RESULT, '2eg', 'дв≥ ' || p_measure_unit2 || ' ');
        RESULT := REPLACE (RESULT, '3eg', 'три ' || p_measure_unit2 || ' ');
        RESULT :=
            REPLACE (RESULT, '4eg', 'чотири ' || p_measure_unit2 || ' ');

        --
        RESULT := REPLACE (RESULT, '0e', '');
        RESULT := REPLACE (RESULT, '1e', 'одна ');
        RESULT := REPLACE (RESULT, '2e', 'дв≥ ');
        RESULT := REPLACE (RESULT, '3e', 'три ');
        RESULT := REPLACE (RESULT, '4e', 'чотири ');
        RESULT := REPLACE (RESULT, '5e', 'п''€ть ');
        RESULT := REPLACE (RESULT, '6e', 'ш≥сть ');
        RESULT := REPLACE (RESULT, '7e', 'с≥м ');
        RESULT := REPLACE (RESULT, '8e', 'в≥с≥м ');
        RESULT := REPLACE (RESULT, '9e', 'дев''€ть ');

        --
        RESULT := REPLACE (RESULT, 't', 'тис€ч ');
        RESULT := REPLACE (RESULT, 'm', 'м≥льйон≥в ');
        RESULT := REPLACE (RESULT, 'M', 'м≥ль€рд≥в ');

        -- одиниц≥ вим≥рюванн€
        RESULT := REPLACE (RESULT, 'g', p_measure_unit3 || ' ');
        RESULT := REPLACE (RESULT, 'k', ' ' || p_fract_measure_unit || ' ');

        IF (SUBSTR (RESULT, 1, LENGTH (p_measure_unit3)) = p_measure_unit3)
        THEN
            RESULT := SUBSTR (RESULT, LENGTH (p_measure_unit3) + 1);
        END IF;

        -- ѕерший символ в верхн≥й рег≥стр
        RETURN (UPPER (SUBSTR (RESULT, 1, 1)) || SUBSTR (RESULT, 2));
    END;

    FUNCTION get_kaot_info (p_kaot_id IN NUMBER)
        RETURN NUMBER
    IS
        l_row   uss_ndi.v_ndi_katottg%ROWTYPE;
    BEGIN
        IF (p_kaot_id IS NULL OR p_kaot_id = 0)
        THEN
            RETURN 1;
        END IF;

        SELECT *
          INTO l_row
          FROM uss_ndi.v_ndi_katottg t
         WHERE t.kaot_id = p_kaot_id;

        IF (l_row.kaot_id = l_row.kaot_kaot_l1)
        THEN
            RETURN 1;
        ELSIF (l_row.kaot_id = l_row.kaot_kaot_l2)
        THEN
            RETURN 2;
        ELSIF (l_row.kaot_id = l_row.kaot_kaot_l3)
        THEN
            RETURN 3;
        ELSIF (l_row.kaot_id = l_row.kaot_kaot_l4)
        THEN
            RETURN 4;
        ELSE
            RETURN 5;
        END IF;
    END;

    PROCEDURE get_kaot_info (p_kaot_id      IN     NUMBER,
                             p_lvl_filter      OUT NUMBER,
                             p_lvl_data        OUT NUMBER,
                             p_lvl_name        OUT VARCHAR2)
    IS
        l_row   uss_ndi.v_ndi_katottg%ROWTYPE;
    BEGIN
        IF (p_kaot_id IS NULL OR p_kaot_id = 0)
        THEN
            p_lvl_filter := 1;
            p_lvl_data := 1;
            p_lvl_name := '”крањна';
            RETURN;
        END IF;

        SELECT *
          INTO l_row
          FROM uss_ndi.v_ndi_katottg t
         WHERE t.kaot_id = p_kaot_id;


        p_lvl_name := '¬сього';

        IF (l_row.kaot_id = l_row.kaot_kaot_l1)
        THEN
            p_lvl_filter := 1;
            p_lvl_data := 2;
            p_lvl_name := l_row.kaot_full_name;
        ELSIF (l_row.kaot_id = l_row.kaot_kaot_l2)
        THEN
            p_lvl_filter := 2;
            p_lvl_data := 3;
            p_lvl_name := l_row.kaot_full_name;
        ELSIF (l_row.kaot_id = l_row.kaot_kaot_l3)
        THEN
            p_lvl_filter := 3;
            p_lvl_data := 3;
        ELSIF (l_row.kaot_id = l_row.kaot_kaot_l4)
        THEN
            p_lvl_filter := 4;
            p_lvl_data := 4;
        ELSE
            p_lvl_filter := 5;
            p_lvl_data := 5;
        END IF;

        IF (l_row.kaot_tp = 'K')
        THEN
            p_lvl_filter := 1;
            p_lvl_data := 5;
        END IF;
    END;

    FUNCTION NEED_CONS_R1 (p_rt_id    IN NUMBER,
                           p_dt       IN DATE,
                           p_org_id   IN NUMBER,
                           p_npc_id   IN NUMBER)
        RETURN DECIMAL
    IS
        l_jbr_id   NUMBER;
        l_dt       DATE := TRUNC (p_dt, 'MM');
    BEGIN
        l_jbr_id := RDM$RTFL.InitReport (p_rt_id);
        --raise_application_error(-20000, p_dt || ';' || p_org_id || ';' || p_npc_id);

        RDM$RTFL.AddDataSet (
            l_jbr_id,
            'ds',
               'SELECT '
            || CASE
                   WHEN p_org_id = 0 THEN 'po.org_name'
                   ELSE 'p.org_name'
               END
            || ' as org_name,
              to_char(SUM(t.pe_sum), ''FM9G999G999G999G999G990D00'', ''NLS_NUMERIC_CHARACTERS='''','''''''''')  AS SUM,
              to_char(SUM(CASE WHEN t.pe_pay_tp = ''2'' THEN t.pe_sum END), ''FM9G999G999G999G999G990D00'', ''NLS_NUMERIC_CHARACTERS='''','''''''''')  AS sum_bank,
              to_char(SUM(CASE WHEN t.pe_pay_tp = ''1'' THEN t.pe_sum END), ''FM9G999G999G999G999G990D00'', ''NLS_NUMERIC_CHARACTERS='''','''''''''')  AS sum_mail,
              SUM(t.pe_row_cnt) AS qnt,
              row_number() OVER (ORDER BY '
            || CASE WHEN p_org_id = 0 THEN 'po.org_id' ELSE 'p.org_id' END
            || ') AS rn
         FROM uss_esr.v_payroll_reestr t
         JOIN uss_esr.v_opfu p ON (p.org_id = t.com_org)
         LEFT JOIN uss_esr.v_opfu po ON (po.org_id = DECODE(p.org_to, 1, p.org_id, 2, p.org_id, NULL, p.org_id, p.org_org))
        WHERE 1 = 1
          and t.pe_po is null
          '
            || CASE
                   WHEN p_npc_id IS NOT NULL
                   THEN
                       'and t.pe_npc = ' || p_npc_id
               END
            || '
          '
            || CASE
                   WHEN p_org_id != 0 THEN ' and po.org_id = ' || p_org_id
               END
            || '
         AND t.pe_pay_dt between to_date('''
            || TO_CHAR (l_dt, 'DD.MM.YYYY')
            || ''', ''DD.MM.YYYY'')
                                 and to_date('''
            || TO_CHAR (p_dt, 'DD.MM.YYYY')
            || ''', ''DD.MM.YYYY'')
       group by '
            || CASE
                   WHEN p_org_id = 0 THEN 'po.org_name, po.org_id'
                   ELSE 'p.org_name, p.org_id'
               END);

        RDM$RTFL.AddDataSet (
            l_jbr_id,
            'ds_summary',
               'SELECT to_char(SUM(t.pe_sum), ''FM9G999G999G999G999G990D00'', ''NLS_NUMERIC_CHARACTERS='''','''''''''')  AS SUM,
              to_char(SUM(CASE WHEN t.pe_pay_tp = ''2'' THEN t.pe_sum END), ''FM9G999G999G999G999G990D00'', ''NLS_NUMERIC_CHARACTERS='''','''''''''')  AS sum_bank,
              to_char(SUM(CASE WHEN t.pe_pay_tp = ''1'' THEN t.pe_sum END), ''FM9G999G999G999G999G990D00'', ''NLS_NUMERIC_CHARACTERS='''','''''''''')  AS sum_mail,
              SUM(t.pe_row_cnt) AS qnt
         FROM uss_esr.v_payroll_reestr t
         JOIN uss_esr.v_opfu p ON (p.org_id = t.com_org)
         LEFT JOIN uss_esr.v_opfu po ON (po.org_id = DECODE(p.org_to, 1, p.org_id, 2, p.org_id, NULL, p.org_id, p.org_org))
        WHERE 1 = 1
          and t.pe_po is null
          '
            || CASE
                   WHEN p_npc_id IS NOT NULL
                   THEN
                       'and t.pe_npc = ' || p_npc_id
               END
            || '
          '
            || CASE
                   WHEN p_org_id != 0 THEN ' and po.org_id = ' || p_org_id
               END
            || '
         AND t.pe_pay_dt between to_date('''
            || TO_CHAR (l_dt, 'DD.MM.YYYY')
            || ''', ''DD.MM.YYYY'')
                                 and to_date('''
            || TO_CHAR (p_dt, 'DD.MM.YYYY')
            || ''', ''DD.MM.YYYY'') ');


        -- constants
        FOR xx
            IN (SELECT z.npc_code || ' ' || z.npc_name    AS code,
                       CASE
                           WHEN p_org_id != 0 THEN p.org_name
                           ELSE '«ведена'
                       END                                AS org_name
                  FROM DUAL
                       LEFT JOIN uss_ndi.v_ndi_payment_codes z
                           ON (z.npc_id = p_npc_id)
                       LEFT JOIN v_opfu p ON (p.org_id = p_org_id)
                 WHERE 1 = 1)
        LOOP
            RDM$RTFL.AddParam (l_jbr_id, 'nst_name', xx.code);
            RDM$RTFL.AddParam (l_jbr_id, 'obl_name', xx.org_name);
        END LOOP;

        RDM$RTFL.AddParam (l_jbr_id, 'dt', TO_CHAR (p_dt, 'DD.MM.YYYY'));
        RDM$RTFL.AddParam (l_jbr_id, 'c_gen_pib', tools.GetCurrUserPIB);
        RDM$RTFL.AddParam (l_jbr_id,
                           'c_gen_dt',
                           TO_CHAR (SYSDATE, 'DD.MM.YYYY HH24:MI:SS'));

        RDM$RTFL.PutReportToWorkingQueue (l_jbr_id);
        RETURN l_jbr_id;
    END;

    FUNCTION SOC_HELP_R1 (p_rt_id      IN NUMBER,
                          p_start_dt   IN DATE,
                          p_stop_dt    IN DATE,
                          p_org_id     IN NUMBER)
        RETURN DECIMAL
    IS
        l_jbr_id   NUMBER;
    BEGIN
        l_jbr_id := RDM$RTFL.InitReport (p_rt_id);

        RDM$RTFL.AddDataSet (
            l_jbr_id,
            'ds',
               'select t.nst_name,
              t.qnt,
              t.pay_qnt,
              to_char(t.sum, ''FM9G999G999G999G999G990D00'', ''NLS_NUMERIC_CHARACTERS='''','''''''''') as sum,
              case when t.pay_qnt != 0 then to_char(t.sum / t.pay_qnt, ''FM9G999G999G999G999G990D00'', ''NLS_NUMERIC_CHARACTERS='''','''''''''')  end as avg_help
         FROM (select st.nst_code || '' '' || st.nst_name as nst_name,
                      SUM(t.pe_row_cnt ) AS qnt,
                      SUM(CASE WHEN EXISTS (SELECT * FROM uss_esr.v_pay_order p WHERE p.po_id = t.pe_po AND p.po_st = ''APPR'') THEN t.pe_row_cnt END) AS pay_qnt,
                      SUM(CASE WHEN EXISTS (SELECT * FROM uss_esr.v_pay_order p WHERE p.po_id = t.pe_po AND p.po_st = ''APPR'') THEN t.pe_sum END) AS sum,
                      row_number() OVER (ORDER BY st.nst_code || '' '' || st.nst_name) AS rn
                 FROM uss_esr.v_payroll_reestr t
                 join uss_ndi.v_ndi_payment_codes pc on (pc.npc_id = t.pe_npc)
                 join uss_ndi.v_ndi_payment_type pt on (pt.npt_npc = pc.npc_id)
                 join uss_ndi.v_ndi_npt_config nc on (nc.nptc_npt = pt.npt_id)
                 JOIN uss_ndi.v_ndi_service_type st ON (st.nst_id = nc.nptc_nst)
                 JOIN uss_esr.v_opfu p ON (p.org_id = t.com_org)
                 LEFT JOIN uss_esr.v_opfu po ON (po.org_id = DECODE(p.org_to, 1, p.org_id, 2, p.org_id, NULL, p.org_id, p.org_org))
                WHERE 1 = 1
                 '
            || CASE
                   WHEN p_org_id != 0 THEN ' and po.org_id = ' || p_org_id
               END
            || '
                 AND t.pe_pay_dt between to_date('''
            || TO_CHAR (p_start_dt, 'DD.MM.YYYY')
            || ''', ''DD.MM.YYYY'')
                                     and to_date('''
            || TO_CHAR (p_stop_dt, 'DD.MM.YYYY')
            || ''', ''DD.MM.YYYY'')
               group by st.nst_code || '' '' || st.nst_name ) t');

        RDM$RTFL.AddDataSet (
            l_jbr_id,
            'ds_summary',
               'select t.qnt,
              t.pay_qnt,
              to_char(t.sum, ''FM9G999G999G999G999G990D00'', ''NLS_NUMERIC_CHARACTERS='''','''''''''') as sum,
              case when t.pay_qnt != 0 then to_char(t.sum / t.pay_qnt, ''FM9G999G999G999G999G990D00'', ''NLS_NUMERIC_CHARACTERS='''','''''''''') end as avg_help
         FROM (select SUM(t.pe_row_cnt) AS qnt,
                      SUM(CASE WHEN EXISTS (SELECT * FROM uss_esr.v_pay_order p WHERE p.po_id = t.pe_po AND p.po_st = ''APPR'') THEN t.pe_row_cnt END) AS pay_qnt,
                      SUM(CASE WHEN EXISTS (SELECT * FROM uss_esr.v_pay_order p WHERE p.po_id = t.pe_po AND p.po_st = ''APPR'') THEN t.pe_sum END) AS sum
                 FROM uss_esr.v_payroll_reestr t
                 join uss_ndi.v_ndi_payment_codes pc on (pc.npc_id = t.pe_npc)
                 join uss_ndi.v_ndi_payment_type pt on (pt.npt_npc = pc.npc_id)
                 join uss_ndi.v_ndi_npt_config nc on (nc.nptc_npt = pt.npt_id)
                 JOIN uss_ndi.v_ndi_service_type st ON (st.nst_id = nc.nptc_nst)
                 JOIN uss_esr.v_opfu p ON (p.org_id = t.com_org)
                 LEFT JOIN uss_esr.v_opfu po ON (po.org_id = DECODE(p.org_to, 1, p.org_id, 2, p.org_id, NULL, p.org_id, p.org_org))
                WHERE 1 = 1
                 '
            || CASE
                   WHEN p_org_id != 0 THEN ' and po.org_id = ' || p_org_id
               END
            || '
                 AND t.pe_pay_dt between to_date('''
            || TO_CHAR (p_start_dt, 'DD.MM.YYYY')
            || ''', ''DD.MM.YYYY'')
                                     and to_date('''
            || TO_CHAR (p_stop_dt, 'DD.MM.YYYY')
            || ''', ''DD.MM.YYYY'') ) t');


        -- constants
        FOR xx IN (SELECT (SELECT z.org_name
                             FROM uss_esr.v_opfu z
                            WHERE z.org_id = p_org_id)    AS region
                     FROM DUAL)
        LOOP
            RDM$RTFL.AddParam (
                l_jbr_id,
                'region',
                CASE WHEN p_org_id = 0 THEN '«ведений' ELSE xx.region END);
        END LOOP;

        RDM$RTFL.AddParam (l_jbr_id,
                           'start_dt',
                           TO_CHAR (p_start_dt, 'DD.MM.YYYY'));
        RDM$RTFL.AddParam (l_jbr_id,
                           'stop_dt',
                           TO_CHAR (p_stop_dt, 'DD.MM.YYYY'));
        RDM$RTFL.AddParam (l_jbr_id,
                           'c_gen_dt',
                           TO_CHAR (SYSDATE, 'DD.MM.YYYY HH24:MI:SS'));


        RDM$RTFL.PutReportToWorkingQueue (l_jbr_id);
        RETURN l_jbr_id;
    END;

    -- ёр зобов`€занн€ #74145 --kolio
    FUNCTION LEG_OBLIG_R1 (p_ids     IN VARCHAR2,
                           p_rt_id   IN rpt_templates.rt_id%TYPE)
        RETURN DECIMAL
    IS
        ctoid                 NUMBER; --первое зобов€занн€ дл€ выт€гивани€ из него данных дл€ шапки
        l_jbr_id              NUMBER;
        one_obligation        obligation%ROWTYPE;
        l_dpp_name            VARCHAR2 (250);
        l_dpp_tax_code        VARCHAR2 (14);
        l_odksu               VARCHAR2 (4);
        l_acs_dpp_dksu        NUMBER;
        l_nbu_code            VARCHAR2 (30);
        l_nbu_name            VARCHAR2 (255);
        l_acs_kvk_code        VARCHAR2 (3);
        l_acs_kvk_name        VARCHAR2 (255);
        l_acs_dpp_dksu_name   VARCHAR2 (255);
        l_acs_adm_code        VARCHAR2 (50);
        l_acs_adm_level       VARCHAR2 (10);
        l_nbg_kpk_code        VARCHAR2 (10);
        l_nbg_name            VARCHAR2 (250);
        l_nfs_tp              VARCHAR2 (1);
        l_nfs_tp_name         VARCHAR2 (250);
        l_acs_fnc_bt_check    VARCHAR2 (250);
        l_acs_fnc_bt_allow    VARCHAR2 (250);

        p_cto_reestr_num      obligation.cto_reestr_num%TYPE;
        p_cto_reestr_dt       obligation.cto_reestr_dt%TYPE;
        p_cto_reestr_num2     obligation.cto_reestr_num%TYPE;
        p_cto_reestr_dt2      obligation.cto_reestr_dt%TYPE;
    BEGIN
        --провер€ем чтобы номера и даты реестра совпадали у всех выбранных зобов€зань
        p_cto_reestr_num2 := NULL;
        p_cto_reestr_dt2 := NULL;

        FOR id IN (    SELECT REGEXP_SUBSTR (text,
                                             '[^(\,)]+',
                                             1,
                                             LEVEL)    AS cto
                         FROM (SELECT p_ids AS text FROM DUAL)
                   CONNECT BY LENGTH (REGEXP_SUBSTR (text,
                                                     '[^(\,)]+',
                                                     1,
                                                     LEVEL)) > 0)
        LOOP
            SELECT cto_reestr_num, cto_reestr_dt
              INTO p_cto_reestr_num, p_cto_reestr_dt
              FROM obligation
             WHERE cto_id = id.cto AND com_org = tools.getcurrorg;

            IF p_cto_reestr_num2 IS NULL
            THEN
                p_cto_reestr_num2 := p_cto_reestr_num;
            END IF;

            IF p_cto_reestr_dt2 IS NULL
            THEN
                p_cto_reestr_dt2 := p_cto_reestr_dt;
            END IF;

            IF p_cto_reestr_num <> p_cto_reestr_num2
            THEN
                raise_application_error (
                    -20000,
                    'Ќомери реЇстру вс≥х обраних зобов`€зань повинн≥ бути однаков≥!');
                EXIT;
            END IF;

            IF p_cto_reestr_dt <> p_cto_reestr_dt2
            THEN
                raise_application_error (
                    -20000,
                    'ƒати реЇстру вс≥х обраних зобов`€зань повинн≥ бути однаков≥!');
                EXIT;
            END IF;
        END LOOP;

        l_jbr_id := RDM$RTFL.InitReport (p_rt_id => p_rt_id);

            SELECT REGEXP_SUBSTR (text,
                                  '[^(\,)]+',
                                  1,
                                  LEVEL)    AS cto
              INTO ctoid
              FROM (SELECT p_ids AS text FROM DUAL)
        CONNECT BY LENGTH (REGEXP_SUBSTR (text,
                                          '[^(\,)]+',
                                          1,
                                          LEVEL)) > 0
             FETCH FIRST 1 ROWS ONLY;

        SELECT *
          INTO one_obligation
          FROM obligation
         WHERE cto_id = ctoid;

        --є
        RDM$RTFL.AddParam (l_jbr_id,
                           'c_reg_num',
                           one_obligation.cto_reestr_num);
        --в≥д
        RDM$RTFL.AddParam (
            l_jbr_id,
            'c_reg_dt',
               TO_CHAR (one_obligation.cto_reestr_dt, 'DD')
            || ' '
            || CASE TO_CHAR (one_obligation.cto_reestr_dt, 'MM')
                   WHEN '01' THEN 'с≥чн€'
                   WHEN '02' THEN 'лютого'
                   WHEN '03' THEN 'березн€'
                   WHEN '04' THEN 'кв≥тн€'
                   WHEN '05' THEN 'травн€'
                   WHEN '06' THEN 'червн€'
                   WHEN '07' THEN 'липн€'
                   WHEN '08' THEN 'серпн€'
                   WHEN '09' THEN 'вересн€'
                   WHEN '10' THEN 'жовтн€'
                   WHEN '11' THEN 'листопада'
                   WHEN '12' THEN 'грудн€'
               END
            || ' '
            || TO_CHAR (one_obligation.cto_reestr_dt, 'YYYY'));

        --сборна€ сол€нка данных дл€ шаблона
        SELECT acs_province_code || acs_dksu_code,
               acs_dpp_dksu,
               acs_kvk_code,
               acs_kvk_name,
               acs_adm_code,
               acs_adm_level,
               (SELECT fnc_fn || ' ' || UPPER (fnc_ln)
                  FROM uss_ndi.V_NDI_FUNCTIONARY
                 WHERE fnc_id = acs_fnc_bt_check),
               (SELECT fnc_fn || ' ' || UPPER (fnc_ln)
                  FROM uss_ndi.V_NDI_FUNCTIONARY
                 WHERE fnc_id = acs_fnc_bt_allow)
          INTO l_odksu,
               l_acs_dpp_dksu,
               l_acs_kvk_code,
               l_acs_kvk_name,
               l_acs_adm_code,
               l_acs_adm_level,
               l_acs_fnc_bt_check,
               l_acs_fnc_bt_allow
          FROM USS_NDI.v_Ndi_Acc_Setup
         WHERE com_org = tools.getcurrorg;

        -- од за ™ƒ–ѕќ” кл≥Їнта
        SELECT dpp_tax_code
          INTO l_dpp_tax_code
          FROM USS_NDI.v_NDI_PAY_PERSON
         WHERE dpp_tp = 'OSZN' AND dpp_org = tools.getcurrorg;

        RDM$RTFL.AddParam (l_jbr_id,
                           'c1_1',
                           SUBSTR (LPAD (l_dpp_tax_code, 10, ' '), 1, 1));
        RDM$RTFL.AddParam (l_jbr_id,
                           'c1_2',
                           SUBSTR (LPAD (l_dpp_tax_code, 10, ' '), 2, 1));
        RDM$RTFL.AddParam (l_jbr_id,
                           'c1_3',
                           SUBSTR (LPAD (l_dpp_tax_code, 10, ' '), 3, 1));
        RDM$RTFL.AddParam (l_jbr_id,
                           'c1_4',
                           SUBSTR (LPAD (l_dpp_tax_code, 10, ' '), 4, 1));
        RDM$RTFL.AddParam (l_jbr_id,
                           'c1_5',
                           SUBSTR (LPAD (l_dpp_tax_code, 10, ' '), 5, 1));
        RDM$RTFL.AddParam (l_jbr_id,
                           'c1_6',
                           SUBSTR (LPAD (l_dpp_tax_code, 10, ' '), 6, 1));
        RDM$RTFL.AddParam (l_jbr_id,
                           'c1_7',
                           SUBSTR (LPAD (l_dpp_tax_code, 10, ' '), 7, 1));
        RDM$RTFL.AddParam (l_jbr_id,
                           'c1_8',
                           SUBSTR (LPAD (l_dpp_tax_code, 10, ' '), 8, 1));
        RDM$RTFL.AddParam (l_jbr_id,
                           'c1_9',
                           SUBSTR (LPAD (l_dpp_tax_code, 10, ' '), 9, 1));
        RDM$RTFL.AddParam (l_jbr_id,
                           'c1_10',
                           SUBSTR (LPAD (l_dpp_tax_code, 10, ' '), 10, 1));

        -- л≥Їнт
        SELECT MAX (dpp_name)
          INTO l_dpp_name
          FROM USS_NDI.v_NDI_PAY_PERSON
         WHERE dpp_tp = 'OSZN' AND dpp_org = tools.getcurrorg;

        RDM$RTFL.AddParam (l_jbr_id, 'c_ca_name', l_dpp_name);
        --ќƒ —” код
        RDM$RTFL.AddParam (l_jbr_id, 'c2_1', SUBSTR (l_odksu, 1, 1));
        RDM$RTFL.AddParam (l_jbr_id, 'c2_2', SUBSTR (l_odksu, 2, 1));
        RDM$RTFL.AddParam (l_jbr_id, 'c2_3', SUBSTR (l_odksu, 3, 1));
        RDM$RTFL.AddParam (l_jbr_id, 'c2_4', SUBSTR (l_odksu, 4, 1));

        --ќƒ —” назва
        SELECT MAX (dpp_sname)
          INTO l_acs_dpp_dksu_name
          FROM USS_NDI.v_ndi_pay_person
         WHERE dpp_id = l_acs_dpp_dksu;

        RDM$RTFL.AddParam (l_jbr_id, 'c_odksu_name', l_acs_dpp_dksu_name);

        --Ѕюджет код
        SELECT b.nbu_code, b.nbu_name
          INTO l_nbu_code, l_nbu_name
          FROM USS_NDI.V_NDI_FUNDING_SOURCE  f
               JOIN USS_NDI.v_Ndi_Budget b ON f.nfs_nbu = b.nbu_id
         WHERE f.nfs_id = one_obligation.cto_nfs;

        RDM$RTFL.AddParam (l_jbr_id, 'c3_1', SUBSTR (l_nbu_code, 1, 1));
        RDM$RTFL.AddParam (l_jbr_id, 'c3_2', SUBSTR (l_nbu_code, 2, 1));
        RDM$RTFL.AddParam (l_jbr_id, 'c3_3', SUBSTR (l_nbu_code, 3, 1));
        RDM$RTFL.AddParam (l_jbr_id, 'c3_4', SUBSTR (l_nbu_code, 4, 1));
        RDM$RTFL.AddParam (l_jbr_id, 'c3_5', SUBSTR (l_nbu_code, 5, 1));
        RDM$RTFL.AddParam (l_jbr_id, 'c3_6', SUBSTR (l_nbu_code, 6, 1));
        RDM$RTFL.AddParam (l_jbr_id, 'c3_7', SUBSTR (l_nbu_code, 7, 1));
        RDM$RTFL.AddParam (l_jbr_id, 'c3_8', SUBSTR (l_nbu_code, 8, 1));
        RDM$RTFL.AddParam (l_jbr_id, 'c3_9', SUBSTR (l_nbu_code, 9, 1));
        RDM$RTFL.AddParam (l_jbr_id, 'c3_10', SUBSTR (l_nbu_code, 10, 1));
        --Ѕюджет назва
        RDM$RTFL.AddParam (l_jbr_id, 'c_budg_name', l_nbu_name);
        -- ¬  код
        RDM$RTFL.AddParam (l_jbr_id, 'c4_1', SUBSTR (l_acs_kvk_code, 1, 1));
        RDM$RTFL.AddParam (l_jbr_id, 'c4_2', SUBSTR (l_acs_kvk_code, 2, 1));
        RDM$RTFL.AddParam (l_jbr_id, 'c4_3', SUBSTR (l_acs_kvk_code, 3, 1));
        -- ¬  назва
        RDM$RTFL.AddParam (l_jbr_id, 'c_nkvk_name', l_acs_kvk_name);
        -- од розпор€дника
        RDM$RTFL.AddParam (l_jbr_id, 'c5_1', SUBSTR (l_acs_adm_code, 1, 1));
        RDM$RTFL.AddParam (l_jbr_id, 'c5_2', SUBSTR (l_acs_adm_code, 2, 1));
        RDM$RTFL.AddParam (l_jbr_id, 'c5_3', SUBSTR (l_acs_adm_code, 3, 1));
        RDM$RTFL.AddParam (l_jbr_id, 'c5_4', SUBSTR (l_acs_adm_code, 4, 1));
        RDM$RTFL.AddParam (l_jbr_id, 'c5_5', SUBSTR (l_acs_adm_code, 5, 1));
        RDM$RTFL.AddParam (l_jbr_id, 'c5_6', SUBSTR (l_acs_adm_code, 6, 1));
        --–≥вень  розпор€дника
        RDM$RTFL.AddParam (l_jbr_id, 'c9', SUBSTR (l_acs_adm_level, 1, 1));

        -- ѕ ¬ / “ ¬ћЅ код
        SELECT b.nbg_kpk_code, b.nbg_name
          INTO l_nbg_kpk_code, l_nbg_name
          FROM USS_NDI.V_NDI_FUNDING_SOURCE  f
               JOIN USS_NDI.v_Ndi_Budget_Program b ON f.nfs_nbg = b.nbg_id
         WHERE f.nfs_id = one_obligation.cto_nfs;

        RDM$RTFL.AddParam (l_jbr_id, 'c6_1', SUBSTR (l_nbg_kpk_code, 1, 1));
        RDM$RTFL.AddParam (l_jbr_id, 'c6_2', SUBSTR (l_nbg_kpk_code, 2, 1));
        RDM$RTFL.AddParam (l_jbr_id, 'c6_3', SUBSTR (l_nbg_kpk_code, 3, 1));
        RDM$RTFL.AddParam (l_jbr_id, 'c6_4', SUBSTR (l_nbg_kpk_code, 4, 1));
        RDM$RTFL.AddParam (l_jbr_id, 'c6_5', SUBSTR (l_nbg_kpk_code, 5, 1));
        RDM$RTFL.AddParam (l_jbr_id, 'c6_6', SUBSTR (l_nbg_kpk_code, 6, 1));
        RDM$RTFL.AddParam (l_jbr_id, 'c6_7', SUBSTR (l_nbg_kpk_code, 7, 1));
        -- ѕ ¬ / “ ¬ћЅ назва
        RDM$RTFL.AddParam (l_jbr_id, 'c_kpkvk', l_nbg_name);

        --‘онд код
        SELECT TO_CHAR (dic_srtordr), dic_name
          INTO l_nfs_tp, l_nfs_tp_name
          FROM USS_NDI.V_NDI_FUNDING_SOURCE  f
               JOIN USS_NDI.v_ddn_nfs_tp ON nfs_id = one_obligation.cto_nfs
         WHERE f.nfs_tp = dic_value;

        RDM$RTFL.AddParam (l_jbr_id, 'c7_1', '0');
        RDM$RTFL.AddParam (l_jbr_id, 'c7_2', SUBSTR (l_nfs_tp, 1, 1));
        --‘онд назва
        RDM$RTFL.AddParam (l_jbr_id, 'c_fond_name', l_nfs_tp_name);
        --ƒан≥ бюджетних зобовТ€зань
        rdm$rtfl.AddDataSet (
            l_jbr_id,
            'ds',
               'SELECT to_char(t.cto_dt, ''DD.MM.YYYY'') AS doc_dt,
               t.cto_num AS doc_num,
               to_char(t.cto_sum, ''FM9G999G999G999G999G990D00'', ''NLS_NUMERIC_CHARACTERS='''','''''''''') AS summ,
               ''0,00'' AS lst_sum,
               substr(k.nkv_code, 1, 1) AS k_1,
               substr(k.nkv_code, 2, 1) AS k_2,
               substr(k.nkv_code, 3, 1) AS k_3,
               substr(k.nkv_code, 4, 1) AS k_4,
               to_char(CASE WHEN t.cto_term_dt IS NULL THEN t.cto_dt + 14 ELSE t.cto_term_dt END, ''DD.MM.YYYY'') as ctr_per,
               ''00'' AS info,
               t.cto_ess_conditions AS other,
               row_number() over (order by t.cto_id) as rn
          FROM uss_esr.v_obligation t
          LEFT JOIN uss_ndi.v_ndi_kekv k ON (k.nkv_id = t.cto_nkv)
         WHERE t.cto_id IN ('
            || p_ids
            || ')
           and t.cto_st = ''AP''
           AND t.cto_reestr_num = '''
            || one_obligation.cto_reestr_num
            || '''
           AND t.cto_nfs = '
            || COALESCE (one_obligation.cto_nfs, -1));
        --√оловний бухгалтер
        RDM$RTFL.AddParam (l_jbr_id, 'c_buch_pib', l_acs_fnc_bt_allow);
        --¬иконавець
        RDM$RTFL.AddParam (l_jbr_id, 'c_curr_user_pib', l_acs_fnc_bt_check);

        RDM$RTFL.PutReportToWorkingQueue (p_jbr_id => l_jbr_id);
        RETURN l_jbr_id;
    END;

    -- ‘≥н зобов`€занн€ #74740 --kolio
    FUNCTION FIN_OBLIG_R1 (p_ids     IN VARCHAR2,
                           p_rt_id   IN rpt_templates.rt_id%TYPE)
        RETURN DECIMAL
    IS
        ctoid                 NUMBER; --первое зобов€занн€ дл€ выт€гивани€ из него данных дл€ шапки
        l_jbr_id              NUMBER;
        one_obligation        obligation%ROWTYPE;
        l_dpp_name            VARCHAR2 (250);
        l_dpp_tax_code        VARCHAR2 (14);
        l_odksu               VARCHAR2 (4);
        l_acs_dpp_dksu        NUMBER;
        l_nbu_code            VARCHAR2 (30);
        l_nbu_name            VARCHAR2 (255);
        l_acs_kvk_code        VARCHAR2 (3);
        l_acs_kvk_name        VARCHAR2 (255);
        l_acs_dpp_dksu_name   VARCHAR2 (255);
        l_acs_adm_code        VARCHAR2 (50);
        l_acs_adm_level       VARCHAR2 (10);
        l_nbg_kpk_code        VARCHAR2 (10);
        l_nbg_name            VARCHAR2 (250);
        l_nfs_tp              VARCHAR2 (1);
        l_nfs_tp_name         VARCHAR2 (250);
        l_acs_fnc_bt_check    VARCHAR2 (250);
        l_acs_fnc_bt_allow    VARCHAR2 (250);

        p_cto_reestr_num      obligation.cto_reestr_num%TYPE;
        p_cto_reestr_dt       obligation.cto_reestr_dt%TYPE;
        p_cto_reestr_num2     obligation.cto_reestr_num%TYPE;
        p_cto_reestr_dt2      obligation.cto_reestr_dt%TYPE;
    BEGIN
        --провер€ем чтобы номера и даты реестра совпадали у всех выбранных зобов€зань
        p_cto_reestr_num2 := NULL;
        p_cto_reestr_dt2 := NULL;

        FOR id IN (    SELECT REGEXP_SUBSTR (text,
                                             '[^(\,)]+',
                                             1,
                                             LEVEL)    AS cto
                         FROM (SELECT p_ids AS text FROM DUAL)
                   CONNECT BY LENGTH (REGEXP_SUBSTR (text,
                                                     '[^(\,)]+',
                                                     1,
                                                     LEVEL)) > 0)
        LOOP
            SELECT cto_reestr_num, cto_reestr_dt
              INTO p_cto_reestr_num, p_cto_reestr_dt
              FROM obligation
             WHERE cto_id = id.cto AND com_org = tools.getcurrorg;

            IF p_cto_reestr_num2 IS NULL
            THEN
                p_cto_reestr_num2 := p_cto_reestr_num;
            END IF;

            IF p_cto_reestr_dt2 IS NULL
            THEN
                p_cto_reestr_dt2 := p_cto_reestr_dt;
            END IF;

            IF p_cto_reestr_num <> p_cto_reestr_num2
            THEN
                raise_application_error (
                    -20000,
                    'Ќомери реЇстру вс≥х обраних зобов`€зань повинн≥ бути однаков≥!');
                EXIT;
            END IF;

            IF p_cto_reestr_dt <> p_cto_reestr_dt2
            THEN
                raise_application_error (
                    -20000,
                    'ƒати реЇстру вс≥х обраних зобов`€зань повинн≥ бути однаков≥!');
                EXIT;
            END IF;
        END LOOP;

        l_jbr_id := RDM$RTFL.InitReport (p_rt_id => p_rt_id);

            SELECT REGEXP_SUBSTR (text,
                                  '[^(\,)]+',
                                  1,
                                  LEVEL)    AS cto
              INTO ctoid
              FROM (SELECT p_ids AS text FROM DUAL)
        CONNECT BY LENGTH (REGEXP_SUBSTR (text,
                                          '[^(\,)]+',
                                          1,
                                          LEVEL)) > 0
             FETCH FIRST 1 ROWS ONLY;

        SELECT *
          INTO one_obligation
          FROM obligation
         WHERE cto_id = ctoid;

        --є
        RDM$RTFL.AddParam (l_jbr_id,
                           'c_reg_num',
                           one_obligation.cto_reestr_num);
        --в≥д
        RDM$RTFL.AddParam (
            l_jbr_id,
            'c_reg_dt',
               TO_CHAR (one_obligation.cto_reestr_dt, 'DD')
            || ' '
            || CASE TO_CHAR (one_obligation.cto_reestr_dt, 'MM')
                   WHEN '01' THEN 'с≥чн€'
                   WHEN '02' THEN 'лютого'
                   WHEN '03' THEN 'березн€'
                   WHEN '04' THEN 'кв≥тн€'
                   WHEN '05' THEN 'травн€'
                   WHEN '06' THEN 'червн€'
                   WHEN '07' THEN 'липн€'
                   WHEN '08' THEN 'серпн€'
                   WHEN '09' THEN 'вересн€'
                   WHEN '10' THEN 'жовтн€'
                   WHEN '11' THEN 'листопада'
                   WHEN '12' THEN 'грудн€'
               END
            || ' '
            || TO_CHAR (one_obligation.cto_reestr_dt, 'YYYY'));

        --сборна€ сол€нка данных дл€ шаблона
        SELECT acs_province_code || acs_dksu_code,
               acs_dpp_dksu,
               acs_kvk_code,
               acs_kvk_name,
               acs_adm_code,
               acs_adm_level,
               (SELECT fnc_fn || ' ' || UPPER (fnc_ln)
                  FROM uss_ndi.V_NDI_FUNCTIONARY
                 WHERE fnc_id = acs_fnc_bt_check),
               (SELECT fnc_fn || ' ' || UPPER (fnc_ln)
                  FROM uss_ndi.V_NDI_FUNCTIONARY
                 WHERE fnc_id = acs_fnc_bt_allow)
          INTO l_odksu,
               l_acs_dpp_dksu,
               l_acs_kvk_code,
               l_acs_kvk_name,
               l_acs_adm_code,
               l_acs_adm_level,
               l_acs_fnc_bt_check,
               l_acs_fnc_bt_allow
          FROM USS_NDI.v_Ndi_Acc_Setup
         WHERE com_org = tools.getcurrorg;

        -- од за ™ƒ–ѕќ” кл≥Їнта
        SELECT dpp_tax_code
          INTO l_dpp_tax_code
          FROM USS_NDI.v_NDI_PAY_PERSON
         WHERE dpp_tp = 'OSZN' AND dpp_org = tools.getcurrorg;

        RDM$RTFL.AddParam (l_jbr_id,
                           'c1_1',
                           SUBSTR (LPAD (l_dpp_tax_code, 10, ' '), 1, 1));
        RDM$RTFL.AddParam (l_jbr_id,
                           'c1_2',
                           SUBSTR (LPAD (l_dpp_tax_code, 10, ' '), 2, 1));
        RDM$RTFL.AddParam (l_jbr_id,
                           'c1_3',
                           SUBSTR (LPAD (l_dpp_tax_code, 10, ' '), 3, 1));
        RDM$RTFL.AddParam (l_jbr_id,
                           'c1_4',
                           SUBSTR (LPAD (l_dpp_tax_code, 10, ' '), 4, 1));
        RDM$RTFL.AddParam (l_jbr_id,
                           'c1_5',
                           SUBSTR (LPAD (l_dpp_tax_code, 10, ' '), 5, 1));
        RDM$RTFL.AddParam (l_jbr_id,
                           'c1_6',
                           SUBSTR (LPAD (l_dpp_tax_code, 10, ' '), 6, 1));
        RDM$RTFL.AddParam (l_jbr_id,
                           'c1_7',
                           SUBSTR (LPAD (l_dpp_tax_code, 10, ' '), 7, 1));
        RDM$RTFL.AddParam (l_jbr_id,
                           'c1_8',
                           SUBSTR (LPAD (l_dpp_tax_code, 10, ' '), 8, 1));
        RDM$RTFL.AddParam (l_jbr_id,
                           'c1_9',
                           SUBSTR (LPAD (l_dpp_tax_code, 10, ' '), 9, 1));
        RDM$RTFL.AddParam (l_jbr_id,
                           'c1_10',
                           SUBSTR (LPAD (l_dpp_tax_code, 10, ' '), 10, 1));

        -- л≥Їнт
        SELECT MAX (dpp_name)
          INTO l_dpp_name
          FROM USS_NDI.v_NDI_PAY_PERSON
         WHERE dpp_tp = 'OSZN' AND dpp_org = tools.getcurrorg;

        RDM$RTFL.AddParam (l_jbr_id, 'c_ca_name', l_dpp_name);
        --ќƒ —” код
        RDM$RTFL.AddParam (l_jbr_id, 'c2_1', SUBSTR (l_odksu, 1, 1));
        RDM$RTFL.AddParam (l_jbr_id, 'c2_2', SUBSTR (l_odksu, 2, 1));
        RDM$RTFL.AddParam (l_jbr_id, 'c2_3', SUBSTR (l_odksu, 3, 1));
        RDM$RTFL.AddParam (l_jbr_id, 'c2_4', SUBSTR (l_odksu, 4, 1));

        --ќƒ —” назва
        SELECT MAX (dpp_sname)
          INTO l_acs_dpp_dksu_name
          FROM USS_NDI.v_ndi_pay_person
         WHERE dpp_id = l_acs_dpp_dksu;

        RDM$RTFL.AddParam (l_jbr_id, 'c_odksu_name', l_acs_dpp_dksu_name);

        --Ѕюджет код
        SELECT b.nbu_code, b.nbu_name
          INTO l_nbu_code, l_nbu_name
          FROM USS_NDI.V_NDI_FUNDING_SOURCE  f
               JOIN USS_NDI.v_Ndi_Budget b ON f.nfs_nbu = b.nbu_id
         WHERE f.nfs_id = one_obligation.cto_nfs;

        RDM$RTFL.AddParam (l_jbr_id, 'c3_1', SUBSTR (l_nbu_code, 1, 1));
        RDM$RTFL.AddParam (l_jbr_id, 'c3_2', SUBSTR (l_nbu_code, 2, 1));
        RDM$RTFL.AddParam (l_jbr_id, 'c3_3', SUBSTR (l_nbu_code, 3, 1));
        RDM$RTFL.AddParam (l_jbr_id, 'c3_4', SUBSTR (l_nbu_code, 4, 1));
        RDM$RTFL.AddParam (l_jbr_id, 'c3_5', SUBSTR (l_nbu_code, 5, 1));
        RDM$RTFL.AddParam (l_jbr_id, 'c3_6', SUBSTR (l_nbu_code, 6, 1));
        RDM$RTFL.AddParam (l_jbr_id, 'c3_7', SUBSTR (l_nbu_code, 7, 1));
        RDM$RTFL.AddParam (l_jbr_id, 'c3_8', SUBSTR (l_nbu_code, 8, 1));
        RDM$RTFL.AddParam (l_jbr_id, 'c3_9', SUBSTR (l_nbu_code, 9, 1));
        RDM$RTFL.AddParam (l_jbr_id, 'c3_10', SUBSTR (l_nbu_code, 10, 1));
        --Ѕюджет назва
        RDM$RTFL.AddParam (l_jbr_id, 'c_budg_name', l_nbu_name);
        -- ¬  код
        RDM$RTFL.AddParam (l_jbr_id, 'c4_1', SUBSTR (l_acs_kvk_code, 1, 1));
        RDM$RTFL.AddParam (l_jbr_id, 'c4_2', SUBSTR (l_acs_kvk_code, 2, 1));
        RDM$RTFL.AddParam (l_jbr_id, 'c4_3', SUBSTR (l_acs_kvk_code, 3, 1));
        -- ¬  назва
        RDM$RTFL.AddParam (l_jbr_id, 'c_nkvk_name', l_acs_kvk_name);
        -- од розпор€дника
        RDM$RTFL.AddParam (l_jbr_id, 'c5_1', SUBSTR (l_acs_adm_code, 1, 1));
        RDM$RTFL.AddParam (l_jbr_id, 'c5_2', SUBSTR (l_acs_adm_code, 2, 1));
        RDM$RTFL.AddParam (l_jbr_id, 'c5_3', SUBSTR (l_acs_adm_code, 3, 1));
        RDM$RTFL.AddParam (l_jbr_id, 'c5_4', SUBSTR (l_acs_adm_code, 4, 1));
        RDM$RTFL.AddParam (l_jbr_id, 'c5_5', SUBSTR (l_acs_adm_code, 5, 1));
        RDM$RTFL.AddParam (l_jbr_id, 'c5_6', SUBSTR (l_acs_adm_code, 6, 1));
        --–≥вень  розпор€дника
        RDM$RTFL.AddParam (l_jbr_id, 'c9', SUBSTR (l_acs_adm_level, 1, 1));

        -- ѕ ¬ / “ ¬ћЅ код
        SELECT b.nbg_kpk_code, b.nbg_name
          INTO l_nbg_kpk_code, l_nbg_name
          FROM USS_NDI.V_NDI_FUNDING_SOURCE  f
               JOIN USS_NDI.v_Ndi_Budget_Program b ON f.nfs_nbg = b.nbg_id
         WHERE f.nfs_id = one_obligation.cto_nfs;

        RDM$RTFL.AddParam (l_jbr_id, 'c6_1', SUBSTR (l_nbg_kpk_code, 1, 1));
        RDM$RTFL.AddParam (l_jbr_id, 'c6_2', SUBSTR (l_nbg_kpk_code, 2, 1));
        RDM$RTFL.AddParam (l_jbr_id, 'c6_3', SUBSTR (l_nbg_kpk_code, 3, 1));
        RDM$RTFL.AddParam (l_jbr_id, 'c6_4', SUBSTR (l_nbg_kpk_code, 4, 1));
        RDM$RTFL.AddParam (l_jbr_id, 'c6_5', SUBSTR (l_nbg_kpk_code, 5, 1));
        RDM$RTFL.AddParam (l_jbr_id, 'c6_6', SUBSTR (l_nbg_kpk_code, 6, 1));
        RDM$RTFL.AddParam (l_jbr_id, 'c6_7', SUBSTR (l_nbg_kpk_code, 7, 1));
        -- ѕ ¬ / “ ¬ћЅ назва
        RDM$RTFL.AddParam (l_jbr_id, 'c_kpkvk', l_nbg_name);

        --‘онд код
        SELECT TO_CHAR (dic_srtordr), dic_name
          INTO l_nfs_tp, l_nfs_tp_name
          FROM USS_NDI.V_NDI_FUNDING_SOURCE  f
               JOIN USS_NDI.v_ddn_nfs_tp ON nfs_id = one_obligation.cto_nfs
         WHERE f.nfs_tp = dic_value;

        RDM$RTFL.AddParam (l_jbr_id, 'c7_1', '0');
        RDM$RTFL.AddParam (l_jbr_id, 'c7_2', SUBSTR (l_nfs_tp, 1, 1));
        --‘онд назва
        RDM$RTFL.AddParam (l_jbr_id, 'c_fond_name', l_nfs_tp_name);
        rdm$rtfl.AddDataSet (
            l_jbr_id,
            'ds',
               'SELECT to_char(t.cto_dt, ''DD.MM.YYYY'') AS fin_dt,
               (SELECT to_char(u.cto_dt, ''DD.MM.YYYY'') FROM uss_esr.v_obligation u WHERE u.cto_id = t.cto_cto_ur) AS ur_dt,
               (SELECT u2.cto_num FROM USS_ESR.v_obligation u2 WHERE u2.cto_id = t.cto_cto_ur) AS ur_num,
               t.cto_num AS fin_num,
               to_char(t.cto_sum, ''FM9G999G999G999G999G990D00'', ''NLS_NUMERIC_CHARACTERS='''','''''''''') AS summ,
               ''0,00'' AS lst_sum,
               substr(k.nkv_code, 1, 1) AS k_1,
               substr(k.nkv_code, 2, 1) AS k_2,
               substr(k.nkv_code, 3, 1) AS k_3,
               substr(k.nkv_code, 4, 1) AS k_4,
               (SELECT p.dpp_tax_code FROM USS_NDI.v_ndi_pay_person p WHERE t.cto_dpp = p.dpp_id) AS edrpou,
               (SELECT pa.dppa_account FROM USS_NDI.v_ndi_pay_person_acc pa WHERE t.cto_dppa_ca = pa.dppa_id) AS acc_num,
               ''00'' AS info,
               '''' AS descr,
               row_number() over (order by t.cto_id) as rn
          FROM uss_esr.v_obligation t
          LEFT JOIN uss_ndi.v_ndi_kekv k ON (k.nkv_id = t.cto_nkv)
         WHERE t.cto_id IN ('
            || p_ids
            || ')
           and t.cto_st = ''AP''
           AND t.cto_reestr_num = '''
            || one_obligation.cto_reestr_num
            || '''
           AND t.cto_nfs = '
            || one_obligation.cto_nfs);
        --√оловний бухгалтер
        RDM$RTFL.AddParam (l_jbr_id, 'c_buch_pib', l_acs_fnc_bt_allow);
        --¬иконавець
        RDM$RTFL.AddParam (l_jbr_id, 'c_curr_user_pib', l_acs_fnc_bt_check);

        RDM$RTFL.PutReportToWorkingQueue (p_jbr_id => l_jbr_id);
        RETURN l_jbr_id;
    END;

    -- ѕлат≥жне дорученн€
    FUNCTION PAY_ORDER_R1 (p_ids     IN VARCHAR2,
                           p_rt_id   IN rpt_templates.rt_id%TYPE)
        RETURN DECIMAL
    IS
        l_jbr_id   NUMBER;
    BEGIN
        tools.WriteMsg ('DNET$PAYMENT_REPORTS.' || $$PLSQL_UNIT);
        l_jbr_id := RDM$RTFL.InitReport (p_rt_id => p_rt_id);

        RDM$RTFL.AddDataSet (
            l_jbr_id,
            'data',
               'SELECT
                t.po_number as ord_num,
                to_char(to_date(t.po_pay_dt, ''DD.MM.YYYY''), ''DD'') as c_day,
                (select lower(mn.dic_sname) from uss_ndi.v_ddn_month_names mn where mn.dic_code = to_char(t.po_pay_dt, ''MM'')) as c_month,
                to_char(t.po_pay_dt, ''YYYY'') c_year,

                -- Payer
                t.po_tax_code_src AS p_code,
                t.po_bank_mfo_src AS p_mfo,
                t.po_bank_account_src AS p_acc,
                po_bank_name_src AS p_name,
                po_name_src AS p_org,

                -- Recipient
                t.po_tax_code_dest AS r_code, /*#50766*/
                t.po_bank_mfo_dest AS r_mfo,
                t.po_bank_account_dest AS r_acc,
                t.po_bank_name_dest AS r_name,
                t.po_name_dest AS r_org,

                -- sum info
                to_char(t.po_sum, ''FM9G999G999G999G999G990D00'', ''NLS_NUMERIC_CHARACTERS='''','''''''''')  summa,
                lower(uss_esr.tools.SUM_TO_TEXT(t.po_sum)) as sum_txt,
                lower(uss_esr.tools.SUM_TO_TEXT(t.po_sum, ''F'', ''F'')) as sum_string,
                lower(uss_esr.tools.SUM_COP_TO_TEXT(t.po_sum)) as sum_cop,
                --upper(substSUM_TO_TEXTr(uss_esr.TOOLS.SUM_TO_TEXT(psum.udp_val_sum, ''F''), 1, 1)) || substr(uss_esr.TOOLS.SUM_TO_TEXT(psum.udp_val_sum, ''F''), 2) || rpad((psum.udp_val_sum - trunc(psum.udp_val_sum)) * 100, 2, ''0'') || '' коп.'' AS sum_txt,
                t.po_purpose as rison
                --case when tp.dic_value = ''N'' and pb.udp_val_string = ''T'' then tp.dic_name end as pdv_tp,
                --CASE WHEN spdv.udp_val_sum > 0 and pb.udp_val_string = ''T'' THEN ''” т.ч. ѕƒ¬ '' || to_char(spdv.udp_val_sum, ''FM9G999G999G999G999G990D00'', ''NLS_NUMERIC_CHARACTERS='''','''''''''') || '';'' ELSE '''' END pdv_sum,
                --pp.udp_val_string ||'';'' rison
          FROM uss_esr.v_pay_order t
         WHERE 1 = 1
           AND t.po_Id IN ('
            || p_ids
            || ')');

        RDM$RTFL.PutReportToWorkingQueue (p_jbr_id => l_jbr_id);
        RETURN l_jbr_id;
    END;

    FUNCTION CONSOLIDATE_PAY_REESTR_R1 (
        p_ids     IN VARCHAR2,
        p_rt_id   IN rpt_templates.rt_id%TYPE)
        RETURN DECIMAL
    IS
        l_jbr_id   NUMBER;
    BEGIN
        tools.WriteMsg ('DNET$PAYMENT_REPORTS.' || $$PLSQL_UNIT);
        l_jbr_id := RDM$RTFL.InitReport (p_rt_id => p_rt_id);

        RDM$RTFL.AddDataSet (
            l_jbr_id,
            'DS1',
               '
        with dat as (SELECT *
                       FROM (select pe_id,
                                    pe_po,
                                    npc_name,
                                    pe_pay_dt,
                                    row_number() over (partition by pe_po order by pe_id) as rn
                               from uss_esr.v_payroll_reestr t
                               join uss_ndi.v_ndi_payment_codes c on (c.npc_code = pe_code)
                              where t.pe_po in ( '
            || p_ids
            || ' )
                             ) t
                       where rn = 1)
        SELECT t.po_id as po_master,
               d.npc_name as c_pe_tp,
               to_char(trunc(d.pe_pay_dt, ''MM''), ''DD'') as c_start_dt,
               to_char(add_months(trunc(d.pe_pay_dt, ''MM''), 1)-1, ''DD'') as c_day,
               (SELECT lower(dic_sname) FROM uss_ndi.v_ddn_month_names z where z.dic_value = to_char(d.pe_pay_dt, ''MM'')) as c_month,
               to_char(trunc(d.pe_pay_dt, ''MM''), ''YYYY'') as c_year,
               (SELECT z.fnc_fn || '' '' || UPPER(z.fnc_ln)
                  FROM uss_ndi.v_ndi_functionary z
                 WHERE z.fnc_tp = ''A''
                   AND z.history_status = ''A''
                   AND z.com_org = t.com_org_src
                 fetch first row only
               ) as main_buch,
               (SELECT z.fnc_fn || '' '' || UPPER(z.fnc_ln)
                  FROM uss_ndi.v_ndi_functionary z
                 WHERE z.fnc_tp = ''B''
                   AND z.history_status = ''A''
                   AND z.com_org = t.com_org_src
                 fetch first row only
               ) as head_department,
               t.po_num as c_pe_num
           FROM uss_esr.v_pay_order t
           join dat d on (d.pe_po = t.po_id)
          WHERE t.po_id in ( '
            || p_ids
            || ' ) ');


        RDM$RTFL.AddDataSet (
            l_jbr_id,
            'ds_main',
            'SELECT t.po_id,
                to_char(t.po_pay_dt, ''DD.MM.YYYY'') AS dt,
                SUM(CASE WHEN r.pe_sum != 0 THEN r.pe_row_cnt END) AS qnt,
                to_char(t.po_sum, ''FM9G999G999G999G999G990D00'', ''NLS_NUMERIC_CHARACTERS='''','''''''''')  AS summ
           FROM uss_esr.v_pay_order t
           JOIN uss_esr.v_payroll_reestr r ON (r.pe_po = t.po_id)
          GROUP BY po_id, t.po_pay_dt, t.po_sum
         HAVING 1 = 1');

        RDM$RTFL.AddRelation (l_jbr_id,
                              'DS1',
                              'po_master',
                              'ds_main',
                              'po_id');

        RDM$RTFL.PutReportToWorkingQueue (p_jbr_id => l_jbr_id);
        RETURN l_jbr_id;
    END;

    -- ѕоданн€ в  азначейство
    FUNCTION KAZNA_R1 (p_ids     IN VARCHAR2,
                       p_rt_id   IN rpt_templates.rt_id%TYPE)
        RETURN DECIMAL
    IS
        l_jbr_id   NUMBER;
    BEGIN
        tools.WriteMsg ('DNET$PAYMENT_REPORTS.' || $$PLSQL_UNIT);
        l_jbr_id := RDM$RTFL.InitReport (p_rt_id => p_rt_id);

        RDM$RTFL.AddDataSet (
            l_jbr_id,
            'ds',
               'SELECT t.po_number as ord_num,
               to_char(t.po_pay_dt, ''DD.MM.YYYY'') as pd_dt,
               to_char(t.po_sum, ''FM9G999G999G999G999G990D00'', ''NLS_NUMERIC_CHARACTERS='''','''''''''')  amount,
               lower(uss_esr.tools.SUM_TO_TEXT(t.po_sum, ''T'', ''T'', ''F'')) as amount_s,
               (select sum(z.pe_row_cnt) from uss_esr.v_payroll_reestr z where z.pe_po = t.po_id) as qnt
          FROM uss_esr.v_pay_order t
         WHERE 1 = 1
           AND t.po_Id IN ('
            || p_ids
            || ')');

        RDM$RTFL.PutReportToWorkingQueue (p_jbr_id => l_jbr_id);
        RETURN l_jbr_id;
    END;

    -- –еЇстр ¬ѕќ
    FUNCTION REESTR_VPO_R1 (p_ids     IN VARCHAR2,
                            p_rt_id   IN rpt_templates.rt_id%TYPE)
        RETURN DECIMAL
    IS
        l_jbr_id   NUMBER;
    BEGIN
        tools.WriteMsg ('DNET$PAYMENT_REPORTS.' || $$PLSQL_UNIT);
        l_jbr_id := RDM$RTFL.InitReport (p_rt_id => p_rt_id);

        RDM$RTFL.AddDataSet (
            l_jbr_id,
            'ds',
               'SELECT t.po_id as main_po_id,
               to_char(t.po_pay_dt, ''DD.MM.YYYY'') as pd_dt,
               to_char(t.po_sum, ''FM9G999G999G999G999G990D00'', ''NLS_NUMERIC_CHARACTERS='''','''''''''')  total_sum,
               (select sum(z.pe_row_cnt) from uss_esr.v_payroll_reestr z where z.pe_po = t.po_id) as qnt
          FROM uss_esr.v_pay_order t
         WHERE 1 = 1
           AND t.po_Id IN ('
            || p_ids
            || ')');

        --#85222 виконано перех≥д на prs_npt на prsd_npt
        /*RDM$RTFL.AddDataSet(l_jbr_id, 'data',
         'SELECT s.prs_ln || '' '' || s.prs_fn || '' '' || s.prs_mn AS pib,
                 s.prs_inn AS rnokpp,
                 to_char(SUM(s.prs_sum), ''FM9G999G999G999G999G990D00'', ''NLS_NUMERIC_CHARACTERS='''','''''''''')  AS sum,
                 s.prs_account AS acc,
                 row_number() OVER (ORDER BY 1) AS rn
            FROM uss_esr.v_pay_order p
            JOIN uss_esr.v_payroll_reestr r ON (r.pe_po = p.po_id)
            JOIN uss_esr.v_pr_sheet s ON (s.prs_pr = r.pe_src_entity)
            join uss_ndi.v_ndi_payment_type pt on (pt.npt_id = s.prs_npt)
           where 1 = 1
             and s.prs_pay_dt = r.pe_pay_dt
             and pt.npt_nbg = r.pe_nbg
             and pt.npt_npc = r.pe_npc
           GROUP BY s.prs_ln, s.prs_fn, s.prs_mn, s.prs_inn, s.prs_account, p.po_id
           having 1 = 1
           ');*/

        RDM$RTFL.AddDataSet (
            l_jbr_id,
            'data',
            q'[SELECT s.prs_ln || ' ' || s.prs_fn || ' ' || s.prs_mn AS pib,
       s.prs_inn AS rnokpp,
       to_char(SUM(CASE
                     WHEN prsd_tp IN ('PWI', 'RDN') THEN
                      prsd_sum
                     WHEN prsd_tp IN ('PRUT', 'PRAL', 'PROZ', 'PROP') THEN
                      0 - prsd_sum
                   END),
               'FM9G999G999G999G999G990D00',
               'NLS_NUMERIC_CHARACTERS='',''''') AS SUM,
       s.prs_account AS acc,
       row_number() over(ORDER BY 1) AS rn
  FROM uss_esr.v_pay_order p
  JOIN uss_esr.v_payroll_reestr r ON r.pe_po = p.po_id
  JOIN uss_esr.v_pr_sheet s ON s.prs_pr = r.pe_src_entity
  JOIN uss_esr.v_pr_sheet_detail d ON d.prsd_prs = s.prs_id
  JOIN uss_ndi.v_ndi_payment_type pt ON pt.npt_id = d.prsd_npt
                                    AND pt.npt_nbg = r.pe_nbg
                                    AND pt.npt_npc = r.pe_npc
 WHERE 1 = 1
   AND s.prs_pay_dt = r.pe_pay_dt
 GROUP BY s.prs_ln, s.prs_fn, s.prs_mn, s.prs_inn, s.prs_account, p.po_id
HAVING 1 = 1
       ]');
        /* RDM$RTFL.AddDataSet(l_jbr_id, 'data',
           'select t.*,
                    row_number() OVER (ORDER BY 1) AS rn,
                    to_char(t.sum_n, ''FM9G999G999G999G999G990D00'', ''NLS_NUMERIC_CHARACTERS='''','''''''''') as sum
               from (SELECT s.prs_ln || '' '' || s.prs_fn || '' '' || s.prs_mn AS pib,
                            s.prs_inn AS rnokpp,
                            SUM(s.prs_sum) AS sum_n,
                            s.prs_account AS acc,
                            p.po_id
                       FROM uss_esr.v_pay_order p
                       JOIN uss_esr.v_payroll_reestr r ON (r.pe_po = p.po_id)
                       JOIN uss_esr.v_pr_sheet s ON (s.prs_pr = r.pe_src_entity)
                      GROUP BY s.prs_ln, s.prs_fn, s.prs_mn, s.prs_inn, s.prs_account, p.po_id
                    ) t
             where 1 = 1');
         */

        RDM$RTFL.AddRelation (l_jbr_id,
                              'ds',
                              'main_po_id',
                              'data',
                              'po_id');

        RDM$RTFL.PutReportToWorkingQueue (p_jbr_id => l_jbr_id);
        RETURN l_jbr_id;
    END;

    -- io #77002  «в≥т. –еЇстр дл€  азначейства
    FUNCTION REESTR_KAZNA_R1 (p_ids     IN VARCHAR2,
                              p_rt_id   IN rpt_templates.rt_id%TYPE)
        RETURN DECIMAL
    IS
        l_jbr_id       NUMBER;
        l_month        VARCHAR2 (50);
        l_year         VARCHAR2 (50);
        l_pay_period   VARCHAR2 (50);
        l_file_name    VARCHAR2 (250);
        l_cnt          NUMBER;
    BEGIN
        tools.WriteMsg ('DNET$PAYMENT_REPORTS.' || $$PLSQL_UNIT);
        l_jbr_id := RDM$RTFL.InitReport (p_rt_id => p_rt_id);

        SELECT TRIM (
                   TO_CHAR (t.po_pay_dt,
                            'Month',
                            'NLS_DATE_LANGUAGE = ukrainian')),
               TO_CHAR (t.po_pay_dt, 'yyyy'),
               /*case  -- з 01 по 03 - 01 пер≥од, з 04 - по 13 - 02 пер≥од, з14 по 23 - 03 пер≥од
                 when extract( day from t.po_pay_dt) between  1 and  3 then '01'
                 when extract( day from t.po_pay_dt) between  4 and 13 then '02'
                 when extract( day from t.po_pay_dt) between 14 and 23 then '03'
               end || ' пер≥од'*/
               'на ' || TO_CHAR (po_pay_dt, 'dd.mm.yyyy')
          INTO l_month, l_year, l_pay_period
          FROM uss_esr.v_pay_order t
         WHERE t.po_Id IN (p_ids);

        SELECT COUNT (1)
          INTO l_cnt
          FROM uss_esr.v_payroll_reestr r
         WHERE r.pe_po IN (p_ids);

        l_file_name :=
            '–еЇстр_' || l_month || '_' || l_year || '_95_00.xml.xls';

        ikis_sysweb.REPORTFL_ENGINE_EX.SetFileName (
            p_jbr_id      => l_jbr_id,
            p_file_name   => l_file_name);

        RDM$RTFL.AddParam (l_jbr_id, 't_month', l_month);
        RDM$RTFL.AddParam (l_jbr_id, 't_year', l_year);
        RDM$RTFL.AddParam (l_jbr_id, 't_pay_period', l_pay_period);

        RDM$RTFL.AddParam (l_jbr_id, 'c_rows', l_cnt);

        RDM$RTFL.AddDataSet (
            l_jbr_id,
            'ds',
            q'[SELECT row_number()over(order by r.com_org) as c_rn,
/*(select
case when org_id = 53000 then 'м. '||reg_name
     else reg_name||' обл.'
end as reg_name from (
select CONNECT_BY_ROOT org_id as root_org,
kaot_name as reg_name,
t.*
from uss_esr.v_opfu_esr t
connect by org_id = prior  org_org
start with t.org_id = r.com_org
)
where org_to = 31
)*/
uss_esr.TOOLS.GetOrgRegName(com_org)  as c_reg,
r.com_org as c_org,
/*org.org_sname*/ uss_esr.TOOLS.GetOrgSName(com_org)  as c_org_name,
r.pe_row_cnt as c_cnt,
/*trim(to_char(r.pe_sum, '999999999999990D00'))*/ r.pe_sum as c_sum
FROM  (
select  r.com_org, sum(r.pe_row_cnt) pe_row_cnt, sum(r.pe_sum) pe_sum
from uss_esr.v_payroll_reestr r
where 1=1
  AND r.pe_po IN (]' || p_ids || ')
group by r.com_org
) r
--left join uss_esr.v_opfu_esr org on org_id = com_org
WHERE 1 = 1 ');

        RDM$RTFL.PutReportToWorkingQueue (p_jbr_id => l_jbr_id);
        RETURN l_jbr_id;
    END;

    -- io #84010 зв≥т по невиплаченим коштам
    FUNCTION REESTR_UNPAID_R1 (p_start_dt   IN DATE,
                               p_stop_dt    IN DATE,
                               p_org_id     IN NUMBER,
                               p_rt_id      IN rpt_templates.rt_id%TYPE)
        RETURN DECIMAL
    IS
        l_jbr_id       NUMBER;
        l_user_org     NUMBER;
        l_month        VARCHAR2 (50);
        l_year         VARCHAR2 (50);
        l_pay_period   VARCHAR2 (50);
        l_file_name    VARCHAR2 (250);
        l_cnt          NUMBER;
        l_pr_sum       NUMBER (14, 2);
        l_pe_sum       NUMBER (14, 2);
        l_pk_sum       NUMBER (14, 2);
        l_pk1_sum      NUMBER (14, 2);
        l_pk2_sum      NUMBER (14, 2);
        l_start_dt     DATE
            := GREATEST (TO_DATE ('01.10.2022', 'dd.mm.yyyy'),
                         TRUNC (NVL (p_start_dt, SYSDATE), 'MM'));
        l_stop_dt      DATE
            := GREATEST (l_start_dt, TRUNC (NVL (p_stop_dt, SYSDATE), 'MM'));
        l_sql          VARCHAR2 (10000);
    BEGIN
        tools.WriteMsg ('DNET$PAYMENT_REPORTS.' || $$PLSQL_UNIT);
        l_jbr_id := RDM$RTFL.InitReport (p_rt_id => p_rt_id);

        IF NVL (p_org_id, 0) = 0
        THEN
            l_user_org := NVL (Tools.GetCurrOrg, 50000);
        ELSE
            l_user_org := p_org_id;
        END IF;

        l_user_org :=
            CASE WHEN l_user_org = 50001 THEN 50000 ELSE l_user_org END;

        l_file_name :=
               'Unpaid_'
            || TO_CHAR (l_start_dt, 'yyyymm')
            || '_'
            || TO_CHAR (p_stop_dt, 'yyyymm')
            || '_'
            || p_org_id
            || '.xml.xls';

        ikis_sysweb.REPORTFL_ENGINE_EX.SetFileName (
            p_jbr_id      => l_jbr_id,
            p_file_name   => l_file_name);

        RDM$RTFL.AddParam (l_jbr_id,
                           'p_start',
                           TO_CHAR (p_start_dt, 'dd.mm.yyyy'));
        RDM$RTFL.AddParam (l_jbr_id,
                           'p_stop',
                           TO_CHAR (p_stop_dt, 'dd.mm.yyyy'));

        --    RDM$RTFL.AddParam(l_jbr_id, 't_pay_period', l_pay_period);

        /*select sum(pr_sum), sum(pe_sum), sum(block_kv_sum), sum(block_kv1_sum), sum(block_kv2_sum)
        into l_pr_sum, l_pe_sum, l_pk_sum, l_pk1_sum, l_pk2_sum
        from (
          select
          pr_id, com_org, pr_month, pr_pc_cnt, pr_sum,
          (select sum(pe_sum) from payroll_reestr r where pe_pr = pr_id and pe_po is not null) as pe_sum,
          block_kv_sum, block_kv1_sum, block_kv2_sum
          from (
          select
            pr_id, com_org, pr_month, pr_sum, pr_pc_cnt,
            sum(prs_sum) as block_kv_sum,
            --sum(case when prs_st = 'PK1' then 1 else 0 end) as block_kv1_cnt,
            sum(case when prs_st = 'PK1' then prs_sum else 0 end) as block_kv1_sum,
            --sum(case when prs_st = 'PK2' then 1 else 0 end) as block_kv2_cnt,
            sum(case when prs_st = 'PK2' then prs_sum else 0 end) as block_kv2_sum
          from uss_esr.v_payroll p
          join uss_esr.v_pr_sheet s on p.pr_id = s.prs_pr and prs_st in ('PK1', 'PK2')
          where p.pr_month >= l_start_dt
            and p.pr_month <= l_stop_dt
            and p.pr_npc = 24
            and pr_src = 0
          group by pr_id, com_org, pr_month, pr_sum, pr_pc_cnt
          having count(1) > 0
          ) t
        );*/

        SELECT NVL (SUM (pr_sum), 0),
               NVL (SUM (pe_sum), 0),
               NVL (SUM (block_kv_sum), 0),
               NVL (SUM (block_kv1_sum), 0),
               NVL (SUM (block_kv2_sum), 0)
          INTO l_pr_sum,
               l_pe_sum,
               l_pk_sum,
               l_pk1_sum,
               l_pk2_sum
          FROM (  SELECT pr_id,
                         pr_month,
                         pr_pc_cnt,
                         pr_sum,
                         SUM (pe_sum)     AS pe_sum,
                         --(select sum(pe_sum) from payroll_reestr r where pe_pr = pr_id and pe_po is not null) as pe_sum,
                         block_kv_sum,
                         block_kv1_sum,
                         block_kv2_sum
                    FROM (  SELECT pr_id,
                                   com_org,
                                   pr_month,
                                   pr_sum,
                                   pr_pc_cnt,
                                   SUM (
                                       CASE
                                           WHEN prs_st IN ('PK1', 'PK2')
                                           THEN
                                               prs_sum
                                           ELSE
                                               0
                                       END)    AS block_kv_sum,
                                   --sum(case when prs_st = 'PK1' then 1 else 0 end) as block_kv1_cnt,
                                   SUM (
                                       CASE
                                           WHEN prs_st = 'PK1' THEN prs_sum
                                           ELSE 0
                                       END)    AS block_kv1_sum,
                                   --sum(case when prs_st = 'PK2' then 1 else 0 end) as block_kv2_cnt,
                                   SUM (
                                       CASE
                                           WHEN prs_st = 'PK2' THEN prs_sum
                                           ELSE 0
                                       END)    AS block_kv2_sum
                              FROM uss_esr.v_payroll p
                                   JOIN uss_esr.v_pr_sheet s
                                       ON p.pr_id = s.prs_pr ----and prs_st in ('PK1', 'PK2')
                             WHERE     p.pr_month >= l_start_dt
                                   AND p.pr_month <= l_stop_dt
                                   AND p.pr_npc = 24
                                   AND pr_src = 0
                          GROUP BY pr_id,
                                   com_org,
                                   pr_month,
                                   pr_sum,
                                   pr_pc_cnt) t
                         JOIN v_opfu
                             ON     com_org = org_id
                                AND (l_user_org = 50000 OR org_org = l_user_org)
                         JOIN uss_esr.v_payroll_reestr r
                             ON pe_pr = pr_id AND pe_npc = 24
                         JOIN uss_esr.v_pay_order po
                             ON po_id = pe_po AND po_st = 'A'
                GROUP BY pr_id,
                         org_org,
                         pr_month,
                         pr_pc_cnt,
                         pr_sum,
                         block_kv_sum,
                         block_kv1_sum,
                         block_kv2_sum);

        RDM$RTFL.AddParam (l_jbr_id, 't_pr_sum', l_pr_sum);
        -- RDM$RTFL.AddParam(l_jbr_id, 't_pr_cnt', l_cnt);
        RDM$RTFL.AddParam (l_jbr_id, 't_pe_sum', l_pe_sum);
        RDM$RTFL.AddParam (l_jbr_id, 't_pk_sum', l_pk_sum);
        RDM$RTFL.AddParam (l_jbr_id, 't_pk1_sum', l_pk1_sum);
        RDM$RTFL.AddParam (l_jbr_id, 't_pk2_sum', l_pk2_sum);

        /*l_sql := q'[SELECT row_number()over(order by r.com_org) as c_num,
          uss_esr.TOOLS.GetOrgRegName(com_org)  as c_reg_name,
        --uss_esr.TOOLS.GetOrgSName(com_org)  as c_org_name,
          to_char(pr_month, 'dd.mm.yyyy') as c_month,
          c_pr_sum, c_pe_sum, c_pk_sum, c_pk1_sum, c_pk2_sum
        FROM  (
            select org_org as com_org, pr_month,
                   to_char(SUM(pr_sum), 'FM9999999999999990D00', 'NLS_NUMERIC_CHARACTERS=''.''''') c_pr_sum,
                   to_char(SUM(pe_sum), 'FM9999999999999990D00', 'NLS_NUMERIC_CHARACTERS=''.''''') c_pe_sum,
                   to_char(sum(block_kv_sum), 'FM9999999999999990D00', 'NLS_NUMERIC_CHARACTERS=''.''''') c_pk_sum,
                   to_char(sum(block_kv1_sum), 'FM9999999999999990D00', 'NLS_NUMERIC_CHARACTERS=''.''''') c_pk1_sum,
                   to_char(sum(block_kv2_sum), 'FM9999999999999990D00', 'NLS_NUMERIC_CHARACTERS=''.''''') c_pk2_sum
            from (
              select
              pr_id, com_org, pr_month, pr_pc_cnt, pr_sum,
              (select sum(pe_sum) from uss_esr.v_payroll_reestr r where pe_pr = pr_id and pe_po is not null) as pe_sum,
              block_kv_sum, block_kv1_sum, block_kv2_sum
              from (
              select
                pr_id, com_org, pr_month, pr_sum, pr_pc_cnt,
                sum(prs_sum) as block_kv_sum,
                sum(case when prs_st = 'PK1' then prs_sum else 0 end) as block_kv1_sum,
                sum(case when prs_st = 'PK2' then prs_sum else 0 end) as block_kv2_sum
              from uss_esr.v_payroll p
              join uss_esr.v_pr_sheet s on p.pr_id = s.prs_pr and prs_st in ('PK1', 'PK2')
              where p.pr_month >= to_date(']' || to_char(l_start_dt, 'dd.mm.yyyy') ||q'[', 'dd.mm.yyyy')
                and p.pr_month <= to_date(']' || to_char(l_stop_dt, 'dd.mm.yyyy') ||q'[', 'dd.mm.yyyy')
              group by pr_id, com_org, pr_month, pr_sum, pr_pc_cnt
              having count(1) > 0
              ) t )
              join v_opfu on com_org = org_id
                ]'||
                case when nvl(p_org_id, 50000) != 50000 then ' and org_org = '||p_org_id else '' end
                ||q'[
             group by org_org, pr_month
            ) r
        WHERE 1 = 1 ]';*/

        l_sql :=
               q'[
SELECT row_number()over(order by o.org_id, pr_month) as c_num,-- org_id,
  uss_esr.TOOLS.GetOrgRegName(o.org_id)  as c_reg_name,
--uss_esr.TOOLS.GetOrgSName(com_org)  as c_org_name,
  nvl(to_char(pr_month, 'mm.yyyy'),
        ']'
            || TO_CHAR (l_start_dt, 'mm.yyyy')
            || q'[') as c_month,
  nvl(c_pr_sum,0)   c_pr_sum,
  nvl(c_pe_sum,0)   c_pe_sum,
  nvl(c_pk_sum,0)   c_pk_sum,
  nvl(c_pk1_sum,0)  c_pk1_sum,
  nvl(c_pk2_sum,0)  c_pk2_sum
FROM v_opfu o
    left join (
    select com_org, pr_month, sum(pr_sum) c_pr_sum, sum(pe_sum) c_pe_sum, sum(block_kv_sum) c_pk_sum,
           sum(block_kv1_sum) c_pk1_sum, sum(block_kv2_sum) c_pk2_sum
    from (
    select
      pr_id, org_org as com_org, pr_month, pr_pc_cnt, pr_sum,    block_kv_sum, block_kv1_sum, block_kv2_sum,
      sum(pe_sum) as pe_sum
    from (
      select
      pr_id, com_org, pr_month, pr_pc_cnt, pr_sum,
      ---(select sum(pe_sum) from uss_esr.payroll_reestr r where pe_pr = pr_id and pe_po is not null) as pe_sum,
      block_kv_sum, block_kv1_sum, block_kv2_sum
      from (
      select
        pr_id, com_org, pr_month, pr_sum, pr_pc_cnt,
        sum(case when prs_st in ('PK1', 'PK2')  then prs_sum else 0 end) as block_kv_sum,
        sum(case when prs_st = 'PK1' then prs_sum else 0 end) as block_kv1_sum,
        sum(case when prs_st = 'PK2' then prs_sum else 0 end) as block_kv2_sum
      from uss_esr.v_payroll p
      join uss_esr.v_pr_sheet s on p.pr_id = s.prs_pr --and prs_st in ('PK1', 'PK2')
      where p.pr_month >= to_date(']'
            || TO_CHAR (l_start_dt, 'dd.mm.yyyy')
            || q'[', 'dd.mm.yyyy')
        and p.pr_month <= to_date(']'
            || TO_CHAR (l_stop_dt, 'dd.mm.yyyy')
            || q'[', 'dd.mm.yyyy')
        and p.pr_npc = 24
        and pr_src = 0
      group by pr_id, com_org, pr_month, pr_sum, pr_pc_cnt
      ) t ) t
      join v_opfu on com_org = org_id
        ]'
            || CASE
                   WHEN l_user_org != 50000
                   THEN
                       ' and org_org = ' || l_user_org
                   ELSE
                       ''
               END
            || q'[
      join uss_esr.v_payroll_reestr r  on pe_pr=pr_id and pe_npc = 24
      join uss_esr.v_pay_order po on po_id = pe_po and po_st = 'A'
     group by pr_id,org_org, pr_month, pr_pc_cnt, pr_sum,    block_kv_sum, block_kv1_sum, block_kv2_sum
     )
     group by com_org, pr_month
     order by com_org
    ) r                 on r.com_org = o.org_id
WHERE org_to = 31
    and org_org = 50000
        ]'
            || CASE
                   WHEN l_user_org != 50000
                   THEN
                       ' and org_id = ' || l_user_org
                   ELSE
                       ''
               END
            || q'[
    and org_code not in ('54000','54300') -- м. —евастополь, ј–  рим
    and o.org_st = 'A'
]';

        DBMS_OUTPUT.put_line (l_sql);

        RDM$RTFL.AddDataSet (l_jbr_id, 'ds', l_sql);

        RDM$RTFL.PutReportToWorkingQueue (p_jbr_id => l_jbr_id);
        RETURN l_jbr_id;
    END;

    -- IC #84394  витанц≥њ банк≥в щодо неоплат
    PROCEDURE SET_DS_KB2 (p_start_dt IN DATE, p_jbr_id IN DECIMAL)
    IS
    BEGIN
        DELETE FROM tmp_univ_rpt_data
              WHERE 1 = 1;

        INSERT INTO tmp_univ_rpt_data (x_id1,
                                       x_dt1,
                                       x_dt2,
                                       x_id2,
                                       x_sum1,
                                       x_id3,
                                       x_sum2,
                                       x_id4)
            SELECT pr.pr_id,                                -- Ќомер в≥домост≥
                   p.pkt_create_dt,                          -- ƒата квитанц≥њ
                   pr.pr_month,                   -- ¬иплатний м≥с€ц в≥домост≥
                   --pkt_st, px.pl_pkt_out,
                   TO_CHAR (
                       uss_esr.tools.get_xmlattr_clob (pc_header,
                                                       'rows_total'))
                       kv2_rows_cnt,                    -- к-ть запис≥в в  ¬-2
                     TO_CHAR (
                         uss_esr.tools.get_xmlattr_clob (pc_header,
                                                         'sum_total'))
                   * 0.01
                       kv2_sum,                                -- сума по  ¬-2
                   TO_CHAR (
                       uss_esr.tools.get_xmlattr_clob (pc_header,
                                                       'rows_notpay'))
                       kv2_notpay_cnt,                  -- к-ть неполат в  ¬-2
                     TO_CHAR (
                         uss_esr.tools.get_xmlattr_clob (pc_header,
                                                         'sum_notpay'))
                   * 0.01
                       kv2_notpay_sum,                  -- сума неполат в  ¬-2
                   ROW_NUMBER () OVER (ORDER BY pr.pr_id)
                       rn
              FROM uss_esr.v_payroll  pr
                   INNER JOIN uss_esr.exchangefiles f ON f.ef_pr = pr.pr_id
                   INNER JOIN ikis_rbm.v_packet_links px
                       ON px.pl_pkt_out = f.ef_pkt
                   INNER JOIN ikis_rbm.v_packet p ON p.pkt_id = px.pl_pkt_in
                   INNER JOIN ikis_rbm.v_packet_content c
                       ON c.pc_pkt = p.pkt_id
             WHERE     p.pkt_pat IN (103)                 -- 102, 103 KB1, KB2
                   AND p.pkt_st = 'PRC'
                   AND pr.pr_month = p_start_dt;
    END;

    -- IC #85151 ≤нформац≥€ щодо нарахуванн€ допомоги на проживанн€ ¬ѕќ
    PROCEDURE SET_DS_ACD_VPO (p_start_dt   IN DATE,
                              p_org_id     IN NUMBER,
                              p_jbr_id     IN DECIMAL)
    IS
        l_user_org   NUMBER;
        l_raj        NUMBER := 0;
    BEGIN
        IF p_org_id = 0
        THEN
            l_user_org := Tools.GetCurrOrg;
        ELSE
            l_user_org := p_org_id;
        END IF;

        IF Tools.GetCurrOrg NOT IN (50000, 50001)
        THEN
            l_raj := 1;
        END IF;

        DELETE FROM tmp_univ_rpt_data
              WHERE 1 = 1;

        INSERT INTO tmp_univ_rpt_data (x_id1,
                                       x_string1,
                                       x_id2,
                                       x_id3,
                                       x_sum1)
            WITH
                org
                AS
                    (    SELECT org_id     i_org
                           FROM ikis_sys.v_opfu
                     CONNECT BY PRIOR org_id = org_org
                     START WITH org_id =
                                CASE
                                    WHEN l_user_org = 50001 THEN 50000
                                    ELSE l_user_org
                                END),
                assign
                AS
                    (  SELECT CASE WHEN l_raj = 1 THEN org_id ELSE org_org END
                                  AS a_org,
                              pc_id
                                  AS a_pc,
                              pd_id
                                  AS a_pd,
                              SUM (pdp_sum)
                                  AS a_assing
                         FROM ikis_sys.v_opfu,
                              uss_esr.personalcase     pc,
                              uss_esr.pc_decision,
                              uss_esr.pd_payment       pp,
                              uss_esr.pd_accrual_period pdap,
                              org
                        WHERE     org_to = 32
                              AND pc.com_org = org_id
                              AND org_id = i_org
                              AND pd_pc = pc_id
                              AND pdp_pd = pd_id
                              AND pdap_pd = pd_id
                              AND pp.history_status = 'A'
                              AND pdap.history_status = 'A'
                              AND TRUNC (p_start_dt, 'MM') BETWEEN pdap_start_dt
                                                               AND pdap_stop_dt
                              AND TRUNC (p_start_dt, 'MM') BETWEEN pdp_start_dt
                                                               AND pdp_stop_dt
                              AND pdp_npt IN (SELECT nptc_npt
                                                FROM USS_NDI.v_Ndi_Npt_Config
                                               WHERE nptc_nst = 664)
                     GROUP BY CASE
                                  WHEN l_raj = 1 THEN org_id
                                  ELSE org_org
                              END,
                              pc_id,
                              pd_id),
                nrh
                AS
                    (  SELECT CASE WHEN l_raj = 1 THEN org_id ELSE org_org END
                                  AS x_org,
                              ac_pc
                                  AS x_pc,
                              acd_pd
                                  AS x_pd,
                              SUM (
                                  uss_esr.api$accrual.xsign (acd_op) * acd_sum)
                                  AS x_narah
                         FROM ikis_sys.v_opfu,
                              uss_esr.accrual,
                              uss_esr.ac_detail d,
                              uss_ndi.v_ndi_op,
                              org
                        WHERE     org_to = 32
                              AND com_org = org_id
                              AND org_id = i_org
                              AND ac_month = TRUNC (p_start_dt, 'MM')
                              AND acd_start_dt BETWEEN TRUNC (p_start_dt, 'MM')
                                                   AND TRUNC (
                                                           LAST_DAY (
                                                               p_start_dt))
                              AND acd_ac = ac_id
                              AND (acd_op IN (1, 2, 3) OR op_tp1 IN ('NR'))
                              AND acd_op = op_id
                              AND d.history_status = 'A'
                              AND acd_npt IN (SELECT nptc_npt
                                                FROM USS_NDI.v_Ndi_Npt_Config
                                               WHERE nptc_nst = 664)
                     GROUP BY CASE
                                  WHEN l_raj = 1 THEN org_id
                                  ELSE org_org
                              END,
                              ac_pc,
                              acd_pd),
                prsd
                AS
                    (  SELECT prsd_id AS x_id, MAX (acd_pd) AS x_pd
                         FROM uss_esr.pr_sheet_detail,
                              uss_esr.v_ac_detail,
                              uss_esr.payroll pr
                        WHERE     acd_prsd = prsd_id
                              AND prsd_pr = pr_id
                              AND pr_month = TRUNC (p_start_dt, 'MM')
                              AND pr_st IN ('F')
                     GROUP BY prsd_id),
                payed
                AS
                    (  SELECT CASE WHEN l_raj = 1 THEN org_id ELSE org_org END
                                  AS s_org,
                              prs_pc
                                  AS s_pc,
                              SUM (prsd_sum)
                                  AS s_sum,
                              SUM (
                                  CASE
                                      WHEN prsd_month =
                                           TRUNC (p_start_dt, 'MM')
                                      THEN
                                          prsd_sum
                                  END)
                                  s_plan_sum,
                              MAX (x_pd)
                                  AS x_pd
                         FROM ikis_sys.v_opfu,
                              uss_esr.pr_sheet_detail,
                              uss_esr.pr_sheet,
                              uss_esr.payroll pr,
                              uss_esr.v_personalcase,
                              prsd,
                              org
                        WHERE     org_to = 32
                              AND pr.com_org = org_id
                              AND org_id = i_org
                              AND prs_pc = pc_id
                              AND prs_pr = pr_id
                              --AND prsd_pr = pr_id
                              AND prsd_prs = prs_id
                              AND pr_month = TRUNC (p_start_dt, 'MM')
                              AND prs_st IN ('NA', 'KV1', 'KV2')
                              AND pr_st IN ('F')
                              AND prsd_tp IN ('PWI', 'RDN')
                              AND prsd_id = x_id
                     GROUP BY CASE
                                  WHEN l_raj = 1 THEN org_id
                                  ELSE org_org
                              END,
                              prs_pc)
              SELECT org_code,                                    --" од ƒ—«Ќ"
                     --org_name,  -- "Ќазва",
                     CASE
                         WHEN l_raj = 1 THEN org_name
                         ELSE uss_esr.TOOLS.GetOrgRegName (o.org_id)
                     END                   reg_name,
                     --nvl(a_cnt,0)       cnt_eoc_assing,      --" ≥льк≥сть ≈ќ— призн.",
                     --nvl(a_fam_qnt,0)   cnt_fam_assing,      --"„лен≥в с≥мей призн.",
                     --nvl(a_assing,0)    sum_assing,          --"ѕризначено",
                     NVL (x_cnt, 0)        cnt_eoc_narah, --" -сть ≈ќ— нарах.",
                     -- nvl(x_fam_qnt,0)   cnt_fam_narah,       --"„лен≥в с≥мей нарах.",
                     -- IC #86948 “реба виправити, щоб у зв≥т≥ при формуванн≥ показника "„исельн≥сть ос≥б" був врахований ≥ за€вник (€к учасник зверненн€)
                     NVL (x_fam_qnt, 0)    cnt_fam_narah, --"„лен≥в с≥мей нарах.",
                     NVL (x_narah, 0)      sum_narah           --"Ќараховано",
                --nvl(s_cnt,0)       cnt_eoc_payed,       --" -сть ≈ќ— випл.",
                --nvl(s_fam_qnt,0)   cnt_fam_payed,       --"„лен≥в с≥мей випл.",
                --nvl(s_plan_sum,0)  sum_payed_month,     --"¬иплачено м≥с€ць",
                --nvl(s_sum,0)       sum_payed_total     --"¬иплачено всього"
                FROM ikis_sys.opfu o
                     INNER JOIN org ON org_id = i_org
                     LEFT JOIN (  SELECT a_org,
                                         COUNT (DISTINCT a_pc)                a_cnt,
                                         SUM (a_assing)                       a_assing,
                                         SUM (
                                             (SELECT COUNT (DISTINCT pdf_sc)
                                                FROM uss_esr.pc_decision pd,
                                                     uss_esr.pd_family fml
                                               WHERE     pd.pd_id = fml.pdf_pd
                                                     AND NOT EXISTS
                                                             (SELECT 1
                                                                FROM uss_esr.ap_person
                                                                     p
                                                               WHERE     p.app_ap =
                                                                         pd.pd_ap
                                                                     AND p.app_sc =
                                                                         fml.pdf_sc
                                                                     AND p.history_status =
                                                                         'A'
                                                                     -- AND p.app_sc = fml.pdf_sc and p.app_tp in ('Z', 'FM', 'FP'))
                                                                     AND p.app_tp =
                                                                         'P') -- ѕредставник за€вника
                                                     AND pd.pd_id = a_pd))    AS a_fam_qnt
                                    FROM assign
                                   WHERE 1 = 1
                                GROUP BY a_org) a
                         ON a.a_org = org_id
                     LEFT JOIN (  SELECT x_org,
                                         COUNT (DISTINCT x_pc)                x_cnt,
                                         SUM (x_narah)                        x_narah,
                                         SUM (
                                             (SELECT COUNT (DISTINCT pdf_sc)
                                                FROM uss_esr.pc_decision pd,
                                                     uss_esr.pd_family fml
                                               WHERE     pd.pd_id = fml.pdf_pd
                                                     AND NOT EXISTS
                                                             (SELECT 1
                                                                FROM uss_esr.ap_person
                                                                     p
                                                               WHERE     p.app_ap =
                                                                         pd.pd_ap
                                                                     AND p.app_sc =
                                                                         fml.pdf_sc
                                                                     AND p.history_status =
                                                                         'A'
                                                                     -- AND p.app_sc = fml.pdf_sc and p.app_tp in ('Z', 'FM', 'FP'))
                                                                     AND p.app_tp =
                                                                         'P') -- ѕредставник за€вника
                                                     AND pd.pd_id = x_pd))    AS x_fam_qnt
                                    FROM nrh
                                   WHERE 1 = 1
                                GROUP BY x_org) n
                         ON x_org = org_id
                     LEFT JOIN
                     (  SELECT s_org,
                               COUNT (DISTINCT s_pc)                s_cnt,
                               SUM (
                                   (SELECT COUNT (DISTINCT pdf_sc)
                                      FROM uss_esr.pc_decision pd,
                                           uss_esr.pd_family fml
                                     WHERE     pd.pd_id = fml.pdf_pd
                                           AND NOT EXISTS
                                                   (SELECT 1
                                                      FROM uss_esr.ap_person
                                                           p
                                                     WHERE     p.app_ap =
                                                               pd.pd_ap
                                                           AND p.app_sc =
                                                               fml.pdf_sc
                                                           AND p.history_status =
                                                               'A'
                                                           -- AND p.app_sc = fml.pdf_sc and p.app_tp in ('Z', 'FM', 'FP'))
                                                           AND p.app_tp =
                                                               'P') -- ѕредставник за€вника
                                           AND pd.pd_id = x_pd))    AS s_fam_qnt,
                               SUM (s_sum)                          s_sum,
                               SUM (s_plan_sum)                     s_plan_sum
                          FROM payed
                         WHERE 1 = 1
                      GROUP BY s_org) p
                         ON s_org = org_id
               WHERE     org_to = CASE WHEN l_raj = 1 THEN 32 ELSE 31 END
                     AND org_org =
                         CASE WHEN l_raj = 1 THEN org_org ELSE 50000 END
                     AND org_code NOT IN ('54000', '54300') -- м. —евастополь, ј–  рим
                     AND o.org_st = 'A'
            ORDER BY 1;
    END SET_DS_ACD_VPO;

    -- IC #85152 ≤нформац≥€ щодо призначених та нарахованих сум допомог на проживанн€ ¬ѕќ
    PROCEDURE SET_DS_PDP_VPO (p_start_dt   IN DATE,
                              p_org_id     IN NUMBER,
                              p_jbr_id     IN DECIMAL)
    IS
        l_user_org   NUMBER;
        l_raj        NUMBER := 0;
    BEGIN
        IF p_org_id = 0
        THEN
            l_user_org := Tools.GetCurrOrg;
        ELSE
            l_user_org := p_org_id;
        END IF;

        IF Tools.GetCurrOrg NOT IN (50000, 50001)
        THEN
            l_raj := 1;
        END IF;

        DELETE FROM tmp_univ_rpt_data
              WHERE 1 = 1;

        INSERT INTO tmp_univ_rpt_data (x_id1,
                                       x_string1,
                                       x_id2,
                                       x_id3,
                                       x_sum1,
                                       x_id4,
                                       x_id5,
                                       x_sum2)
            WITH
                org
                AS
                    (    SELECT org_id     i_org
                           FROM ikis_sys.v_opfu
                     CONNECT BY PRIOR org_id = org_org
                     START WITH org_id =
                                CASE
                                    WHEN l_user_org = 50001 THEN 50000
                                    ELSE l_user_org
                                END),
                assign
                AS
                    (  SELECT CASE WHEN l_raj = 1 THEN org_id ELSE org_org END
                                  AS a_org,
                              pc_id
                                  AS a_pc,
                              pd_id
                                  AS a_pd,
                              SUM (pdp_sum)
                                  AS a_assing
                         FROM ikis_sys.v_opfu,
                              uss_esr.personalcase     pc,
                              uss_esr.pc_decision,
                              uss_esr.pd_payment       pp,
                              uss_esr.pd_accrual_period pdap,
                              org
                        WHERE     org_to = 32
                              AND pc.com_org = org_id
                              AND org_id = i_org
                              AND pd_pc = pc_id
                              AND pdp_pd = pd_id
                              AND pdap_pd = pd_id
                              AND pp.history_status = 'A'
                              AND pdap.history_status = 'A'
                              AND TRUNC (p_start_dt, 'MM') BETWEEN pdap_start_dt
                                                               AND pdap_stop_dt
                              AND TRUNC (p_start_dt, 'MM') BETWEEN pdp_start_dt
                                                               AND pdp_stop_dt
                              AND pdp_npt IN (SELECT nptc_npt
                                                FROM USS_NDI.v_Ndi_Npt_Config
                                               WHERE nptc_nst = 664)
                     GROUP BY CASE
                                  WHEN l_raj = 1 THEN org_id
                                  ELSE org_org
                              END,
                              pc_id,
                              pd_id),
                nrh
                AS
                    (  SELECT CASE WHEN l_raj = 1 THEN org_id ELSE org_org END
                                  AS x_org,
                              ac_pc
                                  AS x_pc,
                              acd_pd
                                  AS x_pd,
                              SUM (
                                  uss_esr.api$accrual.xsign (acd_op) * acd_sum)
                                  AS x_narah
                         FROM ikis_sys.v_opfu,
                              uss_esr.accrual,
                              uss_esr.ac_detail d,
                              uss_ndi.v_ndi_op,
                              org
                        WHERE     org_to = 32
                              AND com_org = org_id
                              AND org_id = i_org
                              AND ac_month = TRUNC (p_start_dt, 'MM')
                              AND acd_start_dt BETWEEN TRUNC (p_start_dt, 'MM')
                                                   AND TRUNC (
                                                           LAST_DAY (
                                                               p_start_dt))
                              AND acd_ac = ac_id
                              AND (acd_op IN (1, 2, 3) OR op_tp1 IN ('NR'))
                              AND acd_op = op_id
                              AND d.history_status = 'A'
                              AND acd_npt IN (SELECT nptc_npt
                                                FROM USS_NDI.v_Ndi_Npt_Config
                                               WHERE nptc_nst = 664)
                     GROUP BY CASE
                                  WHEN l_raj = 1 THEN org_id
                                  ELSE org_org
                              END,
                              ac_pc,
                              acd_pd),
                prsd
                AS
                    (  SELECT prsd_id AS x_id, MAX (acd_pd) AS x_pd
                         FROM uss_esr.pr_sheet_detail,
                              uss_esr.v_ac_detail,
                              uss_esr.payroll pr
                        WHERE     acd_prsd = prsd_id
                              AND prsd_pr = pr_id
                              AND pr_month = TRUNC (p_start_dt, 'MM')
                              AND pr_st IN ('F')
                     GROUP BY prsd_id),
                payed
                AS
                    (  SELECT CASE WHEN l_raj = 1 THEN org_id ELSE org_org END
                                  AS s_org,
                              prs_pc
                                  AS s_pc,
                              SUM (prsd_sum)
                                  AS s_sum,
                              SUM (
                                  CASE
                                      WHEN prsd_month =
                                           TRUNC (p_start_dt, 'MM')
                                      THEN
                                          prsd_sum
                                  END)
                                  s_plan_sum,
                              MAX (x_pd)
                                  AS x_pd
                         FROM ikis_sys.v_opfu,
                              uss_esr.pr_sheet_detail,
                              uss_esr.pr_sheet,
                              uss_esr.payroll pr,
                              uss_esr.v_personalcase,
                              prsd,
                              org
                        WHERE     org_to = 32
                              AND pr.com_org = org_id
                              AND org_id = i_org
                              AND prs_pc = pc_id
                              AND prs_pr = pr_id
                              --AND prsd_pr = pr_id
                              AND prsd_prs = prs_id
                              AND pr_month = TRUNC (p_start_dt, 'MM')
                              AND prs_st IN ('NA', 'KV1', 'KV2')
                              AND pr_st IN ('F')
                              AND prsd_tp IN ('PWI', 'RDN')
                              AND prsd_id = x_id
                     GROUP BY CASE
                                  WHEN l_raj = 1 THEN org_id
                                  ELSE org_org
                              END,
                              prs_pc)
              SELECT org_code,                                    --" од ƒ—«Ќ"
                     --org_name,  -- "Ќазва",
                     CASE
                         WHEN l_raj = 1 THEN org_name
                         ELSE uss_esr.TOOLS.GetOrgRegName (o.org_id)
                     END                   reg_name,
                     NVL (a_cnt, 0)        cnt_eoc_assing, --" ≥льк≥сть ≈ќ— призн.",
                     -- IC #86948
                     NVL (a_fam_qnt, 0)    cnt_fam_assing, --"„лен≥в с≥мей призн.",
                     NVL (a_assing, 0)     sum_assing,         --"ѕризначено",
                     NVL (x_cnt, 0)        cnt_eoc_narah, --" -сть ≈ќ— нарах.",
                     NVL (x_fam_qnt, 0)    cnt_fam_narah, --"„лен≥в с≥мей нарах.",
                     NVL (x_narah, 0)      sum_narah           --"Ќараховано",
                --nvl(s_cnt,0)       cnt_eoc_payed,       --" -сть ≈ќ— випл.",
                --nvl(s_fam_qnt,0)   cnt_fam_payed,       --"„лен≥в с≥мей випл.",
                --nvl(s_plan_sum,0)  sum_payed_month,     --"¬иплачено м≥с€ць",
                --nvl(s_sum,0)       sum_payed_total     --"¬иплачено всього"
                FROM ikis_sys.opfu o
                     INNER JOIN org ON org_id = i_org
                     LEFT JOIN (  SELECT a_org,
                                         COUNT (DISTINCT a_pc)                a_cnt,
                                         SUM (a_assing)                       a_assing,
                                         SUM (
                                             (SELECT COUNT (DISTINCT pdf_sc)
                                                FROM uss_esr.pc_decision pd,
                                                     uss_esr.pd_family fml
                                               WHERE     pd.pd_id = fml.pdf_pd
                                                     AND NOT EXISTS
                                                             (SELECT 1
                                                                FROM uss_esr.ap_person
                                                                     p
                                                               WHERE     p.app_ap =
                                                                         pd.pd_ap
                                                                     AND p.app_sc =
                                                                         fml.pdf_sc
                                                                     AND p.history_status =
                                                                         'A'
                                                                     -- AND p.app_sc = fml.pdf_sc and p.app_tp in ('Z', 'FM', 'FP'))
                                                                     AND p.app_tp =
                                                                         'P') -- ѕредставник за€вника
                                                     AND pd.pd_id = a_pd))    AS a_fam_qnt
                                    FROM assign
                                   WHERE 1 = 1
                                GROUP BY a_org) a
                         ON a.a_org = org_id
                     LEFT JOIN (  SELECT x_org,
                                         COUNT (DISTINCT x_pc)                x_cnt,
                                         SUM (x_narah)                        x_narah,
                                         SUM (
                                             (SELECT COUNT (DISTINCT pdf_sc)
                                                FROM uss_esr.pc_decision pd,
                                                     uss_esr.pd_family fml
                                               WHERE     pd.pd_id = fml.pdf_pd
                                                     AND NOT EXISTS
                                                             (SELECT 1
                                                                FROM uss_esr.ap_person
                                                                     p
                                                               WHERE     p.app_ap =
                                                                         pd.pd_ap
                                                                     AND p.app_sc =
                                                                         fml.pdf_sc
                                                                     AND p.history_status =
                                                                         'A'
                                                                     -- AND p.app_sc = fml.pdf_sc and p.app_tp in ('Z', 'FM', 'FP'))
                                                                     AND p.app_tp =
                                                                         'P') -- ѕредставник за€вника
                                                     AND pd.pd_id = x_pd))    AS x_fam_qnt
                                    FROM nrh
                                   WHERE 1 = 1
                                GROUP BY x_org) n
                         ON x_org = org_id
                     LEFT JOIN
                     (  SELECT s_org,
                               COUNT (DISTINCT s_pc)                s_cnt,
                               SUM (
                                   (SELECT COUNT (DISTINCT pdf_sc)
                                      FROM uss_esr.pc_decision pd,
                                           uss_esr.pd_family fml
                                     WHERE     pd.pd_id = fml.pdf_pd
                                           AND NOT EXISTS
                                                   (SELECT 1
                                                      FROM uss_esr.ap_person
                                                           p
                                                     WHERE     p.app_ap =
                                                               pd.pd_ap
                                                           AND p.app_sc =
                                                               fml.pdf_sc
                                                           AND p.history_status =
                                                               'A'
                                                           -- AND p.app_sc = fml.pdf_sc and p.app_tp in ('Z', 'FM', 'FP'))
                                                           AND p.app_tp =
                                                               'P') -- ѕредставник за€вника
                                           AND pd.pd_id = x_pd))    AS s_fam_qnt,
                               SUM (s_sum)                          s_sum,
                               SUM (s_plan_sum)                     s_plan_sum
                          FROM payed
                         WHERE 1 = 1
                      GROUP BY s_org) p
                         ON s_org = org_id
               WHERE     org_to = CASE WHEN l_raj = 1 THEN 32 ELSE 31 END
                     AND org_org =
                         CASE WHEN l_raj = 1 THEN org_org ELSE 50000 END
                     AND org_code NOT IN ('54000', '54300') -- м. —евастополь, ј–  рим
                     AND o.org_st = 'A'
            ORDER BY 1;
    END SET_DS_PDP_VPO;

    -- IC #85154 ƒов≥дка про стан наданн€ допомоги ¬ѕќ на проживанн€ (з урахуванн€м попередн≥х пер≥од≥в)
    PROCEDURE SET_DS_PAID_VPO (p_start_dt   IN DATE,
                               p_org_id     IN NUMBER,
                               p_jbr_id     IN DECIMAL)
    IS
        l_user_org   NUMBER;
        l_raj        NUMBER := 0;
    BEGIN
        IF p_org_id = 0
        THEN
            l_user_org := Tools.GetCurrOrg;
        ELSE
            l_user_org := p_org_id;
        END IF;

        IF Tools.GetCurrOrg NOT IN (50000, 50001)
        THEN
            l_raj := 1;
        END IF;

        DELETE FROM tmp_univ_rpt_data
              WHERE 1 = 1;

        INSERT INTO tmp_univ_rpt_data (x_id1,
                                       x_string1,
                                       x_sum1,
                                       x_id2,
                                       x_id3)
            WITH
                org
                AS
                    (    SELECT org_id     i_org
                           FROM ikis_sys.v_opfu
                     CONNECT BY PRIOR org_id = org_org
                     START WITH org_id =
                                CASE
                                    WHEN l_user_org = 50001 THEN 50000
                                    ELSE l_user_org
                                END),
                payed
                AS
                    (  SELECT CASE WHEN l_raj = 1 THEN org_id ELSE org_org END
                                  AS s_org,
                              COUNT (DISTINCT prs_pc)
                                  AS s_pc_cnt,
                              pr_month
                                  AS s_month,
                              SUM (
                                  CASE
                                      WHEN     prs_st IN ('NA', 'KV1', 'KV2')
                                           AND prsd_tp IN ('PWI', 'RDN')
                                      THEN
                                          prsd_sum
                                  END)
                                  AS s_sum_curr,
                              COUNT (
                                  DISTINCT
                                      CASE
                                          WHEN prs_st IN ('NA', 'KV1', 'KV2')
                                          THEN
                                              prs_pc
                                      END)
                                  AS s_cnt_curr,
                              SUM (
                                  CASE
                                      WHEN     prs_st IN ('PK1')
                                           AND prsd_tp IN ('PWI', 'RDN')
                                      THEN
                                          prsd_sum
                                  END)
                                  AS s_sum_pk1,
                              COUNT (
                                  DISTINCT
                                      CASE
                                          WHEN     prs_st IN ('PK1')
                                               AND prsd_tp IN ('PWI', 'RDN')
                                          THEN
                                              prs_pc
                                      END)
                                  AS s_cnt_pk1,
                              SUM (
                                  CASE
                                      WHEN     prs_st IN ('PK2')
                                           AND prsd_tp IN ('PWI', 'RDN')
                                      THEN
                                          prsd_sum
                                  END)
                                  AS s_sum_pk2,
                              COUNT (
                                  DISTINCT
                                      CASE
                                          WHEN     prs_st IN ('PK2')
                                               AND prsd_tp IN ('PWI', 'RDN')
                                          THEN
                                              prs_pc
                                      END)
                                  AS s_cnt_pk2,
                              SUM (
                                  CASE
                                      WHEN     prs_st IN ('PP')
                                           AND prsd_tp IN ('PWI', 'RDN')
                                      THEN
                                          prsd_sum
                                  END)
                                  AS s_sum_pp,
                              SUM (CASE
                                       WHEN     prs_st IN ('NA',
                                                           'KV1',
                                                           'KV2',
                                                           'PK1',
                                                           'PK2')
                                            AND prsd_tp IN ('PWI', 'RDN')
                                       THEN
                                           prsd_sum
                                   END)
                                  AS s_sum_pwi,
                              SUM (CASE
                                       WHEN     prs_st IN ('NA',
                                                           'KV1',
                                                           'KV2',
                                                           'PK1',
                                                           'PK2')
                                            AND prsd_tp NOT IN ('PWI', 'RDN')
                                       THEN
                                           prsd_sum
                                   END)
                                  AS s_sum_non_pwi,
                              SUM (
                                  CASE
                                      WHEN prs_st IN ('NA',
                                                      'KV1',
                                                      'KV2',
                                                      'PK1',
                                                      'PK2')
                                      THEN
                                          CASE
                                              WHEN prsd_tp IN ('PWI', 'RDN')
                                              THEN
                                                  prsd_sum
                                              ELSE
                                                  -prsd_sum
                                          END
                                  END)
                                  AS s_sum_full,
                              -- —ума виплачено = сума в реЇстрах (що направл€лись в банк) - сума квитанц≥й (кв1+кв2)
                              --                          SUM(CASE WHEN prs_st IN ('NA', 'PK1', 'PK2') THEN CASE WHEN prsd_tp = 'PWI' THEN prsd_sum ELSE -prsd_sum END END) AS s_sum_full,
                              COUNT (DISTINCT CASE
                                                  WHEN prs_st IN ('NA',
                                                                  'KV1',
                                                                  'KV2',
                                                                  'PK1',
                                                                  'PK2')
                                                  THEN
                                                      prs_pc
                                              END)
                                  AS s_cnt_full,
                              COUNT (CASE
                                         WHEN prs_st IN ('NA',
                                                         'KV1',
                                                         'KV2',
                                                         'PK1',
                                                         'PK2')
                                         THEN
                                             prs_pc
                                     END)
                                  AS s_cnt_fml_full,
                              COUNT (
                                  DISTINCT CASE
                                               WHEN     prs_st IN ('NA',
                                                                   'KV1',
                                                                   'KV2',
                                                                   'PK1',
                                                                   'PK2')
                                                    AND pr_month = prsd_month
                                               THEN
                                                   prs_pc
                                           END)
                                  AS s_cnt_full_curr,
                              SUM (
                                  CASE
                                      WHEN     prs_st IN ('NA',
                                                          'KV1',
                                                          'KV2',
                                                          'PK1',
                                                          'PK2')
                                           AND pr_month = prsd_month
                                      THEN
                                          CASE
                                              WHEN prsd_tp IN ('PWI', 'RDN')
                                              THEN
                                                  prsd_sum
                                              ELSE
                                                  -prsd_sum
                                          END
                                  END)
                                  AS s_sum_full_curr,
                              MAX (CASE
                                       WHEN prs_st IN ('NA',
                                                       'KV1',
                                                       'KV2',
                                                       'PK1',
                                                       'PK2')
                                       THEN
                                           (SELECT MAX (d.acd_pd)
                                              FROM uss_esr.ac_detail d
                                             WHERE d.acd_prsd = prsd_id)
                                   END)
                                  x_pd
                         FROM ikis_sys.v_opfu,
                              uss_esr.pr_sheet_detail,
                              uss_esr.pr_sheet,
                              uss_esr.payroll pr,
                              org
                        WHERE     org_to = 32
                              AND pr.com_org = org_id
                              AND prs_pr = pr_id
                              AND org_id = i_org
                              --AND prsd_pr = pr_id
                              AND prsd_prs = prs_id
                              AND pr_npc = 24                           -- ¬ѕќ
                              AND pr_month = TRUNC (p_start_dt, 'mm') -- « дати старту виплат по ¬ѕќ
                              AND pr_st IN ('F')
                     GROUP BY CASE
                                  WHEN l_raj = 1 THEN org_id
                                  ELSE org_org
                              END,
                              pr_month,
                              prs_pc)
              SELECT org_code,                                   --" од ƒ—«Ќ",
                     CASE
                         WHEN l_raj = 1 THEN o.org_name
                         ELSE uss_esr.TOOLS.GetOrgRegName (o.org_id)
                     END                              reg_name,
                     --org_name, --"Ќазва",
                     --s_month, --AS "ћ≥с€ць",
                     --s_cnt, --" ≥льк≥сть ≈ќ—",
                     --s_sum_curr, --"Ќе заблоковано",
                     --s_cnt_curr, --" ≥льк≥сть ≈ќ— по `не заблоковано`",
                     --s_sum_pk1, --"—ума заблокована KV1",
                     --s_cnt_pk1, --"≈ќ— блокувалось KV1",
                     --s_sum_pk2, --"—ума заблокована KV2",
                     --s_cnt_pk2, --"≈ќ— блокувалось KV2",
                     --s_sum_pwi, --AS "Ќараховано по в≥домост€м",
                     --s_sum_non_pwi, --AS "¬≥драхуванн€",
                     NVL (SUM (s_sum_full), 0)        sum_full, --AS "—ума в реЇстри",
                     --s_sum_full_curr, --AS "—ума в реЇстраи за `поточний`",
                     NVL (SUM (s_cnt_full), 0)        cnt_full, --" ≥льк≥сть ≈ќ— по сумам `в реЇстри`"
                     NVL (SUM (s_cnt_fml_full), 0)    cnt_fml_full
                FROM ikis_sys.opfu o
                     INNER JOIN org ON org_id = i_org
                     LEFT JOIN
                     (  SELECT s_org,
                               s_month,
                               SUM (s_pc_cnt)                       s_cnt,
                               SUM (s_sum_curr)                     s_sum_curr,
                               SUM (s_cnt_curr)                     AS s_cnt_curr,
                               SUM (s_sum_pk1)                      s_sum_pk1,
                               SUM (s_cnt_pk1)                      s_cnt_pk1,
                               SUM (s_sum_pk2)                      s_sum_pk2,
                               SUM (s_cnt_pk2)                      s_cnt_pk2,
                               SUM (s_sum_pp)                       s_sum_pp,
                               SUM (s_sum_pwi)                      AS s_sum_pwi,
                               SUM (s_sum_non_pwi)                  AS s_sum_non_pwi,
                               NVL (SUM (s_sum_full), 0)            AS s_sum_full,
                               SUM (s_sum_full_curr)                AS s_sum_full_curr,
                               NVL (SUM (s_cnt_full), 0)            AS s_cnt_full,
                               --NVL(SUM(s_cnt_fml_full),0) AS s_cnt_fml_full
                               SUM (
                                   (SELECT COUNT (DISTINCT pdf_sc)
                                      FROM uss_esr.pc_decision pd,
                                           uss_esr.pd_family fml
                                     WHERE     pd.pd_id = fml.pdf_pd
                                           AND NOT EXISTS
                                                   (SELECT 1
                                                      FROM uss_esr.ap_person p
                                                     WHERE     p.app_ap =
                                                               pd.pd_ap
                                                           AND p.app_sc =
                                                               fml.pdf_sc
                                                           AND p.history_status =
                                                               'A'
                                                           -- AND p.app_sc = fml.pdf_sc and p.app_tp in ('Z', 'FM', 'FP'))
                                                           AND p.app_tp = 'P') -- ѕредставник за€вника
                                           AND pd.pd_id = x_pd))    s_cnt_fml_full
                          FROM payed
                         WHERE 1 = 1
                      GROUP BY s_org, s_month)
                         ON s_org = org_id
               WHERE     org_to = CASE WHEN l_raj = 1 THEN 32 ELSE 31 END
                     AND org_org =
                         CASE WHEN l_raj = 1 THEN org_org ELSE 50000 END
                     AND org_code NOT IN ('54000', '54300') -- м. —евастополь, ј–  рим
                     AND o.org_st = 'A'
            GROUP BY org_code,
                     CASE
                         WHEN l_raj = 1 THEN o.org_name
                         ELSE uss_esr.TOOLS.GetOrgRegName (o.org_id)
                     END
            ORDER BY 1;
    END SET_DS_PAID_VPO;

    -- IC #85153 ƒинам≥ка ключових показник≥в, €к≥ характеризують стан наданн€ допомоги ¬ѕќ на проживанн€
    PROCEDURE SET_DS_PAID2_VPO (p_start_dt   IN DATE,
                                p_org_id     IN NUMBER,
                                p_jbr_id     IN DECIMAL)
    IS
        p_year       VARCHAR2 (4);
        l_user_org   NUMBER;
        l_raj        NUMBER := 0;
    BEGIN
        IF p_org_id = 0
        THEN
            l_user_org := Tools.GetCurrOrg;
        ELSE
            l_user_org := p_org_id;
        END IF;

        IF Tools.GetCurrOrg NOT IN (50000, 50001)
        THEN
            l_raj := 1;
        END IF;

        p_year := TO_CHAR (p_start_dt, 'yyyy');

        DELETE FROM tmp_univ_rpt_data
              WHERE 1 = 1;

        INSERT INTO tmp_univ_rpt_data (x_id1,
                                       x_string1,
                                       x_sum1,
                                       x_id2,
                                       x_id3,
                                       x_string2)
            WITH
                org
                AS
                    (    SELECT org_id     i_org
                           FROM ikis_sys.v_opfu
                     CONNECT BY PRIOR org_id = org_org
                     START WITH org_id =
                                CASE
                                    WHEN l_user_org = 50001 THEN 50000
                                    ELSE l_user_org
                                END),
                payed
                AS
                    (  SELECT CASE WHEN l_raj = 1 THEN org_id ELSE org_org END
                                  AS s_org,
                              COUNT (DISTINCT prs_pc)
                                  AS s_pc_cnt,
                              pr_month
                                  AS s_month,
                              SUM (
                                  CASE
                                      WHEN     prs_st IN ('NA', 'KV1', 'KV2')
                                           AND prsd_tp IN ('PWI', 'RDN')
                                      THEN
                                          prsd_sum
                                  END)
                                  AS s_sum_curr,
                              COUNT (
                                  DISTINCT
                                      CASE
                                          WHEN prs_st IN ('NA', 'KV1', 'KV2')
                                          THEN
                                              prs_pc
                                      END)
                                  AS s_cnt_curr,
                              SUM (
                                  CASE
                                      WHEN     prs_st IN ('PK1')
                                           AND prsd_tp IN ('PWI', 'RDN')
                                      THEN
                                          prsd_sum
                                  END)
                                  AS s_sum_pk1,
                              COUNT (
                                  DISTINCT
                                      CASE
                                          WHEN     prs_st IN ('PK1')
                                               AND prsd_tp IN ('PWI', 'RDN')
                                          THEN
                                              prs_pc
                                      END)
                                  AS s_cnt_pk1,
                              SUM (
                                  CASE
                                      WHEN     prs_st IN ('PK2')
                                           AND prsd_tp IN ('PWI', 'RDN')
                                      THEN
                                          prsd_sum
                                  END)
                                  AS s_sum_pk2,
                              COUNT (
                                  DISTINCT
                                      CASE
                                          WHEN     prs_st IN ('PK2')
                                               AND prsd_tp IN ('PWI', 'RDN')
                                          THEN
                                              prs_pc
                                      END)
                                  AS s_cnt_pk2,
                              SUM (
                                  CASE
                                      WHEN     prs_st IN ('PP')
                                           AND prsd_tp IN ('PWI', 'RDN')
                                      THEN
                                          prsd_sum
                                  END)
                                  AS s_sum_pp,
                              SUM (CASE
                                       WHEN     prs_st IN ('NA',
                                                           'KV1',
                                                           'KV2',
                                                           'PK1',
                                                           'PK2')
                                            AND prsd_tp IN ('PWI', 'RDN')
                                       THEN
                                           prsd_sum
                                   END)
                                  AS s_sum_pwi,
                              SUM (CASE
                                       WHEN     prs_st IN ('NA',
                                                           'KV1',
                                                           'KV2',
                                                           'PK1',
                                                           'PK2')
                                            AND prsd_tp NOT IN ('PWI', 'RDN')
                                       THEN
                                           prsd_sum
                                   END)
                                  AS s_sum_non_pwi,
                              SUM (
                                  CASE
                                      WHEN prs_st IN ('NA',
                                                      'KV1',
                                                      'KV2',
                                                      'PK1',
                                                      'PK2')
                                      THEN
                                          CASE
                                              WHEN prsd_tp IN ('PWI', 'RDN')
                                              THEN
                                                  prsd_sum
                                              ELSE
                                                  -prsd_sum
                                          END
                                  END)
                                  AS s_sum_full,
                              -- —ума виплачено = сума в реЇстрах (що направл€лись в банк) - сума квитанц≥й (кв1+кв2)
                              --                          SUM(CASE WHEN prs_st IN ('NA', 'PK1', 'PK2') THEN CASE WHEN prsd_tp = 'PWI' THEN prsd_sum ELSE -prsd_sum END END) AS s_sum_full,
                              COUNT (DISTINCT CASE
                                                  WHEN prs_st IN ('NA',
                                                                  'KV1',
                                                                  'KV2',
                                                                  'PK1',
                                                                  'PK2')
                                                  THEN
                                                      prs_pc
                                              END)
                                  AS s_cnt_full,
                              COUNT (
                                  CASE
                                      WHEN prs_st IN ('NA', 'PK1', 'PK2')
                                      THEN
                                          prs_pc
                                  END)
                                  AS s_cnt_fml_full,
                              COUNT (
                                  DISTINCT CASE
                                               WHEN     prs_st IN ('NA',
                                                                   'KV1',
                                                                   'KV2',
                                                                   'PK1',
                                                                   'PK2')
                                                    AND pr_month = prsd_month
                                               THEN
                                                   prs_pc
                                           END)
                                  AS s_cnt_full_curr,
                              SUM (
                                  CASE
                                      WHEN     prs_st IN ('NA',
                                                          'KV1',
                                                          'KV2',
                                                          'PK1',
                                                          'PK2')
                                           AND pr_month = prsd_month
                                      THEN
                                          CASE
                                              WHEN prsd_tp IN ('PWI', 'RDN')
                                              THEN
                                                  prsd_sum
                                              ELSE
                                                  -prsd_sum
                                          END
                                  END)
                                  AS s_sum_full_curr,
                              MAX (CASE
                                       WHEN prs_st IN ('NA',
                                                       'KV1',
                                                       'KV2',
                                                       'PK1',
                                                       'PK2')
                                       THEN
                                           (SELECT MAX (d.acd_pd)
                                              FROM uss_esr.ac_detail d
                                             WHERE d.acd_prsd = prsd_id)
                                   END)
                                  x_pd
                         FROM ikis_sys.v_opfu,
                              uss_esr.pr_sheet_detail,
                              uss_esr.pr_sheet,
                              uss_esr.payroll pr,
                              org
                        WHERE     org_to = 32
                              AND pr.com_org = org_id
                              AND prs_pr = pr_id
                              AND org_id = i_org
                              --AND prsd_pr = pr_id
                              AND prsd_prs = prs_id
                              AND pr_npc = 24
                              AND pr_month BETWEEN TO_DATE ('01.01.' || p_year,
                                                            'dd.mm.yyyy')
                                               AND TO_DATE ('31.12.' || p_year,
                                                            'dd.mm.yyyy')
                              AND pr_st IN ('F')
                     GROUP BY CASE
                                  WHEN l_raj = 1 THEN org_id
                                  ELSE org_org
                              END,
                              pr_month,
                              prs_pc)
              SELECT org_code,                                   --" од ƒ—«Ќ",
                     CASE
                         WHEN l_raj = 1 THEN o.org_name
                         ELSE uss_esr.TOOLS.GetOrgRegName (o.org_id)
                     END                              reg_name,
                     --org_name, --"Ќазва",
                     --s_month, --AS "ћ≥с€ць",
                     --s_cnt, --" ≥льк≥сть ≈ќ—",
                     --s_sum_curr, --"Ќе заблоковано",
                     --s_cnt_curr, --" ≥льк≥сть ≈ќ— по `не заблоковано`",
                     --s_sum_pk1, --"—ума заблокована KV1",
                     --s_cnt_pk1, --"≈ќ— блокувалось KV1",
                     --s_sum_pk2, --"—ума заблокована KV2",
                     --s_cnt_pk2, --"≈ќ— блокувалось KV2",
                     --s_sum_pwi, --AS "Ќараховано по в≥домост€м",
                     --s_sum_non_pwi, --AS "¬≥драхуванн€",
                     SUM (s_sum_full)                 sum_full, --AS "—ума в реЇстри",
                     --s_sum_full_curr, --AS "—ума в реЇстраи за `поточний`",
                     SUM (s_cnt_full)                 cnt_full, --" ≥льк≥сть ≈ќ— по сумам `в реЇстри`"
                     NVL (SUM (s_cnt_fml_full), 0)    cnt_fml_full,
                     mm_rn
                FROM ikis_sys.opfu o
                     INNER JOIN org ON org_id = i_org
                     LEFT JOIN
                     (  SELECT s_org,
                               s_month,
                               SUM (s_pc_cnt)
                                   s_cnt,
                               SUM (s_sum_curr)
                                   s_sum_curr,
                               SUM (s_cnt_curr)
                                   AS s_cnt_curr,
                               SUM (s_sum_pk1)
                                   s_sum_pk1,
                               SUM (s_cnt_pk1)
                                   s_cnt_pk1,
                               SUM (s_sum_pk2)
                                   s_sum_pk2,
                               SUM (s_cnt_pk2)
                                   s_cnt_pk2,
                               SUM (s_sum_pp)
                                   s_sum_pp,
                               SUM (s_sum_pwi)
                                   AS s_sum_pwi,
                               SUM (s_sum_non_pwi)
                                   AS s_sum_non_pwi,
                               NVL (SUM (s_sum_full), 0)
                                   AS s_sum_full,
                               SUM (s_sum_full_curr)
                                   AS s_sum_full_curr,
                               NVL (SUM (s_cnt_full), 0)
                                   AS s_cnt_full,
                               --NVL(SUM(s_cnt_fml_full),0) AS s_cnt_fml_full,
                               SUM (
                                   (SELECT COUNT (DISTINCT pdf_sc)
                                      FROM uss_esr.pc_decision pd,
                                           uss_esr.pd_family fml
                                     WHERE     pd.pd_id = fml.pdf_pd
                                           AND NOT EXISTS
                                                   (SELECT 1
                                                      FROM uss_esr.ap_person p
                                                     WHERE     p.app_ap =
                                                               pd.pd_ap
                                                           AND p.app_sc =
                                                               fml.pdf_sc
                                                           AND p.history_status =
                                                               'A'
                                                           -- AND p.app_sc = fml.pdf_sc and p.app_tp in ('Z', 'FM', 'FP'))
                                                           AND p.app_tp = 'P') -- ѕредставник за€вника
                                           AND pd.pd_id = x_pd))
                                   s_cnt_fml_full,
                               TO_CHAR (s_month, 'mm')
                                   mm_rn
                          FROM payed
                         WHERE 1 = 1
                      GROUP BY s_org, s_month)
                         ON s_org = org_id
               WHERE     org_to = CASE WHEN l_raj = 1 THEN 32 ELSE 31 END
                     AND org_org =
                         CASE WHEN l_raj = 1 THEN org_org ELSE 50000 END
                     AND org_code NOT IN ('54000', '54300') -- м. —евастополь, ј–  рим
                     AND o.org_st = 'A'
            GROUP BY org_code,
                     CASE
                         WHEN l_raj = 1 THEN o.org_name
                         ELSE uss_esr.TOOLS.GetOrgRegName (o.org_id)
                     END,
                     mm_rn
            ORDER BY 1, 6;
    END SET_DS_PAID2_VPO;

    -- IC #85156 ƒан≥ про нарахован≥ та виплачен≥ суми по окремих видах допомог, п≥льг та субсид≥йї (щодо допомоги на проживанн€ ¬ѕќ)
    PROCEDURE SET_DS_PAID3_VPO (p_start_dt   IN DATE,
                                p_org_id     IN NUMBER,
                                p_jbr_id     IN DECIMAL)
    IS
        l_user_org   NUMBER;
        l_raj        NUMBER := 0;
    BEGIN
        IF p_org_id = 0
        THEN
            l_user_org := Tools.GetCurrOrg;
        ELSE
            l_user_org := p_org_id;
        END IF;

        IF Tools.GetCurrOrg NOT IN (50000, 50001)
        THEN
            l_raj := 1;
        END IF;

        DELETE FROM tmp_univ_rpt_data
              WHERE 1 = 1;

        INSERT INTO tmp_univ_rpt_data (x_id1,
                                       x_string1,
                                       x_id2,
                                       x_sum1,
                                       x_id3,
                                       x_sum2)
            WITH
                org
                AS
                    (    SELECT org_id     i_org
                           FROM ikis_sys.v_opfu
                     CONNECT BY PRIOR org_id = org_org
                     START WITH org_id =
                                CASE
                                    WHEN l_user_org = 50001 THEN 50000
                                    ELSE l_user_org
                                END),
                nrh
                AS
                    (  SELECT CASE WHEN l_raj = 1 THEN org_id ELSE org_org END
                                  AS x_org,
                              ac_pc
                                  AS x_pc,
                              acd_pd
                                  AS x_pd,
                              SUM (
                                  uss_esr.api$accrual.xsign (acd_op) * acd_sum)
                                  AS x_narah
                         FROM ikis_sys.v_opfu,
                              uss_esr.accrual,
                              uss_esr.ac_detail d,
                              uss_ndi.v_ndi_op,
                              org
                        WHERE     org_to = 32
                              AND com_org = org_id
                              AND org_id = i_org
                              AND ac_month = TRUNC (p_start_dt, 'MM')
                              AND acd_start_dt BETWEEN TRUNC (p_start_dt, 'MM')
                                                   AND TRUNC (
                                                           LAST_DAY (
                                                               p_start_dt))
                              AND acd_ac = ac_id
                              AND (acd_op IN (1, 2, 3) OR op_tp1 IN ('NR'))
                              AND acd_op = op_id
                              AND d.history_status = 'A'
                              AND acd_npt IN (SELECT nptc_npt
                                                FROM USS_NDI.v_Ndi_Npt_Config
                                               WHERE nptc_nst = 664)
                     GROUP BY CASE
                                  WHEN l_raj = 1 THEN org_id
                                  ELSE org_org
                              END,
                              ac_pc,
                              acd_pd),
                payed
                AS
                    (  SELECT CASE WHEN l_raj = 1 THEN org_id ELSE org_org END
                                  AS s_org,
                              COUNT (DISTINCT prs_pc)
                                  AS s_pc_cnt,
                              SUM (
                                  CASE
                                      WHEN     prs_st IN ('NA', 'KV1', 'KV2')
                                           AND prsd_tp IN ('PWI', 'RDN')
                                      THEN
                                          prsd_sum
                                  END)
                                  AS s_sum_curr,
                              COUNT (
                                  DISTINCT
                                      CASE
                                          WHEN prs_st IN ('NA', 'KV1', 'KV2')
                                          THEN
                                              prs_pc
                                      END)
                                  AS s_cnt_curr,
                              SUM (
                                  CASE
                                      WHEN     prs_st IN ('PK1')
                                           AND prsd_tp IN ('PWI', 'RDN')
                                      THEN
                                          prsd_sum
                                  END)
                                  AS s_sum_pk1,
                              COUNT (
                                  DISTINCT
                                      CASE
                                          WHEN     prs_st IN ('PK1')
                                               AND prsd_tp IN ('PWI', 'RDN')
                                          THEN
                                              prs_pc
                                      END)
                                  AS s_cnt_pk1,
                              SUM (
                                  CASE
                                      WHEN     prs_st IN ('PK2')
                                           AND prsd_tp IN ('PWI', 'RDN')
                                      THEN
                                          prsd_sum
                                  END)
                                  AS s_sum_pk2,
                              COUNT (
                                  DISTINCT
                                      CASE
                                          WHEN     prs_st IN ('PK2')
                                               AND prsd_tp IN ('PWI', 'RDN')
                                          THEN
                                              prs_pc
                                      END)
                                  AS s_cnt_pk2,
                              SUM (
                                  CASE
                                      WHEN     prs_st IN ('PP')
                                           AND prsd_tp IN ('PWI', 'RDN')
                                      THEN
                                          prsd_sum
                                  END)
                                  AS s_sum_pp,
                              SUM (CASE
                                       WHEN     prs_st IN ('NA',
                                                           'KV1',
                                                           'KV2',
                                                           'PK1',
                                                           'PK2')
                                            AND prsd_tp IN ('PWI', 'RDN')
                                       THEN
                                           prsd_sum
                                   END)
                                  AS s_sum_pwi,
                              SUM (CASE
                                       WHEN     prs_st IN ('NA',
                                                           'KV1',
                                                           'KV2',
                                                           'PK1',
                                                           'PK2')
                                            AND prsd_tp NOT IN ('PWI', 'RDN')
                                       THEN
                                           prsd_sum
                                   END)
                                  AS s_sum_non_pwi,
                              --                          SUM(CASE WHEN prs_st IN ('NA', 'KV1', 'KV2', 'PK1', 'PK2') THEN CASE WHEN prsd_tp = 'PWI' THEN prsd_sum ELSE -prsd_sum END END) AS s_sum_full,
                              -- —ума виплачено = сума в реЇстрах (що направл€лись в банк) - сума квитанц≥й (кв1+кв2)
                              SUM (
                                  CASE
                                      WHEN prs_st IN ('NA', 'PK1', 'PK2')
                                      THEN
                                          CASE
                                              WHEN prsd_tp IN ('PWI', 'RDN')
                                              THEN
                                                  prsd_sum
                                              ELSE
                                                  -prsd_sum
                                          END
                                  END)
                                  AS s_sum_full,
                              COUNT (
                                  DISTINCT
                                      CASE
                                          WHEN prs_st IN ('NA', 'PK1', 'PK2')
                                          THEN
                                              prs_pc
                                      END)
                                  AS s_cnt_full,
                              COUNT (
                                  CASE
                                      WHEN prs_st IN ('NA', 'PK1', 'PK2')
                                      THEN
                                          prs_pc
                                  END)
                                  AS s_cnt_fml_full,
                              COUNT (
                                  DISTINCT CASE
                                               WHEN     prs_st IN ('NA',
                                                                   'KV1',
                                                                   'KV2',
                                                                   'PK1',
                                                                   'PK2')
                                                    AND pr_month = prsd_month
                                               THEN
                                                   prs_pc
                                           END)
                                  AS s_cnt_full_curr,
                              SUM (
                                  CASE
                                      WHEN     prs_st IN ('NA',
                                                          'KV1',
                                                          'KV2',
                                                          'PK1',
                                                          'PK2')
                                           AND pr_month = prsd_month
                                      THEN
                                          CASE
                                              WHEN prsd_tp IN ('PWI', 'RDN')
                                              THEN
                                                  prsd_sum
                                              ELSE
                                                  -prsd_sum
                                          END
                                  END)
                                  AS s_sum_full_curr
                         FROM ikis_sys.v_opfu,
                              uss_esr.pr_sheet_detail,
                              uss_esr.pr_sheet,
                              uss_esr.payroll pr,
                              org
                        WHERE     org_to = 32
                              AND pr.com_org = org_id
                              AND prs_pr = pr_id
                              AND org_id = i_org
                              --AND prsd_pr = pr_id
                              AND prsd_prs = prs_id
                              AND pr_npc = 24
                              AND pr_month = TRUNC (p_start_dt, 'MM')
                              AND pr_st IN ('F')
                     GROUP BY CASE
                                  WHEN l_raj = 1 THEN org_id
                                  ELSE org_org
                              END)
              SELECT org_code,                                    --" од ƒ—«Ќ"
                     --org_name,  -- "Ќазва",
                     CASE
                         WHEN l_raj = 1 THEN org_name
                         ELSE uss_esr.TOOLS.GetOrgRegName (o.org_id)
                     END                    reg_name,
                     --nvl(a_cnt,0)       cnt_eoc_assing,      --" ≥льк≥сть ≈ќ— призн.",
                     --nvl(a_fam_qnt,0)   cnt_fam_assing,      --"„лен≥в с≥мей призн.",
                     --nvl(a_assing,0)    sum_assing,          --"ѕризначено",
                     NVL (x_cnt, 0)         cnt_eoc_narah, --" -сть ≈ќ— нарах.",
                     --nvl(x_fam_qnt,0)   cnt_fam_narah,       --"„лен≥в с≥мей нарах.",
                     NVL (x_narah, 0)       sum_narah,         --"Ќараховано",
                     NVL (s_cnt, 0)         cnt_eoc_payed, --" -сть ≈ќ— випл.",
                     --nvl(s_fam_qnt,0)   cnt_fam_payed,       --"„лен≥в с≥мей випл.",
                     NVL (s_plan_sum, 0)    sum_payed_month --"¬иплачено м≥с€ць",
                --nvl(s_sum,0)       sum_payed_total     --"¬иплачено всього"
                FROM ikis_sys.opfu o
                     INNER JOIN org ON org_id = i_org
                     LEFT JOIN (  SELECT x_org,
                                         COUNT (DISTINCT x_pc)                x_cnt,
                                         SUM (x_narah)                        x_narah,
                                         SUM (
                                             (SELECT COUNT (DISTINCT pdf_sc)
                                                FROM uss_esr.pc_decision pd,
                                                     uss_esr.pd_family fml
                                               WHERE     pd.pd_id = fml.pdf_pd
                                                     AND NOT EXISTS
                                                             (SELECT 1
                                                                FROM uss_esr.ap_person
                                                                     p
                                                               WHERE     p.app_ap =
                                                                         pd.pd_ap
                                                                     AND p.app_sc =
                                                                         fml.pdf_sc
                                                                     AND p.history_status =
                                                                         'A'
                                                                     -- AND p.app_sc = fml.pdf_sc and p.app_tp in ('Z', 'FM', 'FP'))
                                                                     AND p.app_tp =
                                                                         'P') -- ѕредставник за€вника
                                                     AND pd.pd_id = x_pd))    AS x_fam_qnt
                                    FROM nrh
                                   WHERE 1 = 1
                                GROUP BY x_org) n
                         ON x_org = org_id
                     LEFT JOIN (  SELECT s_org,
                                         SUM (s_cnt_full_curr)     s_cnt,
                                         --SUM((SELECT COUNT(DISTINCT pdf_sc) FROM uss_esr.pd_family WHERE pdf_pd = x_pd)) AS s_fam_qnt,
                                         SUM (s_sum_full)          s_sum,
                                         SUM (s_sum_full_curr)     s_plan_sum
                                    FROM payed
                                   WHERE 1 = 1
                                GROUP BY s_org) p
                         ON s_org = org_id
               WHERE     org_to = CASE WHEN l_raj = 1 THEN 32 ELSE 31 END
                     AND org_org =
                         CASE WHEN l_raj = 1 THEN org_org ELSE 50000 END
                     AND org_code NOT IN ('54000', '54300') -- м. —евастополь, ј–  рим
                     AND o.org_st = 'A'
            ORDER BY 1;
    END SET_DS_PAID3_VPO;


    -- IC #87518 ƒан≥ щодо виплати допомоги ¬ѕќ
    PROCEDURE SET_DS_PAID_VPO_R4 (p_start_dt   IN DATE,
                                  p_org_id     IN NUMBER,
                                  p_jbr_id     IN DECIMAL)
    IS
        l_user_org   NUMBER;
        l_raj        NUMBER := 0;
    BEGIN
        IF p_org_id = 0
        THEN
            l_user_org := Tools.GetCurrOrg;
        ELSE
            l_user_org := p_org_id;
        END IF;

        IF Tools.GetCurrOrg NOT IN (50000, 50001)
        THEN
            l_raj := 1;
        END IF;

        DELETE FROM tmp_univ_rpt_data
              WHERE 1 = 1;

        INSERT INTO tmp_univ_rpt_data (x_dt1,                          -- a_dt
                                       x_sum1,                      -- pdp_sum
                                       x_id1,                        -- cnt_2K
                                       x_id2,                        -- cnt_3k
                                       x_id3,                       -- cnt_fml
                                       x_sum2,                  -- pdp_sum_err
                                       x_sum3,                       -- prc_2K
                                       x_id5)                            -- rn
            WITH
                dt_rep
                AS
                    (    SELECT ADD_MONTHS (TRUNC (p_start_dt, 'yy'), LEVEL - 1)    dt_r
                           FROM DUAL
                     CONNECT BY LEVEL <= 12),
                assign
                AS
                    (  SELECT pc_id             a_pc,
                              pd_id             a_pd,
                              dt_r              a_dt,
                              SUM (pdp_sum)     pdp_sum
                         FROM uss_esr.personalcase     pc,
                              uss_esr.pc_decision      pd,
                              uss_esr.pd_payment       pp,
                              uss_esr.pd_accrual_period pdap,
                              dt_rep
                        WHERE     pd_pc = pc_id
                              AND pdp_pd = pd_id
                              AND pdap_pd = pd_id
                              AND pp.history_status = 'A'
                              AND pdap.history_status = 'A'
                              AND dt_r BETWEEN pdap_start_dt AND pdap_stop_dt
                              AND dt_r BETWEEN pdp_start_dt AND pdp_stop_dt
                              AND pdp_npt IN (SELECT nptc_npt
                                                FROM USS_NDI.v_Ndi_Npt_Config
                                               WHERE nptc_nst = 664)
                     GROUP BY pc_id, pd_id, dt_r),
                dt1
                AS
                    (SELECT a_pc,
                            a_pd,
                            a_dt,
                            pdp_sum,
                            getCntDistr (pdp_sum,
                                         (SELECT COUNT (DISTINCT f.pdf_sc)
                                            FROM uss_esr.pd_family f
                                           WHERE f.pdf_pd = a_pd),
                                         2)             cnt_2k,
                            getCntDistr (pdp_sum,
                                         (SELECT COUNT (DISTINCT f.pdf_sc)
                                            FROM uss_esr.pd_family f
                                           WHERE f.pdf_pd = a_pd),
                                         3)             cnt_3k,
                            (SELECT COUNT (DISTINCT f.pdf_sc)
                               FROM uss_esr.pd_family f
                              WHERE f.pdf_pd = a_pd)    cnt_fml
                       FROM assign)
              SELECT a_dt,
                     SUM (pdp_sum)              pdp_sum,
                     SUM (cnt_2k)               cnt_2k,
                     SUM (cnt_3k)               cnt_3k,
                     SUM (cnt_fml)              cnt_fml,
                       SUM (pdp_sum)
                     - (2000 * SUM (cnt_2k))
                     - (3000 * SUM (cnt_3k))    pdp_sum_err,
                     ROUND (SUM (cnt_2k) / (SUM (cnt_2k) + SUM (cnt_3k)) * 100,
                            2)                  prc_2k,
                     1                          rn
                FROM dt1
            GROUP BY a_dt
            ORDER BY 1;

        INSERT INTO tmp_univ_rpt_data (x_dt1,                          -- a_dt
                                       x_sum1,                      -- pdp_sum
                                       x_id1,                        -- cnt_2K
                                       x_id2,                        -- cnt_3k
                                       x_id3,                       -- cnt_fml
                                       x_sum2,                  -- pdp_sum_err
                                       x_sum3,                       -- prc_2K
                                       x_id5)                            -- rn
            WITH
                prdata
                AS
                    (SELECT prs_pc,
                            pr_month,
                            prsd_month,
                            prsd_tp,
                            prs_st,
                            prsd_sum,
                            getCntDistr (
                                  prsd_sum
                                * CASE WHEN prsd_sum > 0 THEN 1 ELSE -1 END,
                                DNET$PAYMENT_REPORTS.getCntFMLbyPrsd (
                                    prsd_id),
                                2)    cnt_2k,
                            getCntDistr (
                                  prsd_sum
                                * CASE WHEN prsd_sum > 0 THEN 1 ELSE -1 END,
                                DNET$PAYMENT_REPORTS.getCntFMLbyPrsd (
                                    prsd_id),
                                3)    cnt_3k
                       FROM uss_esr.pr_sheet_detail,
                            uss_esr.pr_sheet,
                            uss_esr.payroll  pr
                      WHERE     prs_pr = pr_id
                            AND prsd_prs = prs_id
                            AND pr_month BETWEEN TO_DATE ('01.10.2022',
                                                          'DD.MM.YYYY')
                                             AND TRUNC (SYSDATE, 'mm')
                            AND pr_month BETWEEN TRUNC (p_start_dt, 'yy')
                                             AND ADD_MONTHS (
                                                     TRUNC (p_start_dt, 'yy'),
                                                     11)
                            AND pr_npc = 24
                            AND pr_st IN ('F')), -- select sum(prsd_sum) from  prdata where prsd_sum != (cnt_2k*2000) + (cnt_3k*3000)
                prdd
                AS
                    (  SELECT pr_month     AS s_month,
                              SUM (
                                  CASE
                                      WHEN     prs_st IN ('NA',
                                                          'KV1',
                                                          'KV2',
                                                          'PK1',
                                                          'PK2')
                                           AND pr_month = prsd_month
                                      THEN
                                          CASE
                                              WHEN prsd_tp IN ('PWI', 'RDN')
                                              THEN
                                                  prsd_sum
                                              ELSE
                                                  -prsd_sum
                                          END
                                      ELSE
                                          0
                                  END)     AS s_sum_narah_curr,
                              SUM (CASE
                                       WHEN     prs_st IN ('NA',
                                                           'KV1',
                                                           'KV2',
                                                           'PK1',
                                                           'PK2')
                                            AND pr_month = prsd_month
                                       THEN
                                           cnt_2k
                                       ELSE
                                           0
                                   END)    AS s_cnt_narah_curr_2k,
                              SUM (CASE
                                       WHEN     prs_st IN ('NA',
                                                           'KV1',
                                                           'KV2',
                                                           'PK1',
                                                           'PK2')
                                            AND pr_month = prsd_month
                                       THEN
                                           cnt_3k
                                       ELSE
                                           0
                                   END)    AS s_cnt_narah_curr_3k,
                              SUM (
                                  CASE
                                      WHEN     prs_st IN ('NA', 'KV1', 'KV2')
                                           AND pr_month = prsd_month
                                      THEN
                                          CASE
                                              WHEN prsd_tp IN ('PWI', 'RDN')
                                              THEN
                                                  prsd_sum
                                              ELSE
                                                  -prsd_sum
                                          END
                                      ELSE
                                          0
                                  END)     AS s_sum_payed_curr,
                              SUM (
                                  CASE
                                      WHEN     prs_st IN ('NA', 'KV1', 'KV2')
                                           AND pr_month = prsd_month
                                      THEN
                                          cnt_2k
                                      ELSE
                                          0
                                  END)     AS s_cnt_payed_curr_2k,
                              SUM (
                                  CASE
                                      WHEN     prs_st IN ('NA', 'KV1', 'KV2')
                                           AND pr_month = prsd_month
                                      THEN
                                          cnt_3k
                                      ELSE
                                          0
                                  END)     AS s_cnt_payed_curr_3k,
                              SUM (
                                  CASE
                                      WHEN     prs_st IN ('PK1', 'PK2')
                                           AND pr_month = prsd_month
                                      THEN
                                          CASE
                                              WHEN prsd_tp IN ('PWI', 'RDN')
                                              THEN
                                                  prsd_sum
                                              ELSE
                                                  -prsd_sum
                                          END
                                      ELSE
                                          0
                                  END)     AS s_sum_not_payed_curr,
                              SUM (
                                  CASE
                                      WHEN     prs_st IN ('PK1', 'PK2')
                                           AND pr_month = prsd_month
                                      THEN
                                          cnt_2k
                                      ELSE
                                          0
                                  END)     AS s_cnt_not_payed_curr_2k,
                              SUM (
                                  CASE
                                      WHEN     prs_st IN ('PK1', 'PK2')
                                           AND pr_month = prsd_month
                                      THEN
                                          cnt_3k
                                      ELSE
                                          0
                                  END)     AS s_cnt_not_payed_curr_3k,
                              SUM (
                                  CASE
                                      WHEN     prs_st IN ('NA',
                                                          'KV1',
                                                          'KV2',
                                                          'PK1',
                                                          'PK2')
                                           AND pr_month <> prsd_month
                                      THEN
                                          CASE
                                              WHEN prsd_tp IN ('PWI', 'RDN')
                                              THEN
                                                  prsd_sum
                                              ELSE
                                                  -prsd_sum
                                          END
                                      ELSE
                                          0
                                  END)     AS s_sum_narah_prev,
                              SUM (CASE
                                       WHEN     prs_st IN ('NA',
                                                           'KV1',
                                                           'KV2',
                                                           'PK1',
                                                           'PK2')
                                            AND pr_month <> prsd_month
                                       THEN
                                           cnt_2k
                                       ELSE
                                           0
                                   END)    AS s_cnt_narah_prev_2k,
                              SUM (CASE
                                       WHEN     prs_st IN ('NA',
                                                           'KV1',
                                                           'KV2',
                                                           'PK1',
                                                           'PK2')
                                            AND pr_month <> prsd_month
                                       THEN
                                           cnt_3k
                                       ELSE
                                           0
                                   END)    AS s_cnt_narah_prev_3k,
                              SUM (
                                  CASE
                                      WHEN     prs_st IN ('PK1', 'PK2')
                                           AND pr_month <> prsd_month
                                      THEN
                                          CASE
                                              WHEN prsd_tp IN ('PWI', 'RDN')
                                              THEN
                                                  prsd_sum
                                              ELSE
                                                  -prsd_sum
                                          END
                                      ELSE
                                          0
                                  END)     AS s_sum_not_payed_prev,
                              SUM (
                                  CASE
                                      WHEN     prs_st IN ('PK1', 'PK2')
                                           AND pr_month <> prsd_month
                                      THEN
                                          cnt_2k
                                      ELSE
                                          0
                                  END)     AS s_cnt_not_payed_prev_2k,
                              SUM (
                                  CASE
                                      WHEN     prs_st IN ('PK1', 'PK2')
                                           AND pr_month <> prsd_month
                                      THEN
                                          cnt_3k
                                      ELSE
                                          0
                                  END)     AS s_cnt_not_payed_prev_3k,
                              SUM (
                                  CASE
                                      WHEN prsd_tp IN ('PWI', 'RDN')
                                      THEN
                                          prsd_sum
                                      ELSE
                                          -prsd_sum
                                  END)     AS s_full_sum
                         FROM prdata
                     GROUP BY pr_month)                   --select * from prdd
                  -- Ќараховано
                  -- ќбс€г кошт≥в дл€ виплати, всього
                  SELECT s_month          dt,
                         ROUND (
                             SUM (
                                 CASE
                                     WHEN s_sum_narah_curr <> 0
                                     THEN
                                         s_sum_narah_curr
                                 END))    pdp_sum,
                         SUM (
                             CASE
                                 WHEN s_sum_narah_curr <> 0
                                 THEN
                                     s_cnt_narah_curr_2k
                             END)         cnt_2K,
                         SUM (
                             CASE
                                 WHEN s_sum_narah_curr <> 0
                                 THEN
                                     s_cnt_narah_curr_3k
                             END)         cnt_3K,
                         0                cnt_fml,
                         0                pdp_sum_err,
                         0                prc_2K,
                         2                rn
                    FROM prdd
                GROUP BY s_month
                UNION ALL
                  --'¬иплачено:'
                  --'ќбс€г кошт≥в дл€ виплати, всього',
                  SELECT s_month          dt,
                         ROUND (
                             SUM (
                                 CASE
                                     WHEN s_sum_payed_curr <> 0
                                     THEN
                                         s_sum_payed_curr
                                 END))    pdp_sum,
                         SUM (
                             CASE
                                 WHEN s_sum_payed_curr <> 0
                                 THEN
                                     s_cnt_payed_curr_2k
                             END)         cnt_2K,
                         SUM (
                             CASE
                                 WHEN s_sum_payed_curr <> 0
                                 THEN
                                     s_cnt_payed_curr_3k
                             END)         cnt_3K,
                         0                cnt_fml,
                         0                pdp_sum_err,
                         0                prc_2K,
                         3                rn
                    FROM prdd
                GROUP BY s_month
                UNION ALL
                  -- 'Ќе виплачено:'
                  -- 'ќбс€г кошт≥в дл€ виплати, всього',
                  SELECT s_month          dt,
                         ROUND (
                             SUM (
                                 CASE
                                     WHEN s_sum_not_payed_curr <> 0
                                     THEN
                                         s_sum_not_payed_curr
                                 END))    pdp_sum,
                         SUM (
                             CASE
                                 WHEN s_sum_not_payed_curr <> 0
                                 THEN
                                     s_cnt_not_payed_curr_2k
                             END)         cnt_2K,
                         SUM (
                             CASE
                                 WHEN s_sum_not_payed_curr <> 0
                                 THEN
                                     s_cnt_not_payed_curr_3k
                             END)         cnt_3K,
                         0                cnt_fml,
                         0                pdp_sum_err,
                         0                prc_2K,
                         4                rn
                    FROM prdd
                GROUP BY s_month
                UNION ALL
                  --'ѕогашенн€ заборгованост≥ за попередн≥й пер≥од:'
                  --'ќбс€г кошт≥в дл€ виплати, всього',
                  SELECT s_month          dt,
                         ROUND (
                             SUM (
                                 CASE
                                     WHEN s_sum_narah_prev <> 0
                                     THEN
                                         s_sum_narah_prev
                                 END))    pdp_sum,
                         SUM (
                             CASE
                                 WHEN s_sum_narah_prev <> 0
                                 THEN
                                     s_cnt_narah_prev_2k
                             END)         cnt_2K,
                         SUM (
                             CASE
                                 WHEN s_sum_narah_prev <> 0
                                 THEN
                                     s_cnt_narah_prev_3k
                             END)         cnt_3K,
                         0                cnt_fml,
                         0                pdp_sum_err,
                         0                prc_2K,
                         5                rn
                    FROM prdd
                GROUP BY s_month
                UNION ALL
                  -- ѕовернуто надм≥ру перерахованих/не знайшли отримувач≥в:
                  -- ќбс€г кошт≥в дл€ виплати, всього, тис.грн
                  SELECT s_month          dt,
                         ROUND (
                             SUM (
                                 CASE
                                     WHEN s_sum_not_payed_prev <> 0
                                     THEN
                                         s_sum_not_payed_prev
                                 END))    pdp_sum,
                         SUM (
                             CASE
                                 WHEN s_sum_not_payed_prev <> 0
                                 THEN
                                     s_cnt_not_payed_prev_2k
                             END)         cnt_2K,
                         SUM (
                             CASE
                                 WHEN s_sum_not_payed_prev <> 0
                                 THEN
                                     s_cnt_not_payed_prev_3k
                             END)         cnt_3K,
                         0                cnt_fml,
                         0                pdp_sum_err,
                         0                prc_2K,
                         6                rn
                    FROM prdd
                GROUP BY s_month
                ORDER BY 8, 1;
    END SET_DS_PAID_VPO_R4;

    -- IC #85123 «в≥тн≥сть про к≥льк≥сть ¬ѕќ з ƒонецькоњ, Ћуганськоњ областей,  риму та м. —евастопол€, €к≥ отримують допомогу ¬ѕќ
    PROCEDURE SET_DS_DLK_VPO (p_start_dt   IN DATE,
                              p_org_id     IN NUMBER,
                              p_jbr_id     IN DECIMAL)
    IS
        l_user_org   NUMBER;
        l_raj        NUMBER := 0;
    BEGIN
        IF p_org_id = 0
        THEN
            l_user_org := Tools.GetCurrOrg;
        ELSE
            l_user_org := p_org_id;
        END IF;

        IF Tools.GetCurrOrg NOT IN (50000, 50001)
        THEN
            l_raj := 1;
        END IF;

        DELETE FROM tmp_univ_rpt_data
              WHERE 1 = 1;

        INSERT INTO tmp_univ_rpt_data (x_id1,
                                       x_string1,
                                       x_id2,
                                       x_id3,
                                       x_id4,
                                       x_id5,
                                       x_id6)
            WITH
                org
                AS
                    (    SELECT org_id     i_org
                           FROM ikis_sys.v_opfu
                     CONNECT BY PRIOR org_id = org_org
                     START WITH org_id =
                                CASE
                                    WHEN l_user_org = 50001 THEN 50000
                                    ELSE l_user_org
                                END),
                prsd
                AS
                    (  SELECT prsd_id AS x_id, MAX (acd_pd) AS x_pd
                         FROM uss_esr.pr_sheet_detail,
                              uss_esr.v_ac_detail,
                              uss_esr.payroll pr
                        WHERE     acd_prsd = prsd_id
                              AND prsd_pr = pr_id
                              AND pr_month = TRUNC (p_start_dt, 'MM')
                              AND pr_st IN ('F')
                     GROUP BY prsd_id),
                payed
                AS
                    (  SELECT CASE WHEN l_raj = 1 THEN org_id ELSE org_org END
                                  AS s_org,
                              prs_pc
                                  AS s_pc,
                              SUM (prsd_sum)
                                  AS s_sum,
                              SUM (
                                  CASE
                                      WHEN prsd_month =
                                           TRUNC (p_start_dt, 'MM')
                                      THEN
                                          prsd_sum
                                  END)
                                  s_plan_sum,
                              MAX (x_pd)
                                  AS x_pd,
                              (SELECT MAX (scd_dh)
                                 FROM Uss_Person.v_Sc_Document
                                WHERE     scd_sc = pc_sc
                                      AND scd_st = '1'
                                      AND scd_ndt = 10052 -- ƒов≥дка про вз€тт€ на обл≥к внутр≥шньо перем≥щеноњ особи
                                                         )
                                  AS s_dh
                         FROM ikis_sys.v_opfu,
                              uss_esr.pr_sheet_detail,
                              uss_esr.pr_sheet,
                              uss_esr.payroll pr,
                              uss_esr.v_personalcase,
                              prsd,
                              org
                        WHERE     org_to = 32
                              AND pr.com_org = org_id
                              AND prs_pc = pc_id
                              AND prs_pr = pr_id
                              --AND prsd_pr = pr_id
                              AND prsd_prs = prs_id
                              AND org_id = i_org
                              AND pr_month = TRUNC (p_start_dt, 'MM')
                              AND prs_st IN ('NA', 'KV1', 'KV2')
                              AND pr_st IN ('F')
                              AND prsd_tp IN ('PWI', 'RDN')
                              AND prsd_id = x_id
                     GROUP BY CASE
                                  WHEN l_raj = 1 THEN org_id
                                  ELSE org_org
                              END,
                              prs_pc,
                              pc_sc)
              SELECT org_code,                                    --" од ƒ—«Ќ"
                     --org_name,  -- "Ќазва",
                     CASE
                         WHEN l_raj = 1 THEN org_name
                         ELSE uss_esr.TOOLS.GetOrgRegName (o.org_id)
                     END                      reg_name,
                     --nvl(a_cnt,0)       cnt_eoc_assing,      --" ≥льк≥сть ≈ќ— призн.",
                     --nvl(a_fam_qnt,0)   cnt_fam_assing,      --"„лен≥в с≥мей призн.",
                     --nvl(a_assing,0)    sum_assing,          --"ѕризначено",
                     --nvl(x_cnt,0)       cnt_eoc_narah,       --" -сть ≈ќ— нарах.",
                     --nvl(x_fam_qnt,0)   cnt_fam_narah,       --"„лен≥в с≥мей нарах.",
                     --nvl(x_narah,0)     sum_narah            --"Ќараховано",
                     --nvl(s_cnt,0)       cnt_eoc_payed,       --" -сть ≈ќ— випл.",
                     -- IC #86948
                     NVL (s_fam_qnt, 0)       cnt_fam_payed, --"„лен≥в с≥мей випл.",
                     NVL (s_fam_qnt_Dn, 0)    cnt_fam_payed_dn,
                     NVL (s_fam_qnt_Lg, 0)    cnt_fam_payed_lg,
                     NVL (s_fam_qnt_Kr, 0)    cnt_fam_payed_kr,
                     NVL (s_fam_qnt_Sv, 0)    cnt_fam_payed_sv
                --nvl(s_plan_sum,0)  sum_payed_month,     --"¬иплачено м≥с€ць",
                --nvl(s_sum,0)       sum_payed_total     --"¬иплачено всього"
                FROM ikis_sys.opfu o
                     INNER JOIN org ON org_id = i_org
                     LEFT JOIN
                     (  SELECT s_org,
                               COUNT (DISTINCT s_pc)
                                   s_cnt,
                               SUM (
                                   (SELECT COUNT (DISTINCT pdf_sc)
                                      FROM uss_esr.pc_decision pd,
                                           uss_esr.pd_family fml
                                     WHERE     pd.pd_id = fml.pdf_pd
                                           AND NOT EXISTS
                                                   (SELECT 1
                                                      FROM uss_esr.ap_person
                                                           p
                                                     WHERE     p.app_ap =
                                                               pd.pd_ap
                                                           AND p.app_sc =
                                                               fml.pdf_sc
                                                           AND p.history_status =
                                                               'A'
                                                           -- AND p.app_sc = fml.pdf_sc and p.app_tp in ('Z', 'FM', 'FP'))
                                                           AND p.app_tp =
                                                               'P') -- ѕредставник за€вника
                                           AND pd.pd_id = x_pd))
                                   AS s_fam_qnt,
                               SUM (
                                   (SELECT COUNT (DISTINCT pdf_sc)
                                      FROM uss_esr.pc_decision pd,
                                           uss_esr.pd_family fml
                                     WHERE     pd.pd_id = fml.pdf_pd
                                           AND NOT EXISTS
                                                   (SELECT 1
                                                      FROM uss_esr.ap_person p
                                                     WHERE     p.app_ap =
                                                               pd.pd_ap
                                                           AND p.app_sc =
                                                               fml.pdf_sc
                                                           AND p.history_status =
                                                               'A'
                                                           -- AND p.app_sc = fml.pdf_sc and p.app_tp in ('Z', 'FM', 'FP'))
                                                           AND p.app_tp = 'P') -- ѕредставник за€вника
                                           AND EXISTS
                                                   (SELECT NULL
                                                      FROM Uss_Doc.v_Doc_Attr2hist
                                                           h,
                                                           Uss_Doc.v_Doc_Attributes
                                                           a,
                                                           uss_ndi.v_ndi_katottg
                                                           k
                                                     WHERE     s_dh = h.Da2h_Dh
                                                           AND h.Da2h_Da =
                                                               a.Da_Id
                                                           AND a.da_val_id =
                                                               k.kaot_id
                                                           AND a.Da_Nda = 2292 --  ј“ќ““√ (зареЇстрованого м≥сц€ проживанн€ )
                                                           AND EXISTS
                                                                   (SELECT NULL
                                                                      FROM uss_ndi.v_ndi_katottg
                                                                           kk
                                                                     WHERE     kk.kaot_id =
                                                                               k.kaot_kaot_l1
                                                                           AND kk.kaot_code IN
                                                                                   ('UA14000000000091971' -- ƒонецка€ область
                                                                                                         )))
                                           AND pd.pd_id = x_pd))
                                   AS s_fam_qnt_Dn,
                               SUM (
                                   (SELECT COUNT (DISTINCT pdf_sc)
                                      FROM uss_esr.pc_decision pd,
                                           uss_esr.pd_family fml
                                     WHERE     pd.pd_id = fml.pdf_pd
                                           AND NOT EXISTS
                                                   (SELECT 1
                                                      FROM uss_esr.ap_person p
                                                     WHERE     p.app_ap =
                                                               pd.pd_ap
                                                           AND p.app_sc =
                                                               fml.pdf_sc
                                                           AND p.history_status =
                                                               'A'
                                                           -- AND p.app_sc = fml.pdf_sc and p.app_tp in ('Z', 'FM', 'FP'))
                                                           AND p.app_tp = 'P') -- ѕредставник за€вника
                                           AND EXISTS
                                                   (SELECT NULL
                                                      FROM Uss_Doc.v_Doc_Attr2hist
                                                           h,
                                                           Uss_Doc.v_Doc_Attributes
                                                           a,
                                                           uss_ndi.v_ndi_katottg
                                                           k
                                                     WHERE     s_dh = h.Da2h_Dh
                                                           AND h.Da2h_Da =
                                                               a.Da_Id
                                                           AND a.da_val_id =
                                                               k.kaot_id
                                                           AND a.Da_Nda = 2292 --  ј“ќ““√ (зареЇстрованого м≥сц€ проживанн€ )
                                                           AND EXISTS
                                                                   (SELECT NULL
                                                                      FROM uss_ndi.v_ndi_katottg
                                                                           kk
                                                                     WHERE     kk.kaot_id =
                                                                               k.kaot_kaot_l1
                                                                           AND kk.kaot_code IN
                                                                                   ('UA44000000000018893' -- Ћуганска€ область
                                                                                                         )))
                                           AND pd.pd_id = x_pd))
                                   AS s_fam_qnt_Lg,
                               SUM (
                                   (SELECT COUNT (DISTINCT pdf_sc)
                                      FROM uss_esr.pc_decision pd,
                                           uss_esr.pd_family fml
                                     WHERE     pd.pd_id = fml.pdf_pd
                                           AND NOT EXISTS
                                                   (SELECT 1
                                                      FROM uss_esr.ap_person p
                                                     WHERE     p.app_ap =
                                                               pd.pd_ap
                                                           AND p.app_sc =
                                                               fml.pdf_sc
                                                           AND p.history_status =
                                                               'A'
                                                           -- AND p.app_sc = fml.pdf_sc and p.app_tp in ('Z', 'FM', 'FP'))
                                                           AND p.app_tp = 'P') -- ѕредставник за€вника
                                           AND EXISTS
                                                   (SELECT NULL
                                                      FROM Uss_Doc.v_Doc_Attr2hist
                                                           h,
                                                           Uss_Doc.v_Doc_Attributes
                                                           a,
                                                           uss_ndi.v_ndi_katottg
                                                           k
                                                     WHERE     s_dh = h.Da2h_Dh
                                                           AND h.Da2h_Da =
                                                               a.Da_Id
                                                           AND a.da_val_id =
                                                               k.kaot_id
                                                           AND a.Da_Nda = 2292 --  ј“ќ““√ (зареЇстрованого м≥сц€ проживанн€ )
                                                           AND EXISTS
                                                                   (SELECT NULL
                                                                      FROM uss_ndi.v_ndi_katottg
                                                                           kk
                                                                     WHERE     kk.kaot_id =
                                                                               k.kaot_kaot_l1
                                                                           AND kk.kaot_code IN
                                                                                   ('UA01000000000013043' --  рим
                                                                                                         )))
                                           AND pd.pd_id = x_pd))
                                   AS s_fam_qnt_Kr,
                               SUM (
                                   (SELECT COUNT (DISTINCT pdf_sc)
                                      FROM uss_esr.pc_decision pd,
                                           uss_esr.pd_family fml
                                     WHERE     pd.pd_id = fml.pdf_pd
                                           AND NOT EXISTS
                                                   (SELECT 1
                                                      FROM uss_esr.ap_person p
                                                     WHERE     p.app_ap =
                                                               pd.pd_ap
                                                           AND p.app_sc =
                                                               fml.pdf_sc
                                                           AND p.history_status =
                                                               'A'
                                                           -- AND p.app_sc = fml.pdf_sc and p.app_tp in ('Z', 'FM', 'FP'))
                                                           AND p.app_tp = 'P') -- ѕредставник за€вника
                                           AND EXISTS
                                                   (SELECT NULL
                                                      FROM Uss_Doc.v_Doc_Attr2hist
                                                           h,
                                                           Uss_Doc.v_Doc_Attributes
                                                           a,
                                                           uss_ndi.v_ndi_katottg
                                                           k
                                                     WHERE     s_dh = h.Da2h_Dh
                                                           AND h.Da2h_Da =
                                                               a.Da_Id
                                                           AND a.da_val_id =
                                                               k.kaot_id
                                                           AND a.Da_Nda = 2292 --  ј“ќ““√ (зареЇстрованого м≥сц€ проживанн€ )
                                                           AND EXISTS
                                                                   (SELECT NULL
                                                                      FROM uss_ndi.v_ndi_katottg
                                                                           kk
                                                                     WHERE     kk.kaot_id =
                                                                               k.kaot_kaot_l1
                                                                           AND kk.kaot_code IN
                                                                                   ('UA85000000000065278' -- м. —евастополь
                                                                                                         )))
                                           AND pd.pd_id = x_pd))
                                   AS s_fam_qnt_Sv,
                               SUM (s_sum)
                                   s_sum,
                               SUM (s_plan_sum)
                                   s_plan_sum
                          FROM payed
                         WHERE EXISTS
                                   (SELECT NULL
                                      FROM Uss_Doc.v_Doc_Attr2hist h,
                                           Uss_Doc.v_Doc_Attributes a,
                                           uss_ndi.v_ndi_katottg k
                                     WHERE     s_dh = h.Da2h_Dh
                                           AND h.Da2h_Da = a.Da_Id
                                           AND a.da_val_id = k.kaot_id
                                           AND a.Da_Nda = 2292 --  ј“ќ““√ (зареЇстрованого м≥сц€ проживанн€ )
                                           AND EXISTS
                                                   (SELECT NULL
                                                      FROM uss_ndi.v_ndi_katottg
                                                           kk
                                                     WHERE     kk.kaot_id =
                                                               k.kaot_kaot_l1
                                                           AND kk.kaot_code IN
                                                                   ('UA14000000000091971' -- ƒонецка€ область
                                                                                         ,
                                                                    'UA44000000000018893' -- Ћуганска€ область
                                                                                         ,
                                                                    'UA01000000000013043' --  рим
                                                                                         ,
                                                                    'UA85000000000065278' -- м. —евастополь
                                                                                         )))
                      GROUP BY s_org) p
                         ON s_org = org_id
               WHERE     org_to = CASE WHEN l_raj = 1 THEN 32 ELSE 31 END
                     AND org_org =
                         CASE WHEN l_raj = 1 THEN org_org ELSE 50000 END
                     AND org_code NOT IN ('54000', '54300') -- м. —евастополь, ј–  рим
                     AND o.org_st = 'A'
            ORDER BY 1;
    END SET_DS_DLK_VPO;

    -- IC #85725 –еестр на  азначейство (6 допомог)
    PROCEDURE SET_DS_REG_6DOP (p_po_id IN NUMBER, p_jbr_id IN DECIMAL)
    IS
    BEGIN
        DELETE FROM tmp_univ_rpt_data
              WHERE 1 = 1;

        INSERT INTO tmp_univ_rpt_data (x_id1,                            -- rn
                                       x_string1,               -- prs_account
                                       x_string2,                   -- nb_name
                                       x_id2,                        -- nb_mfo
                                       x_string3,                 -- nb_edrpou
                                       x_sum1,                      -- prs_sum
                                       x_string4,                       -- pib
                                       x_string5,                    -- rnokpp
                                       x_string6   -- prs_doc_num, prs_address
                                                )
            SELECT ROW_NUMBER () OVER (ORDER BY 1)
                       rn,
                   NVL (s.prs_account, p.po_bank_account_dest)
                       prs_account,
                   NVL (b.nb_name, p.po_bank_name_dest)
                       nb_name,
                   NVL (b.nb_mfo, p.po_bank_mfo_dest)
                       nb_mfo,
                   NVL (b.nb_edrpou, p.po_tax_code_dest)
                       nb_edrpou,
                   s.prs_sum,
                   /*
                   to_char(SUM(CASE
                                 WHEN prsd_tp = 'PWI' THEN
                                  prsd_sum
                                 WHEN prsd_tp IN ('PRUT', 'PRAL', 'PROZ', 'PROP') THEN
                                  0 - prsd_sum
                               END),
                           'FM9999999990D00',
                           'NLS_NUMERIC_CHARACTERS='',''''') AS SUM,*/
                   s.prs_ln || ' ' || s.prs_fn || ' ' || s.prs_mn
                       pib,
                   NVL (s.prs_inn, '0000000000')
                       rnokpp,
                      NVL (s.prs_doc_num, ' ')
                   || '$'
                   || NVL (s.prs_address,
                           uss_person.api$sc_tools.get_address (pc.pc_sc, 2))
                       f_name
              --uss_person.api$sc_tools.get_address(pc.pc_sc, 3) address
              --,p.po_id
              FROM uss_esr.v_pay_order  p
                   JOIN uss_esr.v_payroll_reestr r ON r.pe_po = p.po_id
                   JOIN uss_esr.v_pr_sheet s ON s.prs_pr = r.pe_src_entity
                   LEFT JOIN uss_ndi.v_ndi_post_office ind
                       ON     ind.npo_index = s.prs_index
                          AND ind.history_status = 'A'
                   LEFT JOIN uss_ndi.v_ndi_comm_node cn
                       ON cn.ncn_id = ind.npo_ncn AND cn.history_status = 'A'
                   LEFT JOIN personalcase pc ON pc.pc_id = s.prs_pc
                   --JOIN uss_esr.v_pr_sheet_detail d ON d.prsd_prs = s.prs_id
                   --JOIN uss_ndi.v_ndi_payment_type pt ON pt.npt_id = d.prsd_npt
                   --                                  AND pt.npt_nbg = r.pe_nbg
                   --                                  AND pt.npt_npc = r.pe_npc
                   LEFT JOIN uss_ndi.v_ndi_bank b ON b.nb_id = r.pe_nb
             WHERE     s.prs_pay_dt = r.pe_pay_dt
                   AND (s.prs_nb = r.pe_nb OR s.prs_nb IS NULL)
                   AND (r.pe_bnk_code IS NULL OR cn.ncn_code = r.pe_bnk_code)
                   AND (   r.pe_filia_code IS NULL
                        OR LPAD (s.prs_index, 5, '0') = r.pe_filia_code)
                   AND p.po_id = p_po_id--GROUP BY s.prs_ln, s.prs_fn, s.prs_mn, s.prs_inn, s.prs_account, p.po_id
                                        ;
    END SET_DS_REG_6DOP;

    -- IC #93510 –еестр на  азначейство по утриманн€м
    PROCEDURE SET_DS_REG_DED (p_po_id IN NUMBER, p_jbr_id IN DECIMAL)
    IS
    BEGIN
        DELETE FROM tmp_univ_rpt_data
              WHERE 1 = 1;

        INSERT INTO tmp_univ_rpt_data (x_id1,                             -- 0
                                       x_id2,                            -- rn
                                       x_string1,               -- prs_account
                                       x_string2,                   -- nb_name
                                       x_id3,                        -- nb_mfo
                                       x_string3,                 -- nb_edrpou
                                       x_sum1,                      -- prs_sum
                                       x_string4,                       -- pib
                                       x_string5,                    -- rnokpp
                                       x_string6   -- prs_doc_num, prs_address
                                                )
              SELECT 0                                                             A3, -- A3 = 0
                     ROW_NUMBER () OVER (ORDER BY NULL)                            B3, -- Ќомер за пор€дком
                     s.prs_account                                                 C3, -- Ќомер рахунку орган≥зац≥њ
                     s.prs_fn                                                      D3, -- Ќазва орган≥зац≥њ
                     NVL (b.nb_mfo, p.po_bank_mfo_dest)                            E3, -- ћ‘ќ банку отримувача (з шапки документу)
                     NVL (b.nb_edrpou, p.po_tax_code_dest)                         F3, -- ™ƒ–ѕќ” банку отримувача
                     SUM (d.prsd_sum)                                              G3, -- —ума по людин≥
                     sci_ln || ' ' || sci_fn || ' ' || sci_mn                      H3, -- ѕ≤Ѕ людини повн≥стю
                     (SELECT NVL (MAX (scd_number), '0000000000')
                        FROM uss_person.v_sc_document
                       WHERE     scd_sc = pc.pc_sc
                             AND scd_ndt = 5
                             AND scd_st IN ('1', 'A'))                             I3, -- ≤ѕЌ людини (€кщо немаЇ –Ќќ ѕѕ, тод≥ 0000000000)
                        --            nvl(s.prs_inn,'0000000000')         I3, -- ≤ѕЌ людини (€кщо немаЇ –Ќќ ѕѕ, тод≥ 0000000000)
                         (  SELECT p.scd_seria
                              FROM uss_person.v_sc_document p
                             WHERE     scd_sc = pc.pc_sc
                                   AND scd_ndt IN (6, 7)
                                   AND scd_st IN ('1', 'A')
                          ORDER BY scd_id DESC
                             FETCH FIRST ROW ONLY)
                     || (  SELECT p.scd_number
                             FROM uss_person.v_sc_document p
                            WHERE     scd_sc = pc.pc_sc
                                  AND scd_ndt IN (6, 7)
                                  AND scd_st IN ('1', 'A')
                         ORDER BY scd_id DESC
                            FETCH FIRST ROW ONLY)
                     /*nvl(s.prs_doc_num,' ')*/
                     || '$'
                     || --              J3, -- Ќомер ≥дентиф≥куючого документу людини (паспорту/≤ƒ-картки)
                        NVL (s.prs_address,
                             uss_person.api$sc_tools.get_address (pc.pc_sc, 2))    K3 -- јктивна адреса реЇстрац≥њ з картки особи на дату ѕƒ
                FROM uss_esr.pay_order p
                     JOIN uss_esr.payroll_reestr r ON r.pe_po = p.po_id
                     JOIN uss_esr.pr_sheet s
                         ON s.prs_pr = r.pe_pr AND s.prs_dpp = r.pe_dpp
                     JOIN uss_esr.pr_sheet_detail d
                         ON d.prsd_prs_dn = s.prs_id AND d.prsd_pr = s.prs_pr
                     LEFT JOIN uss_esr.personalcase pc ON pc.pc_id = d.prsd_pc
                     LEFT JOIN uss_person.v_socialcard sc
                         ON sc.sc_id = pc.pc_sc
                     LEFT JOIN uss_person.v_sc_change scc
                         ON scc.scc_sc = sc_id AND scc_id = sc_scc
                     LEFT JOIN uss_person.v_sc_identity ON sci_id = scc_sci
                     LEFT JOIN uss_ndi.v_ndi_bank b ON b.nb_id = r.pe_nb
               WHERE p.po_id = p_po_id                                 -- 1684
            GROUP BY s.prs_account,
                     s.prs_fn,
                     NVL (b.nb_mfo, p.po_bank_mfo_dest),
                     NVL (b.nb_edrpou, p.po_tax_code_dest),
                     sci_ln,
                     sci_fn,
                     sci_mn,
                     s.prs_inn,
                     s.prs_doc_num,
                     s.prs_address,
                     pc.pc_sc;
    END SET_DS_REG_DED;

    -- IC #86322  ≥льк≥сть отримувач≥в допомоги за категор≥€ми
    PROCEDURE SET_CNT_RECIP_DOP (p_start_dt   IN DATE,
                                 p_nst_id     IN NUMBER := 664,         -- ¬ѕќ
                                 p_org_id     IN NUMBER,
                                 p_jbr_id     IN DECIMAL)
    IS
        l_user_org   NUMBER;
    BEGIN
        IF p_org_id = 0
        THEN
            l_user_org := Tools.GetCurrOrg;
        ELSE
            l_user_org := p_org_id;
        END IF;

        DELETE FROM tmp_univ_rpt_data
              WHERE 1 = 1;

        INSERT INTO tmp_univ_rpt_data (x_id1,           --  од ќ—«Ќ - ORG_CODE
                                       x_string1,     -- Ќазва ќ—«Ќ - ORG_NAME
                                       x_id2,               -- ≈ќ— - X_EOS_CNT
                                       x_id3, -- ќтримувач≥в, ос≥б - X_PERSONS_CNT
                                       x_id4,            -- „олов≥к≥в - X_MANS
                                       x_id5,              -- ∆≥нок - X_WOMANS
                                       x_id6,           -- ѕрацездан≥ - X_WORK
                                       x_sum1,      -- ѕенс≥онери - X_PENSIONS
                                       x_sum2,             -- ≤нвал≥ди - X_INV
                                       x_sum3               -- ƒ≥ти - X_CHILDS
                                             )
            WITH
                org
                AS
                    (    SELECT org_id     i_org
                           FROM ikis_sys.v_opfu
                     CONNECT BY PRIOR org_id = org_org
                     START WITH org_id =
                                CASE
                                    WHEN l_user_org = 50001 THEN 50000
                                    ELSE l_user_org
                                END),
                sc
                AS
                    (SELECT DISTINCT org_org          AS x_org,
                                     pc_id            AS x_pc,
                                     pdf_sc           AS x_sc,
                                     pdf_birth_dt     AS x_birth_dt
                       FROM uss_esr.pd_family,
                            uss_esr.pd_accrual_period  pdap,
                            uss_esr.pc_decision,
                            uss_esr.pd_payment         pp,
                            uss_esr.personalcase       pc,
                            ikis_sys.opfu,
                            org
                      WHERE     pdap_pd = pdf_pd
                            AND TRUNC (p_start_dt, 'mm') BETWEEN pdap_start_dt
                                                             AND pdap_stop_dt
                            AND TRUNC (p_start_dt, 'mm') BETWEEN pdp_start_dt
                                                             AND pdp_stop_dt
                            AND pp.history_status = 'A'
                            AND pdap.history_status = 'A'
                            AND pdap_pd = pd_id
                            AND pdp_pd = pd_id
                            AND pdf_pd = pd_id
                            AND pd_pc = pc_id
                            AND pc.com_org = org_id
                            AND org_id = i_org
                            AND pd_nst = p_nst_id
                            AND NOT EXISTS
                                    (SELECT 1
                                       FROM uss_esr.ap_person p
                                      WHERE     p.app_ap = pd_ap
                                            AND p.app_sc = pdf_sc
                                            AND p.history_status = 'A'
                                            -- AND p.app_sc = fml.pdf_sc and p.app_tp in ('Z', 'FM', 'FP'))
                                            AND p.app_tp = 'P') -- ѕредставник за€вника
                            AND org_org > 0),
                sc_data
                AS
                    (SELECT x_org,
                            x_pc,
                            x_sc,
                            x_birth_dt,
                            (SELECT sci_gender
                               FROM uss_person.v_socialcard,
                                    uss_person.v_sc_change,
                                    uss_person.v_sc_identity
                              WHERE     x_sc = sc_id
                                    AND scc_sc = sc_id
                                    AND sc_scc = scc_id
                                    AND scc_sci = sci_id)
                                AS x_gender,
                            CASE
                                WHEN EXISTS
                                         (SELECT 1
                                            FROM uss_person.v_sc_feature ff
                                           WHERE     x_sc = ff.scf_sc
                                                 AND scf_is_pension = 'T')
                                THEN
                                    1
                                ELSE
                                    0
                            END
                                AS x_is_pension,
                            CASE
                                WHEN x_birth_dt >
                                     ADD_MONTHS (TRUNC (p_start_dt, 'mm'),
                                                 -216)
                                THEN
                                    1
                                ELSE
                                    0
                            END
                                AS x_is_child,
                            CASE
                                WHEN x_birth_dt >
                                     ADD_MONTHS (TRUNC (p_start_dt, 'mm'),
                                                 -192)
                                THEN
                                    1
                                ELSE
                                    0
                            END
                                AS x_is_less_16_old,
                            CASE
                                WHEN EXISTS
                                         (SELECT 1
                                            FROM uss_person.v_sc_disability
                                                 sd
                                           WHERE     x_sc = scy_sc
                                                 AND sd.history_Status = 'A'
                                                 AND TRUNC (p_start_dt, 'mm') BETWEEN scy_start_dt
                                                                                  AND NVL (
                                                                                          scy_stop_dt,
                                                                                          TRUNC (
                                                                                              p_start_dt,
                                                                                              'mm')))
                                THEN
                                    1
                                ELSE
                                    0
                            END
                                AS x_is_inv
                       FROM sc)
              SELECT org_code,
                     uss_esr.TOOLS.GetOrgRegName (org_id)     org_name,
                     NVL (x_eos_cnt, 0)                       x_eos_cnt,
                     NVL (x_persons_cnt, 0)                   x_persons_cnt,
                     NVL (x_mans, 0)                          x_mans,
                     NVL (x_womans, 0)                        x_womans,
                     --x_unknowns,
                     NVL (x_work, 0)                          x_work,
                     NVL (x_pensions, 0)                      x_pensions,
                     NVL (x_inv, 0)                           x_inv,
                     NVL (x_childs, 0)                        x_childs
                FROM ikis_sys.opfu
                     INNER JOIN org ON org_id = i_org
                     LEFT JOIN
                     (  SELECT x_org
                                   AS x_org,
                               COUNT (DISTINCT x_pc)
                                   AS x_eos_cnt,
                               COUNT (*)
                                   AS x_persons_cnt,
                               SUM (
                                   CASE
                                       WHEN x_gender = 'F' AND x_is_child = 0
                                       THEN
                                           1
                                       ELSE
                                           0
                                   END)
                                   x_womans,
                               SUM (
                                   CASE
                                       WHEN x_gender = 'M' AND x_is_child = 0
                                       THEN
                                           1
                                       ELSE
                                           0
                                   END)
                                   x_mans,
                               SUM (
                                   CASE
                                       WHEN     NVL (x_gender, '-') = '-'
                                            AND x_is_child = 0
                                       THEN
                                           1
                                       ELSE
                                           0
                                   END)
                                   x_unknowns,
                               SUM (CASE WHEN x_is_pension = 1 THEN 1 END)
                                   x_pensions,
                               SUM (CASE WHEN x_is_child = 1 THEN 1 END)
                                   x_childs,
                               SUM (CASE WHEN x_is_inv = 1 THEN 1 END)
                                   x_inv,
                               SUM (
                                   CASE
                                       WHEN x_is_child = 1 AND x_is_inv = 1
                                       THEN
                                           1
                                   END)
                                   x_child_inv,
                               SUM (
                                   CASE
                                       WHEN     x_is_less_16_old = 0
                                            AND x_is_inv = 0
                                            AND x_is_pension = 0
                                       THEN
                                           1
                                   END)
                                   x_work
                          FROM sc_data
                      GROUP BY x_org)
                         ON x_org = org_id
               WHERE     org_to = 31
                     AND org_org = 50000
                     AND org_st = 'A'
                     AND org_code NOT IN ('54000', '54300') -- м. —евастополь, ј–  рим
            ORDER BY 1;
    END SET_CNT_RECIP_DOP;

    -- IC #86737 ўодо багатод≥тних с≥мей з числа малозабезпечених
    PROCEDURE SET_CNT_MCHILD_FML (p_start_dt   IN DATE,
                                  p_nst_id     IN NUMBER := 249, -- ƒержавна соц≥альна допомога малозабезпеченим с≥мТ€м
                                  p_org_id     IN NUMBER,
                                  p_jbr_id     IN DECIMAL)
    IS
        l_user_org   NUMBER;
        l_org_to     NUMBER := tools.GetCurrOrgTo;
        l_raj        NUMBER := 0;
    BEGIN
        IF p_org_id = 0
        THEN
            l_user_org := Tools.GetCurrOrg;
        ELSE
            l_user_org := p_org_id;
        END IF;

        l_user_org :=
            CASE WHEN l_user_org = 50001 THEN 50000 ELSE l_user_org END;

        IF l_org_to = 34
        THEN
            SELECT org_to
              INTO l_org_to
              FROM ikis_sys.v_opfu
             WHERE org_id = l_user_org;
        END IF;

        l_org_to := CASE WHEN l_org_to = 34 THEN 34 ELSE 32 END;

        IF Tools.GetCurrOrg NOT IN (50000, 50001)
        THEN
            l_raj := 1;
        END IF;

        DELETE FROM tmp_univ_rpt_data
              WHERE 1 = 1;

        INSERT INTO tmp_univ_rpt_data (x_id1,           --  од ќ—«Ќ - ORG_CODE
                                       x_string1,     -- Ќазва ќ—«Ќ - ORG_NAME
                                       x_id2,               --  ≥льк≥сть с≥мей
                                       x_id3,            -- с≥мей багатод≥дних
                                       x_id4,               --  ≥льк≥сть д≥тей
                                       x_id5,          -- д≥тей в багатод≥тних
                                       x_sum1,     -- —ередн≥й розм≥р допомоги
                                       x_sum2  -- —ума на виплату багатод≥тним
                                             )
            WITH
                org
                AS
                    (    SELECT org_id     i_org
                           FROM ikis_sys.v_opfu
                          WHERE l_org_to = 32
                     CONNECT BY PRIOR org_id = org_org
                     START WITH org_id = l_user_org
                     UNION ALL
                     SELECT org_id     i_org
                       FROM ikis_sys.v_opfu
                      WHERE l_org_to = 34 AND org_acc_org = l_user_org),
                -- IC #96731 ≤нформац≥€ т≥льки по реЇстру в≥домостей (без призначених р≥шень)
                payed
                AS
                    (  SELECT CASE WHEN l_raj = 1 THEN org_id ELSE org_org END
                                  s_org,
                              prs_pc
                                  s_pc,
                              SUM (prsd_sum)
                                  s_sum,
                              (SELECT COUNT (
                                          DISTINCT
                                              CASE
                                                  WHEN pdf_birth_dt >
                                                       ADD_MONTHS (
                                                           TRUNC (p_start_dt,
                                                                  'mm'),
                                                           -216)
                                                  THEN
                                                      pdf_sc
                                                  ELSE
                                                      NULL
                                              END)    is_child
                                 FROM uss_esr.pc_decision,
                                      uss_esr.personalcase pc,
                                      uss_esr.pd_family
                                WHERE     pc.pc_id = prs_pc
                                      AND pd_pc = pc_id
                                      AND pd_id = pdf_pd
                                      AND pd_nst = 249 -- ƒержавна соц≥альна допомога малозабезпеченим с≥мТ€м
                                                      )
                                  s_is_child
                         FROM ikis_sys.v_opfu,
                              uss_esr.pr_sheet_detail,
                              uss_esr.pr_sheet,
                              uss_esr.payroll pr,
                              uss_esr.v_personalcase,
                              org
                        WHERE     org_to = 32
                              AND pr.com_org = org_id
                              AND org_id = i_org
                              AND prs_pc = pc_id
                              AND prs_pr = pr_id
                              AND prsd_prs = prs_id
                              AND pr_npc = 40 -- ƒержавна соц≥альна допомога малозабезпеченим  с≥м'€м
                              AND pr_month = TRUNC (p_start_dt, 'MM')
                              AND prs_st IN ('NA', 'KV1', 'KV2')
                              AND pr_st IN ('F')
                              AND prsd_tp IN ('PWI', 'RDN')
                     GROUP BY CASE
                                  WHEN l_raj = 1 THEN org_id
                                  ELSE org_org
                              END,
                              prs_pc)
              SELECT org_code,                                    --" од ƒ—«Ќ"
                     --org_name,  -- "Ќазва",
                     CASE
                         WHEN l_raj = 1 THEN org_name
                         ELSE uss_esr.TOOLS.GetOrgRegName (o.org_id)
                     END                       reg_name,
                     NVL (x_eos_cnt, 0)        x_eos_cnt,   --  ≥льк≥сть с≥мей
                     NVL (x_fml_more, 0)       x_fml_more, -- с≥мей багатод≥дних
                     NVL (x_childs, 0)         x_childs,    --  ≥льк≥сть д≥тей
                     NVL (x_childs_more, 0)    x_childs_more, -- д≥тей в багатод≥тних
                     --                nvl(x_persons_cnt,0)    x_persons_cnt,
                     CASE
                         WHEN NVL (x_fml_more, 0) = 0 THEN 0
                         ELSE ROUND (NVL (s_sum, 0) / NVL (x_fml_more, 0), 2)
                     END                       x_avg_pay_sum, -- середн≥й розм≥р допомоги
                     NVL (s_sum, 0)            x_sum -- сума на виплату багатод≥тним
                FROM ikis_sys.opfu o
                     INNER JOIN org ON org_id = i_org
                     LEFT JOIN
                     (  SELECT s_org
                                   x_org,
                               COUNT (*)
                                   x_eos_cnt,
                               SUM (s_is_child)
                                   x_childs,
                               SUM (CASE WHEN s_is_child > 2 THEN 1 ELSE 0 END)
                                   x_fml_more,
                               SUM (
                                   CASE
                                       WHEN s_is_child > 2 THEN s_is_child
                                       ELSE 0
                                   END)
                                   x_childs_more,
                               SUM (
                                   CASE WHEN s_is_child > 2 THEN s_sum ELSE 0 END)
                                   s_sum
                          FROM payed
                      GROUP BY s_org)
                         ON x_org = org_id
               WHERE     org_to = CASE WHEN l_raj = 1 THEN 32 ELSE 31 END
                     AND org_org =
                         CASE WHEN l_raj = 1 THEN org_org ELSE 50000 END
                     AND org_code NOT IN ('54000', '54300') -- м. —евастополь, ј–  рим
                     AND (o.org_st = 'A' OR x_org IS NOT NULL)
            ORDER BY 1;

        UPDATE tmp_univ_rpt_data
           SET x_string2 =
                      '
   <Row>
    <Cell ss:StyleID="s23"><Data ss:Type="Number">'
                   || x_id1
                   || '</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s24"><Data ss:Type="String">'
                   || x_string1
                   || '</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s25"><Data ss:Type="Number">'
                   || x_id2
                   || '</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s26"><Data ss:Type="Number">'
                   || x_id3
                   || '</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s25"><Data ss:Type="Number">'
                   || x_id4
                   || '</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s26"><Data ss:Type="Number">'
                   || x_id5
                   || '</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s27"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_sum2, 0), 'FM9999999999990.00')
                   || '</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s27"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_sum1, 0), 'FM9999999999990.00')
                   || '</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
   </Row>';
    END SET_CNT_MCHILD_FML;

    -- IC #93410 «в≥т про державну допомогу с≥м'€м з д≥тьми (наказ ћ—ѕ є 272 р≥чна)
    PROCEDURE SET_CHILDREN_272 (p_start_dt   IN DATE,
                                p_org_id     IN NUMBER,
                                p_jbr_id     IN DECIMAL)
    IS
        l_user_org   NUMBER;
        l_org_to     NUMBER := tools.GetCurrOrgTo;

        p_prc        NUMBER;
    BEGIN
        IF p_org_id = 0
        THEN
            l_user_org := Tools.GetCurrOrg;
        ELSE
            l_user_org := p_org_id;
        END IF;

        l_user_org :=
            CASE WHEN l_user_org = 50001 THEN 50000 ELSE l_user_org END;

        IF l_org_to = 34
        THEN
            SELECT org_to
              INTO l_org_to
              FROM ikis_sys.v_opfu
             WHERE org_id = l_user_org;
        END IF;

        l_org_to := CASE WHEN l_org_to = 34 THEN 34 ELSE 32 END;


        DELETE FROM tmp_work_set1
              WHERE 1 = 1;

        INSERT INTO tmp_work_set1 (x_id1, x_id2)
            WITH
                org
                AS
                    (    SELECT org_id     i_org
                           FROM ikis_sys.v_opfu
                          WHERE l_org_to = 32
                     CONNECT BY PRIOR org_id = org_org
                     START WITH org_id = l_user_org
                     UNION ALL
                     SELECT org_id     i_org
                       FROM ikis_sys.v_opfu
                      WHERE l_org_to = 34 AND org_acc_org = l_user_org)
            SELECT DISTINCT d.acd_pd, d.acd_npt
              FROM uss_esr.ac_detail  d
                   INNER JOIN uss_esr.pr_sheet_detail sd
                       ON sd.prsd_id = d.acd_prsd
                   INNER JOIN uss_esr.pr_sheet s ON s.prs_id = sd.prsd_prs
                   INNER JOIN uss_esr.pc_account a ON a.pa_id = s.prs_pa
                   INNER JOIN uss_esr.payroll pr ON pr.pr_id = s.prs_pr
                   INNER JOIN org ON org.i_org = pr.com_org
             WHERE     d.history_status = 'A'
                   AND s.prs_sum != 0
                   --AND s.prs_st != 'PP'  -- з≥ вс≥ма статусами, кр≥м PP (ручне блокуванн€)
                   AND pr.pr_st IN ('F')
                   AND s.prs_tp IN ('PB', 'PP')
                   AND pr.pr_month >=
                       ADD_MONTHS (TRUNC (p_start_dt, 'yy'), -12)
                   AND pr.pr_month < TRUNC (p_start_dt, 'yy')
                   AND a.pa_nst IN (  --250, -- ƒопомога при народженн≥ дитини
                                    251, -- ƒопомога у звТ€зку з ваг≥тн≥стю та пологами
                                    265, -- ƒопомога особ≥, €ка догл€даЇ за хворою дитиною
                                    267, -- ƒопомога на д≥тей одиноким матер€м
                                    268, -- ƒопомога на д≥тей, над €кими встановлено оп≥ку чи п≥клуванн€
                                    269)    -- ƒопомога при усиновленн≥ дитини
                                        ;

        DELETE FROM tmp_univ_rpt_data
              WHERE 1 = 1;

        INSERT INTO tmp_univ_rpt_data (x_sum1,
                                       x_string1,
                                       x_id1,
                                       x_id2)
            WITH
                rpt
                AS
                    (SELECT 1                                                                                                  ca,
                            'ƒержавна допомога с≥м''€м з д≥тьми, усього: (сума значень р€дк≥в 02 + 08 + 10 + 15 + 22 + 31)'    cb
                       FROM DUAL
                     UNION ALL
                     SELECT 2                                                                                             ca,
                            'ƒопомога у звТ€зку з ваг≥тн≥стю та пологами (сума значень р€дк≥в 03 + 04 + 05 + 06 + 07)'    cb
                       FROM DUAL
                     UNION ALL
                     SELECT 2.1 ca, 'у тому числ≥:' cb FROM DUAL
                     UNION ALL
                     SELECT 3                                                                              ca,
                            'к≥льк≥сть ж≥нок, зв≥льнених з роботи у звТ€зку з л≥кв≥дац≥Їю п≥дприЇмства'    cb
                       FROM DUAL
                     UNION ALL
                     SELECT 4                                                                                                                            ca,
                            'к≥льк≥сть ж≥нок, зареЇстрованих у державн≥й служб≥ зайн€тост≥ €к безроб≥тн≥ у державн≥й служб≥ зайн€тост≥ €к безроб≥тн≥'    cb
                       FROM DUAL
                     UNION ALL
                     SELECT 5                                                                                ca,
                            'к≥льк≥сть ж≥нок Ч асп≥ранток, докторанток, кл≥н≥чних ординатор≥в, студенток'    cb
                       FROM DUAL
                     UNION ALL
                     SELECT 6 ca, 'к≥льк≥сть непрацюючих ж≥нок' cb FROM DUAL
                     UNION ALL
                     SELECT 7                                                                           ca,
                            'к≥льк≥сть ж≥нок, зареЇстрованих €к субТЇкти п≥дприЇмницькоњ д≥€льност≥'    cb
                       FROM DUAL
                     UNION ALL
                     SELECT 8 ca, 'ƒопомога при усиновленн≥ дитини' cb
                       FROM DUAL
                     UNION ALL
                     SELECT 9 ca, '≥з них: чолов≥кам' cb FROM DUAL
                     UNION ALL
                     SELECT 10                                                                ca,
                            'ƒопомога при народженн≥ дитини (сума значень р€дк≥в 13 + 14)'    cb
                       FROM DUAL
                     UNION ALL
                     SELECT 11 ca, '≥з них: чолов≥кам' cb FROM DUAL
                     UNION ALL
                     SELECT 11.1 ca, '≤з р€дка 10:' cb FROM DUAL
                     UNION ALL
                     SELECT 12                                                                                       ca,
                            'за за€вами в електронн≥й форм≥ з використанн€м квал≥ф≥кованого електронного п≥дпису'    cb
                       FROM DUAL
                     UNION ALL
                     SELECT 13                                             ca,
                            'на д≥тей, €к≥ народилис€ до зв≥тного року'    cb
                       FROM DUAL
                     UNION ALL
                     SELECT 14                                             ca,
                            'на д≥тей, €к≥ народилис€ у зв≥тному роц≥'     cb
                       FROM DUAL
                     UNION ALL
                     SELECT 15                                                                                                   ca,
                            'ƒопомога на д≥тей, над €кими встановлено оп≥ку чи п≥клуванн€ (сума значень р€дк≥в 17 + 19 + 21)'    cb
                       FROM DUAL
                     UNION ALL
                     SELECT 16 ca, '≥з них:  чолов≥кам' cb FROM DUAL
                     UNION ALL
                     SELECT 16.1 ca, '≤з р€дка 15:' cb FROM DUAL
                     UNION ALL
                     SELECT 17 ca, 'на д≥тей в≥ком до 6 рок≥в' cb FROM DUAL
                     UNION ALL
                     SELECT 18                                                    ca,
                            '≥з них: на д≥тей з ≥нвал≥дн≥стю в≥ком до 6 рок≥в'    cb
                       FROM DUAL
                     UNION ALL
                     SELECT 19 ca, 'на д≥тей в≥ком в≥д 6 до 18 рок≥в' cb
                       FROM DUAL
                     UNION ALL
                     SELECT 20                                                            ca,
                            '≥з них:  на д≥тей з ≥нвал≥дн≥стю в≥ком в≥д 6 до 18 рок≥в'    cb
                       FROM DUAL
                     UNION ALL
                     SELECT 21                                                                                                                                                    ca,
                            'на д≥тей, над €кими встановлено оп≥ку чи п≥клуванн€ ≥ €к≥ Ї вихованц€ми дит€чих заклад≥в осв≥ти, що ф≥нансуютьс€ не за рахунок бюджетних кошт≥в '    cb
                       FROM DUAL
                     UNION ALL
                     SELECT 22                                                                             ca,
                            'ƒопомога на д≥тей одиноким особам (сума значень р€дк≥в 23 + 24 + 25 + 26)'    cb
                       FROM DUAL
                     UNION ALL
                     SELECT 22.1 ca, 'у тому числ≥:' cb FROM DUAL
                     UNION ALL
                     SELECT 23 ca, 'одиноких матер≥в' cb FROM DUAL
                     UNION ALL
                     SELECT 24 ca, 'одиноких усиновлювач≥в' cb FROM DUAL
                     UNION ALL
                     SELECT 25 ca, 'уд≥в' cb FROM DUAL
                     UNION ALL
                     SELECT 26 ca, 'уд≥вц≥в' cb FROM DUAL
                     UNION ALL
                     SELECT 27                                                                      ca,
                            '"≤з р€дка 22: отримано допомогу (сума значень р€дк≥в 28 + 29 + 30)'    cb
                       FROM DUAL
                     UNION ALL
                     SELECT 28 ca, 'на д≥тей в≥ком до 6 рок≥в' cb FROM DUAL
                     UNION ALL
                     SELECT 29 ca, 'на д≥тей в≥ком в≥д 6 до 18 рок≥в' cb
                       FROM DUAL
                     UNION ALL
                     SELECT 30                                                                                                                                                                                   ca,
                            'на д≥тей в≥ком в≥д 18 до 23 рок≥в, €кщо д≥ти навчаютьс€ за денною формою у закладах загальноњ середньоњ, профес≥йноњ (профес≥йно-техн≥чноњ), фаховоњ передвищоњ та вищоњ осв≥ти'    cb
                       FROM DUAL
                     UNION ALL
                     SELECT 31                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  ca,
                            'ƒопомога на д≥тей, хворих на т€жк≥ перинатальн≥ ураженн€ нервовоњ системи, т€жк≥ вроджен≥ вади розвитку, р≥дк≥сн≥ орфанн≥ захворюванн€, онколог≥чн≥, онкогематолог≥чн≥ захворюванн€, дит€чий церебральний парал≥ч, т€жк≥ псих≥чн≥ розлади, цукровий д≥абет I типу (≥нсул≥нозалежний), гостр≥ або хрон≥чн≥ захворюванн€ нирок IV ступен€, на дитину, €ка отримала т€жку травму, потребуЇ трансплантац≥њ органа, потребуЇ пал≥ативноњ допомоги, €ким не встановлено ≥нвал≥дн≥сть'    cb
                       FROM DUAL
                     UNION ALL
                     SELECT 32                                                                                             ca,
                            '≤з р€дка 01: €к≥ проживають на територ≥њ населеного пункту, €кому надано статус г≥рського'    cb
                       FROM DUAL),
                sc
                AS
                    (  SELECT pd_nst
                                  AS x_nst,
                              pc_id
                                  AS x_pc,
                              pdf_sc
                                  AS x_sc,      -- pdf_birth_dt AS x_birth_dt,
                              MAX (
                                  (SELECT MAX (pp.app_sc)
                                     FROM uss_esr.ap_person pp
                                    WHERE     pp.app_ap = pd.pd_ap
                                          AND pp.history_status = 'A'
                                          AND pp.app_tp = 'Z'))
                                  x_sc_z,
                              MAX (
                                  CASE
                                      WHEN f.pdf_birth_dt >
                                           ADD_MONTHS (p_start_dt, -72)
                                      THEN
                                          6
                                      WHEN     f.pdf_birth_dt >
                                               ADD_MONTHS (p_start_dt, -216)
                                           AND f.pdf_birth_dt <=
                                               ADD_MONTHS (p_start_dt, -72)
                                      THEN
                                          18
                                      WHEN     f.pdf_birth_dt >
                                               ADD_MONTHS (p_start_dt, -276)
                                           AND f.pdf_birth_dt <=
                                               ADD_MONTHS (p_start_dt, -216)
                                      THEN
                                          23
                                      ELSE
                                          100
                                  END)
                                  x_year_old,
                              MAX (
                                  CASE
                                      WHEN f.pdf_birth_dt >
                                           TRUNC (p_start_dt, 'yy')
                                      THEN
                                          1
                                      ELSE
                                          0
                                  END)
                                  x_year_birth,
                              (SELECT MAX (sci_gender)
                                 FROM uss_person.v_socialcard,
                                      uss_person.v_sc_change,
                                      uss_person.v_sc_identity
                                WHERE     pdf_sc = sc_id
                                      AND scc_sc = sc_id
                                      AND sc_scc = scc_id
                                      AND scc_sci = sci_id)
                                  x_gender,
                              /*
                              max((SELECT MAX(da.apda_nda)
                                  FROM uss_esr.ap_person pp,
                                      uss_esr.ap_document d,
                                      uss_esr.ap_document_attr da
                                  WHERE   pp.app_ap = pd.pd_ap
                                      --AND pp.app_sc = f.pdf_sc
                                      AND pp.app_ap = d.apd_ap
                                      AND pp.app_id = d.apd_app
                                      AND d.apd_id = da.apda_apd
                                      AND da.apda_nda IN (2636,   -- ќсоба, зв≥льнена у зв'€зку з л≥кв≥дац≥Їю п≥дприЇмства
                                                          652,    -- Ќа обл≥ку в центр≥ зайн€тост≥
                                                          662,    -- ЌавчаЇтьс€
                                                          663,    -- Ќе працюЇ
                                                          651)    -- ‘ќѕ
                                      AND da.history_status = 'A'
                                      AND pp.app_tp = 'Z'
                                      AND pd.pd_nst = 251 -- ƒопомога у звТ€зку з ваг≥тн≥стю та пологами
                                      ))                      x_pp_type_251,
                              */
                              -- IC #114748
                              MAX (
                                  CASE t.npt_id
                                      WHEN 830 THEN 2636 -- ƒопомога у зв'€зку з ваг≥тн≥стю та пологами ж≥нкам, зв≥льненим у звС€зку з л≥кв≥дац≥Їю п≥дприЇмства
                                      WHEN 831 THEN 652 -- ƒопомога у зв'€зку з ваг≥тн≥стю та пологами ж≥нкам, зареЇстрованим в центр≥ зайн€тост≥ €к безроб≥тн≥
                                      WHEN 832 THEN 662 -- ƒопомога у зв'€зку з ваг≥тн≥стю та пологами асп≥ранткам, докторанткам, студенткам
                                      WHEN 833 THEN 663 -- ƒопомога у зв'€зку з ваг≥тн≥стю та пологами непрацюючим ж≥нкам
                                      WHEN 834 THEN 651 -- ƒопомога у зв'€зку з ваг≥тн≥стю та пологами, ж≥нкам, зареЇстрованим €к —ѕƒ
                                      ELSE 0
                                  END)
                                  x_pp_type_251,
                              MAX (
                                  (SELECT 1
                                     FROM uss_esr.ap_person       pp,
                                          uss_esr.ap_document     d,
                                          uss_esr.ap_document_attr da
                                    WHERE     pp.app_ap = pd.pd_ap
                                          --AND pp.app_sc = f.pdf_sc
                                          AND pp.app_ap = d.apd_ap
                                          AND pp.app_id = d.apd_app
                                          AND d.apd_id = da.apda_apd
                                          AND da.apda_nda IN (674, -- ¬дова/вд≥вець
                                                                   819) -- ¬дова/вд≥вець
                                          AND da.history_status = 'A'
                                          AND pp.app_tp = 'Z'
                                          AND pd.pd_nst = 267 -- ƒопомога на д≥тей одиноким особам
                                                             ))
                                  x_widow,
                              /*
                              max((SELECT 1
                                  FROM uss_esr.ap_person pp,
                                      uss_esr.ap_document d,
                                      uss_esr.ap_document_attr da
                                  WHERE   pp.app_ap = pd.pd_ap
                                      AND pp.app_sc = f.pdf_sc
                                      AND pp.app_ap = d.apd_ap
                                      AND pp.app_id = d.apd_app
                                      AND d.apd_id = da.apda_apd
                                      AND da.apda_nda = 2658  -- ќсоба, €ка проживаЇ ≥ працюЇ (навчаЇтьс€) на територ≥њ г≥рського населеного пункту
                                      AND da.history_status = 'A'
                                      ))                      x_highlander,
                              */
                              -- IC #114748
                              MAX (
                                  CASE t.npt_code WHEN '256' THEN 1 -- ѕ≤ƒ¬.ѕ-–јћ,ўќ ѕ–ќ∆»¬јё“№ ¬ √≤–—№ »’ Ќј—≈Ћ. ѕ”Ќ “ј’
                                                                    ELSE 0 END)
                                  x_highlander,
                              MAX (
                                  (SELECT 1
                                     FROM uss_esr.ap_person       pp,
                                          uss_esr.ap_document     d,
                                          uss_esr.ap_document_attr da
                                    WHERE     pp.app_ap = pd.pd_ap
                                          AND pp.app_sc = f.pdf_sc
                                          AND pp.app_ap = d.apd_ap
                                          AND pp.app_id = d.apd_app
                                          AND d.apd_id = da.apda_apd
                                          AND da.apda_nda = 2206 -- ƒитина на вихованн≥ в с≥мТњ оп≥кун≥в, п≥клувальник≥в, прийомн≥й с≥мТњ, дит. будинку с≥мейного типу
                                          AND da.history_status = 'A'))
                                  x_chd_hous,
                              MAX (
                                  CASE
                                      WHEN EXISTS
                                               (SELECT 1
                                                  FROM uss_person.v_sc_disability
                                                       sd
                                                 WHERE     f.pdf_sc = scy_sc
                                                       AND sd.history_Status =
                                                           'A'
                                                       AND TRUNC (p_start_dt,
                                                                  'mm') BETWEEN TRUNC (
                                                                                    scy_start_dt,
                                                                                    'yy')
                                                                            AND NVL (
                                                                                    scy_stop_dt,
                                                                                    p_start_dt))
                                      THEN
                                          1
                                      WHEN EXISTS
                                               (SELECT 1
                                                  FROM uss_esr.ap_person  pp,
                                                       uss_esr.ap_document d,
                                                       uss_esr.ap_document_attr
                                                       da
                                                 WHERE     pp.app_ap = pd.pd_ap
                                                       AND pp.app_sc = f.pdf_sc
                                                       AND pp.app_ap = d.apd_ap
                                                       AND pp.app_id =
                                                           d.apd_app
                                                       AND d.apd_id =
                                                           da.apda_apd
                                                       AND da.apda_nda IN
                                                               (2661, --  ƒитина з ≥нвал≥дн≥стю
                                                                1798, -- ќсоба з ≥нвал≥дн≥стю I групи
                                                                1794, -- ƒитина з ≥нвал≥дн≥стю внасл≥док авар≥њ на „ј≈—
                                                                1797, -- ƒитина з ≥нвал≥дн≥стю
                                                                1772, -- ќсоба з ≥нвал≥дн≥стю
                                                                942, -- ƒитина з ≥нвал≥дн≥стю внасл≥док авар≥њ на „ј≈—
                                                                666, -- √рупа ≥нвал≥дност≥
                                                                660, -- ќсоба з ≥нвал≥дн≥стю
                                                                645, -- ќсоба з ≥нвал≥дн≥стю з дитинства
                                                                818 -- ќсоба з ≥нвал≥дн≥стю з дитинства
                                                                   )
                                                       AND NVL (
                                                               da.apda_val_string,
                                                               'F') !=
                                                           'F'
                                                       AND da.history_status =
                                                           'A')
                                      THEN
                                          1
                                      WHEN EXISTS
                                               (SELECT 1
                                                  FROM uss_esr.ap_person  pp,
                                                       uss_esr.ap_document ad,
                                                       uss_esr.ap_document_attr
                                                       da
                                                 WHERE     pp.app_sc = f.pdf_sc
                                                       AND pp.app_ap = pd.pd_ap
                                                       AND pp.app_ap =
                                                           ad.apd_ap
                                                       AND pp.app_id =
                                                           ad.apd_app
                                                       AND ad.apd_id =
                                                           da.apda_apd
                                                       AND da.apda_nda IN (797) -- категор≥€
                                                       AND da.apda_val_string IN
                                                               ('DI', 'DIA') -- DI/DIA (ƒитина з ≥нвал≥дн≥стю/ƒитина з ≥нвал≥дн≥стю п≥дгрупи "ј")
                                                       AND da.history_status =
                                                           'A')
                                      THEN
                                          1
                                      ELSE
                                          0
                                  END)
                                  x_is_inv
                         FROM uss_esr.tmp_work_set1 s
                              INNER JOIN uss_esr.pc_decision pd
                                  ON pd.pd_id = s.x_id1
                              INNER JOIN uss_esr.pd_family f
                                  ON f.pdf_pd = pd.pd_id
                              INNER JOIN uss_ndi.v_ndi_payment_type t
                                  ON t.npt_id = s.x_id2
                              INNER JOIN uss_esr.personalcase pc
                                  ON pc.pc_id = pd.pd_pc
                        WHERE NOT EXISTS
                                  (SELECT 1
                                     FROM uss_esr.ap_person p
                                    WHERE     p.app_ap = pd_ap
                                          AND p.app_sc = pdf_sc
                                          AND p.history_status = 'A'
                                          -- AND p.app_sc = fml.pdf_sc and p.app_tp in ('Z', 'FM', 'FP'))
                                          AND p.app_tp = 'P') -- ѕредставник за€вника
                     GROUP BY pd_nst, pc_id, pdf_sc)
              -- select * from sc; /*
              SELECT rpt.ca,
                     rpt.cb,
                     t.cnt_pc,
                     t.cnt_chd
                FROM rpt
                     LEFT JOIN
                     (  -- 251
                        SELECT CASE NVL (x_pp_type_251, 663)
                                   WHEN 2636 THEN 3
                                   WHEN 652 THEN 4
                                   WHEN 662 THEN 5
                                   WHEN 663 THEN 6
                                   WHEN 651 THEN 7
                               END                      rep_row,
                               COUNT (DISTINCT x_pc)    cnt_pc,
                               COUNT (
                                   DISTINCT
                                       CASE
                                           WHEN x_year_old < 100 THEN x_sc
                                           ELSE NULL
                                       END)             cnt_chd
                          FROM sc
                         WHERE x_nst = 251
                      GROUP BY NVL (x_pp_type_251, 663)
                      UNION ALL                                         -- 269
                      SELECT 8                        rep_row,
                             COUNT (DISTINCT x_pc)    cnt_pc,
                             COUNT (
                                 DISTINCT
                                     CASE
                                         WHEN x_year_old < 100 THEN x_sc
                                         ELSE NULL
                                     END)             cnt_chd
                        FROM sc
                       WHERE x_nst = 269
                      UNION ALL
                      SELECT 9                        rep_row,
                             COUNT (DISTINCT x_pc)    cnt_pc,
                             COUNT (
                                 DISTINCT
                                     CASE
                                         WHEN x_year_old < 100 THEN x_sc
                                         ELSE NULL
                                     END)             cnt_chd
                        FROM sc
                       WHERE     x_nst = 269
                             AND EXISTS
                                     (SELECT 1
                                        FROM uss_person.v_socialcard,
                                             uss_person.v_sc_change,
                                             uss_person.v_sc_identity
                                       WHERE     x_sc_z = sc_id
                                             AND scc_sc = sc_id
                                             AND sc_scc = scc_id
                                             AND scc_sci = sci_id
                                             AND sci_gender = 'M')
                      UNION ALL                                         -- 250
                      SELECT 11                       rep_row,
                             COUNT (DISTINCT x_pc)    cnt_pc,
                             COUNT (
                                 DISTINCT
                                     CASE
                                         WHEN x_year_old < 100 THEN x_sc
                                         ELSE NULL
                                     END)             cnt_chd
                        FROM sc
                       WHERE     x_nst = 250
                             AND EXISTS
                                     (SELECT 1
                                        FROM uss_person.v_socialcard,
                                             uss_person.v_sc_change,
                                             uss_person.v_sc_identity
                                       WHERE     x_sc_z = sc_id
                                             AND scc_sc = sc_id
                                             AND sc_scc = scc_id
                                             AND scc_sci = sci_id
                                             AND sci_gender = 'M')
                      UNION ALL
                      SELECT 13                       rep_row,
                             COUNT (DISTINCT x_pc)    cnt_pc,
                             COUNT (
                                 DISTINCT
                                     CASE
                                         WHEN x_year_old < 100 THEN x_sc
                                         ELSE NULL
                                     END)             cnt_chd
                        FROM sc
                       WHERE x_nst = 250 AND x_year_birth = 0 -- до зв≥тного року
                      UNION ALL
                      SELECT 14                       rep_row,
                             COUNT (DISTINCT x_pc)    cnt_pc,
                             COUNT (
                                 DISTINCT
                                     CASE
                                         WHEN x_year_old < 100 THEN x_sc
                                         ELSE NULL
                                     END)             cnt_chd
                        FROM sc
                       WHERE x_nst = 250 AND x_year_birth = 1 -- у зв≥тному роц≥
                      UNION ALL                                         -- 268
                      SELECT 16                       rep_row,
                             COUNT (DISTINCT x_pc)    cnt_pc,
                             COUNT (
                                 DISTINCT
                                     CASE
                                         WHEN x_year_old < 100 THEN x_sc
                                         ELSE NULL
                                     END)             cnt_chd
                        FROM sc
                       WHERE     x_nst = 268
                             AND EXISTS
                                     (SELECT 1
                                        FROM uss_person.v_socialcard,
                                             uss_person.v_sc_change,
                                             uss_person.v_sc_identity
                                       WHERE     x_sc_z = sc_id
                                             AND scc_sc = sc_id
                                             AND sc_scc = scc_id
                                             AND scc_sci = sci_id
                                             AND sci_gender = 'M')
                      UNION ALL
                        SELECT CASE
                                   WHEN x_chd_hous = 1 THEN 21
                                   WHEN x_year_old = 6 AND x_is_inv = 1 THEN 18
                                   WHEN x_year_old = 18 AND x_is_inv = 1 THEN 20
                                   WHEN x_year_old = 6 THEN 17
                                   WHEN x_year_old = 18 THEN 19
                                   ELSE -1
                               END                      rep_row,
                               COUNT (DISTINCT x_pc)    cnt_pc,
                               COUNT (
                                   DISTINCT
                                       CASE
                                           WHEN    x_year_old < 100
                                                OR x_chd_hous = 1
                                           THEN
                                               x_sc
                                           ELSE
                                               NULL
                                       END)             cnt_chd
                          FROM sc
                         WHERE x_nst = 268
                      GROUP BY CASE
                                   WHEN x_chd_hous = 1
                                   THEN
                                       21
                                   WHEN x_year_old = 6 AND x_is_inv = 1
                                   THEN
                                       18
                                   WHEN x_year_old = 18 AND x_is_inv = 1
                                   THEN
                                       20
                                   WHEN x_year_old = 6
                                   THEN
                                       17
                                   WHEN x_year_old = 18
                                   THEN
                                       19
                                   ELSE
                                       -1
                               END
                      UNION ALL                                         -- 267
                        SELECT a.rep_row,
                               COUNT (DISTINCT a.x_pc)    cnt_pc,
                               COUNT (
                                   DISTINCT
                                       CASE
                                           WHEN a.x_year_old < 100 THEN a.x_sc
                                           ELSE NULL
                                       END)               cnt_chd
                          FROM (SELECT CASE
                                           WHEN     x_widow = 1
                                                AND EXISTS
                                                        (SELECT 1
                                                           FROM uss_person.v_socialcard,
                                                                uss_person.v_sc_change,
                                                                uss_person.v_sc_identity
                                                          WHERE     x_sc_z =
                                                                    sc_id
                                                                AND scc_sc =
                                                                    sc_id
                                                                AND sc_scc =
                                                                    scc_id
                                                                AND scc_sci =
                                                                    sci_id
                                                                AND sci_gender =
                                                                    'M')
                                           THEN
                                               26                   -- вд≥вець
                                           WHEN x_widow = 1
                                           THEN
                                               25                     -- вдова
                                           WHEN EXISTS
                                                    (SELECT 1
                                                       FROM uss_person.v_socialcard,
                                                            uss_person.v_sc_change,
                                                            uss_person.v_sc_identity
                                                      WHERE     x_sc_z = sc_id
                                                            AND scc_sc = sc_id
                                                            AND sc_scc = scc_id
                                                            AND scc_sci = sci_id
                                                            AND sci_gender = 'M')
                                           THEN
                                               24      -- одинокий усиновлювач
                                           ELSE
                                               23          -- одиноких матер≥в
                                       END    rep_row,
                                       x_pc,
                                       x_sc,
                                       x_year_old
                                  FROM sc
                                 WHERE x_nst = 267) a
                      GROUP BY a.rep_row
                      UNION ALL
                        SELECT CASE x_year_old
                                   WHEN 6 THEN 28
                                   WHEN 23 THEN 30
                                   ELSE 29
                               END                      rep_row,
                               COUNT (DISTINCT x_pc)    cnt_pc,
                               COUNT (DISTINCT x_sc)    cnt_chd
                          FROM sc
                         WHERE x_nst = 267 AND x_year_old < 100
                      GROUP BY CASE x_year_old
                                   WHEN 6 THEN 28
                                   WHEN 23 THEN 30
                                   ELSE 29
                               END
                      UNION ALL                                         -- 265
                      SELECT 31                       rep_row,
                             COUNT (DISTINCT x_pc)    cnt_pc,
                             COUNT (
                                 DISTINCT
                                     CASE
                                         WHEN x_year_old < 100 THEN x_sc
                                         ELSE NULL
                                     END)             cnt_chd
                        FROM sc
                       WHERE x_nst = 265
                      UNION ALL
                      SELECT 32                       rep_row,
                             COUNT (DISTINCT x_pc)    cnt_pc,
                             COUNT (
                                 DISTINCT
                                     CASE
                                         WHEN x_year_old < 100 THEN x_sc
                                         ELSE NULL
                                     END)             cnt_chd
                        FROM sc
                       WHERE x_highlander = 1) t
                         ON t.rep_row = rpt.ca
            ORDER BY 1;

        UPDATE tmp_univ_rpt_data
           SET x_id1 =
                   (SELECT SUM (t.x_id1)
                      FROM tmp_univ_rpt_data t
                     WHERE t.x_sum1 IN (3,
                                        4,
                                        5,
                                        6,
                                        7))
         WHERE x_sum1 = 2;

        UPDATE tmp_univ_rpt_data
           SET x_id1 =
                   (SELECT SUM (t.x_id1)
                      FROM tmp_univ_rpt_data t
                     WHERE t.x_sum1 IN (13, 14)),
               x_id2 =
                   (SELECT SUM (t.x_id2)
                      FROM tmp_univ_rpt_data t
                     WHERE t.x_sum1 IN (13, 14))
         WHERE x_sum1 = 10;

        UPDATE tmp_univ_rpt_data
           SET x_id1 =
                   (SELECT SUM (t.x_id1)
                      FROM tmp_univ_rpt_data t
                     WHERE t.x_sum1 IN (17, 18)),
               x_id2 =
                   (SELECT SUM (t.x_id2)
                      FROM tmp_univ_rpt_data t
                     WHERE t.x_sum1 IN (17, 18))
         WHERE x_sum1 = 17;

        UPDATE tmp_univ_rpt_data
           SET x_id1 =
                   (SELECT SUM (t.x_id1)
                      FROM tmp_univ_rpt_data t
                     WHERE t.x_sum1 IN (19, 20)),
               x_id2 =
                   (SELECT SUM (t.x_id2)
                      FROM tmp_univ_rpt_data t
                     WHERE t.x_sum1 IN (19, 20))
         WHERE x_sum1 = 19;

        UPDATE tmp_univ_rpt_data
           SET x_id1 =
                   (SELECT SUM (t.x_id1)
                      FROM tmp_univ_rpt_data t
                     WHERE t.x_sum1 IN (17, 19, 21)),
               x_id2 =
                   (SELECT SUM (t.x_id2)
                      FROM tmp_univ_rpt_data t
                     WHERE t.x_sum1 IN (17, 19, 21))
         WHERE x_sum1 = 15;

        UPDATE tmp_univ_rpt_data
           SET x_id1 =
                   (SELECT SUM (t.x_id1)
                      FROM tmp_univ_rpt_data t
                     WHERE t.x_sum1 IN (23,
                                        24,
                                        25,
                                        26)),
               x_id2 =
                   (SELECT SUM (t.x_id2)
                      FROM tmp_univ_rpt_data t
                     WHERE t.x_sum1 IN (23,
                                        24,
                                        25,
                                        26))
         WHERE x_sum1 = 22;

        UPDATE tmp_univ_rpt_data
           SET x_id1 =
                   (SELECT SUM (t.x_id1)
                      FROM tmp_univ_rpt_data t
                     WHERE t.x_sum1 IN (28, 29, 30)),
               x_id2 =
                   (SELECT SUM (t.x_id2)
                      FROM tmp_univ_rpt_data t
                     WHERE t.x_sum1 IN (28, 29, 30))
         WHERE x_sum1 = 27;

        UPDATE tmp_univ_rpt_data
           SET x_id1 =
                   (SELECT SUM (t.x_id1)
                      FROM tmp_univ_rpt_data t
                     WHERE t.x_sum1 IN (2,
                                        8,
                                        10,
                                        15,
                                        22,
                                        31)),
               x_id2 =
                   (SELECT SUM (t.x_id2)
                      FROM tmp_univ_rpt_data t
                     WHERE t.x_sum1 IN (8,
                                        10,
                                        15,
                                        22,
                                        31))
         WHERE x_sum1 = 1;

        UPDATE tmp_univ_rpt_data
           SET x_string2 =
                      '
   <Row ss:AutoFitHeight="0" ss:Height="31.200000000000003">
    <Cell ss:StyleID="s102"><Data ss:Type="String">ƒержавна допомога с≥м''€м з д≥тьми, усього:&#10;(сума значень р€дк≥в 02 + 08 + 10 + 15 + 22 + 31) </Data></Cell>
    <Cell ss:StyleID="s103"><Data ss:Type="String">01</Data></Cell>
    <Cell ss:StyleID="s105"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_id1, 0))
                   || '</Data></Cell>
    <Cell ss:StyleID="s105"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_id2, 0))
                   || '</Data></Cell>
   </Row>'
         WHERE x_sum1 = 1;

        UPDATE tmp_univ_rpt_data
           SET x_string2 =
                      '
   <Row ss:AutoFitHeight="0" ss:Height="31.200000000000003">
    <Cell ss:StyleID="s102"><Data ss:Type="String">ƒопомога у зв''€зку з ваг≥тн≥стю та пологами&#10;(сума значень р€дк≥в 03 + 04 + 05 + 06 + 07)</Data></Cell>
    <Cell ss:StyleID="s103"><Data ss:Type="String">02</Data></Cell>
    <Cell ss:StyleID="s105"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_id1, 0))
                   || '</Data></Cell>
    <Cell ss:StyleID="s106"><Data ss:Type="String">x</Data></Cell>
   </Row>'
         WHERE x_sum1 = 2;

        UPDATE tmp_univ_rpt_data
           SET x_string2 =
                   '
   <Row ss:AutoFitHeight="0" ss:Height="15.45">
    <Cell ss:StyleID="s102"><Data ss:Type="String">у тому числ≥: </Data></Cell>
    <Cell ss:StyleID="s103"></Cell>
    <Cell ss:StyleID="s107"></Cell>
    <Cell ss:StyleID="s107"></Cell>
   </Row>'
         WHERE x_sum1 = 2.1;

        UPDATE tmp_univ_rpt_data
           SET x_string2 =
                      '
   <Row ss:AutoFitHeight="0" ss:Height="31.200000000000003">
    <Cell ss:StyleID="s108"><Data ss:Type="String">к≥льк≥сть ж≥нок, зв≥льнених з роботи у звТ€зку з л≥кв≥дац≥Їю п≥дприЇмства </Data></Cell>
    <Cell ss:StyleID="s103"><Data ss:Type="String">03</Data></Cell>
    <Cell ss:StyleID="s107"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_id1, 0))
                   || '</Data></Cell>
    <Cell ss:StyleID="s106"><Data ss:Type="String">x</Data></Cell>
   </Row>'
         WHERE x_sum1 = 3;

        UPDATE tmp_univ_rpt_data
           SET x_string2 =
                      '
   <Row ss:AutoFitHeight="0" ss:Height="46.800000000000004">
    <Cell ss:StyleID="s108"><Data ss:Type="String">к≥льк≥сть ж≥нок, зареЇстрованих у державн≥й служб≥ зайн€тост≥ €к безроб≥тн≥ у державн≥й служб≥ зайн€тост≥ €к безроб≥тн≥</Data></Cell>
    <Cell ss:StyleID="s103"><Data ss:Type="String">04</Data></Cell>
    <Cell ss:StyleID="s107"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_id1, 0))
                   || '</Data></Cell>
    <Cell ss:StyleID="s106"><Data ss:Type="String">x</Data></Cell>
   </Row>'
         WHERE x_sum1 = 4;

        UPDATE tmp_univ_rpt_data
           SET x_string2 =
                      '
   <Row ss:AutoFitHeight="0" ss:Height="31.200000000000003">
    <Cell ss:StyleID="s108"><Data ss:Type="String">к≥льк≥сть ж≥нок Ч асп≥ранток, докторанток, кл≥н≥чних ординатор≥в, студенток </Data></Cell>
    <Cell ss:StyleID="s103"><Data ss:Type="String">05</Data></Cell>
    <Cell ss:StyleID="s107"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_id1, 0))
                   || '</Data></Cell>
    <Cell ss:StyleID="s106"><Data ss:Type="String">x</Data></Cell>
   </Row>'
         WHERE x_sum1 = 5;

        UPDATE tmp_univ_rpt_data
           SET x_string2 =
                      '
   <Row ss:AutoFitHeight="0" ss:Height="15.45">
    <Cell ss:StyleID="s108"><Data ss:Type="String">к≥льк≥сть непрацюючих ж≥нок</Data></Cell>
    <Cell ss:StyleID="s103"><Data ss:Type="String">06</Data></Cell>
    <Cell ss:StyleID="s107"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_id1, 0))
                   || '</Data></Cell>
    <Cell ss:StyleID="s106"><Data ss:Type="String">x</Data></Cell>
   </Row>'
         WHERE x_sum1 = 6;

        UPDATE tmp_univ_rpt_data
           SET x_string2 =
                      '
   <Row ss:AutoFitHeight="0" ss:Height="31.200000000000003">
    <Cell ss:StyleID="s108"><Data ss:Type="String">к≥льк≥сть ж≥нок, зареЇстрованих €к субТЇкти п≥дприЇмницькоњ д≥€льност≥ </Data></Cell>
    <Cell ss:StyleID="s103"><Data ss:Type="String">07</Data></Cell>
    <Cell ss:StyleID="s107"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_id1, 0))
                   || '</Data></Cell>
    <Cell ss:StyleID="s106"><Data ss:Type="String">x</Data></Cell>
   </Row>'
         WHERE x_sum1 = 7;

        UPDATE tmp_univ_rpt_data
           SET x_string2 =
                      '
   <Row ss:AutoFitHeight="0" ss:Height="15.45">
    <Cell ss:StyleID="s102"><Data ss:Type="String">ƒопомога при усиновленн≥ дитини</Data></Cell>
    <Cell ss:StyleID="s103"><Data ss:Type="String">08</Data></Cell>
    <Cell ss:StyleID="s105"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_id1, 0))
                   || '</Data></Cell>
    <Cell ss:StyleID="s105"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_id2, 0))
                   || '</Data></Cell>
   </Row>'
         WHERE x_sum1 = 8;

        UPDATE tmp_univ_rpt_data
           SET x_string2 =
                      '
   <Row ss:AutoFitHeight="0" ss:Height="15.45">
    <Cell ss:StyleID="s109"><Data ss:Type="String">≥з них: чолов≥кам </Data></Cell>
    <Cell ss:StyleID="s103"><Data ss:Type="String">09</Data></Cell>
    <Cell ss:StyleID="s107"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_id1, 0))
                   || '</Data></Cell>
    <Cell ss:StyleID="s107"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_id2, 0))
                   || '</Data></Cell>
   </Row>'
         WHERE x_sum1 = 9;

        UPDATE tmp_univ_rpt_data
           SET x_string2 =
                      '
   <Row ss:AutoFitHeight="0" ss:Height="31.200000000000003">
    <Cell ss:StyleID="s102"><Data ss:Type="String">ƒопомога при народженн≥ дитини (сума значень р€дк≥в 13 + 14)</Data></Cell>
    <Cell ss:StyleID="s103"><Data ss:Type="Number">10</Data></Cell>
    <Cell ss:StyleID="s105"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_id1, 0))
                   || '</Data></Cell>
    <Cell ss:StyleID="s105"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_id2, 0))
                   || '</Data></Cell>
   </Row>'
         WHERE x_sum1 = 10;

        UPDATE tmp_univ_rpt_data
           SET x_string2 =
                      '
   <Row ss:AutoFitHeight="0" ss:Height="15.45">
    <Cell ss:StyleID="s109"><Data ss:Type="String">≥з них: чолов≥кам </Data></Cell>
    <Cell ss:StyleID="s103"><Data ss:Type="Number">11</Data></Cell>
    <Cell ss:StyleID="s107"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_id1, 0))
                   || '</Data></Cell>
    <Cell ss:StyleID="s107"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_id2, 0))
                   || '</Data></Cell>
   </Row>'
         WHERE x_sum1 = 11;

        UPDATE tmp_univ_rpt_data
           SET x_string2 = '
   <Row ss:AutoFitHeight="0" ss:Height="15.45">
    <Cell ss:StyleID="s102"><Data ss:Type="String">≤з р€дка 10: </Data></Cell>
    <Cell ss:StyleID="s107"></Cell>
    <Cell ss:StyleID="s107"></Cell>
    <Cell ss:StyleID="s107"></Cell>
   </Row>'
         WHERE x_sum1 = 11.1;

        UPDATE tmp_univ_rpt_data
           SET x_string2 =
                      '
   <Row ss:AutoFitHeight="0" ss:Height="32">
    <Cell ss:StyleID="s110"><Data ss:Type="String">за за€вами в електронн≥й форм≥ з використанн€м квал≥ф≥кованого електронного п≥дпису</Data></Cell>
    <Cell ss:StyleID="s103"><Data ss:Type="Number">12</Data></Cell>
    <Cell ss:StyleID="s107"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_id1, 0))
                   || '</Data></Cell>
    <Cell ss:StyleID="s107"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_id2, 0))
                   || '</Data></Cell>
   </Row>'
         WHERE x_sum1 = 12;

        UPDATE tmp_univ_rpt_data
           SET x_string2 =
                      '
   <Row ss:AutoFitHeight="0" ss:Height="15.45">
    <Cell ss:StyleID="s110"><Data ss:Type="String">на д≥тей, €к≥ народилис€ до зв≥тного року</Data></Cell>
    <Cell ss:StyleID="s103"><Data ss:Type="Number">13</Data></Cell>
    <Cell ss:StyleID="s107"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_id1, 0))
                   || '</Data></Cell>
    <Cell ss:StyleID="s107"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_id2, 0))
                   || '</Data></Cell>
   </Row>'
         WHERE x_sum1 = 13;

        UPDATE tmp_univ_rpt_data
           SET x_string2 =
                      '
   <Row ss:AutoFitHeight="0" ss:Height="15.45">
    <Cell ss:StyleID="s110"><Data ss:Type="String">на д≥тей, €к≥ народилис€ у зв≥тному роц≥</Data></Cell>
    <Cell ss:StyleID="s103"><Data ss:Type="Number">14</Data></Cell>
    <Cell ss:StyleID="s107"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_id1, 0))
                   || '</Data></Cell>
    <Cell ss:StyleID="s107"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_id2, 0))
                   || '</Data></Cell>
   </Row>'
         WHERE x_sum1 = 14;

        UPDATE tmp_univ_rpt_data
           SET x_string2 =
                      '
   <Row ss:AutoFitHeight="0" ss:Height="46.800000000000004">
    <Cell ss:StyleID="s102"><Data ss:Type="String">ƒопомога на д≥тей, над €кими встановлено оп≥ку чи п≥клуванн€&#10;(сума значень р€дк≥в 17 + 19 + 21)</Data></Cell>
    <Cell ss:StyleID="s103"><Data ss:Type="Number">15</Data></Cell>
    <Cell ss:StyleID="s105"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_id1, 0))
                   || '</Data></Cell>
    <Cell ss:StyleID="s105"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_id2, 0))
                   || '</Data></Cell>
   </Row>'
         WHERE x_sum1 = 15;

        UPDATE tmp_univ_rpt_data
           SET x_string2 =
                      '
   <Row ss:AutoFitHeight="0" ss:Height="15.45">
    <Cell ss:StyleID="s109"><Data ss:Type="String">≥з них:  чолов≥кам </Data></Cell>
    <Cell ss:StyleID="s103"><Data ss:Type="Number">16</Data></Cell>
    <Cell ss:StyleID="s107"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_id1, 0))
                   || '</Data></Cell>
    <Cell ss:StyleID="s107"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_id2, 0))
                   || '</Data></Cell>
   </Row>'
         WHERE x_sum1 = 16;

        UPDATE tmp_univ_rpt_data
           SET x_string2 =
                   '
   <Row ss:AutoFitHeight="0" ss:Height="15.45">
    <Cell ss:StyleID="s102"><ss:Data ss:Type="String" xmlns="http://www.w3.org/TR/REC-html40"><B>≤з р€дка 15:</B><Font> </Font></ss:Data></Cell>
    <Cell ss:StyleID="s111"></Cell>
    <Cell ss:StyleID="s107"></Cell>
    <Cell ss:StyleID="s107"></Cell>
   </Row>'
         WHERE x_sum1 = 16.1;

        UPDATE tmp_univ_rpt_data
           SET x_string2 =
                      '
   <Row ss:AutoFitHeight="0" ss:Height="15.45">
    <Cell ss:StyleID="s110"><ss:Data ss:Type="String"
      xmlns="http://www.w3.org/TR/REC-html40">на д≥тей <U>в≥ком до 6 рок≥в </U></ss:Data></Cell>
    <Cell ss:StyleID="s103"><Data ss:Type="Number">17</Data></Cell>
    <Cell ss:StyleID="s107"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_id1, 0))
                   || '</Data></Cell>
    <Cell ss:StyleID="s107"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_id2, 0))
                   || '</Data></Cell>
   </Row>'
         WHERE x_sum1 = 17;

        UPDATE tmp_univ_rpt_data
           SET x_string2 =
                      '
   <Row ss:AutoFitHeight="0" ss:Height="15.45">
    <Cell ss:StyleID="s112"><ss:Data ss:Type="String"
      xmlns="http://www.w3.org/TR/REC-html40">≥з них: на д≥тей<I> з ≥нвал≥дн≥стю в≥ком до 6 рок≥в</I></ss:Data></Cell>
    <Cell ss:StyleID="s103"><Data ss:Type="Number">18</Data></Cell>
    <Cell ss:StyleID="s107"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_id1, 0))
                   || '</Data></Cell>
    <Cell ss:StyleID="s107"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_id2, 0))
                   || '</Data></Cell>
   </Row>'
         WHERE x_sum1 = 18;

        UPDATE tmp_univ_rpt_data
           SET x_string2 =
                      '
   <Row ss:AutoFitHeight="0" ss:Height="15.45">
    <Cell ss:StyleID="s110"><ss:Data ss:Type="String"
      xmlns="http://www.w3.org/TR/REC-html40">на д≥тей в≥ком <U>в≥д 6 до 18 рок≥в</U></ss:Data></Cell>
    <Cell ss:StyleID="s103"><Data ss:Type="Number">19</Data></Cell>
    <Cell ss:StyleID="s107"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_id1, 0))
                   || '</Data></Cell>
    <Cell ss:StyleID="s107"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_id2, 0))
                   || '</Data></Cell>
   </Row>'
         WHERE x_sum1 = 19;

        UPDATE tmp_univ_rpt_data
           SET x_string2 =
                      '
   <Row ss:AutoFitHeight="0" ss:Height="15.45">
    <Cell ss:StyleID="s108"><ss:Data ss:Type="String"
      xmlns="http://www.w3.org/TR/REC-html40">≥з них:  на д≥тей<I> з ≥нвал≥дн≥стю в≥ком в≥д 6 до 18 рок≥в</I></ss:Data></Cell>
    <Cell ss:StyleID="s103"><Data ss:Type="Number">20</Data></Cell>
    <Cell ss:StyleID="s107"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_id1, 0))
                   || '</Data></Cell>
    <Cell ss:StyleID="s107"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_id2, 0))
                   || '</Data></Cell>
   </Row>'
         WHERE x_sum1 = 20;

        UPDATE tmp_univ_rpt_data
           SET x_string2 =
                      '
   <Row ss:AutoFitHeight="0" ss:Height="46.800000000000004">
    <Cell ss:StyleID="s113"><Data ss:Type="String">на д≥тей, над €кими встановлено оп≥ку чи п≥клуванн€ ≥ €к≥ Ї вихованц€ми дит€чих заклад≥в осв≥ти, що ф≥нансуютьс€ не за рахунок бюджетних кошт≥в </Data></Cell>
    <Cell ss:StyleID="s103"><Data ss:Type="Number">21</Data></Cell>
    <Cell ss:StyleID="s107"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_id1, 0))
                   || '</Data></Cell>
    <Cell ss:StyleID="s107"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_id2, 0))
                   || '</Data></Cell>
   </Row>'
         WHERE x_sum1 = 21;

        UPDATE tmp_univ_rpt_data
           SET x_string2 =
                      '
   <Row ss:AutoFitHeight="0" ss:Height="31.200000000000003">
    <Cell ss:StyleID="s102"><Data ss:Type="String">ƒопомога на д≥тей одиноким особам (сума значень р€дк≥в 23 + 24 + 25 + 26)</Data></Cell>
    <Cell ss:StyleID="s103"><Data ss:Type="Number">22</Data></Cell>
    <Cell ss:StyleID="s105"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_id1, 0))
                   || '</Data></Cell>
    <Cell ss:StyleID="s105"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_id2, 0))
                   || '</Data></Cell>
   </Row>'
         WHERE x_sum1 = 22;

        UPDATE tmp_univ_rpt_data
           SET x_string2 =
                   '
   <Row ss:AutoFitHeight="0" ss:Height="15.45">
    <Cell ss:StyleID="s102"><Data ss:Type="String">у тому числ≥: </Data></Cell>
    <Cell ss:StyleID="s114"></Cell>
    <Cell ss:StyleID="s107"></Cell>
    <Cell ss:StyleID="s107"></Cell>
   </Row>'
         WHERE x_sum1 = 22.1;

        UPDATE tmp_univ_rpt_data
           SET x_string2 =
                      '
   <Row ss:AutoFitHeight="0" ss:Height="15.45">
    <Cell ss:StyleID="s108"><Data ss:Type="String">одиноких матер≥в</Data></Cell>
    <Cell ss:StyleID="s103"><Data ss:Type="Number">23</Data></Cell>
    <Cell ss:StyleID="s107"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_id1, 0))
                   || '</Data></Cell>
    <Cell ss:StyleID="s107"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_id2, 0))
                   || '</Data></Cell>
   </Row>'
         WHERE x_sum1 = 23;

        UPDATE tmp_univ_rpt_data
           SET x_string2 =
                      '
   <Row ss:AutoFitHeight="0" ss:Height="15.45">
    <Cell ss:StyleID="s108"><Data ss:Type="String">одиноких усиновлювач≥в</Data></Cell>
    <Cell ss:StyleID="s103"><Data ss:Type="Number">24</Data></Cell>
    <Cell ss:StyleID="s107"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_id1, 0))
                   || '</Data></Cell>
    <Cell ss:StyleID="s107"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_id2, 0))
                   || '</Data></Cell>
   </Row>'
         WHERE x_sum1 = 24;

        UPDATE tmp_univ_rpt_data
           SET x_string2 =
                      '
   <Row ss:AutoFitHeight="0" ss:Height="15.45">
    <Cell ss:StyleID="s108"><Data ss:Type="String">уд≥в</Data></Cell>
    <Cell ss:StyleID="s103"><Data ss:Type="Number">25</Data></Cell>
    <Cell ss:StyleID="s107"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_id1, 0))
                   || '</Data></Cell>
    <Cell ss:StyleID="s107"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_id2, 0))
                   || '</Data></Cell>
   </Row>'
         WHERE x_sum1 = 25;

        UPDATE tmp_univ_rpt_data
           SET x_string2 =
                      '
   <Row ss:AutoFitHeight="0" ss:Height="15.45">
    <Cell ss:StyleID="s108"><Data ss:Type="String">уд≥вц≥в</Data></Cell>
    <Cell ss:StyleID="s103"><Data ss:Type="Number">26</Data></Cell>
    <Cell ss:StyleID="s107"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_id1, 0))
                   || '</Data></Cell>
    <Cell ss:StyleID="s107"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_id2, 0))
                   || '</Data></Cell>
   </Row>'
         WHERE x_sum1 = 26;

        UPDATE tmp_univ_rpt_data
           SET x_string2 =
                      '
   <Row ss:AutoFitHeight="0" ss:Height="31.200000000000003">
    <Cell ss:StyleID="s102"><Data ss:Type="String">≤з р€дка 22: отримано допомогу&#10;(сума значень р€дк≥в 28 + 29 + 30) </Data></Cell>
    <Cell ss:StyleID="s103"><Data ss:Type="Number">27</Data></Cell>
    <Cell ss:StyleID="s105"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_id1, 0))
                   || '</Data></Cell>
    <Cell ss:StyleID="s105"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_id2, 0))
                   || '</Data></Cell>
   </Row>'
         WHERE x_sum1 = 27;

        UPDATE tmp_univ_rpt_data
           SET x_string2 =
                      '
   <Row ss:AutoFitHeight="0" ss:Height="15.45">
    <Cell ss:StyleID="s108"><Data ss:Type="String">на д≥тей в≥ком до 6 рок≥в </Data></Cell>
    <Cell ss:StyleID="s103"><Data ss:Type="Number">28</Data></Cell>
    <Cell ss:StyleID="s107"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_id1, 0))
                   || '</Data></Cell>
    <Cell ss:StyleID="s107"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_id2, 0))
                   || '</Data></Cell>
   </Row>'
         WHERE x_sum1 = 28;

        UPDATE tmp_univ_rpt_data
           SET x_string2 =
                      '
   <Row ss:AutoFitHeight="0" ss:Height="15.45">
    <Cell ss:StyleID="s108"><Data ss:Type="String">на д≥тей в≥ком в≥д 6 до 18 рок≥в</Data></Cell>
    <Cell ss:StyleID="s103"><Data ss:Type="Number">29</Data></Cell>
    <Cell ss:StyleID="s107"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_id1, 0))
                   || '</Data></Cell>
    <Cell ss:StyleID="s107"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_id2, 0))
                   || '</Data></Cell>
   </Row>'
         WHERE x_sum1 = 29;

        UPDATE tmp_univ_rpt_data
           SET x_string2 =
                      '
   <Row ss:AutoFitHeight="0" ss:Height="62.550000000000004">
    <Cell ss:StyleID="s108"><Data ss:Type="String">на д≥тей в≥ком в≥д 18 до 23 рок≥в, €кщо д≥ти навчаютьс€ за денною формою у закладах загальноњ середньоњ, профес≥йноњ (профес≥йно-техн≥чноњ), фаховоњ передвищоњ та вищоњ осв≥ти</Data></Cell>
    <Cell ss:StyleID="s103"><Data ss:Type="Number">30</Data></Cell>
    <Cell ss:StyleID="s107"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_id1, 0))
                   || '</Data></Cell>
    <Cell ss:StyleID="s107"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_id2, 0))
                   || '</Data></Cell>
   </Row>'
         WHERE x_sum1 = 30;

        UPDATE tmp_univ_rpt_data
           SET x_string2 =
                      '
   <Row ss:AutoFitHeight="0" ss:Height="156">
    <Cell ss:StyleID="s102"><Data ss:Type="String">ƒопомога на д≥тей, хворих на т€жк≥ перинатальн≥ ураженн€ нервовоњ системи, т€жк≥ вроджен≥ вади розвитку, р≥дк≥сн≥ орфанн≥ захворюванн€, онколог≥чн≥, онкогематолог≥чн≥ захворюванн€, дит€чий церебральний парал≥ч, т€жк≥ псих≥чн≥ розлади, цукровий д≥абет I типу (≥нсул≥нозалежний), гостр≥ або хрон≥чн≥ захворюванн€ нирок IV ступен€, на дитину, €ка отримала т€жку травму, потребуЇ трансплантац≥њ органа, потребуЇ пал≥ативноњ допомоги, €ким не встановлено ≥нвал≥дн≥сть</Data></Cell>
    <Cell ss:StyleID="s103"><Data ss:Type="Number">31</Data></Cell>
    <Cell ss:StyleID="s107"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_id1, 0))
                   || '</Data></Cell>
    <Cell ss:StyleID="s107"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_id2, 0))
                   || '</Data></Cell>
   </Row>'
         WHERE x_sum1 = 31;

        UPDATE tmp_univ_rpt_data
           SET x_string2 =
                      '
   <Row ss:AutoFitHeight="0" ss:Height="46.800000000000004">
    <Cell ss:StyleID="s115"><Data ss:Type="String">≤з р€дка 01: &#10;€к≥ проживають на територ≥њ населеного пункту, €кому надано статус г≥рського</Data></Cell>
    <Cell ss:StyleID="s103"><Data ss:Type="Number">32</Data></Cell>
    <Cell ss:StyleID="s107"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_id1, 0))
                   || '</Data></Cell>
    <Cell ss:StyleID="s107"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_id2, 0))
                   || '</Data></Cell>
   </Row>'
         WHERE x_sum1 = 32;

        INSERT INTO tmp_univ_rpt_data (x_sum1,
                                       x_string1,
                                       x_sum2,
                                       x_sum3)
            WITH
                org
                AS
                    (    SELECT org_id     i_org
                           FROM ikis_sys.v_opfu
                          WHERE l_org_to = 32
                     CONNECT BY PRIOR org_id = org_org
                     START WITH org_id = l_user_org
                     UNION ALL
                     SELECT org_id     i_org
                       FROM ikis_sys.v_opfu
                      WHERE l_org_to = 34 AND org_acc_org = l_user_org),
                rpt
                AS
                    (SELECT 1                                                                                                         ca,
                            '«агальна сума державноњ допомоги с≥м''€м з д≥тьми:  (сума значень р€дк≥в 02 + 03+ 04 + 08 + 14 + 18)'    cb
                       FROM DUAL
                     UNION ALL
                     SELECT 2 ca, 'у зв''€зку з ваг≥тн≥стю та пологами' cb
                       FROM DUAL
                     UNION ALL
                     SELECT 3 ca, 'при усиновленн≥ дитини' cb FROM DUAL
                     UNION ALL
                     SELECT 4                                                        ca,
                            'при народженн≥ дитини (сума значень р€дк≥в 06 + 07)'    cb
                       FROM DUAL
                     UNION ALL
                     SELECT 4.1 ca, '≤з р€дка 04:' cb FROM DUAL
                     UNION ALL
                     SELECT 5                                                                                        ca,
                            'за за€вами в електронн≥й форм≥ з використанн€м квал≥ф≥кованого електронного п≥дпису'    cb
                       FROM DUAL
                     UNION ALL
                     SELECT 6                                               ca,
                            'на д≥тей, €к≥ народилис€ до зв≥тного року '    cb
                       FROM DUAL
                     UNION ALL
                     SELECT 7                                              ca,
                            'на д≥тей, €к≥ народилис€ у зв≥тному роц≥'     cb
                       FROM DUAL
                     UNION ALL
                     SELECT 8                                                                                                     ca,
                            'ƒопомога на д≥тей, над €кими встановлено оп≥ку чи п≥клуванн€  (сума значень р€дк≥в 09 + 11 + 13)'    cb
                       FROM DUAL
                     UNION ALL
                     SELECT 8.1 ca, '≤з р€дка 08:' cb FROM DUAL
                     UNION ALL
                     SELECT 9 ca, 'на д≥тей в≥ком до 6 рок≥в' cb FROM DUAL
                     UNION ALL
                     SELECT 10                                                    ca,
                            '≥з них: на д≥тей з ≥нвал≥дн≥стю в≥ком до 6 рок≥в'    cb
                       FROM DUAL
                     UNION ALL
                     SELECT 11 ca, 'на д≥тей в≥ком в≥д 6 до 18 рок≥в' cb
                       FROM DUAL
                     UNION ALL
                     SELECT 12                                                            ca,
                            '≥з них:  на д≥тей з ≥нвал≥дн≥стю в≥ком в≥д 6 до 18 рок≥в'    cb
                       FROM DUAL
                     UNION ALL
                     SELECT 13                                                                                                                                                   ca,
                            'на д≥тей, над €кими встановлено оп≥ку чи п≥клуванн€ ≥ €к≥ Ї вихованц€ми дит€чих заклад≥в осв≥ти, що ф≥нансуютьс€ не за рахунок бюджетних кошт≥в'    cb
                       FROM DUAL
                     UNION ALL
                     SELECT 14                                                                        ca,
                            'ƒопомога на д≥тей одиноким особам (сума значень р€дк≥в 15 + 16 + 17)'    cb
                       FROM DUAL
                     UNION ALL
                     SELECT 14.1 ca, 'у тому числ≥:' cb FROM DUAL
                     UNION ALL
                     SELECT 15 ca, 'на д≥тей в≥ком до 6 рок≥в' cb FROM DUAL
                     UNION ALL
                     SELECT 16 ca, 'на д≥тей в≥ком в≥д 6 до 18 рок≥в' cb
                       FROM DUAL
                     UNION ALL
                     SELECT 17                                                                                                                                                                                   ca,
                            'на д≥тей в≥ком в≥д 18 до 23 рок≥в, €кщо д≥ти навчаютьс€ за денною формою у закладах загальноњ середньоњ, профес≥йноњ (профес≥йно-техн≥чноњ), фаховоњ передвищоњ та вищоњ осв≥ти'    cb
                       FROM DUAL
                     UNION ALL
                     SELECT 18                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  ca,
                            'ƒопомога на д≥тей, хворих на т€жк≥ перинатальн≥ ураженн€ нервовоњ системи, т€жк≥ вроджен≥ вади розвитку, р≥дк≥сн≥ орфанн≥ захворюванн€, онколог≥чн≥, онкогематолог≥чн≥ захворюванн€, дит€чий церебральний парал≥ч, т€жк≥ псих≥чн≥ розлади, цукровий д≥абет I типу (≥нсул≥нозалежний), гостр≥ або хрон≥чн≥ захворюванн€ нирок IV ступен€, на дитину, €ка отримала т€жку травму, потребуЇ трансплантац≥њ органа, потребуЇ пал≥ативноњ допомоги, €ким не встановлено ≥нвал≥дн≥сть'    cb
                       FROM DUAL
                     UNION ALL
                     SELECT 18.1 ca, '≤з р€дка 01:' cb FROM DUAL
                     UNION ALL
                     SELECT 19                                                                                ca,
                            '€к≥ проживають на територ≥њ населеного пункту, €кому надано статус г≥рського'    cb
                       FROM DUAL),
                nrh
                AS
                    (  SELECT SUM (s.prs_sum)    x_nrh,
                              SUM (
                                  CASE
                                      WHEN s.prs_st != 'PP' THEN s.prs_sum
                                      ELSE 0
                                  END)           x_pay,
                              SUM (
                                  CASE
                                      WHEN s.prs_st IN ('NA', 'KV1', 'KV2')
                                      THEN
                                          s.prs_sum
                                      ELSE
                                          0
                                  END)           x_payed,
                              a.pa_nst           pd_nst
                         FROM uss_esr.pr_sheet s
                              INNER JOIN uss_esr.payroll pr
                                  ON pr.pr_id = s.prs_pr
                              INNER JOIN uss_esr.pc_account a
                                  ON a.pa_id = s.prs_pa
                              INNER JOIN org ON org.i_org = pr.com_org
                        WHERE     s.prs_sum != 0
                              --AND s.prs_st != 'PP'  -- з≥ вс≥ма статусами, кр≥м PP (ручне блокуванн€)
                              AND pr.pr_st IN ('F')
                              AND s.prs_tp IN ('PB', 'PP')
                              AND pr.pr_month >=
                                  ADD_MONTHS (TRUNC (p_start_dt, 'yy'), -12)
                              AND pr.pr_month < TRUNC (p_start_dt, 'yy')
                              AND a.pa_nst IN ( --250, -- ƒопомога при народженн≥ дитини
                                               251, -- ƒопомога у звТ€зку з ваг≥тн≥стю та пологами
                                               265, -- ƒопомога особ≥, €ка догл€даЇ за хворою дитиною
                                               267, -- ƒопомога на д≥тей одиноким матер€м
                                               268, -- ƒопомога на д≥тей, над €кими встановлено оп≥ку чи п≥клуванн€
                                               269) -- ƒопомога при усиновленн≥ дитини
                     GROUP BY a.pa_nst)
              --select * from nrh;
              SELECT 100 + rpt.ca     cs,
                     rpt.cb,
                     n.x_payed,
                     0                x_borh
                FROM rpt
                     LEFT JOIN
                     (SELECT CASE pd_nst
                                 WHEN 251 THEN 2
                                 WHEN 269 THEN 3
                                 WHEN 250 THEN 4
                                 WHEN 268 THEN 8
                                 WHEN 267 THEN 14
                                 WHEN 265 THEN 18
                                 ELSE 0
                             END                rep_row,
                             x_payed            x_payed,
                             x_pay - x_payed    x_borh
                        FROM nrh) n
                         ON n.rep_row = rpt.ca
            ORDER BY 1;

        UPDATE tmp_univ_rpt_data
           SET x_sum2 =
                   (SELECT SUM (t.x_sum2)
                      FROM tmp_univ_rpt_data t
                     WHERE t.x_sum1 IN (102,
                                        103,
                                        104,
                                        108,
                                        114,
                                        118)),
               x_sum3 =
                   (SELECT SUM (t.x_sum3)
                      FROM tmp_univ_rpt_data t
                     WHERE t.x_sum1 IN (102,
                                        103,
                                        104,
                                        108,
                                        114,
                                        118))
         WHERE x_sum1 = 101;

        FOR c IN (  SELECT a.x_sum1,
                           CASE
                               WHEN NVL (x_id2, 0) = 0 THEN 0
                               ELSE 100 * x_id2 / SUM (x_id2) OVER ()
                           END                        prc,
                           x_id2,
                           (SELECT SUM (t.x_sum2)
                              FROM tmp_univ_rpt_data t
                             WHERE t.x_sum1 = 104)    sum_pay
                      FROM tmp_univ_rpt_data a
                     WHERE x_sum1 IN (13, 14)
                  ORDER BY 1)
        LOOP
            UPDATE tmp_univ_rpt_data
               SET x_sum2 = ROUND (c.sum_pay * c.prc * 0.01, 2)
             WHERE x_sum1 =
                   CASE c.x_sum1 WHEN 13 THEN 106 WHEN 14 THEN 107 END;
        END LOOP;

        UPDATE tmp_univ_rpt_data
           SET x_sum2 =
                   (SELECT   t.x_sum2
                           - (SELECT SUM (a.x_sum2)
                                FROM tmp_univ_rpt_data a
                               WHERE a.x_sum1 IN (107))
                      FROM tmp_univ_rpt_data t
                     WHERE t.x_sum1 = 104)
         WHERE x_sum1 = 106;

        FOR c IN (  SELECT a.x_sum1,
                           CASE
                               WHEN NVL (x_id1, 0) = 0 THEN 0
                               ELSE 100 * x_id1 / SUM (x_id1) OVER ()
                           END                        prc,
                           x_id1,
                           (SELECT SUM (t.x_sum2)
                              FROM tmp_univ_rpt_data t
                             WHERE t.x_sum1 = 108)    sum_pay
                      FROM tmp_univ_rpt_data a
                     WHERE x_sum1 IN (17, 19, 21)
                  ORDER BY 1)
        LOOP
            UPDATE tmp_univ_rpt_data
               SET x_sum2 = ROUND (c.sum_pay * c.prc * 0.01, 2)
             WHERE x_sum1 =
                   CASE c.x_sum1
                       WHEN 17 THEN 109
                       WHEN 19 THEN 111
                       WHEN 21 THEN 113
                   END;
        END LOOP;

        UPDATE tmp_univ_rpt_data
           SET x_sum2 =
                   (SELECT   t.x_sum2
                           - (SELECT SUM (a.x_sum2)
                                FROM tmp_univ_rpt_data a
                               WHERE a.x_sum1 IN (109, 113))
                      FROM tmp_univ_rpt_data t
                     WHERE t.x_sum1 = 108)
         WHERE x_sum1 = 111;

        FOR c IN (  SELECT a.x_sum1,
                           CASE
                               WHEN NVL (x_id1, 0) = 0
                               THEN
                                   0
                               ELSE
                                   (SELECT SUM (t.x_id1) / a.x_id1 * 100
                                      FROM tmp_univ_rpt_data t
                                     WHERE t.x_sum1 = a.x_sum1 + 1)
                           END             prc,
                           a.x_id1,
                           (SELECT t.x_sum2
                              FROM tmp_univ_rpt_data t
                             WHERE t.x_sum1 =
                                   CASE a.x_sum1
                                       WHEN 17 THEN 109
                                       WHEN 19 THEN 111
                                   END)    sum_pay
                      FROM tmp_univ_rpt_data a
                     WHERE a.x_sum1 IN (17, 19)
                  ORDER BY 1)
        LOOP
            UPDATE tmp_univ_rpt_data
               SET x_sum2 = ROUND (c.sum_pay * c.prc * 0.01, 2)
             WHERE x_sum1 =
                   CASE c.x_sum1 WHEN 17 THEN 110 WHEN 19 THEN 112 END;
        END LOOP;

        FOR c IN (  SELECT a.x_sum1,
                           CASE
                               WHEN NVL (x_id1, 0) = 0 THEN 0
                               ELSE 100 * x_id1 / SUM (x_id1) OVER ()
                           END                        prc,
                           x_id1,
                           (SELECT SUM (t.x_sum2)
                              FROM tmp_univ_rpt_data t
                             WHERE t.x_sum1 = 114)    sum_pay
                      FROM tmp_univ_rpt_data a
                     WHERE x_sum1 IN (28, 29, 30)
                  ORDER BY 1)
        LOOP
            UPDATE tmp_univ_rpt_data
               SET x_sum2 = ROUND (c.sum_pay * c.prc * 0.01, 2)
             WHERE x_sum1 =
                   CASE c.x_sum1
                       WHEN 28 THEN 115
                       WHEN 29 THEN 116
                       WHEN 30 THEN 117
                   END;
        END LOOP;

        UPDATE tmp_univ_rpt_data
           SET x_sum2 =
                   (SELECT   t.x_sum2
                           - (SELECT SUM (a.x_sum2)
                                FROM tmp_univ_rpt_data a
                               WHERE a.x_sum1 IN (115, 117))
                      FROM tmp_univ_rpt_data t
                     WHERE t.x_sum1 = 114)
         WHERE x_sum1 = 116;

        SELECT   x_id1
               / (SELECT a.x_id1
                    FROM tmp_univ_rpt_data a
                   WHERE a.x_sum1 = 1 AND NVL (a.x_id1, 0) > 0)
               * 100
          INTO p_prc
          FROM tmp_univ_rpt_data
         WHERE x_sum1 = 32;

        UPDATE tmp_univ_rpt_data
           SET x_sum2 =
                   (SELECT ROUND (a.x_sum2 * p_prc * 0.01, 2)
                      FROM tmp_univ_rpt_data a
                     WHERE a.x_sum1 = 101)
         WHERE x_sum1 = 119;

        UPDATE tmp_univ_rpt_data
           SET x_string2 =
                      '
   <Row ss:AutoFitHeight="0" ss:Height="31.200000000000003">
    <Cell ss:StyleID="s145"><Data ss:Type="String">«агальна сума державноњ допомоги с≥м''€м з д≥тьми:  (сума значень р€дк≥в 02 + 03+ 04 + 08 + 14 + 18)</Data></Cell>
    <Cell ss:StyleID="s146"><Data ss:Type="String">01</Data></Cell>
    <Cell ss:StyleID="s148"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_sum2, 0), 'FM9999999999990.00')
                   || '</Data></Cell>
    <Cell ss:StyleID="s149"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_sum2, 0), 'FM9999999999990.00')
                   || '</Data></Cell>
    <Cell ss:StyleID="s150"><Data ss:Type="Number">0</Data></Cell>
    <Cell ss:StyleID="s148"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_sum3, 0), 'FM9999999999990.00')
                   || '</Data></Cell>
   </Row>'
         WHERE x_sum1 = 101;

        UPDATE tmp_univ_rpt_data
           SET x_string2 =
                      '
   <Row ss:AutoFitHeight="0" ss:Height="15.45">
    <Cell ss:StyleID="s145"><Data ss:Type="String">у зв''€зку з ваг≥тн≥стю та пологами </Data></Cell>
    <Cell ss:StyleID="s146"><Data ss:Type="String">02</Data></Cell>
    <Cell ss:StyleID="s151"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_sum2, 0), 'FM9999999999990.00')
                   || '</Data></Cell>
    <Cell ss:StyleID="s152"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_sum2, 0), 'FM9999999999990.00')
                   || '</Data></Cell>
    <Cell ss:StyleID="s153"><Data ss:Type="Number">0</Data></Cell>
    <Cell ss:StyleID="s151"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_sum3, 0), 'FM9999999999990.00')
                   || '</Data></Cell>
   </Row>'
         WHERE x_sum1 = 102;

        UPDATE tmp_univ_rpt_data
           SET x_string2 =
                      '
   <Row ss:AutoFitHeight="0" ss:Height="15.45">
    <Cell ss:StyleID="s145"><Data ss:Type="String">при усиновленн≥ дитини</Data></Cell>
    <Cell ss:StyleID="s146"><Data ss:Type="String">03</Data></Cell>
    <Cell ss:StyleID="s151"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_sum2, 0), 'FM9999999999990.00')
                   || '</Data></Cell>
    <Cell ss:StyleID="s152"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_sum2, 0), 'FM9999999999990.00')
                   || '</Data></Cell>
    <Cell ss:StyleID="s153"><Data ss:Type="Number">0</Data></Cell>
    <Cell ss:StyleID="s151"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_sum3, 0), 'FM9999999999990.00')
                   || '</Data></Cell>
   </Row>'
         WHERE x_sum1 = 103;

        UPDATE tmp_univ_rpt_data
           SET x_string2 =
                      '
   <Row ss:AutoFitHeight="0" ss:Height="15.45">
    <Cell ss:StyleID="s145"><Data ss:Type="String">при народженн≥ дитини (сума значень р€дк≥в 06 + 07)</Data></Cell>
    <Cell ss:StyleID="s146"><Data ss:Type="String">04</Data></Cell>
    <Cell ss:StyleID="s148"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_sum2, 0), 'FM9999999999990.00')
                   || '</Data></Cell>
    <Cell ss:StyleID="s149"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_sum2, 0), 'FM9999999999990.00')
                   || '</Data></Cell>
    <Cell ss:StyleID="s150"><Data ss:Type="Number">0</Data></Cell>
    <Cell ss:StyleID="s148"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_sum3, 0), 'FM9999999999990.00')
                   || '</Data></Cell>
   </Row>'
         WHERE x_sum1 = 104;

        UPDATE tmp_univ_rpt_data
           SET x_string2 = '
   <Row ss:AutoFitHeight="0" ss:Height="15.45">
    <Cell ss:StyleID="s145"><Data ss:Type="String">≤з р€дка 04: </Data></Cell>
    <Cell ss:StyleID="s154"/>
    <Cell ss:StyleID="s151"/>
    <Cell ss:StyleID="s152"/>
    <Cell ss:StyleID="s155"/>
    <Cell ss:StyleID="s151"/>
   </Row>'
         WHERE x_sum1 = 104.1;

        UPDATE tmp_univ_rpt_data
           SET x_string2 =
                      '
   <Row ss:AutoFitHeight="0" ss:Height="31.200000000000003">
    <Cell ss:StyleID="s156"><Data ss:Type="String">за за€вами в електронн≥й форм≥ з використанн€м квал≥ф≥кованого електронного п≥дпису</Data></Cell>
    <Cell ss:StyleID="s146"><Data ss:Type="String">05</Data></Cell>
    <Cell ss:StyleID="s151"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_sum2, 0), 'FM9999999999990.00')
                   || '</Data></Cell>
    <Cell ss:StyleID="s152"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_sum2, 0), 'FM9999999999990.00')
                   || '</Data></Cell>
    <Cell ss:StyleID="s155"><Data ss:Type="Number">0</Data></Cell>
    <Cell ss:StyleID="s151"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_sum3, 0), 'FM9999999999990.00')
                   || '</Data></Cell>
   </Row>'
         WHERE x_sum1 = 105;

        UPDATE tmp_univ_rpt_data
           SET x_string2 =
                      '
   <Row ss:AutoFitHeight="0" ss:Height="15.45">
    <Cell ss:StyleID="s156"><Data ss:Type="String">на д≥тей, €к≥ народилис€ до зв≥тного року </Data></Cell>
    <Cell ss:StyleID="s146"><Data ss:Type="String">06</Data></Cell>
    <Cell ss:StyleID="s151"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_sum2, 0), 'FM9999999999990.00')
                   || '</Data></Cell>
    <Cell ss:StyleID="s152"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_sum2, 0), 'FM9999999999990.00')
                   || '</Data></Cell>
    <Cell ss:StyleID="s155"><Data ss:Type="Number">0</Data></Cell>
    <Cell ss:StyleID="s151"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_sum3, 0), 'FM9999999999990.00')
                   || '</Data></Cell>
   </Row>'
         WHERE x_sum1 = 106;

        UPDATE tmp_univ_rpt_data
           SET x_string2 =
                      '
   <Row ss:AutoFitHeight="0" ss:Height="15.45">
    <Cell ss:StyleID="s156"><Data ss:Type="String">на д≥тей, €к≥ народилис€ у зв≥тному роц≥</Data></Cell>
    <Cell ss:StyleID="s146"><Data ss:Type="String">07</Data></Cell>
    <Cell ss:StyleID="s151"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_sum2, 0), 'FM9999999999990.00')
                   || '</Data></Cell>
    <Cell ss:StyleID="s152"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_sum2, 0), 'FM9999999999990.00')
                   || '</Data></Cell>
    <Cell ss:StyleID="s155"><Data ss:Type="Number">0</Data></Cell>
    <Cell ss:StyleID="s157"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_sum3, 0), 'FM9999999999990.00')
                   || '</Data></Cell>
   </Row>'
         WHERE x_sum1 = 107;

        UPDATE tmp_univ_rpt_data
           SET x_string2 =
                      '
   <Row ss:AutoFitHeight="0" ss:Height="31.200000000000003">
    <Cell ss:StyleID="s145"><Data ss:Type="String">ƒопомога на д≥тей, над €кими встановлено оп≥ку чи п≥клуванн€  (сума значень р€дк≥в 09 + 11 + 13)</Data></Cell>
    <Cell ss:StyleID="s146"><Data ss:Type="String">08</Data></Cell>
    <Cell ss:StyleID="s148"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_sum2, 0), 'FM9999999999990.00')
                   || '</Data></Cell>
    <Cell ss:StyleID="s149"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_sum2, 0), 'FM9999999999990.00')
                   || '</Data></Cell>
    <Cell ss:StyleID="s150"><Data ss:Type="Number">0</Data></Cell>
    <Cell ss:StyleID="s148"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_sum3, 0), 'FM9999999999990.00')
                   || '</Data></Cell>
   </Row>'
         WHERE x_sum1 = 108;

        UPDATE tmp_univ_rpt_data
           SET x_string2 = '
   <Row ss:AutoFitHeight="0" ss:Height="15.45">
    <Cell ss:StyleID="s158"><Data ss:Type="String">≤з р€дка 08: </Data></Cell>
    <Cell ss:StyleID="s154"/>
    <Cell ss:StyleID="s159"/>
    <Cell ss:StyleID="s160"/>
    <Cell ss:StyleID="s161"/>
    <Cell ss:StyleID="s159"/>
   </Row>'
         WHERE x_sum1 = 108.1;

        UPDATE tmp_univ_rpt_data
           SET x_string2 =
                      '
   <Row ss:AutoFitHeight="0" ss:Height="15.45">
    <Cell ss:StyleID="s156"><Data ss:Type="String">на д≥тей в≥ком до 6 рок≥в </Data></Cell>
    <Cell ss:StyleID="s146"><Data ss:Type="String">09</Data></Cell>
    <Cell ss:StyleID="s151"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_sum2, 0), 'FM9999999999990.00')
                   || '</Data></Cell>
    <Cell ss:StyleID="s152"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_sum2, 0), 'FM9999999999990.00')
                   || '</Data></Cell>
    <Cell ss:StyleID="s155"><Data ss:Type="Number">0</Data></Cell>
    <Cell ss:StyleID="s157"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_sum3, 0), 'FM9999999999990.00')
                   || '</Data></Cell>
   </Row>'
         WHERE x_sum1 = 109;

        UPDATE tmp_univ_rpt_data
           SET x_string2 =
                      '
   <Row ss:AutoFitHeight="0" ss:Height="15.45">
    <Cell ss:StyleID="s162"><Data ss:Type="String">≥з них: на д≥тей з ≥нвал≥дн≥стю в≥ком до 6 рок≥в</Data></Cell>
    <Cell ss:StyleID="s146"><Data ss:Type="Number">10</Data></Cell>
    <Cell ss:StyleID="s151"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_sum2, 0), 'FM9999999999990.00')
                   || '</Data></Cell>
    <Cell ss:StyleID="s152"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_sum2, 0), 'FM9999999999990.00')
                   || '</Data></Cell>
    <Cell ss:StyleID="s153"><Data ss:Type="Number">0</Data></Cell>
    <Cell ss:StyleID="s151"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_sum3, 0), 'FM9999999999990.00')
                   || '</Data></Cell>
   </Row>'
         WHERE x_sum1 = 110;

        UPDATE tmp_univ_rpt_data
           SET x_string2 =
                      '
   <Row ss:AutoFitHeight="0" ss:Height="15.45">
    <Cell ss:StyleID="s156"><Data ss:Type="String">на д≥тей в≥ком в≥д 6 до 18 рок≥в</Data></Cell>
    <Cell ss:StyleID="s146"><Data ss:Type="Number">11</Data></Cell>
    <Cell ss:StyleID="s151"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_sum2, 0), 'FM9999999999990.00')
                   || '</Data></Cell>
    <Cell ss:StyleID="s152"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_sum2, 0), 'FM9999999999990.00')
                   || '</Data></Cell>
    <Cell ss:StyleID="s155"><Data ss:Type="Number">0</Data></Cell>
    <Cell ss:StyleID="s157"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_sum3, 0), 'FM9999999999990.00')
                   || '</Data></Cell>
   </Row>'
         WHERE x_sum1 = 111;

        UPDATE tmp_univ_rpt_data
           SET x_string2 =
                      '
   <Row ss:AutoFitHeight="0" ss:Height="31.200000000000003">
    <Cell ss:StyleID="s162"><Data ss:Type="String">≥з них:  на д≥тей з ≥нвал≥дн≥стю в≥ком в≥д 6 до 18 рок≥в</Data></Cell>
    <Cell ss:StyleID="s146"><Data ss:Type="Number">12</Data></Cell>
    <Cell ss:StyleID="s151"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_sum2, 0), 'FM9999999999990.00')
                   || '</Data></Cell>
    <Cell ss:StyleID="s152"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_sum2, 0), 'FM9999999999990.00')
                   || '</Data></Cell>
    <Cell ss:StyleID="s153"><Data ss:Type="Number">0</Data></Cell>
    <Cell ss:StyleID="s151"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_sum3, 0), 'FM9999999999990.00')
                   || '</Data></Cell>
   </Row>'
         WHERE x_sum1 = 112;

        UPDATE tmp_univ_rpt_data
           SET x_string2 =
                      '
   <Row ss:AutoFitHeight="0" ss:Height="46.800000000000004">
    <Cell ss:StyleID="s156"><Data ss:Type="String">на д≥тей, над €кими встановлено оп≥ку чи п≥клуванн€ ≥ €к≥ Ї вихованц€ми дит€чих заклад≥в осв≥ти, що ф≥нансуютьс€ не за рахунок бюджетних кошт≥в </Data></Cell>
    <Cell ss:StyleID="s146"><Data ss:Type="Number">13</Data></Cell>
    <Cell ss:StyleID="s151"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_sum2, 0), 'FM9999999999990.00')
                   || '</Data></Cell>
    <Cell ss:StyleID="s152"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_sum2, 0), 'FM9999999999990.00')
                   || '</Data></Cell>
    <Cell ss:StyleID="s155"><Data ss:Type="Number">0</Data></Cell>
    <Cell ss:StyleID="s157"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_sum3, 0), 'FM9999999999990.00')
                   || '</Data></Cell>
   </Row>'
         WHERE x_sum1 = 113;

        UPDATE tmp_univ_rpt_data
           SET x_string2 =
                      '
   <Row ss:AutoFitHeight="0" ss:Height="31.200000000000003">
    <Cell ss:StyleID="s145"><Data ss:Type="String">ƒопомога на д≥тей одиноким особам (сума значень р€дк≥в 15 + 16 + 17)</Data></Cell>
    <Cell ss:StyleID="s146"><Data ss:Type="Number">14</Data></Cell>
    <Cell ss:StyleID="s148"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_sum2, 0), 'FM9999999999990.00')
                   || '</Data></Cell>
    <Cell ss:StyleID="s149"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_sum2, 0), 'FM9999999999990.00')
                   || '</Data></Cell>
    <Cell ss:StyleID="s150"><Data ss:Type="Number">0</Data></Cell>
    <Cell ss:StyleID="s148"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_sum3, 0), 'FM9999999999990.00')
                   || '</Data></Cell>
   </Row>'
         WHERE x_sum1 = 114;

        UPDATE tmp_univ_rpt_data
           SET x_string2 =
                   '
   <Row ss:AutoFitHeight="0" ss:Height="15.45">
    <Cell ss:StyleID="s145"><Data ss:Type="String">у тому числ≥: </Data></Cell>
    <Cell ss:StyleID="s154"/>
    <Cell ss:StyleID="s151"/>
    <Cell ss:StyleID="s152"/>
    <Cell ss:StyleID="s155"/>
    <Cell ss:StyleID="s157"/>
   </Row>'
         WHERE x_sum1 = 114.1;

        UPDATE tmp_univ_rpt_data
           SET x_string2 =
                      '
   <Row ss:AutoFitHeight="0" ss:Height="15.45">
    <Cell ss:StyleID="s156"><Data ss:Type="String">на д≥тей в≥ком до 6 рок≥в </Data></Cell>
    <Cell ss:StyleID="s146"><Data ss:Type="Number">15</Data></Cell>
    <Cell ss:StyleID="s151"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_sum2, 0), 'FM9999999999990.00')
                   || '</Data></Cell>
    <Cell ss:StyleID="s152"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_sum2, 0), 'FM9999999999990.00')
                   || '</Data></Cell>
    <Cell ss:StyleID="s155"><Data ss:Type="Number">0</Data></Cell>
    <Cell ss:StyleID="s157"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_sum3, 0), 'FM9999999999990.00')
                   || '</Data></Cell>
   </Row>'
         WHERE x_sum1 = 115;

        UPDATE tmp_univ_rpt_data
           SET x_string2 =
                      '
   <Row ss:AutoFitHeight="0" ss:Height="15.45">
    <Cell ss:StyleID="s156"><Data ss:Type="String">на д≥тей в≥ком в≥д 6 до 18 рок≥в</Data></Cell>
    <Cell ss:StyleID="s146"><Data ss:Type="Number">16</Data></Cell>
    <Cell ss:StyleID="s151"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_sum2, 0), 'FM9999999999990.00')
                   || '</Data></Cell>
    <Cell ss:StyleID="s152"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_sum2, 0), 'FM9999999999990.00')
                   || '</Data></Cell>
    <Cell ss:StyleID="s155"><Data ss:Type="Number">0</Data></Cell>
    <Cell ss:StyleID="s157"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_sum3, 0), 'FM9999999999990.00')
                   || '</Data></Cell>
   </Row>'
         WHERE x_sum1 = 116;

        UPDATE tmp_univ_rpt_data
           SET x_string2 =
                      '
   <Row ss:AutoFitHeight="0" ss:Height="62.550000000000004">
    <Cell ss:StyleID="s156"><Data ss:Type="String">на д≥тей в≥ком в≥д 18 до 23 рок≥в, €кщо д≥ти навчаютьс€ за денною формою у закладах загальноњ середньоњ, профес≥йноњ (профес≥йно-техн≥чноњ), фаховоњ передвищоњ та вищоњ осв≥ти</Data></Cell>
    <Cell ss:StyleID="s146"><Data ss:Type="Number">17</Data></Cell>
    <Cell ss:StyleID="s151"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_sum2, 0), 'FM9999999999990.00')
                   || '</Data></Cell>
    <Cell ss:StyleID="s152"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_sum2, 0), 'FM9999999999990.00')
                   || '</Data></Cell>
    <Cell ss:StyleID="s155"><Data ss:Type="Number">0</Data></Cell>
    <Cell ss:StyleID="s157"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_sum3, 0), 'FM9999999999990.00')
                   || '</Data></Cell>
   </Row>'
         WHERE x_sum1 = 117;

        UPDATE tmp_univ_rpt_data
           SET x_string2 =
                      '
   <Row ss:AutoFitHeight="0" ss:Height="156">
    <Cell ss:StyleID="s145"><Data ss:Type="String">ƒопомога на д≥тей, хворих на т€жк≥ перинатальн≥ ураженн€ нервовоњ системи, т€жк≥ вроджен≥ вади розвитку, р≥дк≥сн≥ орфанн≥ захворюванн€, онколог≥чн≥, онкогематолог≥чн≥ захворюванн€, дит€чий церебральний парал≥ч, т€жк≥ псих≥чн≥ розлади, цукровий д≥абет I типу (≥нсул≥нозалежний), гостр≥ або хрон≥чн≥ захворюванн€ нирок IV ступен€, на дитину, €ка отримала т€жку травму, потребуЇ трансплантац≥њ органа, потребуЇ пал≥ативноњ допомоги, €ким не встановлено ≥нвал≥дн≥сть</Data></Cell>
    <Cell ss:StyleID="s146"><Data ss:Type="Number">18</Data></Cell>
    <Cell ss:StyleID="s151"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_sum2, 0), 'FM9999999999990.00')
                   || '</Data></Cell>
    <Cell ss:StyleID="s152"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_sum2, 0), 'FM9999999999990.00')
                   || '</Data></Cell>
    <Cell ss:StyleID="s153"><Data ss:Type="Number">0</Data></Cell>
    <Cell ss:StyleID="s151"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_sum3, 0), 'FM9999999999990.00')
                   || '</Data></Cell>
   </Row>'
         WHERE x_sum1 = 118;

        UPDATE tmp_univ_rpt_data
           SET x_string2 = '
   <Row ss:AutoFitHeight="0" ss:Height="15.45">
    <Cell ss:StyleID="s158"><Data ss:Type="String">≤з р€дка 01: </Data></Cell>
    <Cell ss:StyleID="s154"/>
    <Cell ss:StyleID="s151"/>
    <Cell ss:StyleID="s152"/>
    <Cell ss:StyleID="s153"/>
    <Cell ss:StyleID="s151"/>
   </Row>'
         WHERE x_sum1 = 118.1;

        UPDATE tmp_univ_rpt_data
           SET x_string2 =
                      '
   <Row ss:AutoFitHeight="0" ss:Height="31.200000000000003">
    <Cell ss:StyleID="s156"><Data ss:Type="String">€к≥ проживають на територ≥њ населеного пункту, €кому надано статус г≥рського</Data></Cell>
    <Cell ss:StyleID="s146"><Data ss:Type="Number">19</Data></Cell>
    <Cell ss:StyleID="s151"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_sum2, 0), 'FM9999999999990.00')
                   || '</Data></Cell>
    <Cell ss:StyleID="s152"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_sum2, 0), 'FM9999999999990.00')
                   || '</Data></Cell>
    <Cell ss:StyleID="s153"><Data ss:Type="Number">0</Data></Cell>
    <Cell ss:StyleID="s151"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_sum3, 0), 'FM9999999999990.00')
                   || '</Data></Cell>
   </Row>'
         WHERE x_sum1 = 119;
    END SET_CHILDREN_272;

    -- IC #96873 «в≥т з нарахуванн€ та виплати допомоги
    PROCEDURE SET_PRSD_R1 (p_start_dt   IN DATE,
                           p_nst_id     IN NUMBER := 249,
                           p_org_id     IN NUMBER,
                           p_jbr_id     IN DECIMAL)
    IS
        l_user_org   NUMBER;
    BEGIN
        IF p_org_id = 0
        THEN
            l_user_org := Tools.GetCurrOrg;
        ELSE
            l_user_org := p_org_id;
        END IF;

        l_user_org :=
            CASE WHEN l_user_org = 50001 THEN 50000 ELSE l_user_org END;

        DELETE FROM tmp_univ_rpt_data
              WHERE 1 = 1;

        INSERT INTO tmp_univ_rpt_data (x_id1,                            -- rn
                                       x_string1,                    -- prs_st
                                       x_id2,                    -- s_cnt_bank
                                       x_id3,                    -- s_cnt_post
                                       x_id4,                -- s_cnt_fml_bank
                                       x_id5,                -- s_cnt_fml_post
                                       x_sum1,                   -- s_sum_bank
                                       x_sum2,                   -- s_sum_post
                                       x_sum3,              -- s_sum_borh_bank
                                       x_sum4,              -- s_sum_borh_post
                                       x_sum5,                    -- s_sum_vrh
                                       x_sum6                -- s_sum_borh_vrh
                                             )
            WITH
                org
                AS
                    (    SELECT org_id     i_org
                           FROM ikis_sys.v_opfu
                     CONNECT BY PRIOR org_id = org_org
                     START WITH org_id = l_user_org),    -- Org_id ќргану ќѕ‘”
                dt_rep AS (SELECT TRUNC (p_start_dt,         -- «в≥тний м≥с€ць
                                                     'mm') dtb FROM DUAL),
                nst_rep
                AS
                    (SELECT c.nptc_npt npt_id, c.nptc_nst nst_id
                       FROM USS_NDI.v_Ndi_Npt_Config c
                      WHERE c.nptc_nst = p_nst_id -- nst_id послуги (ndi_dict_config where upper(ndc_code) like upper('%ndi_service_type_rpt2')
                                                 ),
                payed
                AS
                    (  SELECT prs_pc
                                  s_pc,
                              dnet$payment_reports.getCntFmlByPC (prs_pc,
                                                                  p_nst_id)
                                  s_cnt_fml,
                              SUM (
                                  CASE
                                      WHEN prsd_tp IN ('PWI', 'RDN')
                                      THEN
                                          prsd_sum
                                      ELSE
                                          -prsd_sum
                                  END)
                                  s_sum,
                              SUM (
                                  CASE
                                      WHEN prsd_tp IN ('PWI', 'RDN') THEN 0
                                      ELSE prsd_sum
                                  END)
                                  s_sum_vrh,                   -- в≥драхуванн€
                              SUM (
                                  CASE
                                      WHEN prsd_month = dt_rep.dtb
                                      THEN
                                          CASE
                                              WHEN prsd_tp IN ('PWI', 'RDN')
                                              THEN
                                                  prsd_sum
                                              ELSE
                                                  -prsd_sum
                                          END
                                      ELSE
                                          0
                                  END)
                                  s_sum_plan,
                              SUM (
                                  CASE
                                      WHEN prsd_month = dt_rep.dtb
                                      THEN
                                          CASE
                                              WHEN prsd_tp IN ('PWI', 'RDN')
                                              THEN
                                                  0
                                              ELSE
                                                  prsd_sum
                                          END
                                      ELSE
                                          0
                                  END)
                                  s_sum_plan_vrh, -- в≥драхуванн€ за поточний м≥с€ц
                              CASE
                                  WHEN prs_st IN ('NA', 'KV1', 'KV2')
                                  THEN
                                      'PAY'
                                  ELSE
                                      'BLK'
                              END
                                  prs_st,
                              CASE
                                  WHEN pr.pr_pay_tp = 'BANK' THEN pr.pr_pay_tp
                                  ELSE 'POST'
                              END
                                  pr_pay_tp
                         FROM ikis_sys.v_opfu,
                              uss_esr.pr_sheet_detail,
                              uss_esr.pr_sheet,
                              uss_esr.payroll pr,
                              uss_esr.v_personalcase,
                              org,
                              dt_rep
                        WHERE     org_to = 32
                              AND pr.com_org = org_id
                              AND org_id = i_org
                              AND prs_pc = pc_id
                              AND prs_pr = pr_id
                              AND prsd_prs = prs_id
                              AND pr_month = dt_rep.dtb
                              AND prs_st IN ('NA',
                                             'KV1',
                                             'KV2',
                                             'PK1',
                                             'PK2',
                                             'PP')                   --#100219
                              AND pr_st IN ('F')
                              AND prs_tp IN ('PB', 'PP')
                              AND prsd_npt IN (SELECT npt_id FROM nst_rep)
                     GROUP BY prs_pc,
                              CASE
                                  WHEN prs_st IN ('NA', 'KV1', 'KV2')
                                  THEN
                                      'PAY'
                                  ELSE
                                      'BLK'
                              END,
                              CASE
                                  WHEN pr.pr_pay_tp = 'BANK'
                                  THEN
                                      pr.pr_pay_tp
                                  ELSE
                                      'POST'
                              END)
              SELECT 0
                         rn,
                     prs_st,
                     COUNT (CASE WHEN pr_pay_tp = 'BANK' THEN s_pc END)
                         s_cnt_bank,
                     COUNT (CASE WHEN pr_pay_tp = 'POST' THEN s_pc END)
                         s_cnt_post,
                     SUM (
                         CASE WHEN pr_pay_tp = 'BANK' THEN s_cnt_fml ELSE 0 END)
                         s_cnt_fml_bank,
                     SUM (
                         CASE WHEN pr_pay_tp = 'POST' THEN s_cnt_fml ELSE 0 END)
                         s_cnt_fml_post,
                     SUM (
                         CASE
                             WHEN pr_pay_tp = 'BANK' THEN s_sum_plan
                             ELSE 0
                         END)
                         s_sum_bank,
                     SUM (
                         CASE
                             WHEN pr_pay_tp = 'POST' THEN s_sum_plan
                             ELSE 0
                         END)
                         s_sum_post,
                     SUM (
                         CASE
                             WHEN pr_pay_tp = 'BANK' THEN s_sum - s_sum_plan
                             ELSE 0
                         END)
                         s_sum_borh_bank,
                     SUM (
                         CASE
                             WHEN pr_pay_tp = 'POST' THEN s_sum - s_sum_plan
                             ELSE 0
                         END)
                         s_sum_borh_post,
                     SUM (s_sum_plan_vrh)
                         s_sum_vrh,
                     SUM (s_sum_vrh - s_sum_plan_vrh)
                         s_sum_borh_vrh
                FROM payed
               WHERE 1 = 1
            GROUP BY prs_st;

        INSERT INTO tmp_univ_rpt_data (x_id1)
                SELECT LEVEL     rn
                  FROM DUAL
            CONNECT BY LEVEL <= 34;

        -- Ќараховано
        FOR c IN (SELECT SUM (x_id2)      x_id2,                 -- s_cnt_bank
                         SUM (x_id3)      x_id3,                 -- s_cnt_post
                         SUM (x_id4)      x_id4,             -- s_cnt_fml_bank
                         SUM (x_id5)      x_id5,             -- s_cnt_fml_post
                         SUM (x_sum1)     x_sum1,                -- s_sum_bank
                         SUM (x_sum2)     x_sum2,                -- s_sum_post
                         SUM (x_sum3)     x_sum3,           -- s_sum_borh_bank
                         SUM (x_sum4)     x_sum4,           -- s_sum_borh_post
                         SUM (x_sum5)     x_sum5,                 -- s_sum_vrh
                         SUM (x_sum6)     x_sum6             -- s_sum_borh_vrh
                    FROM tmp_univ_rpt_data
                   WHERE x_id1 = 0)
        LOOP
            UPDATE tmp_univ_rpt_data
               SET x_sum1 = c.x_id2, x_sum2 = c.x_id3
             WHERE x_id1 = 1;

            UPDATE tmp_univ_rpt_data
               SET x_sum1 = c.x_id4, x_sum2 = c.x_id5
             WHERE x_id1 = 2;

            UPDATE tmp_univ_rpt_data
               SET x_sum3 = NVL (c.x_sum5, 0) + NVL (c.x_sum6, 0)
             WHERE x_id1 = 3;

            UPDATE tmp_univ_rpt_data
               SET x_sum1 = c.x_sum1, x_sum2 = c.x_sum2, x_sum3 = c.x_sum5
             WHERE x_id1 = 4;

            UPDATE tmp_univ_rpt_data
               SET x_sum1 = c.x_sum3, x_sum2 = c.x_sum4, x_sum3 = c.x_sum6
             WHERE x_id1 = 5;
        END LOOP;

        -- ¬идалено з виплатноњ в≥домост≥
        FOR c IN (SELECT NVL (x_id2, 0)      x_id2,              -- s_cnt_bank
                         NVL (x_id3, 0)      x_id3,              -- s_cnt_post
                         NVL (x_id4, 0)      x_id4,          -- s_cnt_fml_bank
                         NVL (x_id5, 0)      x_id5,          -- s_cnt_fml_post
                         NVL (x_sum1, 0)     x_sum1,             -- s_sum_bank
                         NVL (x_sum2, 0)     x_sum2,             -- s_sum_post
                         NVL (x_sum3, 0)     x_sum3,        -- s_sum_borh_bank
                         NVL (x_sum4, 0)     x_sum4,        -- s_sum_borh_post
                         NVL (x_sum5, 0)     x_sum5,              -- s_sum_vrh
                         NVL (x_sum6, 0)     x_sum6          -- s_sum_borh_vrh
                    FROM tmp_univ_rpt_data
                   WHERE x_id1 = 0 AND x_string1 = 'BLK')
        LOOP
            UPDATE tmp_univ_rpt_data
               SET x_sum1 = c.x_id2, x_sum2 = c.x_id3
             WHERE x_id1 = 7;

            UPDATE tmp_univ_rpt_data
               SET x_sum1 = c.x_id4, x_sum2 = c.x_id5
             WHERE x_id1 = 8;

            UPDATE tmp_univ_rpt_data
               SET x_sum3 = NVL (c.x_sum5, 0) + NVL (c.x_sum6, 0)
             WHERE x_id1 = 9;

            UPDATE tmp_univ_rpt_data
               SET x_sum1 = c.x_sum1, x_sum2 = c.x_sum2, x_sum3 = c.x_sum5
             WHERE x_id1 = 10;

            UPDATE tmp_univ_rpt_data
               SET x_sum1 = c.x_sum3, x_sum2 = c.x_sum4, x_sum3 = c.x_sum6
             WHERE x_id1 = 11;
        END LOOP;

        -- ‘актично виплачено в≥дпов≥дно до касових видатк≥в
        FOR c IN (SELECT NVL (x_id2, 0)      x_id2,              -- s_cnt_bank
                         NVL (x_id3, 0)      x_id3,              -- s_cnt_post
                         NVL (x_id4, 0)      x_id4,          -- s_cnt_fml_bank
                         NVL (x_id5, 0)      x_id5,          -- s_cnt_fml_post
                         NVL (x_sum1, 0)     x_sum1,             -- s_sum_bank
                         NVL (x_sum2, 0)     x_sum2,             -- s_sum_post
                         NVL (x_sum3, 0)     x_sum3,        -- s_sum_borh_bank
                         NVL (x_sum4, 0)     x_sum4,        -- s_sum_borh_post
                         NVL (x_sum5, 0)     x_sum5,              -- s_sum_vrh
                         NVL (x_sum6, 0)     x_sum6          -- s_sum_borh_vrh
                    FROM tmp_univ_rpt_data
                   WHERE x_id1 = 0 AND x_string1 = 'PAY')
        LOOP
            UPDATE tmp_univ_rpt_data
               SET x_sum1 = c.x_id2, x_sum2 = c.x_id3
             WHERE x_id1 = 30;

            UPDATE tmp_univ_rpt_data
               SET x_sum1 = c.x_id4, x_sum2 = c.x_id5
             WHERE x_id1 = 31;

            UPDATE tmp_univ_rpt_data
               SET x_sum1 = c.x_sum1 + c.x_sum3,
                   x_sum2 = c.x_sum2 + c.x_sum4,
                   x_sum3 = c.x_sum5 + c.x_sum6
             WHERE x_id1 IN (32, 33);
        END LOOP;

        UPDATE tmp_univ_rpt_data
           SET x_string2 =
                      '<Row ss:AutoFitHeight="0">
    <Cell ss:MergeDown="5" ss:StyleID="m2666370773060"><Data ss:Type="String">Ќараховано</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s94"><Data ss:Type="String"> ≥льк≥сть отримувач≥в (особових рахунк≥в)</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s95"><Data ss:Type="Number">1</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s96"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_sum1, 0))
                   || '</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s97"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_sum2, 0))
                   || '</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s98"><Data ss:Type="String">’</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s99"><Data ss:Type="String">’</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s100" ss:Formula="=RC[-4]+RC[-3]"><Data ss:Type="Number">0</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s100"><Data ss:Type="Number"></Data><NamedCell
      ss:Name="Print_Area"/></Cell>
   </Row>'
         WHERE x_id1 = 1;

        UPDATE tmp_univ_rpt_data
           SET x_string2 =
                      '<Row ss:AutoFitHeight="0" ss:Height="14.55">
    <Cell ss:Index="2" ss:StyleID="s101"><Data ss:Type="String">у т. ч. к≥льк≥сть член≥в родини</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s102"><Data ss:Type="Number">2</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s103"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_sum1, 0))
                   || '</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s104"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_sum2, 0))
                   || '</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s105"><Data ss:Type="String">’</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s106"><Data ss:Type="String">’</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s107" ss:Formula="=RC[-4]+RC[-3]"><Data ss:Type="Number">0</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s107"><Data ss:Type="Number"></Data><NamedCell
      ss:Name="Print_Area"/></Cell>
   </Row>'
         WHERE x_id1 = 2;

        UPDATE tmp_univ_rpt_data
           SET x_string2 =
                      '<Row ss:AutoFitHeight="0" ss:Height="27.45">
    <Cell ss:Index="2" ss:StyleID="s108"><Data ss:Type="String">загальна сума допомоги включена у в≥дом≥сть (р€док 4+5+6)</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s109"><Data ss:Type="Number">3</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s110" ss:Formula="=R[1]C+R[2]C+R[3]C"><Data ss:Type="Number">0</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s110" ss:Formula="=R[1]C+R[2]C+R[3]C"><Data ss:Type="Number">0</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s111"><Data ss:Type="String">’</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s112"><Data ss:Type="String">’</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s113" ss:Formula="=RC[-4]+RC[-3]"><Data ss:Type="Number">0</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s113"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_sum3, 0), 'FM9999999999990.00')
                   || '</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
   </Row>'
         WHERE x_id1 = 3;

        UPDATE tmp_univ_rpt_data
           SET x_string2 =
                      '<Row ss:AutoFitHeight="0" ss:Height="14.55">
    <Cell ss:Index="2" ss:StyleID="s114"><Data ss:Type="String">за поточний м≥с€ць</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s115"><Data ss:Type="Number">4</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s116"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_sum1, 0), 'FM9999999999990.00')
                   || '</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s117"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_sum2, 0), 'FM9999999999990.00')
                   || '</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s118"><Data ss:Type="String">’</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s119"><Data ss:Type="String">’</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s120" ss:Formula="=RC[-4]+RC[-3]"><Data ss:Type="Number">0</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s120"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_sum3, 0), 'FM9999999999990.00')
                   || '</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
   </Row>'
         WHERE x_id1 = 4;

        UPDATE tmp_univ_rpt_data
           SET x_string2 =
                      '<Row ss:AutoFitHeight="0" ss:Height="14.55">
    <Cell ss:Index="2" ss:StyleID="s114"><Data ss:Type="String">борги за минулий пер≥од</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s115"><Data ss:Type="Number">5</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s116"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_sum1, 0), 'FM9999999999990.00')
                   || '</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s117"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_sum2, 0), 'FM9999999999990.00')
                   || '</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s118"><Data ss:Type="String">’</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s119"><Data ss:Type="String">’</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s120" ss:Formula="=RC[-4]+RC[-3]"><Data ss:Type="Number">0</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s120"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_sum3, 0), 'FM9999999999990.00')
                   || '</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
   </Row>'
         WHERE x_id1 = 5;

        UPDATE tmp_univ_rpt_data
           SET x_string2 =
                   '<Row ss:AutoFitHeight="0" ss:Height="15">
    <Cell ss:Index="2" ss:StyleID="s121"><Data ss:Type="String">невиплата  за минулий пер≥од</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s122"><Data ss:Type="Number">6</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s123"><Data ss:Type="Number">0</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s124"><Data ss:Type="Number">0</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s125"><Data ss:Type="String">’</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s126"><Data ss:Type="String">’</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s127" ss:Formula="=RC[-4]+RC[-3]"><Data ss:Type="Number">0</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s127"><Data ss:Type="Number"></Data><NamedCell
      ss:Name="Print_Area"/></Cell>
   </Row>'
         WHERE x_id1 = 6;

        UPDATE tmp_univ_rpt_data
           SET x_string2 =
                      '<Row ss:AutoFitHeight="0" ss:Height="14.55">
    <Cell ss:MergeDown="5" ss:StyleID="m2666370768384"><Data ss:Type="String">¬идалено з виплатноњ в≥домост≥</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s94"><Data ss:Type="String"> ≥льк≥сть отримувач≥в (особових рахунк≥в)</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s95"><Data ss:Type="Number">7</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s96"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_sum1, 0))
                   || '</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s97"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_sum2, 0))
                   || '</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s118"><Data ss:Type="String">’</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s119"><Data ss:Type="String">’</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s100" ss:Formula="=RC[-4]+RC[-3]"><Data ss:Type="Number">0</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s100"><Data ss:Type="Number"></Data><NamedCell
      ss:Name="Print_Area"/></Cell>
   </Row>'
         WHERE x_id1 = 7;

        UPDATE tmp_univ_rpt_data
           SET x_string2 =
                      '<Row ss:AutoFitHeight="0" ss:Height="14.55">
    <Cell ss:Index="2" ss:StyleID="s101"><Data ss:Type="String">у т. ч. к≥льк≥сть член≥в родини</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s102"><Data ss:Type="Number">8</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s103"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_sum1, 0))
                   || '</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s104"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_sum2, 0))
                   || '</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s105"><Data ss:Type="String">’</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s106"><Data ss:Type="String">’</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s107" ss:Formula="=RC[-4]+RC[-3]"><Data ss:Type="Number">0</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s107"><Data ss:Type="Number"></Data><NamedCell
      ss:Name="Print_Area"/></Cell>
   </Row>'
         WHERE x_id1 = 8;

        UPDATE tmp_univ_rpt_data
           SET x_string2 =
                      '<Row ss:AutoFitHeight="0" ss:Height="14.55">
    <Cell ss:Index="2" ss:StyleID="s108"><Data ss:Type="String">загальна сума допомоги (р€док 10+11+12)</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s109"><Data ss:Type="Number">9</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s110" ss:Formula="=R[1]C+R[2]C+R[3]C"><Data ss:Type="Number">0</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s110" ss:Formula="=R[1]C+R[2]C+R[3]C"><Data ss:Type="Number">0</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s111"><Data ss:Type="String">’</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s112"><Data ss:Type="String">’</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s113" ss:Formula="=RC[-4]+RC[-3]"><Data ss:Type="Number">0</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s113"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_sum3, 0), 'FM9999999999990.00')
                   || '</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
   </Row>'
         WHERE x_id1 = 9;

        UPDATE tmp_univ_rpt_data
           SET x_string2 =
                      '<Row ss:AutoFitHeight="0" ss:Height="14.55">
    <Cell ss:Index="2" ss:StyleID="s114"><Data ss:Type="String">за поточний м≥с€ць</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s115"><Data ss:Type="Number">10</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s116"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_sum1, 0), 'FM9999999999990.00')
                   || '</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s117"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_sum2, 0), 'FM9999999999990.00')
                   || '</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s118"><Data ss:Type="String">’</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s119"><Data ss:Type="String">’</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s120" ss:Formula="=RC[-4]+RC[-3]"><Data ss:Type="Number">0</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s120"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_sum3, 0), 'FM9999999999990.00')
                   || '</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
   </Row>'
         WHERE x_id1 = 10;

        UPDATE tmp_univ_rpt_data
           SET x_string2 =
                      '<Row ss:AutoFitHeight="0" ss:Height="14.55">
    <Cell ss:Index="2" ss:StyleID="s114"><Data ss:Type="String">борги за минулий пер≥од</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s115"><Data ss:Type="Number">11</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s116"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_sum1, 0), 'FM9999999999990.00')
                   || '</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s117"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_sum2, 0), 'FM9999999999990.00')
                   || '</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s118"><Data ss:Type="String">’</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s119"><Data ss:Type="String">’</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s120" ss:Formula="=RC[-4]+RC[-3]"><Data ss:Type="Number">0</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s120"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_sum3, 0), 'FM9999999999990.00')
                   || '</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
   </Row>'
         WHERE x_id1 = 11;

        UPDATE tmp_univ_rpt_data
           SET x_string2 =
                   '<Row ss:AutoFitHeight="0" ss:Height="15">
    <Cell ss:Index="2" ss:StyleID="s121"><Data ss:Type="String">невиплата за минулий пер≥од</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s122"><Data ss:Type="Number">12</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s123"><Data ss:Type="Number">0</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s124"><Data ss:Type="Number">0</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s125"><Data ss:Type="String">’</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s126"><Data ss:Type="String">’</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s127" ss:Formula="=RC[-4]+RC[-3]"><Data ss:Type="Number">0</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s127"><Data ss:Type="Number"></Data><NamedCell
      ss:Name="Print_Area"/></Cell>
   </Row>'
         WHERE x_id1 = 12;

        UPDATE tmp_univ_rpt_data
           SET x_string2 =
                   '<Row ss:AutoFitHeight="0">
    <Cell ss:MergeDown="2" ss:StyleID="m2666370768404"><Data ss:Type="String">ѕотреба у видатках, грн</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s94"><Data ss:Type="String">загальна сума потреби (р€док 14+15)</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s95"><Data ss:Type="Number">13</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s128" ss:Formula="=R[1]C"><Data ss:Type="Number">0</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s129" ss:Formula="=R[1]C+R[2]C"><Data ss:Type="Number">0</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s129" ss:Formula="=R[1]C+R[2]C"><Data ss:Type="Number">0</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s130" ss:Formula="=R[1]C+R[2]C"><Data ss:Type="Number">0</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s131" ss:Formula="=SUM(RC[-4]:RC[-1])"><Data ss:Type="Number">0</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s131"><Data ss:Type="Number"></Data><NamedCell
      ss:Name="Print_Area"/></Cell>
   </Row>'
         WHERE x_id1 = 13;

        UPDATE tmp_univ_rpt_data
           SET x_string2 =
                   '<Row ss:AutoFitHeight="0" ss:Height="14.55">
    <Cell ss:Index="2" ss:StyleID="s114"><Data ss:Type="String">сума допомоги</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s115"><Data ss:Type="Number">14</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s116"><Data ss:Type="Number">0</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s117"><Data ss:Type="Number">0</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s117"><Data ss:Type="Number">0</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s132"><Data ss:Type="Number">0</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s120" ss:Formula="=SUM(RC[-4]:RC[-1])"><Data ss:Type="Number">0</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s120"><Data ss:Type="Number"></Data><NamedCell
      ss:Name="Print_Area"/></Cell>
   </Row>'
         WHERE x_id1 = 14;

        UPDATE tmp_univ_rpt_data
           SET x_string2 =
                   '<Row ss:AutoFitHeight="0" ss:Height="15">
    <Cell ss:Index="2" ss:StyleID="s121"><Data ss:Type="String">сума поштового збору</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s122"><Data ss:Type="Number">15</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s133"><Data ss:Type="String">’</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s124"><Data ss:Type="Number">0</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s124"><Data ss:Type="Number">0</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s134"><Data ss:Type="Number">0</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s127" ss:Formula="=SUM(RC[-3]:RC[-1])"><Data ss:Type="Number">0</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s127"><Data ss:Type="Number"></Data><NamedCell
      ss:Name="Print_Area"/></Cell>
   </Row>'
         WHERE x_id1 = 15;

        UPDATE tmp_univ_rpt_data
           SET x_string2 =
                   '<Row ss:AutoFitHeight="0" ss:Height="14.55">
    <Cell ss:MergeDown="2" ss:StyleID="m2666370768424"><Data ss:Type="String">«алишок кошт≥в за попередн≥й пер≥од, грн</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s94"><Data ss:Type="String">загальна сума (р€док 17+18)</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s95"><Data ss:Type="Number">16</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s128" ss:Formula="=R[1]C"><Data ss:Type="Number">0</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s129" ss:Formula="=R[1]C+R[2]C"><Data ss:Type="Number">0</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s129" ss:Formula="=R[1]C+R[2]C"><Data ss:Type="Number">0</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s130" ss:Formula="=R[1]C+R[2]C"><Data ss:Type="Number">0</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s131" ss:Formula="=SUM(RC[-4]:RC[-1])"><Data ss:Type="Number">0</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s131"><Data ss:Type="Number"></Data><NamedCell
      ss:Name="Print_Area"/></Cell>
   </Row>'
         WHERE x_id1 = 16;

        UPDATE tmp_univ_rpt_data
           SET x_string2 =
                   '<Row ss:AutoFitHeight="0" ss:Height="14.55">
    <Cell ss:Index="2" ss:StyleID="s114"><Data ss:Type="String">сума допомоги</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s115"><Data ss:Type="Number">17</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s116"><Data ss:Type="Number">0</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s117"><Data ss:Type="Number">0</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s117"><Data ss:Type="Number">0</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s132"><Data ss:Type="Number">0</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s120" ss:Formula="=SUM(RC[-4]:RC[-1])"><Data ss:Type="Number">0</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s120"><Data ss:Type="Number"></Data><NamedCell
      ss:Name="Print_Area"/></Cell>
   </Row>'
         WHERE x_id1 = 17;

        UPDATE tmp_univ_rpt_data
           SET x_string2 =
                   '<Row ss:AutoFitHeight="0" ss:Height="15">
    <Cell ss:Index="2" ss:StyleID="s121"><Data ss:Type="String">сума поштового збору</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s122"><Data ss:Type="Number">18</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s133"><Data ss:Type="String">’</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s124"><Data ss:Type="Number">0</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s124"><Data ss:Type="Number">0</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s134"><Data ss:Type="Number">0</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s127" ss:Formula="=SUM(RC[-3]:RC[-1])"><Data ss:Type="Number">0</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s127"><Data ss:Type="Number"></Data><NamedCell
      ss:Name="Print_Area"/></Cell>
   </Row>'
         WHERE x_id1 = 18;

        UPDATE tmp_univ_rpt_data
           SET x_string2 =
                   '<Row ss:AutoFitHeight="0" ss:Height="14.55">
    <Cell ss:MergeDown="2" ss:StyleID="m2666370768444"><Data ss:Type="String">«а€вка  на ф≥нансуванн€  з урахуванн€м залишку, грн</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s94"><Data ss:Type="String">загальна сума потреби (р€док 13 -16)</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s95"><Data ss:Type="Number">19</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s128" ss:Formula="=R[1]C"><Data ss:Type="Number">0</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s129" ss:Formula="=R[-6]C-R[-3]C"><Data ss:Type="Number">0</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s129" ss:Formula="=R[-6]C-R[-3]C"><Data ss:Type="Number">0</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s130" ss:Formula="=R[-6]C-R[-3]C"><Data ss:Type="Number">0</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s131" ss:Formula="=SUM(RC[-4]:RC[-1])"><Data ss:Type="Number">0</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s131"><Data ss:Type="Number"></Data><NamedCell
      ss:Name="Print_Area"/></Cell>
   </Row>'
         WHERE x_id1 = 19;

        UPDATE tmp_univ_rpt_data
           SET x_string2 =
                   '<Row ss:AutoFitHeight="0" ss:Height="14.55">
    <Cell ss:Index="2" ss:StyleID="s114"><Data ss:Type="String">сума допомоги (р€док 14 -17)</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s115"><Data ss:Type="Number">20</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s116" ss:Formula="=R[-6]C-R[-3]C"><Data ss:Type="Number">0</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s117" ss:Formula="=R[-6]C-R[-3]C"><Data ss:Type="Number">0</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s117" ss:Formula="=R[-6]C-R[-3]C"><Data ss:Type="Number">0</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s132" ss:Formula="=R[-6]C-R[-3]C"><Data ss:Type="Number">0</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s120" ss:Formula="=SUM(RC[-4]:RC[-1])"><Data ss:Type="Number">0</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s120"><Data ss:Type="Number"></Data><NamedCell
      ss:Name="Print_Area"/></Cell>
   </Row>'
         WHERE x_id1 = 20;

        UPDATE tmp_univ_rpt_data
           SET x_string2 =
                   '<Row ss:AutoFitHeight="0" ss:Height="15">
    <Cell ss:Index="2" ss:StyleID="s121"><Data ss:Type="String">сума поштового збору  (р€док 15 -18)</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s122"><Data ss:Type="Number">21</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s133"><Data ss:Type="String">’</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s124" ss:Formula="=R[-6]C-R[-3]C"><Data ss:Type="Number">0</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s124" ss:Formula="=R[-6]C-R[-3]C"><Data ss:Type="Number">0</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s134" ss:Formula="=R[-6]C-R[-3]C"><Data ss:Type="Number">0</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s127" ss:Formula="=SUM(RC[-3]:RC[-1])"><Data ss:Type="Number">0</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s127"><Data ss:Type="Number"></Data><NamedCell
      ss:Name="Print_Area"/></Cell>
   </Row>'
         WHERE x_id1 = 21;

        UPDATE tmp_univ_rpt_data
           SET x_string2 =
                   '<Row ss:AutoFitHeight="0">
    <Cell ss:MergeDown="2" ss:StyleID="m2666370768464"><Data ss:Type="String">ѕроф≥нансовано, грн</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s94"><Data ss:Type="String">загальна сума (р€док 23+24)</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s95"><Data ss:Type="Number">22</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s128" ss:Formula="=R[1]C"><Data ss:Type="Number">0</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s129" ss:Formula="=R[1]C+R[2]C"><Data ss:Type="Number">0</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s129" ss:Formula="=R[1]C+R[2]C"><Data ss:Type="Number">0</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s130" ss:Formula="=R[1]C+R[2]C"><Data ss:Type="Number">0</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s131" ss:Formula="=SUM(RC[-4]:RC[-1])"><Data ss:Type="Number">0</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s131"><Data ss:Type="Number"></Data><NamedCell
      ss:Name="Print_Area"/></Cell>
   </Row>'
         WHERE x_id1 = 22;

        UPDATE tmp_univ_rpt_data
           SET x_string2 =
                   '<Row ss:AutoFitHeight="0" ss:Height="14.55">
    <Cell ss:Index="2" ss:StyleID="s114"><Data ss:Type="String">сума допомоги</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s115"><Data ss:Type="Number">23</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s116"><Data ss:Type="Number">0</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s117"><Data ss:Type="Number">0</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s117"><Data ss:Type="Number">0</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s132"><Data ss:Type="Number">0</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s120" ss:Formula="=SUM(RC[-4]:RC[-1])"><Data ss:Type="Number">0</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s120"><Data ss:Type="Number"></Data><NamedCell
      ss:Name="Print_Area"/></Cell>
   </Row>'
         WHERE x_id1 = 23;

        UPDATE tmp_univ_rpt_data
           SET x_string2 =
                   '<Row ss:AutoFitHeight="0" ss:Height="15">
    <Cell ss:Index="2" ss:StyleID="s135"><Data ss:Type="String">у т. ч. сума поштового збору</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s122"><Data ss:Type="Number">24</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s133"><Data ss:Type="String">’</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s124"><Data ss:Type="Number">0</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s124"><Data ss:Type="Number">0</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s134"><Data ss:Type="Number">0</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s127" ss:Formula="=SUM(RC[-4]:RC[-1])"><Data ss:Type="Number">0</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s127"><Data ss:Type="Number"></Data><NamedCell
      ss:Name="Print_Area"/></Cell>
   </Row>'
         WHERE x_id1 = 24;

        UPDATE tmp_univ_rpt_data
           SET x_string2 =
                   '<Row ss:AutoFitHeight="0" ss:Height="14.55">
    <Cell ss:MergeDown="2" ss:StyleID="m2666370768484"><Data ss:Type="String">ѕерераховано у виплатну установу (банк, пошта, ≥нш.) </Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s94"><Data ss:Type="String">загальна сума</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s95"><Data ss:Type="Number">25</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s128" ss:Formula="=R[1]C"><Data ss:Type="Number">0</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s129" ss:Formula="=R[1]C+R[2]C"><Data ss:Type="Number">0</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s129" ss:Formula="=R[1]C+R[2]C"><Data ss:Type="Number">0</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s130" ss:Formula="=R[1]C+R[2]C"><Data ss:Type="Number">0</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s131" ss:Formula="=SUM(RC[-4]:RC[-1])"><Data ss:Type="Number">0</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s131"><Data ss:Type="Number"></Data><NamedCell
      ss:Name="Print_Area"/></Cell>
   </Row>'
         WHERE x_id1 = 25;

        UPDATE tmp_univ_rpt_data
           SET x_string2 =
                   '<Row ss:AutoFitHeight="0" ss:Height="14.55">
    <Cell ss:Index="2" ss:StyleID="s114"><Data ss:Type="String">сума допомоги</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s115"><Data ss:Type="Number">26</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s116"><Data ss:Type="Number">0</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s117"><Data ss:Type="Number">0</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s117"><Data ss:Type="Number">0</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s132"><Data ss:Type="Number">0</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s120" ss:Formula="=SUM(RC[-4]:RC[-1])"><Data ss:Type="Number">0</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s120"><Data ss:Type="Number"></Data><NamedCell
      ss:Name="Print_Area"/></Cell>
   </Row>'
         WHERE x_id1 = 26;

        UPDATE tmp_univ_rpt_data
           SET x_string2 =
                   '<Row ss:AutoFitHeight="0" ss:Height="15">
    <Cell ss:Index="2" ss:StyleID="s121"><Data ss:Type="String">сума поштового збору</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s122"><Data ss:Type="Number">27</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s133"><Data ss:Type="String">’</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s124"><Data ss:Type="Number">0</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s124"><Data ss:Type="Number">0</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s134"><Data ss:Type="Number">0</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s127" ss:Formula="=SUM(RC[-3]:RC[-1])"><Data ss:Type="Number">0</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s127"><Data ss:Type="Number"></Data><NamedCell
      ss:Name="Print_Area"/></Cell>
   </Row>'
         WHERE x_id1 = 27;

        UPDATE tmp_univ_rpt_data
           SET x_string2 =
                   '<Row ss:AutoFitHeight="0" ss:Height="27" ss:StyleID="s136">
    <Cell ss:MergeDown="1" ss:StyleID="m2666370778784"><Data ss:Type="String">¬ключено у реЇстр виплат в≥дпов≥дно постанови  ћ”  є151 в≥д 18.02.2016</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s94"><Data ss:Type="String">к≥льк≥сть отримувач≥в (особових рахунк≥в)</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s95"><Data ss:Type="Number">28</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s97"><Data ss:Type="Number">0</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s97"><Data ss:Type="Number">0</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s137"><Data ss:Type="String">’</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s138"><Data ss:Type="String">’</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s100" ss:Formula="=RC[-4]+RC[-3]"><Data ss:Type="Number">0</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s100"><Data ss:Type="Number"></Data><NamedCell
      ss:Name="Print_Area"/></Cell>
   </Row>'
         WHERE x_id1 = 28;

        UPDATE tmp_univ_rpt_data
           SET x_string2 =
                   '<Row ss:AutoFitHeight="0" ss:Height="14.55" ss:StyleID="s136">
    <Cell ss:Index="2" ss:StyleID="s121"><Data ss:Type="String">сума допомоги, грн</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s122"><Data ss:Type="Number">29</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s123"><Data ss:Type="Number">0</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s124"><Data ss:Type="Number">0</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s125"><Data ss:Type="Number">0</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s126"><Data ss:Type="Number">0</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s127" ss:Formula="=SUM(RC[-4]:RC[-1])"><Data ss:Type="Number">0</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s127"><Data ss:Type="Number"></Data><NamedCell
      ss:Name="Print_Area"/></Cell>
   </Row>'
         WHERE x_id1 = 29;

        UPDATE tmp_univ_rpt_data
           SET x_string2 =
                      '<Row ss:AutoFitHeight="0" ss:Height="14.55">
    <Cell ss:MergeDown="4" ss:StyleID="m2666370778804"><Data ss:Type="String">‘актично виплачено в≥дпов≥дно до касових видатк≥в</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s139"><Data ss:Type="String">к≥льк≥сть отримувач≥в</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s95"><Data ss:Type="Number">30</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s97"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_sum1, 0))
                   || '</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s97"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_sum2, 0))
                   || '</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s97"><Data ss:Type="Number">0</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s140"><Data ss:Type="Number">0</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s141" ss:Formula="=SUM(RC[-4]:RC[-1])"><Data ss:Type="Number">0</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s141"><Data ss:Type="Number"></Data><NamedCell
      ss:Name="Print_Area"/></Cell>
   </Row>'
         WHERE x_id1 = 30;

        UPDATE tmp_univ_rpt_data
           SET x_string2 =
                      '<Row ss:AutoFitHeight="0" ss:Height="14.55">
    <Cell ss:Index="2" ss:StyleID="s101"><Data ss:Type="String">у т. ч. к≥льк≥сть член≥в родини</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s102"><Data ss:Type="Number">31</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s104"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_sum1, 0))
                   || '</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s104"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_sum2, 0))
                   || '</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s104"><Data ss:Type="Number">0</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s142"><Data ss:Type="Number">0</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s143" ss:Formula="=SUM(RC[-4]:RC[-1])"><Data ss:Type="Number">0</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s143"><Data ss:Type="Number"></Data><NamedCell
      ss:Name="Print_Area"/></Cell>
   </Row>'
         WHERE x_id1 = 31;

        UPDATE tmp_univ_rpt_data
           SET x_string2 =
                      '<Row ss:AutoFitHeight="0" ss:Height="14.55">
    <Cell ss:Index="2" ss:StyleID="s144"><Data ss:Type="String">загальна сума, грн</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s109"><Data ss:Type="Number">32</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s146"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_sum1, 0), 'FM9999999999990.00')
                   || '</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s147"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_sum2, 0), 'FM9999999999990.00')
                   || '</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s148" ss:Formula="=R[1]C+R[2]C"><Data ss:Type="Number">0</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s149" ss:Formula="=R[1]C+R[2]C"><Data ss:Type="Number">0</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s150" ss:Formula="=SUM(RC[-4]:RC[-1])"><Data ss:Type="Number">0</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s150"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_sum3, 0), 'FM9999999999990.00')
                   || '</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
   </Row>'
         WHERE x_id1 = 32;

        UPDATE tmp_univ_rpt_data
           SET x_string2 =
                      '<Row ss:AutoFitHeight="0" ss:Height="14.55">
    <Cell ss:Index="2" ss:StyleID="s108"><Data ss:Type="String">сума допомоги, грн</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s109"><Data ss:Type="Number">33</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s110"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_sum1, 0), 'FM9999999999990.00')
                   || '</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s148"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_sum2, 0), 'FM9999999999990.00')
                   || '</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s117"><Data ss:Type="Number">0</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s132"><Data ss:Type="Number">0</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s113" ss:Formula="=SUM(RC[-4]:RC[-1])"><Data ss:Type="Number">0</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s113"><Data ss:Type="Number">'
                   || TO_CHAR (NVL (x_sum3, 0), 'FM9999999999990.00')
                   || '</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
   </Row>'
         WHERE x_id1 = 33;

        UPDATE tmp_univ_rpt_data
           SET x_string2 =
                   '<Row ss:AutoFitHeight="0" ss:Height="15">
    <Cell ss:Index="2" ss:StyleID="s121"><Data ss:Type="String">сума поштового збору, грн</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s122"><Data ss:Type="Number">34</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s133"><Data ss:Type="String">’</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s124"><Data ss:Type="Number">0</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s124"><Data ss:Type="Number">0</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s134"><Data ss:Type="Number">0</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s127" ss:Formula="=SUM(RC[-3]:RC[-1])"><Data ss:Type="Number">0</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s127"><Data ss:Type="Number"></Data><NamedCell
      ss:Name="Print_Area"/></Cell>
   </Row>'
         WHERE x_id1 = 34;
    END SET_PRSD_R1;

    -- IC #108718 «в≥т по в≥домост€м (€к ми рахуЇмо дан≥ по ¬ѕќ) - лист 3859/0/290-24/51 в≥д 03.09.24
    PROCEDURE SET_PRSD_R2 (p_start_dt   IN DATE,
                           p_stop_dt    IN DATE,
                           p_nst_id     IN NUMBER,
                           p_org_id     IN NUMBER,
                           p_jbr_id     IN DECIMAL)
    IS
        l_user_org   NUMBER;
        l_org_to     NUMBER := tools.GetCurrOrgTo;
    BEGIN
        IF p_org_id = 0
        THEN
            l_user_org := Tools.GetCurrOrg;
        ELSE
            l_user_org := p_org_id;
        END IF;

        l_user_org :=
            CASE WHEN l_user_org = 50001 THEN 50000 ELSE l_user_org END;

        IF l_org_to = 34
        THEN
            SELECT org_to
              INTO l_org_to
              FROM ikis_sys.v_opfu
             WHERE org_id = l_user_org;
        END IF;

        l_org_to := CASE WHEN l_org_to = 34 THEN 34 ELSE 32 END;

        DELETE FROM tmp_univ_rpt_data
              WHERE 1 = 1;

        INSERT INTO tmp_univ_rpt_data (x_dt1,                      -- nm_month
                                       x_string1,                   -- nm_name
                                       x_string2,                  -- reg_name
                                       x_id1,                       -- cnt_nrh
                                       x_sum1,                      -- sum_nrh
                                       x_id2,                      -- cnt_vpl,
                                       x_sum2                       -- sum_vpl
                                             )
            WITH
                org
                AS
                    (    SELECT org_id     i_org
                           FROM ikis_sys.v_opfu
                          WHERE l_org_to = 32
                     CONNECT BY PRIOR org_id = org_org
                     START WITH org_id = l_user_org
                     UNION ALL
                     SELECT org_id     i_org
                       FROM ikis_sys.v_opfu
                      WHERE l_org_to = 34 AND org_acc_org = l_user_org),
                dat
                AS
                    (SELECT m.nm_month,
                            m.nm_start_dt,
                            m.nm_stop_dt,
                            INITCAP (
                                   uss_esr.dnet$payment_reports.getMonthName (
                                       TO_NUMBER (TO_CHAR (m.nm_month, 'mm')))
                                || ' '
                                || TO_CHAR (m.nm_month, 'yyyy'))    nm_name
                       FROM uss_ndi.v_ndi_months m
                      --WHERE m.nm_month BETWEEN TRUNC(p_start_dt,'mm') AND TRUNC(p_stop_dt,'mm')
                      WHERE m.nm_month = TRUNC (p_start_dt, 'mm'))
              SELECT dat.nm_month,
                     dat.nm_name,
                     uss_esr.TOOLS.GetOrgRegName (o.org_id)    reg_name,
                     COUNT (*)                                 cnt_nrh,
                     SUM (s.prs_sum)                           sum_nrh,
                     SUM (
                         CASE
                             WHEN s.prs_st IN ('KV1', 'KV2', 'NA') THEN 1
                             ELSE 0
                         END)                                  cnt_vpl,
                     SUM (
                         CASE
                             WHEN s.prs_st IN ('KV1', 'KV2', 'NA')
                             THEN
                                 s.prs_sum
                             ELSE
                                 0
                         END)                                  sum_vpl
                FROM org
                     INNER JOIN uss_esr.opfu o ON o.org_id = org.i_org
                     INNER JOIN uss_esr.payroll p ON p.com_org = o.org_id
                     INNER JOIN uss_esr.pr_sheet s ON s.prs_pr = p.pr_id
                     INNER JOIN uss_esr.pc_account a ON a.pa_id = s.prs_pa
                     --INNER JOIN uss_esr.pr_sheet_detail sd   ON sd.prsd_prs = s.prs_id
                     --INNER JOIN uss_esr.personalcase c       ON c.pc_id = s.prs_pc
                     INNER JOIN dat ON dat.nm_month = p.pr_month
               WHERE     org_to = 32
                     AND s.prs_sum != 0 -- виключаЇмо т≥льки суми = 0 при розрахунку к≥лькост≥
                     AND prs_st != 'PP' -- з≥ вс≥ма статусами, кр≥м PP (ручне блокуванн€)
                     AND pr_st IN ('F')
                     AND prs_tp IN ('PB', 'PP')
                     --AND prsd_tp IN ('PWI', 'RDN')   -- т≥льки нарахуванн€
                     AND a.pa_nst = p_nst_id
            GROUP BY dat.nm_month,
                     dat.nm_name,
                     uss_esr.TOOLS.GetOrgRegName (o.org_id)
            ORDER BY 1, 3;
    END SET_PRSD_R2;

    -- IC #91166 «в≥т про наданн€ державноњ соц≥альноњ допомоги ≥нвал≥дам з дитинства та д≥т€м-≥нвал≥дам
    PROCEDURE SET_DSDI_R1 (p_start_dt   IN DATE,
                           p_org_id     IN NUMBER,
                           p_jbr_id     IN DECIMAL)
    IS
        l_user_org                NUMBER;
        l_raj                     NUMBER := 0;

        l_sum                     NUMBER;
        l_prc                     NUMBER;
        l_tmp                     tmp_univ_rpt_data%ROWTYPE;

        l_start_dt_mm    CONSTANT DATE := TRUNC (p_start_dt, 'mm');
        l_start_dt_yy    CONSTANT DATE := TRUNC (p_start_dt, 'yy');
        l_start_dt_6y    CONSTANT DATE := ADD_MONTHS (p_start_dt, -72);
        l_start_dt_18y   CONSTANT DATE := ADD_MONTHS (p_start_dt, -216);
    BEGIN
        IF p_org_id = 0
        THEN
            l_user_org := Tools.GetCurrOrg;
        ELSE
            l_user_org := p_org_id;
        END IF;

        IF Tools.GetCurrOrg NOT IN (50000, 50001)
        THEN
            l_raj := 1;
        END IF;

        DELETE FROM tmp_univ_rpt_data
              WHERE 1 = 1;

        INSERT INTO tmp_univ_rpt_data (x_string1,         -- CB  атегор≥€ ос≥б
                                       x_id1,                    -- CA є р€дка
                                       --  ≥льк≥сть отримувач≥в державноњ соц≥альноњ допомоги, ос≥б
                                       x_id2,                -- CNT_ALL усього
                                       x_id3, -- CNT_DUTR з них: на повному державному утриманн≥
                                       x_id4, -- CNT_Y к≥льк≥сть отримувач≥в, €ким призначено допомогу з початку поточного року (наростаючим п≥дсумком)
                                       x_id5, -- CNT_M к≥льк≥сть отримувач≥в, €ким призначено допомогу у зв≥тному м≥с€ц≥
                                       -- —ума нарахованоњ допомоги, тис. грн
                                       x_sum1, -- x_narah   з початку поточного року (наростаючим п≥дсумком)
                                       x_sum2,  -- x_narah_m у зв≥тному м≥с€ц≥
                                       -- —ума фактично проф≥нансованих кошт≥в, тис. грн
                                       x_sum3, -- x_pay (з початку поточного року (наростаючим п≥дсумком))
                                       x_sum4,  -- x_pay_m (у зв≥тному м≥с€ц≥)
                                       x_sum5, -- x_pay_befor (з них: погашено заборгованост≥ за попередн≥ роки)
                                       -- —ума виплаченоњ допомоги, тис. грн
                                       x_sum6, -- x_payed (з початку поточного року (наростаючим п≥дсумком))
                                       x_sum7, -- x_payed_m (у зв≥тному м≥с€ц≥)
                                       -- —ума заборгованост≥, тис. грн
                                       x_sum8, -- x_borh_befor (за попередн≥ роки)
                                       -- дл€ розпод≥лу по пропорц≥€м
                                       x_sum9,                     -- a_assing
                                       x_sum10)                  -- a_assing_m
            WITH
                org
                AS
                    (    SELECT org_id     i_org
                           FROM ikis_sys.v_opfu
                     CONNECT BY PRIOR org_id = org_org
                     START WITH org_id =
                                CASE
                                    WHEN l_user_org = 50001 THEN 50000
                                    ELSE l_user_org
                                END),
                rpt
                AS
                    (SELECT 1                                                                             ca,
                            '1. ”сього отримують державну соц≥альну допомогу  (р€дки 2+7),&#10;з них:'    cb
                       FROM DUAL
                     UNION ALL
                     SELECT 2                                                                            ca,
                            '1.1. ќсоба з ≥нвал≥дн≥стю з дитинства  (р€дки 3+5+6),&#10;у тому числ≥:'    cb
                       FROM DUAL
                     UNION ALL
                     SELECT 3 ca, ' ≤ групи' cb FROM DUAL
                     UNION ALL
                     SELECT 4 ca, '<B>з них:</B><Font> п≥дгрупи ј</Font>' cb
                       FROM DUAL
                     UNION ALL
                     SELECT 5 ca, '≤≤ групи' cb FROM DUAL
                     UNION ALL
                     SELECT 6 ca, '≤≤≤ групи' cb FROM DUAL
                     UNION ALL
                     SELECT 7                                                                  ca,
                            '1.2. ƒ≥ти з ≥нвал≥дн≥стю в≥ком до 18 рок≥в,&#10;у тому числ≥:'    cb
                       FROM DUAL
                     UNION ALL
                     SELECT 8                                                      ca,
                            ' д≥ти з ≥нвал≥дн≥стю в≥ком до 18 рок≥в п≥дгрупи ј'    cb
                       FROM DUAL
                     UNION ALL
                     SELECT 9                                                                          ca,
                            'д≥ти з ≥нвал≥дн≥стю, захворюванн€ €ких повТ€зане з „орнобильською ј≈—'    cb
                       FROM DUAL
                     UNION ALL
                     SELECT 10                                                                                                                                              ca,
                            '<B><I>з них:</I></B><I> д≥ти з ≥нвал≥дн≥стю, захворюванн€ €ких повТ€зане з „орнобильською ј≈—, п≥дгрупи <Font html:Size="6.5">ј</Font></I>'    cb
                       FROM DUAL
                     UNION ALL
                     SELECT 11                                                                                                                      ca,
                            '2. ≤з загальноњ к≥лькост≥ отримувач≥в допомоги Ц отримують надбавку на догл€д  (усього)  (р€дки 12+16),&#10;з них:'    cb
                       FROM DUAL
                     UNION ALL
                     SELECT 12                                                                                               ca,
                            '2.1. Ќа догл€д за особою з ≥нвал≥дн≥стю з дитинства&#10;(р€дки 13+14+15),&#10;у тому числ≥:'    cb
                       FROM DUAL
                     UNION ALL
                     SELECT 13 ca, '≤ групи' cb FROM DUAL
                     UNION ALL
                     SELECT 14 ca, '≤≤ групи' cb FROM DUAL
                     UNION ALL
                     SELECT 15 ca, '≤≤≤ групи' cb FROM DUAL
                     UNION ALL
                     SELECT 16                                                                            ca,
                            '2.2. Ќа догл€д за дитиною з ≥нвал≥дн≥стю в≥ком до 18 рок≥в (р€дки 17+18)'    cb
                       FROM DUAL
                     UNION ALL
                     SELECT 17                                                   ca,
                            '<B>з них</B><Font>:&#10;в≥ком до 6 рок≥в</Font>'    cb
                       FROM DUAL
                     UNION ALL
                     SELECT 18 ca, 'в≥ком в≥д 6 до 18 рок≥в' cb FROM DUAL
                     UNION ALL
                     SELECT 19                                                                                                                                                           ca,
                            '<I>з р€дка 16 </I><Font>Ц</Font><I><Font html:Size="8.75"> </Font><Font>за дитиною з ≥нвал≥дн≥стю в≥ком до 18 рок≥в п≥дгрупи ј (р€дки 20+21)</Font></I>'    cb
                       FROM DUAL
                     UNION ALL
                     SELECT 20                                                    ca,
                            '<B> з них:</B><Font>&#10;в≥ком до 6 рок≥в</Font>'    cb
                       FROM DUAL
                     UNION ALL
                     SELECT 21 ca, 'в≥ком в≥д 6 до 18 рок≥в ' cb FROM DUAL
                     UNION ALL
                     SELECT 22                                                                                                                                                                                                                      ca,
                            '<I>з р€дка 16 </I><Font>Ц</Font><I><Font html:Size="8.75"> </Font><Font>за дитиною з ≥нвал≥дн≥стю в≥ком до 18 рок≥в, захворюванн€ €коњ пов</Font></I><Font>Т</Font><I>€зане з „орнобильською ј≈— (р€дки 23+24)</I>'    cb
                       FROM DUAL
                     UNION ALL
                     SELECT 23                                                    ca,
                            '<B>з них:&#10;</B><Font> в≥ком до 6 рок≥в</Font>'    cb
                       FROM DUAL
                     UNION ALL
                     SELECT 24 ca, 'в≥ком в≥д 6 до 18 рок≥в' cb FROM DUAL
                     UNION ALL
                     SELECT 25                                                                                                                                                                                      ca,
                            '<I>з р€дка 22 </I><Font>Ц</Font><I> за дитиною з ≥нвал≥дн≥стю в≥ком до 18 рок≥в п≥дгрупи ј, захворюванн€ €коњ пов</I><Font>Т</Font><I>€зане з „орнобильською ј≈— (р€дки 26+27)</I>'    cb
                       FROM DUAL
                     UNION ALL
                     SELECT 26                                                   ca,
                            '<B>з них:</B><Font>&#10;в≥ком до 6 рок≥в</Font>'    cb
                       FROM DUAL
                     UNION ALL
                     SELECT 27 ca, 'в≥ком в≥д 6 до 18 рок≥в ' cb FROM DUAL
                     UNION ALL
                     SELECT 28                                                                                                                       ca,
                            '<I>з р€дка 16 </I><Font>Ц</Font><I> за дитиною з ≥нвал≥дн≥стю до 18 рок≥в одинок≥й матер≥, батьку (р€дки 29+30)</I>'    cb
                       FROM DUAL
                     UNION ALL
                     SELECT 29                                                                                                                                                             ca,
                            '<B>з них:                                                                                                               </B><Font>в≥ком до 6 рок≥в</Font>'    cb
                       FROM DUAL
                     UNION ALL
                     SELECT 30 ca, 'в≥ком в≥д 6 до 18 рок≥в' cb FROM DUAL
                     UNION ALL
                     SELECT 31                                                                 ca,
                            '3. ƒопомога на похованн€  (р€дки 32+36)                      '    cb
                       FROM DUAL
                     UNION ALL
                     SELECT 32                                                                                                                                                       ca,
                            'у тому числ≥:                                                                                3.1. ќсоба з ≥нвал≥дн≥стю з дитинства (р€дки 33+34+35)'    cb
                       FROM DUAL
                     UNION ALL
                     SELECT 33                                                                                                                                         ca,
                            '<B>з них:  </B><Font>                                                                                                  ≤ групи</Font>'    cb
                       FROM DUAL
                     UNION ALL
                     SELECT 34 ca, '≤≤ групи' cb FROM DUAL
                     UNION ALL
                     SELECT 35 ca, '≤≤≤ групи' cb FROM DUAL
                     UNION ALL
                     SELECT 36                                              ca,
                            '3.2. ƒ≥ти з ≥нвал≥дн≥стю в≥ком до 18 рок≥в'    cb
                       FROM DUAL
                     UNION ALL
                     SELECT 37                                                                                                               ca,
                            '4.ќтримують державну соц≥альну допомогу та пенс≥ю у звТ€зку з втратою годувальника одночасно  (р€дки 38+42)'    cb
                       FROM DUAL
                     UNION ALL
                     SELECT 38                                                                              ca,
                            'у тому числ≥:&#10;4.1  ќсоба з ≥нвал≥дн≥стю з дитинства   (р€дки 39+40+41)'    cb
                       FROM DUAL
                     UNION ALL
                     SELECT 39                                           ca,
                            '<B>з них</B><Font>:&#10;≤ групи</Font>'     cb
                       FROM DUAL
                     UNION ALL
                     SELECT 40 ca, '≤≤ групи' cb FROM DUAL
                     UNION ALL
                     SELECT 41 ca, '≤≤≤ групи' cb FROM DUAL
                     UNION ALL
                     SELECT 42                                             ca,
                            '4.2 ƒ≥ти з ≥нвал≥дн≥стю в≥ком до 18 рок≥в'    cb
                       FROM DUAL
                     UNION ALL
                     SELECT 43 ca, '5. ≤нш≥ виплати' cb FROM DUAL),
                assign
                AS
                    (SELECT pc_id
                                a_pc,
                            d.pd_id
                                a_pd,
                            d.pd_ap
                                a_ap,
                            f.pdf_sc,
                            --pdp_sum     a_assing,
                             (SELECT NVL (SUM (pd.pdd_value), pdp_sum)
                                FROM uss_esr.pd_detail pd
                               WHERE     pd.pdd_pdp = pp.pdp_id
                                     AND pd.pdd_key = f.pdf_id)
                                a_assing,
                            CASE
                                WHEN d.pd_start_dt >= l_start_dt_yy THEN 1
                                ELSE 0
                            END
                                is_new_y,
                            CASE
                                WHEN d.pd_start_dt >= l_start_dt_mm THEN 1
                                ELSE 0
                            END
                                is_new,
                            CASE
                                WHEN f.pdf_birth_dt > l_start_dt_6y THEN 6
                                WHEN f.pdf_birth_dt > l_start_dt_18y THEN 18
                                ELSE 100
                            END
                                year_old,
                            (SELECT MAX (1)
                               FROM uss_esr.ap_person         pp,
                                    uss_esr.ap_document       ad,
                                    uss_esr.ap_document_attr  da
                              WHERE     pp.app_sc = f.pdf_sc
                                    AND pp.app_ap = d.pd_ap
                                    AND pp.app_ap = ad.apd_ap
                                    AND pp.app_id = ad.apd_app
                                    AND ad.apd_id = da.apda_apd
                                    AND da.apda_nda IN (353, -- причина ≥нвал≥дност≥
                                                             645) -- ќсоба з ≥нвал≥дн≥стю з дитинства
                                    AND (   da.apda_val_string = 'ID' -- ≤нвал≥дн≥сть з дитинства
                                         OR da.apda_nda = 645)
                                    AND da.history_status = 'A')
                                inv_pers,
                            (SELECT MAX (da.apda_val_string) -- DI/DIA (ƒитина з ≥нвал≥дн≥стю/ƒитина з ≥нвал≥дн≥стю п≥дгрупи "ј")
                               FROM uss_esr.ap_person         pp,
                                    uss_esr.ap_document       ad,
                                    uss_esr.ap_document_attr  da
                              WHERE     pp.app_sc = f.pdf_sc
                                    AND pp.app_ap = d.pd_ap
                                    AND pp.app_ap = ad.apd_ap
                                    AND pp.app_id = ad.apd_app
                                    AND ad.apd_id = da.apda_apd
                                    AND da.apda_nda IN (797)      -- категор≥€
                                    AND da.history_status = 'A')
                                inv_chld,
                            (SELECT MAX (da.apda_val_string)
                               FROM uss_esr.ap_person         pp,
                                    uss_esr.ap_document       ad,
                                    uss_esr.ap_document_attr  da
                              WHERE     pp.app_sc = f.pdf_sc
                                    AND pp.app_ap = d.pd_ap
                                    AND pp.app_ap = ad.apd_ap
                                    AND pp.app_id = ad.apd_app
                                    AND ad.apd_id = da.apda_apd
                                    AND da.apda_nda IN (349, 666, 1790)
                                    AND da.apda_val_string IN ('1', '2', '3')
                                    AND da.history_status = 'A')
                                inv_gr,
                            (SELECT MAX (da.apda_val_string)
                               FROM uss_esr.ap_person         pp,
                                    uss_esr.ap_document       ad,
                                    uss_esr.ap_document_attr  da
                              WHERE     pp.app_sc = f.pdf_sc
                                    AND pp.app_ap = d.pd_ap
                                    AND pp.app_ap = ad.apd_ap
                                    AND pp.app_id = ad.apd_app
                                    AND ad.apd_id = da.apda_apd
                                    AND da.apda_nda IN (791, 1792, 1792)
                                    AND da.apda_val_string = 'A'
                                    AND da.history_status = 'A')
                                inv_subgr,
                            (SELECT MAX (1)
                               FROM uss_esr.ap_person         pp,
                                    uss_esr.ap_document       ad,
                                    uss_esr.ap_document_attr  da
                              WHERE     pp.app_sc = f.pdf_sc
                                    AND pp.app_ap = d.pd_ap
                                    AND pp.app_ap = ad.apd_ap
                                    AND pp.app_id = ad.apd_app
                                    AND ad.apd_id = da.apda_apd
                                    AND da.apda_val_string = 'T'
                                    AND da.apda_nda IN (677) -- «находитьс€ на держутриманн≥
                                    AND da.history_status = 'A')
                                is_dutr,
                            (SELECT MAX (1)
                               FROM uss_esr.ap_person         pp,
                                    uss_esr.ap_document       ad,
                                    uss_esr.ap_document_attr  da
                              WHERE     pp.app_sc = f.pdf_sc
                                    AND pp.app_ap = d.pd_ap
                                    AND pp.app_ap = ad.apd_ap
                                    AND pp.app_id = ad.apd_app
                                    AND ad.apd_id = da.apda_apd
                                    AND da.apda_val_string = 'T'
                                    AND da.apda_nda IN (942) -- ƒитина з ≥нвал≥дн≥стю внасл≥док авар≥њ на „ј≈—
                                    AND da.history_status = 'A')
                                is_AES,
                            (SELECT MAX (1)
                               FROM uss_esr.ap_person         pp,
                                    uss_esr.ap_document       ad,
                                    uss_esr.ap_document_attr  da
                              WHERE /*pp.app_sc = f.pdf_sc
                                  and*/
                                        pp.app_ap = d.pd_ap
                                    AND pp.app_ap = ad.apd_ap
                                    AND pp.app_id = ad.apd_app
                                    AND ad.apd_id = da.apda_apd
                                    AND da.apda_val_string = 'T'
                                    AND da.apda_nda IN (641) -- ќдинока/одинокий
                                    AND da.history_status = 'A')
                                is_lon,
                            --row_number() over(partition by d.pd_id, nnc.nptc_npt, pp.pdp_id order by f.pdf_pd, nnc.nptc_npt)    rn,
                            1
                                rn,
                            nnc.nptc_npt
                       FROM ikis_sys.v_opfu  o
                            INNER JOIN org ON i_org = org_id
                            INNER JOIN uss_esr.personalcase pc
                                ON pc.com_org = o.org_id
                            INNER JOIN uss_esr.pc_decision d
                                ON d.pd_pc = pc.pc_id
                            INNER JOIN uss_esr.pd_family f
                                ON     f.pdf_pd = d.pd_id
                                   AND NOT EXISTS
                                           (SELECT 1
                                              FROM uss_esr.ap_person p
                                             WHERE     p.app_ap = d.pd_ap
                                                   AND p.app_sc = f.pdf_sc
                                                   AND p.history_status = 'A'
                                                   AND p.app_tp = 'P') -- ѕредставник за€вника
                            INNER JOIN uss_esr.pd_payment pp
                                ON pp.pdp_pd = d.pd_id
                            INNER JOIN uss_esr.pd_accrual_period pdap
                                ON pdap.pdap_pd = d.pd_id
                            INNER JOIN uss_ndi.v_Ndi_Npt_Config nnc
                                ON nnc.nptc_npt = pp.pdp_npt
                            INNER JOIN uss_ndi.v_ndi_service_type st
                                ON st.nst_id = nnc.nptc_nst
                      WHERE     o.org_to = 32
                            AND pp.history_status = 'A'
                            AND pdap.history_status = 'A'
                            AND st.nst_id = 248 -- ƒержавна соц≥альна допомога особам з ≥нвал≥дн≥стю з дитинства та д≥т€м з ≥нвал≥дн≥стю
                            AND p_start_dt BETWEEN TRUNC (pdap.pdap_start_dt,
                                                          'mm')
                                               AND pdap.pdap_stop_dt
                            AND p_start_dt BETWEEN TRUNC (pp.pdp_start_dt,
                                                          'mm')
                                               AND pp.pdp_stop_dt-- and d.pd_id = 701
                                                                 ),
                nrh
                AS
                    (  SELECT ac.ac_month         dt_r,
                              --ac.ac_pc    x_pc,
                              --d.acd_pd    x_pd,
                              SUM (
                                    uss_esr.api$accrual.xsign (d.acd_op)
                                  * d.acd_sum)    x_narah,
                              SUM (
                                  CASE
                                      WHEN d.acd_prsd IS NOT NULL
                                      THEN
                                            uss_esr.api$accrual.xsign (
                                                d.acd_op)
                                          * d.acd_sum
                                      ELSE
                                          0
                                  END)            x_pay,
                              SUM (
                                  CASE
                                      WHEN     d.acd_prsd IS NOT NULL
                                           AND TRUNC (d.acd_ac_start_dt, 'yy') >
                                               TRUNC (d.acd_start_dt, 'yy')
                                      THEN
                                            uss_esr.api$accrual.xsign (
                                                d.acd_op)
                                          * d.acd_sum
                                      ELSE
                                          0
                                  END)            x_pay_befor,
                              SUM (
                                  CASE
                                      WHEN EXISTS
                                               (SELECT 1
                                                  FROM uss_esr.payroll pr
                                                       INNER JOIN
                                                       uss_esr.pr_sheet s
                                                           ON s.prs_pr =
                                                              pr.pr_id
                                                       INNER JOIN
                                                       uss_esr.pr_sheet_detail
                                                       sd
                                                           ON sd.prsd_prs =
                                                              s.prs_id
                                                 WHERE     sd.prsd_id =
                                                           d.acd_prsd
                                                       AND s.prs_st IN
                                                               ('NA',
                                                                'KV1',
                                                                'KV2')
                                                       AND pr.pr_st IN ('F')
                                                       AND sd.prsd_tp IN
                                                               ('PWI', 'RDN'))
                                      THEN
                                            uss_esr.api$accrual.xsign (
                                                d.acd_op)
                                          * d.acd_sum
                                      ELSE
                                          0
                                  END)            x_payed,
                              SUM (
                                  CASE
                                      WHEN     d.acd_prsd IS NULL -- не виплачено
                                           AND TRUNC (d.acd_ac_start_dt, 'yy') >
                                               TRUNC (d.acd_start_dt, 'yy') -- р≥к нарахуванн€ б≥льший року призначенн€
                                           AND TRUNC (d.acd_start_dt, 'yy') =
                                               TRUNC (d.acd_start_dt, 'mm') -- на перший м≥с€ць зв≥тного року
                                      THEN
                                            uss_esr.api$accrual.xsign (
                                                d.acd_op)
                                          * d.acd_sum
                                      ELSE
                                          0
                                  END)            x_borh_befor,
                              nnc.nptc_npt
                         FROM ikis_sys.v_opfu o
                              INNER JOIN org ON i_org = o.org_id
                              INNER JOIN uss_esr.accrual ac
                                  ON ac.com_org = o.org_id
                              INNER JOIN uss_esr.ac_detail d
                                  ON     d.acd_ac = ac.ac_id
                                     AND d.history_status = 'A'
                              INNER JOIN uss_ndi.v_ndi_op op
                                  ON op.op_id = d.acd_op
                              INNER JOIN uss_ndi.v_Ndi_Npt_Config nnc
                                  ON nnc.nptc_npt = d.acd_npt
                        WHERE     o.org_to = 32
                              AND ac.ac_month >= l_start_dt_yy
                              AND ac.ac_month <= l_start_dt_mm
                              AND d.acd_start_dt BETWEEN ac.ac_month
                                                     AND TRUNC (
                                                             LAST_DAY (
                                                                 ac.ac_month))
                              AND (d.acd_op IN (1, 2, 3) OR op.op_tp1 IN ('NR'))
                              AND ac.history_status = 'A'
                              AND nnc.nptc_nst = 248
                     GROUP BY ac.ac_month, nnc.nptc_npt)
              -- qq
              SELECT rpt.cb,
                     rpt.ca,
                     a.cnt_all,
                     a.cnt_dutr,
                     a.cnt_y,
                     a.cnt_m,
                     --a.a_assing,
                     --a.a_assing_m,
                     n.x_narah,
                     n.x_narah_m,
                     n.x_pay,
                     n.x_pay_m,
                     n.x_pay_befor,
                     n.x_payed,
                     n.x_payed_m,
                     n.x_borh_befor,
                     a.a_assing,
                     a.a_assing_m
                FROM rpt
                     LEFT JOIN
                     (SELECT 3
                                 npp,
                             COUNT (DISTINCT a.a_pc)
                                 cnt_all,
                             COUNT (
                                 DISTINCT
                                     CASE
                                         WHEN a.is_dutr = 1 THEN a.a_pc
                                         ELSE NULL
                                     END)
                                 cnt_dutr,
                             COUNT (
                                 DISTINCT
                                     CASE
                                         WHEN a.is_new_y = 1 THEN a.a_pc
                                         ELSE NULL
                                     END)
                                 cnt_y,
                             COUNT (
                                 DISTINCT
                                     CASE
                                         WHEN a.is_new = 1 THEN a.a_pc
                                         ELSE NULL
                                     END)
                                 cnt_m,
                             SUM (
                                 CASE WHEN a.rn = 1 THEN a.a_assing ELSE 0 END)
                                 a_assing,
                             SUM (
                                 CASE
                                     WHEN a.rn = 1 AND a.is_new = 1
                                     THEN
                                         a.a_assing
                                     ELSE
                                         0
                                 END)
                                 a_assing_m
                        FROM assign a
                       WHERE inv_pers = 1 AND inv_gr = '1'
                      UNION ALL
                      SELECT 4
                                 npp,
                             COUNT (DISTINCT a.a_pc)
                                 cnt_all,
                             COUNT (
                                 DISTINCT
                                     CASE
                                         WHEN a.is_dutr = 1 THEN a.a_pc
                                         ELSE NULL
                                     END)
                                 cnt_dutr,
                             COUNT (
                                 DISTINCT
                                     CASE
                                         WHEN a.is_new_y = 1 THEN a.a_pc
                                         ELSE NULL
                                     END)
                                 cnt_y,
                             COUNT (
                                 DISTINCT
                                     CASE
                                         WHEN a.is_new = 1 THEN a.a_pc
                                         ELSE NULL
                                     END)
                                 cnt_m,
                             SUM (
                                 CASE WHEN a.rn = 1 THEN a.a_assing ELSE 0 END)
                                 a_assing,
                             SUM (
                                 CASE
                                     WHEN a.rn = 1 AND a.is_new = 1
                                     THEN
                                         a.a_assing
                                     ELSE
                                         0
                                 END)
                                 a_assing_m
                        FROM assign a
                       WHERE inv_pers = 1 AND inv_gr = '1' AND inv_subgr = 'A'
                      UNION ALL
                      SELECT 5
                                 npp,
                             COUNT (DISTINCT a.a_pc)
                                 cnt_all,
                             COUNT (
                                 DISTINCT
                                     CASE
                                         WHEN a.is_dutr = 1 THEN a.a_pc
                                         ELSE NULL
                                     END)
                                 cnt_dutr,
                             COUNT (
                                 DISTINCT
                                     CASE
                                         WHEN a.is_new_y = 1 THEN a.a_pc
                                         ELSE NULL
                                     END)
                                 cnt_y,
                             COUNT (
                                 DISTINCT
                                     CASE
                                         WHEN a.is_new = 1 THEN a.a_pc
                                         ELSE NULL
                                     END)
                                 cnt_m,
                             SUM (
                                 CASE WHEN a.rn = 1 THEN a.a_assing ELSE 0 END)
                                 a_assing,
                             SUM (
                                 CASE
                                     WHEN a.rn = 1 AND a.is_new = 1
                                     THEN
                                         a.a_assing
                                     ELSE
                                         0
                                 END)
                                 a_assing_m
                        FROM assign a
                       WHERE inv_pers = 1 AND inv_gr = '2'
                      UNION ALL
                      SELECT 6
                                 npp,
                             COUNT (DISTINCT a.a_pc)
                                 cnt_all,
                             COUNT (
                                 DISTINCT
                                     CASE
                                         WHEN a.is_dutr = 1 THEN a.a_pc
                                         ELSE NULL
                                     END)
                                 cnt_dutr,
                             COUNT (
                                 DISTINCT
                                     CASE
                                         WHEN a.is_new_y = 1 THEN a.a_pc
                                         ELSE NULL
                                     END)
                                 cnt_y,
                             COUNT (
                                 DISTINCT
                                     CASE
                                         WHEN a.is_new = 1 THEN a.a_pc
                                         ELSE NULL
                                     END)
                                 cnt_m,
                             SUM (
                                 CASE WHEN a.rn = 1 THEN a.a_assing ELSE 0 END)
                                 a_assing,
                             SUM (
                                 CASE
                                     WHEN a.rn = 1 AND a.is_new = 1
                                     THEN
                                         a.a_assing
                                     ELSE
                                         0
                                 END)
                                 a_assing_m
                        FROM assign a
                       WHERE inv_pers = 1 AND inv_gr = '3'
                      UNION ALL
                      SELECT 7
                                 npp,
                             COUNT (DISTINCT a.a_pc)
                                 cnt_all,
                             COUNT (
                                 DISTINCT
                                     CASE
                                         WHEN a.is_dutr = 1 THEN a.a_pc
                                         ELSE NULL
                                     END)
                                 cnt_dutr,
                             COUNT (
                                 DISTINCT
                                     CASE
                                         WHEN a.is_new_y = 1 THEN a.a_pc
                                         ELSE NULL
                                     END)
                                 cnt_y,
                             COUNT (
                                 DISTINCT
                                     CASE
                                         WHEN a.is_new = 1 THEN a.a_pc
                                         ELSE NULL
                                     END)
                                 cnt_m,
                             SUM (
                                 CASE WHEN a.rn = 1 THEN a.a_assing ELSE 0 END)
                                 a_assing,
                             SUM (
                                 CASE
                                     WHEN a.rn = 1 AND a.is_new = 1
                                     THEN
                                         a.a_assing
                                     ELSE
                                         0
                                 END)
                                 a_assing_m
                        FROM assign a
                       WHERE inv_chld IN ('DI', 'DIA')
                      UNION ALL
                      SELECT 8
                                 npp,
                             COUNT (DISTINCT a.a_pc)
                                 cnt_all,
                             COUNT (
                                 DISTINCT
                                     CASE
                                         WHEN a.is_dutr = 1 THEN a.a_pc
                                         ELSE NULL
                                     END)
                                 cnt_dutr,
                             COUNT (
                                 DISTINCT
                                     CASE
                                         WHEN a.is_new_y = 1 THEN a.a_pc
                                         ELSE NULL
                                     END)
                                 cnt_y,
                             COUNT (
                                 DISTINCT
                                     CASE
                                         WHEN a.is_new = 1 THEN a.a_pc
                                         ELSE NULL
                                     END)
                                 cnt_m,
                             SUM (
                                 CASE WHEN a.rn = 1 THEN a.a_assing ELSE 0 END)
                                 a_assing,
                             SUM (
                                 CASE
                                     WHEN a.rn = 1 AND a.is_new = 1
                                     THEN
                                         a.a_assing
                                     ELSE
                                         0
                                 END)
                                 a_assing_m
                        FROM assign a
                       WHERE inv_chld IN ('DIA')
                      UNION ALL
                      SELECT 9
                                 npp,
                             COUNT (DISTINCT a.a_pc)
                                 cnt_all,
                             COUNT (
                                 DISTINCT
                                     CASE
                                         WHEN a.is_dutr = 1 THEN a.a_pc
                                         ELSE NULL
                                     END)
                                 cnt_dutr,
                             COUNT (
                                 DISTINCT
                                     CASE
                                         WHEN a.is_new_y = 1 THEN a.a_pc
                                         ELSE NULL
                                     END)
                                 cnt_y,
                             COUNT (
                                 DISTINCT
                                     CASE
                                         WHEN a.is_new = 1 THEN a.a_pc
                                         ELSE NULL
                                     END)
                                 cnt_m,
                             SUM (
                                 CASE WHEN a.rn = 1 THEN a.a_assing ELSE 0 END)
                                 a_assing,
                             SUM (
                                 CASE
                                     WHEN a.rn = 1 AND a.is_new = 1
                                     THEN
                                         a.a_assing
                                     ELSE
                                         0
                                 END)
                                 a_assing_m
                        FROM assign a
                       WHERE inv_chld IN ('DI', 'DIA') AND is_AES = 1
                      UNION ALL
                      SELECT 10
                                 npp,
                             COUNT (DISTINCT a.a_pc)
                                 cnt_all,
                             COUNT (
                                 DISTINCT
                                     CASE
                                         WHEN a.is_dutr = 1 THEN a.a_pc
                                         ELSE NULL
                                     END)
                                 cnt_dutr,
                             COUNT (
                                 DISTINCT
                                     CASE
                                         WHEN a.is_new_y = 1 THEN a.a_pc
                                         ELSE NULL
                                     END)
                                 cnt_y,
                             COUNT (
                                 DISTINCT
                                     CASE
                                         WHEN a.is_new = 1 THEN a.a_pc
                                         ELSE NULL
                                     END)
                                 cnt_m,
                             SUM (
                                 CASE WHEN a.rn = 1 THEN a.a_assing ELSE 0 END)
                                 a_assing,
                             SUM (
                                 CASE
                                     WHEN a.rn = 1 AND a.is_new = 1
                                     THEN
                                         a.a_assing
                                     ELSE
                                         0
                                 END)
                                 a_assing_m
                        FROM assign a
                       WHERE inv_chld IN ('DIA') AND is_AES = 1
                      -- nptc_npt = 48   -- Ќадбавка на догл€д за особою з ≥нвал≥дн≥стю з дитинства та дитини з ≥нвал≥дн≥стю (290)
                      UNION ALL
                      SELECT 11
                                 npp,
                             COUNT (DISTINCT a.a_pc)
                                 cnt_all,
                             COUNT (
                                 DISTINCT
                                     CASE
                                         WHEN a.is_dutr = 1 THEN a.a_pc
                                         ELSE NULL
                                     END)
                                 cnt_dutr,
                             COUNT (
                                 DISTINCT
                                     CASE
                                         WHEN a.is_new_y = 1 THEN a.a_pc
                                         ELSE NULL
                                     END)
                                 cnt_y,
                             COUNT (
                                 DISTINCT
                                     CASE
                                         WHEN a.is_new = 1 THEN a.a_pc
                                         ELSE NULL
                                     END)
                                 cnt_m,
                             SUM (
                                 CASE WHEN a.rn = 1 THEN a.a_assing ELSE 0 END)
                                 a_assing,
                             SUM (
                                 CASE
                                     WHEN a.rn = 1 AND a.is_new = 1
                                     THEN
                                         a.a_assing
                                     ELSE
                                         0
                                 END)
                                 a_assing_m
                        FROM assign a
                       WHERE a.nptc_npt = 48
                      UNION ALL
                      SELECT 13
                                 npp,
                             COUNT (DISTINCT a.a_pc)
                                 cnt_all,
                             COUNT (
                                 DISTINCT
                                     CASE
                                         WHEN a.is_dutr = 1 THEN a.a_pc
                                         ELSE NULL
                                     END)
                                 cnt_dutr,
                             COUNT (
                                 DISTINCT
                                     CASE
                                         WHEN a.is_new_y = 1 THEN a.a_pc
                                         ELSE NULL
                                     END)
                                 cnt_y,
                             COUNT (
                                 DISTINCT
                                     CASE
                                         WHEN a.is_new = 1 THEN a.a_pc
                                         ELSE NULL
                                     END)
                                 cnt_m,
                             SUM (
                                 CASE WHEN a.rn = 1 THEN a.a_assing ELSE 0 END)
                                 a_assing,
                             SUM (
                                 CASE
                                     WHEN a.rn = 1 AND a.is_new = 1
                                     THEN
                                         a.a_assing
                                     ELSE
                                         0
                                 END)
                                 a_assing_m
                        FROM assign a
                       WHERE a.nptc_npt = 48 AND inv_pers = 1 AND inv_gr = '1'
                      UNION ALL
                      SELECT 14
                                 npp,
                             COUNT (DISTINCT a.a_pc)
                                 cnt_all,
                             COUNT (
                                 DISTINCT
                                     CASE
                                         WHEN a.is_dutr = 1 THEN a.a_pc
                                         ELSE NULL
                                     END)
                                 cnt_dutr,
                             COUNT (
                                 DISTINCT
                                     CASE
                                         WHEN a.is_new_y = 1 THEN a.a_pc
                                         ELSE NULL
                                     END)
                                 cnt_y,
                             COUNT (
                                 DISTINCT
                                     CASE
                                         WHEN a.is_new = 1 THEN a.a_pc
                                         ELSE NULL
                                     END)
                                 cnt_m,
                             SUM (
                                 CASE WHEN a.rn = 1 THEN a.a_assing ELSE 0 END)
                                 a_assing,
                             SUM (
                                 CASE
                                     WHEN a.rn = 1 AND a.is_new = 1
                                     THEN
                                         a.a_assing
                                     ELSE
                                         0
                                 END)
                                 a_assing_m
                        FROM assign a
                       WHERE a.nptc_npt = 48 AND inv_pers = 1 AND inv_gr = '2'
                      UNION ALL
                      SELECT 15
                                 npp,
                             COUNT (DISTINCT a.a_pc)
                                 cnt_all,
                             COUNT (
                                 DISTINCT
                                     CASE
                                         WHEN a.is_dutr = 1 THEN a.a_pc
                                         ELSE NULL
                                     END)
                                 cnt_dutr,
                             COUNT (
                                 DISTINCT
                                     CASE
                                         WHEN a.is_new_y = 1 THEN a.a_pc
                                         ELSE NULL
                                     END)
                                 cnt_y,
                             COUNT (
                                 DISTINCT
                                     CASE
                                         WHEN a.is_new = 1 THEN a.a_pc
                                         ELSE NULL
                                     END)
                                 cnt_m,
                             SUM (
                                 CASE WHEN a.rn = 1 THEN a.a_assing ELSE 0 END)
                                 a_assing,
                             SUM (
                                 CASE
                                     WHEN a.rn = 1 AND a.is_new = 1
                                     THEN
                                         a.a_assing
                                     ELSE
                                         0
                                 END)
                                 a_assing_m
                        FROM assign a
                       WHERE a.nptc_npt = 48 AND inv_pers = 1 AND inv_gr = '3'
                      UNION ALL
                      SELECT 17
                                 npp,
                             COUNT (DISTINCT a.a_pc)
                                 cnt_all,
                             COUNT (
                                 DISTINCT
                                     CASE
                                         WHEN a.is_dutr = 1 THEN a.a_pc
                                         ELSE NULL
                                     END)
                                 cnt_dutr,
                             COUNT (
                                 DISTINCT
                                     CASE
                                         WHEN a.is_new_y = 1 THEN a.a_pc
                                         ELSE NULL
                                     END)
                                 cnt_y,
                             COUNT (
                                 DISTINCT
                                     CASE
                                         WHEN a.is_new = 1 THEN a.a_pc
                                         ELSE NULL
                                     END)
                                 cnt_m,
                             SUM (
                                 CASE WHEN a.rn = 1 THEN a.a_assing ELSE 0 END)
                                 a_assing,
                             SUM (
                                 CASE
                                     WHEN a.rn = 1 AND a.is_new = 1
                                     THEN
                                         a.a_assing
                                     ELSE
                                         0
                                 END)
                                 a_assing_m
                        FROM assign a
                       WHERE     inv_chld IN ('DI', 'DIA')
                             AND year_old = 6
                             AND a.nptc_npt = 48
                      UNION ALL
                      SELECT 18
                                 npp,
                             COUNT (DISTINCT a.a_pc)
                                 cnt_all,
                             COUNT (
                                 DISTINCT
                                     CASE
                                         WHEN a.is_dutr = 1 THEN a.a_pc
                                         ELSE NULL
                                     END)
                                 cnt_dutr,
                             COUNT (
                                 DISTINCT
                                     CASE
                                         WHEN a.is_new_y = 1 THEN a.a_pc
                                         ELSE NULL
                                     END)
                                 cnt_y,
                             COUNT (
                                 DISTINCT
                                     CASE
                                         WHEN a.is_new = 1 THEN a.a_pc
                                         ELSE NULL
                                     END)
                                 cnt_m,
                             SUM (
                                 CASE WHEN a.rn = 1 THEN a.a_assing ELSE 0 END)
                                 a_assing,
                             SUM (
                                 CASE
                                     WHEN a.rn = 1 AND a.is_new = 1
                                     THEN
                                         a.a_assing
                                     ELSE
                                         0
                                 END)
                                 a_assing_m
                        FROM assign a
                       WHERE     inv_chld IN ('DI', 'DIA')
                             AND year_old = 18
                             AND a.nptc_npt = 48
                      UNION ALL
                      SELECT 20
                                 npp,
                             COUNT (DISTINCT a.a_pc)
                                 cnt_all,
                             COUNT (
                                 DISTINCT
                                     CASE
                                         WHEN a.is_dutr = 1 THEN a.a_pc
                                         ELSE NULL
                                     END)
                                 cnt_dutr,
                             COUNT (
                                 DISTINCT
                                     CASE
                                         WHEN a.is_new_y = 1 THEN a.a_pc
                                         ELSE NULL
                                     END)
                                 cnt_y,
                             COUNT (
                                 DISTINCT
                                     CASE
                                         WHEN a.is_new = 1 THEN a.a_pc
                                         ELSE NULL
                                     END)
                                 cnt_m,
                             SUM (
                                 CASE WHEN a.rn = 1 THEN a.a_assing ELSE 0 END)
                                 a_assing,
                             SUM (
                                 CASE
                                     WHEN a.rn = 1 AND a.is_new = 1
                                     THEN
                                         a.a_assing
                                     ELSE
                                         0
                                 END)
                                 a_assing_m
                        FROM assign a
                       WHERE     inv_chld IN ('DIA')
                             AND year_old = 6
                             AND a.nptc_npt = 48
                      UNION ALL
                      SELECT 21
                                 npp,
                             COUNT (DISTINCT a.a_pc)
                                 cnt_all,
                             COUNT (
                                 DISTINCT
                                     CASE
                                         WHEN a.is_dutr = 1 THEN a.a_pc
                                         ELSE NULL
                                     END)
                                 cnt_dutr,
                             COUNT (
                                 DISTINCT
                                     CASE
                                         WHEN a.is_new_y = 1 THEN a.a_pc
                                         ELSE NULL
                                     END)
                                 cnt_y,
                             COUNT (
                                 DISTINCT
                                     CASE
                                         WHEN a.is_new = 1 THEN a.a_pc
                                         ELSE NULL
                                     END)
                                 cnt_m,
                             SUM (
                                 CASE WHEN a.rn = 1 THEN a.a_assing ELSE 0 END)
                                 a_assing,
                             SUM (
                                 CASE
                                     WHEN a.rn = 1 AND a.is_new = 1
                                     THEN
                                         a.a_assing
                                     ELSE
                                         0
                                 END)
                                 a_assing_m
                        FROM assign a
                       WHERE     inv_chld IN ('DIA')
                             AND year_old = 18
                             AND a.nptc_npt = 48
                      UNION ALL
                      SELECT 23
                                 npp,
                             COUNT (DISTINCT a.a_pc)
                                 cnt_all,
                             COUNT (
                                 DISTINCT
                                     CASE
                                         WHEN a.is_dutr = 1 THEN a.a_pc
                                         ELSE NULL
                                     END)
                                 cnt_dutr,
                             COUNT (
                                 DISTINCT
                                     CASE
                                         WHEN a.is_new_y = 1 THEN a.a_pc
                                         ELSE NULL
                                     END)
                                 cnt_y,
                             COUNT (
                                 DISTINCT
                                     CASE
                                         WHEN a.is_new = 1 THEN a.a_pc
                                         ELSE NULL
                                     END)
                                 cnt_m,
                             SUM (
                                 CASE WHEN a.rn = 1 THEN a.a_assing ELSE 0 END)
                                 a_assing,
                             SUM (
                                 CASE
                                     WHEN a.rn = 1 AND a.is_new = 1
                                     THEN
                                         a.a_assing
                                     ELSE
                                         0
                                 END)
                                 a_assing_m
                        FROM assign a
                       WHERE     inv_chld IN ('DI', 'DIA')
                             AND year_old = 6
                             AND is_AES = 1
                             AND a.nptc_npt = 48
                      UNION ALL
                      SELECT 24
                                 npp,
                             COUNT (DISTINCT a.a_pc)
                                 cnt_all,
                             COUNT (
                                 DISTINCT
                                     CASE
                                         WHEN a.is_dutr = 1 THEN a.a_pc
                                         ELSE NULL
                                     END)
                                 cnt_dutr,
                             COUNT (
                                 DISTINCT
                                     CASE
                                         WHEN a.is_new_y = 1 THEN a.a_pc
                                         ELSE NULL
                                     END)
                                 cnt_y,
                             COUNT (
                                 DISTINCT
                                     CASE
                                         WHEN a.is_new = 1 THEN a.a_pc
                                         ELSE NULL
                                     END)
                                 cnt_m,
                             SUM (
                                 CASE WHEN a.rn = 1 THEN a.a_assing ELSE 0 END)
                                 a_assing,
                             SUM (
                                 CASE
                                     WHEN a.rn = 1 AND a.is_new = 1
                                     THEN
                                         a.a_assing
                                     ELSE
                                         0
                                 END)
                                 a_assing_m
                        FROM assign a
                       WHERE     inv_chld IN ('DI', 'DIA')
                             AND year_old = 18
                             AND is_AES = 1
                             AND a.nptc_npt = 48
                      UNION ALL
                      SELECT 26
                                 npp,
                             COUNT (DISTINCT a.a_pc)
                                 cnt_all,
                             COUNT (
                                 DISTINCT
                                     CASE
                                         WHEN a.is_dutr = 1 THEN a.a_pc
                                         ELSE NULL
                                     END)
                                 cnt_dutr,
                             COUNT (
                                 DISTINCT
                                     CASE
                                         WHEN a.is_new_y = 1 THEN a.a_pc
                                         ELSE NULL
                                     END)
                                 cnt_y,
                             COUNT (
                                 DISTINCT
                                     CASE
                                         WHEN a.is_new = 1 THEN a.a_pc
                                         ELSE NULL
                                     END)
                                 cnt_m,
                             SUM (
                                 CASE WHEN a.rn = 1 THEN a.a_assing ELSE 0 END)
                                 a_assing,
                             SUM (
                                 CASE
                                     WHEN a.rn = 1 AND a.is_new = 1
                                     THEN
                                         a.a_assing
                                     ELSE
                                         0
                                 END)
                                 a_assing_m
                        FROM assign a
                       WHERE     inv_chld IN ('DIA')
                             AND year_old = 6
                             AND is_AES = 1
                             AND a.nptc_npt = 48
                      UNION ALL
                      SELECT 27
                                 npp,
                             COUNT (DISTINCT a.a_pc)
                                 cnt_all,
                             COUNT (
                                 DISTINCT
                                     CASE
                                         WHEN a.is_dutr = 1 THEN a.a_pc
                                         ELSE NULL
                                     END)
                                 cnt_dutr,
                             COUNT (
                                 DISTINCT
                                     CASE
                                         WHEN a.is_new_y = 1 THEN a.a_pc
                                         ELSE NULL
                                     END)
                                 cnt_y,
                             COUNT (
                                 DISTINCT
                                     CASE
                                         WHEN a.is_new = 1 THEN a.a_pc
                                         ELSE NULL
                                     END)
                                 cnt_m,
                             SUM (
                                 CASE WHEN a.rn = 1 THEN a.a_assing ELSE 0 END)
                                 a_assing,
                             SUM (
                                 CASE
                                     WHEN a.rn = 1 AND a.is_new = 1
                                     THEN
                                         a.a_assing
                                     ELSE
                                         0
                                 END)
                                 a_assing_m
                        FROM assign a
                       WHERE     inv_chld IN ('DIA')
                             AND year_old = 18
                             AND is_AES = 1
                             AND a.nptc_npt = 48
                      UNION ALL
                      SELECT 29
                                 npp,
                             COUNT (DISTINCT a.a_pc)
                                 cnt_all,
                             COUNT (
                                 DISTINCT
                                     CASE
                                         WHEN a.is_dutr = 1 THEN a.a_pc
                                         ELSE NULL
                                     END)
                                 cnt_dutr,
                             COUNT (
                                 DISTINCT
                                     CASE
                                         WHEN a.is_new_y = 1 THEN a.a_pc
                                         ELSE NULL
                                     END)
                                 cnt_y,
                             COUNT (
                                 DISTINCT
                                     CASE
                                         WHEN a.is_new = 1 THEN a.a_pc
                                         ELSE NULL
                                     END)
                                 cnt_m,
                             SUM (
                                 CASE WHEN a.rn = 1 THEN a.a_assing ELSE 0 END)
                                 a_assing,
                             SUM (
                                 CASE
                                     WHEN a.rn = 1 AND a.is_new = 1
                                     THEN
                                         a.a_assing
                                     ELSE
                                         0
                                 END)
                                 a_assing_m
                        FROM assign a
                       WHERE     inv_chld IN ('DI', 'DIA')
                             AND year_old = 6
                             AND is_lon = 1                -- ќдинока/одинокий
                             AND a.nptc_npt = 48
                      UNION ALL
                      SELECT 30
                                 npp,
                             COUNT (DISTINCT a.a_pc)
                                 cnt_all,
                             COUNT (
                                 DISTINCT
                                     CASE
                                         WHEN a.is_dutr = 1 THEN a.a_pc
                                         ELSE NULL
                                     END)
                                 cnt_dutr,
                             COUNT (
                                 DISTINCT
                                     CASE
                                         WHEN a.is_new_y = 1 THEN a.a_pc
                                         ELSE NULL
                                     END)
                                 cnt_y,
                             COUNT (
                                 DISTINCT
                                     CASE
                                         WHEN a.is_new = 1 THEN a.a_pc
                                         ELSE NULL
                                     END)
                                 cnt_m,
                             SUM (
                                 CASE WHEN a.rn = 1 THEN a.a_assing ELSE 0 END)
                                 a_assing,
                             SUM (
                                 CASE
                                     WHEN a.rn = 1 AND a.is_new = 1
                                     THEN
                                         a.a_assing
                                     ELSE
                                         0
                                 END)
                                 a_assing_m
                        FROM assign a
                       WHERE     inv_chld IN ('DI', 'DIA')
                             AND year_old = 18
                             AND is_lon = 1
                             AND a.nptc_npt = 48) a
                         ON a.npp = rpt.ca
                     LEFT JOIN
                     (SELECT 1                     npp,
                             SUM (x_narah)         x_narah,
                             SUM (
                                 CASE
                                     WHEN dt_r = l_start_dt_mm THEN x_narah
                                     ELSE 0
                                 END)              x_narah_m,
                             SUM (x_pay)           x_pay,
                             SUM (
                                 CASE
                                     WHEN dt_r = l_start_dt_mm THEN x_pay
                                     ELSE 0
                                 END)              x_pay_m,
                             SUM (x_pay_befor)     x_pay_befor,
                             SUM (x_payed)         x_payed,
                             SUM (
                                 CASE
                                     WHEN dt_r = l_start_dt_mm THEN x_payed
                                     ELSE 0
                                 END)              x_payed_m,
                             SUM (x_borh_befor)    x_borh_befor
                        FROM nrh
                      UNION ALL
                      SELECT 11                    npp,
                             SUM (x_narah)         x_narah,
                             SUM (
                                 CASE
                                     WHEN dt_r = l_start_dt_mm THEN x_narah
                                     ELSE 0
                                 END)              x_narah_m,
                             SUM (x_pay)           x_pay,
                             SUM (
                                 CASE
                                     WHEN dt_r = l_start_dt_mm THEN x_pay
                                     ELSE 0
                                 END)              x_pay_m,
                             SUM (x_pay_befor)     x_pay_befor,
                             SUM (x_payed)         x_payed,
                             SUM (
                                 CASE
                                     WHEN dt_r = l_start_dt_mm THEN x_payed
                                     ELSE 0
                                 END)              x_payed_m,
                             SUM (x_borh_befor)    x_borh_befor
                        FROM nrh
                       WHERE nptc_npt = 48 -- Ќадбавка на догл€д за особою з ≥нвал≥дн≥стю з дитинства та дитини з ≥нвал≥дн≥стю (290)
                                          ) n
                         ON n.npp = rpt.ca
            ORDER BY 2;

        UPDATE tmp_univ_rpt_data
           SET x_id2 = NVL (x_id2, 0),
               x_id3 = NVL (x_id3, 0),
               x_id4 = NVL (x_id4, 0),
               x_id5 = NVL (x_id5, 0),
               x_sum1 = NVL (x_sum1, 0),
               x_sum2 = NVL (x_sum2, 0),
               x_sum3 = NVL (x_sum3, 0),
               x_sum4 = NVL (x_sum4, 0),
               x_sum5 = NVL (x_sum5, 0),
               x_sum6 = NVL (x_sum6, 0),
               x_sum7 = NVL (x_sum7, 0),
               x_sum8 = NVL (x_sum8, 0),
               x_sum9 = NVL (x_sum9, 0),
               x_sum10 = NVL (x_sum10, 0)
         WHERE 1 = 1;

        UPDATE Tmp_Univ_Rpt_Data
           SET (x_Id2,
                x_Id3,
                x_Id4,
                x_Id5,
                x_Sum9,
                x_Sum10) =
                   (SELECT SUM (a.x_Id2),
                           SUM (a.x_Id3),
                           SUM (a.x_Id4),
                           SUM (a.x_Id5),
                           SUM (a.x_Sum9),
                           SUM (a.x_Sum10)
                      FROM Tmp_Univ_Rpt_Data a
                     WHERE a.x_Id1 IN (3, 5, 6))
         WHERE x_Id1 = 2;

        UPDATE Tmp_Univ_Rpt_Data
           SET (x_Id2,
                x_Id3,
                x_Id4,
                x_Id5,
                x_Sum9,
                x_Sum10) =
                   (SELECT SUM (a.x_Id2),
                           SUM (a.x_Id3),
                           SUM (a.x_Id4),
                           SUM (a.x_Id5),
                           SUM (a.x_Sum9),
                           SUM (a.x_Sum10)
                      FROM Tmp_Univ_Rpt_Data a
                     WHERE a.x_Id1 IN (2, 7))
         WHERE x_Id1 = 1;

        UPDATE Tmp_Univ_Rpt_Data
           SET (x_Id2,
                x_Id3,
                x_Id4,
                x_Id5,
                x_Sum9,
                x_Sum10) =
                   (SELECT SUM (a.x_Id2),
                           SUM (a.x_Id3),
                           SUM (a.x_Id4),
                           SUM (a.x_Id5),
                           SUM (a.x_Sum9),
                           SUM (a.x_Sum10)
                      FROM Tmp_Univ_Rpt_Data a
                     WHERE a.x_Id1 IN (20, 21))
         WHERE x_Id1 = 19;

        UPDATE Tmp_Univ_Rpt_Data
           SET (x_Id2,
                x_Id3,
                x_Id4,
                x_Id5,
                x_Sum9,
                x_Sum10) =
                   (SELECT SUM (a.x_Id2),
                           SUM (a.x_Id3),
                           SUM (a.x_Id4),
                           SUM (a.x_Id5),
                           SUM (a.x_Sum9),
                           SUM (a.x_Sum10)
                      FROM Tmp_Univ_Rpt_Data a
                     WHERE a.x_Id1 IN (13, 14, 15))
         WHERE x_Id1 = 12;

        UPDATE Tmp_Univ_Rpt_Data
           SET (x_Id2,
                x_Id3,
                x_Id4,
                x_Id5,
                x_Sum9,
                x_Sum10) =
                   (SELECT SUM (a.x_Id2),
                           SUM (a.x_Id3),
                           SUM (a.x_Id4),
                           SUM (a.x_Id5),
                           SUM (a.x_Sum9),
                           SUM (a.x_Sum10)
                      FROM Tmp_Univ_Rpt_Data a
                     WHERE a.x_Id1 IN (17, 18))
         WHERE x_Id1 = 16;

        UPDATE Tmp_Univ_Rpt_Data
           SET (x_Id2,
                x_Id3,
                x_Id4,
                x_Id5,
                x_Sum9,
                x_Sum10) =
                   (SELECT SUM (a.x_Id2),
                           SUM (a.x_Id3),
                           SUM (a.x_Id4),
                           SUM (a.x_Id5),
                           SUM (a.x_Sum9),
                           SUM (a.x_Sum10)
                      FROM Tmp_Univ_Rpt_Data a
                     WHERE a.x_Id1 IN (23, 24))
         WHERE x_Id1 = 22;

        UPDATE Tmp_Univ_Rpt_Data
           SET (x_Id2,
                x_Id3,
                x_Id4,
                x_Id5,
                x_Sum9,
                x_Sum10) =
                   (SELECT SUM (a.x_Id2),
                           SUM (a.x_Id3),
                           SUM (a.x_Id4),
                           SUM (a.x_Id5),
                           SUM (a.x_Sum9),
                           SUM (a.x_Sum10)
                      FROM Tmp_Univ_Rpt_Data a
                     WHERE a.x_Id1 IN (26, 27))
         WHERE x_Id1 = 25;

        UPDATE Tmp_Univ_Rpt_Data
           SET (x_Id2,
                x_Id3,
                x_Id4,
                x_Id5,
                x_Sum9,
                x_Sum10) =
                   (SELECT SUM (a.x_Id2),
                           SUM (a.x_Id3),
                           SUM (a.x_Id4),
                           SUM (a.x_Id5),
                           SUM (a.x_Sum9),
                           SUM (a.x_Sum10)
                      FROM Tmp_Univ_Rpt_Data a
                     WHERE a.x_Id1 IN (29, 30))
         WHERE x_Id1 = 28;

        UPDATE Tmp_Univ_Rpt_Data
           SET (x_Id2,
                x_Id3,
                x_Id4,
                x_Id5,
                x_Sum9,
                x_Sum10) =
                   (SELECT SUM (a.x_Id2),
                           SUM (a.x_Id3),
                           SUM (a.x_Id4),
                           SUM (a.x_Id5),
                           SUM (a.x_Sum9),
                           SUM (a.x_Sum10)
                      FROM Tmp_Univ_Rpt_Data a
                     WHERE a.x_Id1 IN (12, 16))
         WHERE x_Id1 = 11;

        --qq
        FOR c IN (SELECT x_sum1,
                         x_sum2,
                         x_sum3,
                         x_sum4,
                         x_sum5,
                         x_sum6,
                         x_sum7,
                         x_sum8
                    FROM tmp_univ_rpt_data a
                   WHERE x_id1 IN (1)                                -- блок 1
                                     )
        LOOP
            SELECT SUM (x_sum9)
              INTO l_sum
              FROM tmp_univ_rpt_data
             WHERE x_id1 IN (2, 7);

            -- ¬изначаЇмо пропорц≥ю ≥нвал≥д≥в з дитинства до д≥тей ≥нвал≥д≥в
            IF NVL (l_sum, 0) > 0
            THEN
                SELECT x_sum9 / l_sum
                  INTO l_prc
                  FROM tmp_univ_rpt_data
                 WHERE x_id1 = 2;
            ELSE
                l_prc := 0;
            END IF;

            UPDATE tmp_univ_rpt_data
               SET x_sum1 = ROUND (c.x_sum1 * l_prc, 2),
                   x_sum2 = ROUND (c.x_sum2 * l_prc, 2),
                   x_sum3 = ROUND (c.x_sum3 * l_prc, 2),
                   x_sum4 = ROUND (c.x_sum4 * l_prc, 2),
                   x_sum5 = ROUND (c.x_sum5 * l_prc, 2),
                   x_sum6 = ROUND (c.x_sum6 * l_prc, 2),
                   x_sum7 = ROUND (c.x_sum7 * l_prc, 2),
                   x_sum8 = ROUND (c.x_sum8 * l_prc, 2)
             WHERE x_id1 = 2;

            UPDATE Tmp_Univ_Rpt_Data
               SET (x_Sum1,
                    x_Sum2,
                    x_Sum3,
                    x_Sum4,
                    x_Sum5,
                    x_Sum6,
                    x_Sum7,
                    x_Sum8) =
                       (SELECT c.x_Sum1 - a.x_Sum1,
                               c.x_Sum2 - a.x_Sum2,
                               c.x_Sum3 - a.x_Sum3,
                               c.x_Sum4 - a.x_Sum4,
                               c.x_Sum5 - a.x_Sum5,
                               c.x_Sum6 - a.x_Sum6,
                               c.x_Sum7 - a.x_Sum7,
                               c.x_Sum8 - a.x_Sum8
                          FROM Tmp_Univ_Rpt_Data a
                         WHERE a.x_Id1 = 2)
             WHERE x_Id1 = 7;
        END LOOP;

        FOR c IN (SELECT x_sum1,
                         x_sum2,
                         x_sum3,
                         x_sum4,
                         x_sum5,
                         x_sum6,
                         x_sum7,
                         x_sum8,
                         x_sum9
                    FROM tmp_univ_rpt_data a
                   WHERE x_id1 = 2                                 -- блок 1.1
                                  )
        LOOP
            UPDATE tmp_univ_rpt_data
               SET x_sum1 =
                       ROUND (
                           CASE
                               WHEN NVL (c.x_sum9, 0) = 0 THEN 0
                               ELSE c.x_sum1 * (x_sum9 / c.x_sum9)
                           END,
                           2),
                   x_sum2 =
                       ROUND (
                           CASE
                               WHEN NVL (c.x_sum9, 0) = 0 THEN 0
                               ELSE c.x_sum2 * (x_sum9 / c.x_sum9)
                           END,
                           2),
                   x_sum3 =
                       ROUND (
                           CASE
                               WHEN NVL (c.x_sum9, 0) = 0 THEN 0
                               ELSE c.x_sum3 * (x_sum9 / c.x_sum9)
                           END,
                           2),
                   x_sum4 =
                       ROUND (
                           CASE
                               WHEN NVL (c.x_sum9, 0) = 0 THEN 0
                               ELSE c.x_sum4 * (x_sum9 / c.x_sum9)
                           END,
                           2),
                   x_sum5 =
                       ROUND (
                           CASE
                               WHEN NVL (c.x_sum9, 0) = 0 THEN 0
                               ELSE c.x_sum5 * (x_sum9 / c.x_sum9)
                           END,
                           2),
                   x_sum6 =
                       ROUND (
                           CASE
                               WHEN NVL (c.x_sum9, 0) = 0 THEN 0
                               ELSE c.x_sum6 * (x_sum9 / c.x_sum9)
                           END,
                           2),
                   x_sum7 =
                       ROUND (
                           CASE
                               WHEN NVL (c.x_sum9, 0) = 0 THEN 0
                               ELSE c.x_sum7 * (x_sum9 / c.x_sum9)
                           END,
                           2),
                   x_sum8 =
                       ROUND (
                           CASE
                               WHEN NVL (c.x_sum9, 0) = 0 THEN 0
                               ELSE c.x_sum8 * (x_sum9 / c.x_sum9)
                           END,
                           2)
             WHERE x_id1 IN (3, 5);

            UPDATE Tmp_Univ_Rpt_Data
               SET (x_Sum1,
                    x_Sum2,
                    x_Sum3,
                    x_Sum4,
                    x_Sum5,
                    x_Sum6,
                    x_Sum7,
                    x_Sum8) =
                       (SELECT c.x_Sum1 - SUM (a.x_Sum1),
                               c.x_Sum2 - SUM (a.x_Sum2),
                               c.x_Sum3 - SUM (a.x_Sum3),
                               c.x_Sum4 - SUM (a.x_Sum4),
                               c.x_Sum5 - SUM (a.x_Sum5),
                               c.x_Sum6 - SUM (a.x_Sum6),
                               c.x_Sum7 - SUM (a.x_Sum7),
                               c.x_Sum8 - SUM (a.x_Sum8)
                          FROM Tmp_Univ_Rpt_Data a
                         WHERE a.x_Id1 IN (3, 5))
             WHERE x_Id1 = 6;

            UPDATE Tmp_Univ_Rpt_Data
               SET (x_Sum1,
                    x_Sum2,
                    x_Sum3,
                    x_Sum4,
                    x_Sum5,
                    x_Sum6,
                    x_Sum7,
                    x_Sum8) =
                       (SELECT ROUND (
                                   CASE
                                       WHEN NVL (a.x_Sum9, 0) = 0 THEN 0
                                       ELSE a.x_Sum1 * (x_Sum9 / a.x_Sum9)
                                   END,
                                   2),
                               ROUND (
                                   CASE
                                       WHEN NVL (a.x_Sum9, 0) = 0 THEN 0
                                       ELSE a.x_Sum2 * (x_Sum9 / a.x_Sum9)
                                   END,
                                   2),
                               ROUND (
                                   CASE
                                       WHEN NVL (a.x_Sum9, 0) = 0 THEN 0
                                       ELSE a.x_Sum3 * (x_Sum9 / a.x_Sum9)
                                   END,
                                   2),
                               ROUND (
                                   CASE
                                       WHEN NVL (a.x_Sum9, 0) = 0 THEN 0
                                       ELSE a.x_Sum4 * (x_Sum9 / a.x_Sum9)
                                   END,
                                   2),
                               ROUND (
                                   CASE
                                       WHEN NVL (a.x_Sum9, 0) = 0 THEN 0
                                       ELSE a.x_Sum5 * (x_Sum9 / a.x_Sum9)
                                   END,
                                   2),
                               ROUND (
                                   CASE
                                       WHEN NVL (a.x_Sum9, 0) = 0 THEN 0
                                       ELSE a.x_Sum6 * (x_Sum9 / a.x_Sum9)
                                   END,
                                   2),
                               ROUND (
                                   CASE
                                       WHEN NVL (a.x_Sum9, 0) = 0 THEN 0
                                       ELSE a.x_Sum7 * (x_Sum9 / a.x_Sum9)
                                   END,
                                   2),
                               ROUND (
                                   CASE
                                       WHEN NVL (a.x_Sum9, 0) = 0 THEN 0
                                       ELSE a.x_Sum8 * (x_Sum9 / a.x_Sum9)
                                   END,
                                   2)
                          FROM Tmp_Univ_Rpt_Data a
                         WHERE a.x_Id1 = 3)
             WHERE x_Id1 = 4;
        END LOOP;

        FOR c IN (SELECT x_sum1,
                         x_sum2,
                         x_sum3,
                         x_sum4,
                         x_sum5,
                         x_sum6,
                         x_sum7,
                         x_sum8,
                         x_sum9
                    FROM tmp_univ_rpt_data a
                   WHERE x_id1 = 7                                 -- блок 1.2
                                  )
        LOOP
            UPDATE tmp_univ_rpt_data
               SET x_sum1 =
                       ROUND (
                           CASE
                               WHEN NVL (c.x_sum9, 0) = 0 THEN 0
                               ELSE c.x_sum1 * (x_sum9 / c.x_sum9)
                           END,
                           2),
                   x_sum2 =
                       ROUND (
                           CASE
                               WHEN NVL (c.x_sum9, 0) = 0 THEN 0
                               ELSE c.x_sum2 * (x_sum9 / c.x_sum9)
                           END,
                           2),
                   x_sum3 =
                       ROUND (
                           CASE
                               WHEN NVL (c.x_sum9, 0) = 0 THEN 0
                               ELSE c.x_sum3 * (x_sum9 / c.x_sum9)
                           END,
                           2),
                   x_sum4 =
                       ROUND (
                           CASE
                               WHEN NVL (c.x_sum9, 0) = 0 THEN 0
                               ELSE c.x_sum4 * (x_sum9 / c.x_sum9)
                           END,
                           2),
                   x_sum5 =
                       ROUND (
                           CASE
                               WHEN NVL (c.x_sum9, 0) = 0 THEN 0
                               ELSE c.x_sum5 * (x_sum9 / c.x_sum9)
                           END,
                           2),
                   x_sum6 =
                       ROUND (
                           CASE
                               WHEN NVL (c.x_sum9, 0) = 0 THEN 0
                               ELSE c.x_sum6 * (x_sum9 / c.x_sum9)
                           END,
                           2),
                   x_sum7 =
                       ROUND (
                           CASE
                               WHEN NVL (c.x_sum9, 0) = 0 THEN 0
                               ELSE c.x_sum7 * (x_sum9 / c.x_sum9)
                           END,
                           2),
                   x_sum8 =
                       ROUND (
                           CASE
                               WHEN NVL (c.x_sum9, 0) = 0 THEN 0
                               ELSE c.x_sum8 * (x_sum9 / c.x_sum9)
                           END,
                           2)
             WHERE x_id1 IN (8, 9, 10);
        END LOOP;

        FOR c IN (SELECT x_sum1,
                         x_sum2,
                         x_sum3,
                         x_sum4,
                         x_sum5,
                         x_sum6,
                         x_sum7,
                         x_sum8
                    FROM tmp_univ_rpt_data a
                   WHERE x_id1 IN (11)                               -- блок 2
                                      )
        LOOP
            SELECT SUM (x_sum9)
              INTO l_sum
              FROM tmp_univ_rpt_data
             WHERE x_id1 IN (12, 16);

            -- ¬изначаЇмо пропорц≥ю ≥нвал≥д≥в з дитинства до д≥тей ≥нвал≥д≥в
            IF NVL (l_sum, 0) > 0
            THEN
                SELECT x_sum9 / l_sum
                  INTO l_prc
                  FROM tmp_univ_rpt_data
                 WHERE x_id1 = 12;
            ELSE
                l_prc := 0;
            END IF;

            UPDATE tmp_univ_rpt_data
               SET x_sum1 = ROUND (c.x_sum1 * l_prc, 2),
                   x_sum2 = ROUND (c.x_sum2 * l_prc, 2),
                   x_sum3 = ROUND (c.x_sum3 * l_prc, 2),
                   x_sum4 = ROUND (c.x_sum4 * l_prc, 2),
                   x_sum5 = ROUND (c.x_sum5 * l_prc, 2),
                   x_sum6 = ROUND (c.x_sum6 * l_prc, 2),
                   x_sum7 = ROUND (c.x_sum7 * l_prc, 2),
                   x_sum8 = ROUND (c.x_sum8 * l_prc, 2)
             WHERE x_id1 = 12;

            UPDATE Tmp_Univ_Rpt_Data
               SET (x_Sum1,
                    x_Sum2,
                    x_Sum3,
                    x_Sum4,
                    x_Sum5,
                    x_Sum6,
                    x_Sum7,
                    x_Sum8) =
                       (SELECT c.x_Sum1 - a.x_Sum1,
                               c.x_Sum2 - a.x_Sum2,
                               c.x_Sum3 - a.x_Sum3,
                               c.x_Sum4 - a.x_Sum4,
                               c.x_Sum5 - a.x_Sum5,
                               c.x_Sum6 - a.x_Sum6,
                               c.x_Sum7 - a.x_Sum7,
                               c.x_Sum8 - a.x_Sum8
                          FROM Tmp_Univ_Rpt_Data a
                         WHERE a.x_Id1 = 12)
             WHERE x_Id1 = 16;
        END LOOP;

        FOR c IN (SELECT x_sum1,
                         x_sum2,
                         x_sum3,
                         x_sum4,
                         x_sum5,
                         x_sum6,
                         x_sum7,
                         x_sum8,
                         x_sum9
                    FROM tmp_univ_rpt_data a
                   WHERE x_id1 = 12                                -- блок 2.1
                                   )
        LOOP
            UPDATE tmp_univ_rpt_data
               SET x_sum1 =
                       ROUND (
                           CASE
                               WHEN NVL (c.x_sum9, 0) = 0 THEN 0
                               ELSE c.x_sum1 * (x_sum9 / c.x_sum9)
                           END,
                           2),
                   x_sum2 =
                       ROUND (
                           CASE
                               WHEN NVL (c.x_sum9, 0) = 0 THEN 0
                               ELSE c.x_sum2 * (x_sum9 / c.x_sum9)
                           END,
                           2),
                   x_sum3 =
                       ROUND (
                           CASE
                               WHEN NVL (c.x_sum9, 0) = 0 THEN 0
                               ELSE c.x_sum3 * (x_sum9 / c.x_sum9)
                           END,
                           2),
                   x_sum4 =
                       ROUND (
                           CASE
                               WHEN NVL (c.x_sum9, 0) = 0 THEN 0
                               ELSE c.x_sum4 * (x_sum9 / c.x_sum9)
                           END,
                           2),
                   x_sum5 =
                       ROUND (
                           CASE
                               WHEN NVL (c.x_sum9, 0) = 0 THEN 0
                               ELSE c.x_sum5 * (x_sum9 / c.x_sum9)
                           END,
                           2),
                   x_sum6 =
                       ROUND (
                           CASE
                               WHEN NVL (c.x_sum9, 0) = 0 THEN 0
                               ELSE c.x_sum6 * (x_sum9 / c.x_sum9)
                           END,
                           2),
                   x_sum7 =
                       ROUND (
                           CASE
                               WHEN NVL (c.x_sum9, 0) = 0 THEN 0
                               ELSE c.x_sum7 * (x_sum9 / c.x_sum9)
                           END,
                           2),
                   x_sum8 =
                       ROUND (
                           CASE
                               WHEN NVL (c.x_sum9, 0) = 0 THEN 0
                               ELSE c.x_sum8 * (x_sum9 / c.x_sum9)
                           END,
                           2)
             WHERE x_id1 IN (13, 14);

            UPDATE Tmp_Univ_Rpt_Data
               SET (x_Sum1,
                    x_Sum2,
                    x_Sum3,
                    x_Sum4,
                    x_Sum5,
                    x_Sum6,
                    x_Sum7,
                    x_Sum8) =
                       (SELECT c.x_Sum1 - SUM (a.x_Sum1),
                               c.x_Sum2 - SUM (a.x_Sum2),
                               c.x_Sum3 - SUM (a.x_Sum3),
                               c.x_Sum4 - SUM (a.x_Sum4),
                               c.x_Sum5 - SUM (a.x_Sum5),
                               c.x_Sum6 - SUM (a.x_Sum6),
                               c.x_Sum7 - SUM (a.x_Sum7),
                               c.x_Sum8 - SUM (a.x_Sum8)
                          FROM Tmp_Univ_Rpt_Data a
                         WHERE a.x_Id1 IN (13, 14))
             WHERE x_Id1 = 15;
        END LOOP;

        FOR c IN (SELECT x_sum1,
                         x_sum2,
                         x_sum3,
                         x_sum4,
                         x_sum5,
                         x_sum6,
                         x_sum7,
                         x_sum8,
                         x_sum9
                    FROM tmp_univ_rpt_data a
                   WHERE x_id1 = 16                                -- блок 2.2
                                   )
        LOOP
            UPDATE tmp_univ_rpt_data
               SET x_sum1 =
                       ROUND (
                           CASE
                               WHEN NVL (c.x_sum9, 0) = 0 THEN 0
                               ELSE c.x_sum1 * (x_sum9 / c.x_sum9)
                           END,
                           2),
                   x_sum2 =
                       ROUND (
                           CASE
                               WHEN NVL (c.x_sum9, 0) = 0 THEN 0
                               ELSE c.x_sum2 * (x_sum9 / c.x_sum9)
                           END,
                           2),
                   x_sum3 =
                       ROUND (
                           CASE
                               WHEN NVL (c.x_sum9, 0) = 0 THEN 0
                               ELSE c.x_sum3 * (x_sum9 / c.x_sum9)
                           END,
                           2),
                   x_sum4 =
                       ROUND (
                           CASE
                               WHEN NVL (c.x_sum9, 0) = 0 THEN 0
                               ELSE c.x_sum4 * (x_sum9 / c.x_sum9)
                           END,
                           2),
                   x_sum5 =
                       ROUND (
                           CASE
                               WHEN NVL (c.x_sum9, 0) = 0 THEN 0
                               ELSE c.x_sum5 * (x_sum9 / c.x_sum9)
                           END,
                           2),
                   x_sum6 =
                       ROUND (
                           CASE
                               WHEN NVL (c.x_sum9, 0) = 0 THEN 0
                               ELSE c.x_sum6 * (x_sum9 / c.x_sum9)
                           END,
                           2),
                   x_sum7 =
                       ROUND (
                           CASE
                               WHEN NVL (c.x_sum9, 0) = 0 THEN 0
                               ELSE c.x_sum7 * (x_sum9 / c.x_sum9)
                           END,
                           2),
                   x_sum8 =
                       ROUND (
                           CASE
                               WHEN NVL (c.x_sum9, 0) = 0 THEN 0
                               ELSE c.x_sum8 * (x_sum9 / c.x_sum9)
                           END,
                           2)
             WHERE x_id1 IN (17);

            UPDATE Tmp_Univ_Rpt_Data
               SET (x_Sum1,
                    x_Sum2,
                    x_Sum3,
                    x_Sum4,
                    x_Sum5,
                    x_Sum6,
                    x_Sum7,
                    x_Sum8) =
                       (SELECT c.x_Sum1 - SUM (a.x_Sum1),
                               c.x_Sum2 - SUM (a.x_Sum2),
                               c.x_Sum3 - SUM (a.x_Sum3),
                               c.x_Sum4 - SUM (a.x_Sum4),
                               c.x_Sum5 - SUM (a.x_Sum5),
                               c.x_Sum6 - SUM (a.x_Sum6),
                               c.x_Sum7 - SUM (a.x_Sum7),
                               c.x_Sum8 - SUM (a.x_Sum8)
                          FROM Tmp_Univ_Rpt_Data a
                         WHERE a.x_Id1 IN (17))
             WHERE x_Id1 = 18;

            UPDATE tmp_univ_rpt_data
               SET x_sum1 =
                       ROUND (
                           CASE
                               WHEN NVL (c.x_sum9, 0) = 0 THEN 0
                               ELSE c.x_sum1 * (x_sum9 / c.x_sum9)
                           END,
                           2),
                   x_sum2 =
                       ROUND (
                           CASE
                               WHEN NVL (c.x_sum9, 0) = 0 THEN 0
                               ELSE c.x_sum2 * (x_sum9 / c.x_sum9)
                           END,
                           2),
                   x_sum3 =
                       ROUND (
                           CASE
                               WHEN NVL (c.x_sum9, 0) = 0 THEN 0
                               ELSE c.x_sum3 * (x_sum9 / c.x_sum9)
                           END,
                           2),
                   x_sum4 =
                       ROUND (
                           CASE
                               WHEN NVL (c.x_sum9, 0) = 0 THEN 0
                               ELSE c.x_sum4 * (x_sum9 / c.x_sum9)
                           END,
                           2),
                   x_sum5 =
                       ROUND (
                           CASE
                               WHEN NVL (c.x_sum9, 0) = 0 THEN 0
                               ELSE c.x_sum5 * (x_sum9 / c.x_sum9)
                           END,
                           2),
                   x_sum6 =
                       ROUND (
                           CASE
                               WHEN NVL (c.x_sum9, 0) = 0 THEN 0
                               ELSE c.x_sum6 * (x_sum9 / c.x_sum9)
                           END,
                           2),
                   x_sum7 =
                       ROUND (
                           CASE
                               WHEN NVL (c.x_sum9, 0) = 0 THEN 0
                               ELSE c.x_sum7 * (x_sum9 / c.x_sum9)
                           END,
                           2),
                   x_sum8 =
                       ROUND (
                           CASE
                               WHEN NVL (c.x_sum9, 0) = 0 THEN 0
                               ELSE c.x_sum8 * (x_sum9 / c.x_sum9)
                           END,
                           2)
             WHERE x_id1 = 19;

            SELECT *
              INTO l_tmp
              FROM tmp_univ_rpt_data
             WHERE x_id1 = 19;

            UPDATE tmp_univ_rpt_data
               SET x_sum1 =
                       ROUND (
                           CASE
                               WHEN NVL (l_tmp.x_sum9, 0) = 0 THEN 0
                               ELSE l_tmp.x_sum1 * (x_sum9 / l_tmp.x_sum9)
                           END,
                           2),
                   x_sum2 =
                       ROUND (
                           CASE
                               WHEN NVL (l_tmp.x_sum9, 0) = 0 THEN 0
                               ELSE l_tmp.x_sum2 * (x_sum9 / l_tmp.x_sum9)
                           END,
                           2),
                   x_sum3 =
                       ROUND (
                           CASE
                               WHEN NVL (l_tmp.x_sum9, 0) = 0 THEN 0
                               ELSE l_tmp.x_sum3 * (x_sum9 / l_tmp.x_sum9)
                           END,
                           2),
                   x_sum4 =
                       ROUND (
                           CASE
                               WHEN NVL (l_tmp.x_sum9, 0) = 0 THEN 0
                               ELSE l_tmp.x_sum4 * (x_sum9 / l_tmp.x_sum9)
                           END,
                           2),
                   x_sum5 =
                       ROUND (
                           CASE
                               WHEN NVL (l_tmp.x_sum9, 0) = 0 THEN 0
                               ELSE l_tmp.x_sum5 * (x_sum9 / l_tmp.x_sum9)
                           END,
                           2),
                   x_sum6 =
                       ROUND (
                           CASE
                               WHEN NVL (l_tmp.x_sum9, 0) = 0 THEN 0
                               ELSE l_tmp.x_sum6 * (x_sum9 / l_tmp.x_sum9)
                           END,
                           2),
                   x_sum7 =
                       ROUND (
                           CASE
                               WHEN NVL (l_tmp.x_sum9, 0) = 0 THEN 0
                               ELSE l_tmp.x_sum7 * (x_sum9 / l_tmp.x_sum9)
                           END,
                           2),
                   x_sum8 =
                       ROUND (
                           CASE
                               WHEN NVL (l_tmp.x_sum9, 0) = 0 THEN 0
                               ELSE l_tmp.x_sum8 * (x_sum9 / l_tmp.x_sum9)
                           END,
                           2)
             WHERE x_id1 = 20;

            UPDATE Tmp_Univ_Rpt_Data
               SET (x_Sum1,
                    x_Sum2,
                    x_Sum3,
                    x_Sum4,
                    x_Sum5,
                    x_Sum6,
                    x_Sum7,
                    x_Sum8) =
                       (SELECT l_Tmp.x_Sum1 - SUM (a.x_Sum1),
                               l_Tmp.x_Sum2 - SUM (a.x_Sum2),
                               l_Tmp.x_Sum3 - SUM (a.x_Sum3),
                               l_Tmp.x_Sum4 - SUM (a.x_Sum4),
                               l_Tmp.x_Sum5 - SUM (a.x_Sum5),
                               l_Tmp.x_Sum6 - SUM (a.x_Sum6),
                               l_Tmp.x_Sum7 - SUM (a.x_Sum7),
                               l_Tmp.x_Sum8 - SUM (a.x_Sum8)
                          FROM Tmp_Univ_Rpt_Data a
                         WHERE a.x_Id1 IN (20))
             WHERE x_Id1 = 21;

            UPDATE tmp_univ_rpt_data
               SET x_sum1 =
                       ROUND (
                           CASE
                               WHEN NVL (c.x_sum9, 0) = 0 THEN 0
                               ELSE c.x_sum1 * (x_sum9 / c.x_sum9)
                           END,
                           2),
                   x_sum2 =
                       ROUND (
                           CASE
                               WHEN NVL (c.x_sum9, 0) = 0 THEN 0
                               ELSE c.x_sum2 * (x_sum9 / c.x_sum9)
                           END,
                           2),
                   x_sum3 =
                       ROUND (
                           CASE
                               WHEN NVL (c.x_sum9, 0) = 0 THEN 0
                               ELSE c.x_sum3 * (x_sum9 / c.x_sum9)
                           END,
                           2),
                   x_sum4 =
                       ROUND (
                           CASE
                               WHEN NVL (c.x_sum9, 0) = 0 THEN 0
                               ELSE c.x_sum4 * (x_sum9 / c.x_sum9)
                           END,
                           2),
                   x_sum5 =
                       ROUND (
                           CASE
                               WHEN NVL (c.x_sum9, 0) = 0 THEN 0
                               ELSE c.x_sum5 * (x_sum9 / c.x_sum9)
                           END,
                           2),
                   x_sum6 =
                       ROUND (
                           CASE
                               WHEN NVL (c.x_sum9, 0) = 0 THEN 0
                               ELSE c.x_sum6 * (x_sum9 / c.x_sum9)
                           END,
                           2),
                   x_sum7 =
                       ROUND (
                           CASE
                               WHEN NVL (c.x_sum9, 0) = 0 THEN 0
                               ELSE c.x_sum7 * (x_sum9 / c.x_sum9)
                           END,
                           2),
                   x_sum8 =
                       ROUND (
                           CASE
                               WHEN NVL (c.x_sum9, 0) = 0 THEN 0
                               ELSE c.x_sum8 * (x_sum9 / c.x_sum9)
                           END,
                           2)
             WHERE x_id1 = 22;

            SELECT *
              INTO l_tmp
              FROM tmp_univ_rpt_data
             WHERE x_id1 = 22;

            UPDATE tmp_univ_rpt_data
               SET x_sum1 =
                       ROUND (
                           CASE
                               WHEN NVL (l_tmp.x_sum9, 0) = 0 THEN 0
                               ELSE l_tmp.x_sum1 * (x_sum9 / l_tmp.x_sum9)
                           END,
                           2),
                   x_sum2 =
                       ROUND (
                           CASE
                               WHEN NVL (l_tmp.x_sum9, 0) = 0 THEN 0
                               ELSE l_tmp.x_sum2 * (x_sum9 / l_tmp.x_sum9)
                           END,
                           2),
                   x_sum3 =
                       ROUND (
                           CASE
                               WHEN NVL (l_tmp.x_sum9, 0) = 0 THEN 0
                               ELSE l_tmp.x_sum3 * (x_sum9 / l_tmp.x_sum9)
                           END,
                           2),
                   x_sum4 =
                       ROUND (
                           CASE
                               WHEN NVL (l_tmp.x_sum9, 0) = 0 THEN 0
                               ELSE l_tmp.x_sum4 * (x_sum9 / l_tmp.x_sum9)
                           END,
                           2),
                   x_sum5 =
                       ROUND (
                           CASE
                               WHEN NVL (l_tmp.x_sum9, 0) = 0 THEN 0
                               ELSE l_tmp.x_sum5 * (x_sum9 / l_tmp.x_sum9)
                           END,
                           2),
                   x_sum6 =
                       ROUND (
                           CASE
                               WHEN NVL (l_tmp.x_sum9, 0) = 0 THEN 0
                               ELSE l_tmp.x_sum6 * (x_sum9 / l_tmp.x_sum9)
                           END,
                           2),
                   x_sum7 =
                       ROUND (
                           CASE
                               WHEN NVL (l_tmp.x_sum9, 0) = 0 THEN 0
                               ELSE l_tmp.x_sum7 * (x_sum9 / l_tmp.x_sum9)
                           END,
                           2),
                   x_sum8 =
                       ROUND (
                           CASE
                               WHEN NVL (l_tmp.x_sum9, 0) = 0 THEN 0
                               ELSE l_tmp.x_sum8 * (x_sum9 / l_tmp.x_sum9)
                           END,
                           2)
             WHERE x_id1 = 23;

            UPDATE Tmp_Univ_Rpt_Data
               SET (x_Sum1,
                    x_Sum2,
                    x_Sum3,
                    x_Sum4,
                    x_Sum5,
                    x_Sum6,
                    x_Sum7,
                    x_Sum8) =
                       (SELECT l_Tmp.x_Sum1 - SUM (a.x_Sum1),
                               l_Tmp.x_Sum2 - SUM (a.x_Sum2),
                               l_Tmp.x_Sum3 - SUM (a.x_Sum3),
                               l_Tmp.x_Sum4 - SUM (a.x_Sum4),
                               l_Tmp.x_Sum5 - SUM (a.x_Sum5),
                               l_Tmp.x_Sum6 - SUM (a.x_Sum6),
                               l_Tmp.x_Sum7 - SUM (a.x_Sum7),
                               l_Tmp.x_Sum8 - SUM (a.x_Sum8)
                          FROM Tmp_Univ_Rpt_Data a
                         WHERE a.x_Id1 IN (23))
             WHERE x_Id1 = 24;

            UPDATE tmp_univ_rpt_data
               SET x_sum1 =
                       ROUND (
                           CASE
                               WHEN NVL (l_tmp.x_sum9, 0) = 0 THEN 0
                               ELSE l_tmp.x_sum1 * (x_sum9 / l_tmp.x_sum9)
                           END,
                           2),
                   x_sum2 =
                       ROUND (
                           CASE
                               WHEN NVL (l_tmp.x_sum9, 0) = 0 THEN 0
                               ELSE l_tmp.x_sum2 * (x_sum9 / l_tmp.x_sum9)
                           END,
                           2),
                   x_sum3 =
                       ROUND (
                           CASE
                               WHEN NVL (l_tmp.x_sum9, 0) = 0 THEN 0
                               ELSE l_tmp.x_sum3 * (x_sum9 / l_tmp.x_sum9)
                           END,
                           2),
                   x_sum4 =
                       ROUND (
                           CASE
                               WHEN NVL (l_tmp.x_sum9, 0) = 0 THEN 0
                               ELSE l_tmp.x_sum4 * (x_sum9 / l_tmp.x_sum9)
                           END,
                           2),
                   x_sum5 =
                       ROUND (
                           CASE
                               WHEN NVL (l_tmp.x_sum9, 0) = 0 THEN 0
                               ELSE l_tmp.x_sum5 * (x_sum9 / l_tmp.x_sum9)
                           END,
                           2),
                   x_sum6 =
                       ROUND (
                           CASE
                               WHEN NVL (l_tmp.x_sum9, 0) = 0 THEN 0
                               ELSE l_tmp.x_sum6 * (x_sum9 / l_tmp.x_sum9)
                           END,
                           2),
                   x_sum7 =
                       ROUND (
                           CASE
                               WHEN NVL (l_tmp.x_sum9, 0) = 0 THEN 0
                               ELSE l_tmp.x_sum7 * (x_sum9 / l_tmp.x_sum9)
                           END,
                           2),
                   x_sum8 =
                       ROUND (
                           CASE
                               WHEN NVL (l_tmp.x_sum9, 0) = 0 THEN 0
                               ELSE l_tmp.x_sum8 * (x_sum9 / l_tmp.x_sum9)
                           END,
                           2)
             WHERE x_id1 = 25;

            SELECT *
              INTO l_tmp
              FROM tmp_univ_rpt_data
             WHERE x_id1 = 25;

            UPDATE tmp_univ_rpt_data
               SET x_sum1 =
                       ROUND (
                           CASE
                               WHEN NVL (l_tmp.x_sum9, 0) = 0 THEN 0
                               ELSE l_tmp.x_sum1 * (x_sum9 / l_tmp.x_sum9)
                           END,
                           2),
                   x_sum2 =
                       ROUND (
                           CASE
                               WHEN NVL (l_tmp.x_sum9, 0) = 0 THEN 0
                               ELSE l_tmp.x_sum2 * (x_sum9 / l_tmp.x_sum9)
                           END,
                           2),
                   x_sum3 =
                       ROUND (
                           CASE
                               WHEN NVL (l_tmp.x_sum9, 0) = 0 THEN 0
                               ELSE l_tmp.x_sum3 * (x_sum9 / l_tmp.x_sum9)
                           END,
                           2),
                   x_sum4 =
                       ROUND (
                           CASE
                               WHEN NVL (l_tmp.x_sum9, 0) = 0 THEN 0
                               ELSE l_tmp.x_sum4 * (x_sum9 / l_tmp.x_sum9)
                           END,
                           2),
                   x_sum5 =
                       ROUND (
                           CASE
                               WHEN NVL (l_tmp.x_sum9, 0) = 0 THEN 0
                               ELSE l_tmp.x_sum5 * (x_sum9 / l_tmp.x_sum9)
                           END,
                           2),
                   x_sum6 =
                       ROUND (
                           CASE
                               WHEN NVL (l_tmp.x_sum9, 0) = 0 THEN 0
                               ELSE l_tmp.x_sum6 * (x_sum9 / l_tmp.x_sum9)
                           END,
                           2),
                   x_sum7 =
                       ROUND (
                           CASE
                               WHEN NVL (l_tmp.x_sum9, 0) = 0 THEN 0
                               ELSE l_tmp.x_sum7 * (x_sum9 / l_tmp.x_sum9)
                           END,
                           2),
                   x_sum8 =
                       ROUND (
                           CASE
                               WHEN NVL (l_tmp.x_sum9, 0) = 0 THEN 0
                               ELSE l_tmp.x_sum8 * (x_sum9 / l_tmp.x_sum9)
                           END,
                           2)
             WHERE x_id1 = 26;

            UPDATE Tmp_Univ_Rpt_Data
               SET (x_Sum1,
                    x_Sum2,
                    x_Sum3,
                    x_Sum4,
                    x_Sum5,
                    x_Sum6,
                    x_Sum7,
                    x_Sum8) =
                       (SELECT l_Tmp.x_Sum1 - SUM (a.x_Sum1),
                               l_Tmp.x_Sum2 - SUM (a.x_Sum2),
                               l_Tmp.x_Sum3 - SUM (a.x_Sum3),
                               l_Tmp.x_Sum4 - SUM (a.x_Sum4),
                               l_Tmp.x_Sum5 - SUM (a.x_Sum5),
                               l_Tmp.x_Sum6 - SUM (a.x_Sum6),
                               l_Tmp.x_Sum7 - SUM (a.x_Sum7),
                               l_Tmp.x_Sum8 - SUM (a.x_Sum8)
                          FROM Tmp_Univ_Rpt_Data a
                         WHERE a.x_Id1 IN (26))
             WHERE x_Id1 = 27;

            UPDATE tmp_univ_rpt_data
               SET x_sum1 =
                       ROUND (
                           CASE
                               WHEN NVL (c.x_sum9, 0) = 0 THEN 0
                               ELSE c.x_sum1 * (x_sum9 / c.x_sum9)
                           END,
                           2),
                   x_sum2 =
                       ROUND (
                           CASE
                               WHEN NVL (c.x_sum9, 0) = 0 THEN 0
                               ELSE c.x_sum2 * (x_sum9 / c.x_sum9)
                           END,
                           2),
                   x_sum3 =
                       ROUND (
                           CASE
                               WHEN NVL (c.x_sum9, 0) = 0 THEN 0
                               ELSE c.x_sum3 * (x_sum9 / c.x_sum9)
                           END,
                           2),
                   x_sum4 =
                       ROUND (
                           CASE
                               WHEN NVL (c.x_sum9, 0) = 0 THEN 0
                               ELSE c.x_sum4 * (x_sum9 / c.x_sum9)
                           END,
                           2),
                   x_sum5 =
                       ROUND (
                           CASE
                               WHEN NVL (c.x_sum9, 0) = 0 THEN 0
                               ELSE c.x_sum5 * (x_sum9 / c.x_sum9)
                           END,
                           2),
                   x_sum6 =
                       ROUND (
                           CASE
                               WHEN NVL (c.x_sum9, 0) = 0 THEN 0
                               ELSE c.x_sum6 * (x_sum9 / c.x_sum9)
                           END,
                           2),
                   x_sum7 =
                       ROUND (
                           CASE
                               WHEN NVL (c.x_sum9, 0) = 0 THEN 0
                               ELSE c.x_sum7 * (x_sum9 / c.x_sum9)
                           END,
                           2),
                   x_sum8 =
                       ROUND (
                           CASE
                               WHEN NVL (c.x_sum9, 0) = 0 THEN 0
                               ELSE c.x_sum8 * (x_sum9 / c.x_sum9)
                           END,
                           2)
             WHERE x_id1 = 28;

            SELECT *
              INTO l_tmp
              FROM tmp_univ_rpt_data
             WHERE x_id1 = 28;

            UPDATE tmp_univ_rpt_data
               SET x_sum1 =
                       ROUND (
                           CASE
                               WHEN NVL (l_tmp.x_sum9, 0) = 0 THEN 0
                               ELSE l_tmp.x_sum1 * (x_sum9 / l_tmp.x_sum9)
                           END,
                           2),
                   x_sum2 =
                       ROUND (
                           CASE
                               WHEN NVL (l_tmp.x_sum9, 0) = 0 THEN 0
                               ELSE l_tmp.x_sum2 * (x_sum9 / l_tmp.x_sum9)
                           END,
                           2),
                   x_sum3 =
                       ROUND (
                           CASE
                               WHEN NVL (l_tmp.x_sum9, 0) = 0 THEN 0
                               ELSE l_tmp.x_sum3 * (x_sum9 / l_tmp.x_sum9)
                           END,
                           2),
                   x_sum4 =
                       ROUND (
                           CASE
                               WHEN NVL (l_tmp.x_sum9, 0) = 0 THEN 0
                               ELSE l_tmp.x_sum4 * (x_sum9 / l_tmp.x_sum9)
                           END,
                           2),
                   x_sum5 =
                       ROUND (
                           CASE
                               WHEN NVL (l_tmp.x_sum9, 0) = 0 THEN 0
                               ELSE l_tmp.x_sum5 * (x_sum9 / l_tmp.x_sum9)
                           END,
                           2),
                   x_sum6 =
                       ROUND (
                           CASE
                               WHEN NVL (l_tmp.x_sum9, 0) = 0 THEN 0
                               ELSE l_tmp.x_sum6 * (x_sum9 / l_tmp.x_sum9)
                           END,
                           2),
                   x_sum7 =
                       ROUND (
                           CASE
                               WHEN NVL (l_tmp.x_sum9, 0) = 0 THEN 0
                               ELSE l_tmp.x_sum7 * (x_sum9 / l_tmp.x_sum9)
                           END,
                           2),
                   x_sum8 =
                       ROUND (
                           CASE
                               WHEN NVL (l_tmp.x_sum9, 0) = 0 THEN 0
                               ELSE l_tmp.x_sum8 * (x_sum9 / l_tmp.x_sum9)
                           END,
                           2)
             WHERE x_id1 = 29;

            UPDATE Tmp_Univ_Rpt_Data
               SET (x_Sum1,
                    x_Sum2,
                    x_Sum3,
                    x_Sum4,
                    x_Sum5,
                    x_Sum6,
                    x_Sum7,
                    x_Sum8) =
                       (SELECT l_Tmp.x_Sum1 - SUM (a.x_Sum1),
                               l_Tmp.x_Sum2 - SUM (a.x_Sum2),
                               l_Tmp.x_Sum3 - SUM (a.x_Sum3),
                               l_Tmp.x_Sum4 - SUM (a.x_Sum4),
                               l_Tmp.x_Sum5 - SUM (a.x_Sum5),
                               l_Tmp.x_Sum6 - SUM (a.x_Sum6),
                               l_Tmp.x_Sum7 - SUM (a.x_Sum7),
                               l_Tmp.x_Sum8 - SUM (a.x_Sum8)
                          FROM Tmp_Univ_Rpt_Data a
                         WHERE a.x_Id1 IN (29))
             WHERE x_Id1 = 30;
        END LOOP;                                                  -- блок 2.2

        --qq3
        UPDATE tmp_univ_rpt_data
           SET x_string2 =
                      '
   <Row ss:AutoFitHeight="0" ss:Height="34.199999999999996">
    <Cell ss:StyleID="s160"><Data ss:Type="String">'
                   || x_string1
                   || '</Data></Cell>
    <Cell ss:StyleID="s161"><Data ss:Type="String">'
                   || x_id1
                   || '</Data></Cell>
    <Cell ss:StyleID="s162"><Data ss:Type="Number">'
                   || x_id2
                   || '</Data></Cell>
    <Cell ss:StyleID="s163"><Data ss:Type="Number">'
                   || x_id3
                   || '</Data></Cell>
    <Cell ss:StyleID="s163"><Data ss:Type="Number">'
                   || x_id4
                   || '</Data></Cell>
    <Cell ss:StyleID="s164"><Data ss:Type="Number">'
                   || x_id5
                   || '</Data></Cell>
    <Cell ss:StyleID="s165"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum1, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s166"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum2, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s165"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum3, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s167"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum4, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s168"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum5, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s165"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum6, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s168"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum7, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s169"><Data ss:Type="Number"></Data></Cell>
    <Cell ss:StyleID="s167"><Data ss:Type="Number"></Data></Cell>
    <Cell ss:StyleID="s168"><Data ss:Type="Number"></Data></Cell>
   </Row>'
         WHERE x_id1 = 1;

        UPDATE tmp_univ_rpt_data
           SET x_string2 =
                      '
   <Row ss:AutoFitHeight="0" ss:Height="31.799999999999997">
    <Cell ss:StyleID="s170"><Data ss:Type="String">'
                   || x_string1
                   || '</Data></Cell>
    <Cell ss:StyleID="s171"><Data ss:Type="String">'
                   || x_id1
                   || '</Data></Cell>
    <Cell ss:StyleID="s172"><Data ss:Type="Number">'
                   || x_id2
                   || '</Data></Cell>
    <Cell ss:StyleID="s173"><Data ss:Type="Number">'
                   || x_id3
                   || '</Data></Cell>
    <Cell ss:StyleID="s173"><Data ss:Type="Number">'
                   || x_id4
                   || '</Data></Cell>
    <Cell ss:StyleID="s174"><Data ss:Type="Number">'
                   || x_id5
                   || '</Data></Cell>
    <Cell ss:StyleID="s175"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum1, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s176"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum2, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s175"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum3, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s177"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum4, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s178"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum5, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s175"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum6, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s178"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum7, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s179"><Data ss:Type="Number"></Data></Cell>
    <Cell ss:StyleID="s177"><Data ss:Type="Number"></Data></Cell>
    <Cell ss:StyleID="s178"><Data ss:Type="Number"></Data></Cell>
   </Row>'
         WHERE x_id1 = 2;

        UPDATE tmp_univ_rpt_data
           SET x_string2 =
                      '
   <Row ss:AutoFitHeight="0">
    <Cell ss:StyleID="s180"><Data ss:Type="String">'
                   || x_string1
                   || '</Data></Cell>
    <Cell ss:StyleID="s171"><Data ss:Type="String">'
                   || x_id1
                   || '</Data></Cell>
    <Cell ss:StyleID="s181"><Data ss:Type="Number">'
                   || x_id2
                   || '</Data></Cell>
    <Cell ss:StyleID="s182"><Data ss:Type="Number">'
                   || x_id3
                   || '</Data></Cell>
    <Cell ss:StyleID="s182"><Data ss:Type="Number">'
                   || x_id4
                   || '</Data></Cell>
    <Cell ss:StyleID="s183"><Data ss:Type="Number">'
                   || x_id5
                   || '</Data></Cell>
    <Cell ss:StyleID="s184"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum1, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s185"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum2, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s184"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum3, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s186"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum4, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s187"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum5, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s188"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum6, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s187"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum7, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s189"><Data ss:Type="Number"></Data></Cell>
    <Cell ss:StyleID="s186"><Data ss:Type="Number"></Data></Cell>
    <Cell ss:StyleID="s187"><Data ss:Type="Number"></Data></Cell>
   </Row>'
         WHERE x_id1 = 3;

        UPDATE tmp_univ_rpt_data
           SET x_string2 =
                      '
   <Row ss:AutoFitHeight="0">
    <Cell ss:StyleID="s190"><ss:Data ss:Type="String"
      xmlns="http://www.w3.org/TR/REC-html40">'
                   || x_string1
                   || '</ss:Data></Cell>
    <Cell ss:StyleID="s171"><Data ss:Type="String">'
                   || x_id1
                   || '</Data></Cell>
    <Cell ss:StyleID="s181"><Data ss:Type="Number">'
                   || x_id2
                   || '</Data></Cell>
    <Cell ss:StyleID="s182"><Data ss:Type="Number">'
                   || x_id3
                   || '</Data></Cell>
    <Cell ss:StyleID="s182"><Data ss:Type="Number">'
                   || x_id4
                   || '</Data></Cell>
    <Cell ss:StyleID="s183"><Data ss:Type="Number">'
                   || x_id5
                   || '</Data></Cell>
    <Cell ss:StyleID="s184"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum1, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s185"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum2, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s184"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum3, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s186"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum4, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s187"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum5, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s188"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum6, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s187"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum7, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s189"><Data ss:Type="Number"></Data></Cell>
    <Cell ss:StyleID="s186"><Data ss:Type="Number"></Data></Cell>
    <Cell ss:StyleID="s187"><Data ss:Type="Number"></Data></Cell>
   </Row>'
         WHERE x_id1 = 4;

        UPDATE tmp_univ_rpt_data
           SET x_string2 =
                      '
   <Row ss:AutoFitHeight="0">
    <Cell ss:StyleID="s180"><Data ss:Type="String">'
                   || x_string1
                   || '</Data></Cell>
    <Cell ss:StyleID="s171"><Data ss:Type="String">'
                   || x_id1
                   || '</Data></Cell>
    <Cell ss:StyleID="s181"><Data ss:Type="Number">'
                   || x_id2
                   || '</Data></Cell>
    <Cell ss:StyleID="s182"><Data ss:Type="Number">'
                   || x_id3
                   || '</Data></Cell>
    <Cell ss:StyleID="s182"><Data ss:Type="Number">'
                   || x_id4
                   || '</Data></Cell>
    <Cell ss:StyleID="s183"><Data ss:Type="Number">'
                   || x_id5
                   || '</Data></Cell>
    <Cell ss:StyleID="s184"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum1, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s185"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum2, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s184"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum3, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s186"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum4, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s187"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum5, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s188"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum6, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s187"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum7, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s189"><Data ss:Type="Number"></Data></Cell>
    <Cell ss:StyleID="s186"><Data ss:Type="Number"></Data></Cell>
    <Cell ss:StyleID="s187"><Data ss:Type="Number"></Data></Cell>
   </Row>'
         WHERE x_id1 = 5;

        UPDATE tmp_univ_rpt_data
           SET x_string2 =
                      '
   <Row ss:AutoFitHeight="0">
    <Cell ss:StyleID="s180"><Data ss:Type="String">'
                   || x_string1
                   || '</Data></Cell>
    <Cell ss:StyleID="s171"><Data ss:Type="String">'
                   || x_id1
                   || '</Data></Cell>
    <Cell ss:StyleID="s181"><Data ss:Type="Number">'
                   || x_id2
                   || '</Data></Cell>
    <Cell ss:StyleID="s182"><Data ss:Type="Number">'
                   || x_id3
                   || '</Data></Cell>
    <Cell ss:StyleID="s182"><Data ss:Type="Number">'
                   || x_id4
                   || '</Data></Cell>
    <Cell ss:StyleID="s183"><Data ss:Type="Number">'
                   || x_id5
                   || '</Data></Cell>
    <Cell ss:StyleID="s184"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum1, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s185"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum2, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s184"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum3, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s186"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum4, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s187"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum5, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s188"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum6, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s187"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum7, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s189"><Data ss:Type="Number"></Data></Cell>
    <Cell ss:StyleID="s186"><Data ss:Type="Number"></Data></Cell>
    <Cell ss:StyleID="s187"><Data ss:Type="Number"></Data></Cell>
   </Row>'
         WHERE x_id1 = 6;

        UPDATE tmp_univ_rpt_data
           SET x_string2 =
                      '
   <Row ss:AutoFitHeight="0" ss:Height="21.45">
    <Cell ss:StyleID="s170"><Data ss:Type="String">'
                   || x_string1
                   || '</Data></Cell>
    <Cell ss:StyleID="s171"><Data ss:Type="String">'
                   || x_id1
                   || '</Data></Cell>
    <Cell ss:StyleID="s181"><Data ss:Type="Number">'
                   || x_id2
                   || '</Data></Cell>
    <Cell ss:StyleID="s182"><Data ss:Type="Number">'
                   || x_id3
                   || '</Data></Cell>
    <Cell ss:StyleID="s182"><Data ss:Type="Number">'
                   || x_id4
                   || '</Data></Cell>
    <Cell ss:StyleID="s183"><Data ss:Type="Number">'
                   || x_id5
                   || '</Data></Cell>
    <Cell ss:StyleID="s184"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum1, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s185"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum2, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s184"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum3, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s186"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum4, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s187"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum5, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s188"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum6, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s187"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum7, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s189"><Data ss:Type="Number"></Data></Cell>
    <Cell ss:StyleID="s186"><Data ss:Type="Number"></Data></Cell>
    <Cell ss:StyleID="s187"><Data ss:Type="Number"></Data></Cell>
   </Row>'
         WHERE x_id1 = 7;

        UPDATE tmp_univ_rpt_data
           SET x_string2 =
                      '
   <Row ss:AutoFitHeight="0">
    <Cell ss:StyleID="s191"><Data ss:Type="String">'
                   || x_string1
                   || '</Data></Cell>
    <Cell ss:StyleID="s171"><Data ss:Type="String">'
                   || x_id1
                   || '</Data></Cell>
    <Cell ss:StyleID="s192"><Data ss:Type="Number">'
                   || x_id2
                   || '</Data></Cell>
    <Cell ss:StyleID="s182"><Data ss:Type="Number">'
                   || x_id3
                   || '</Data></Cell>
    <Cell ss:StyleID="s182"><Data ss:Type="Number">'
                   || x_id4
                   || '</Data></Cell>
    <Cell ss:StyleID="s183"><Data ss:Type="Number">'
                   || x_id5
                   || '</Data></Cell>
    <Cell ss:StyleID="s184"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum1, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s185"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum2, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s184"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum3, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s186"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum4, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s187"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum5, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s188"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum6, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s187"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum7, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s189"><Data ss:Type="Number"></Data></Cell>
    <Cell ss:StyleID="s193"><Data ss:Type="Number"></Data></Cell>
    <Cell ss:StyleID="s194"><Data ss:Type="Number"></Data></Cell>
   </Row>'
         WHERE x_id1 = 8;

        UPDATE tmp_univ_rpt_data
           SET x_string2 =
                      '
   <Row ss:AutoFitHeight="0" ss:Height="19.2">
    <Cell ss:StyleID="s191"><Data ss:Type="String">'
                   || x_string1
                   || '</Data></Cell>
    <Cell ss:StyleID="s171"><Data ss:Type="String">'
                   || x_id1
                   || '</Data></Cell>
    <Cell ss:StyleID="s192"><Data ss:Type="Number">'
                   || x_id2
                   || '</Data></Cell>
    <Cell ss:StyleID="s182"><Data ss:Type="Number">'
                   || x_id3
                   || '</Data></Cell>
    <Cell ss:StyleID="s182"><Data ss:Type="Number">'
                   || x_id4
                   || '</Data></Cell>
    <Cell ss:StyleID="s183"><Data ss:Type="Number">'
                   || x_id5
                   || '</Data></Cell>
    <Cell ss:StyleID="s184"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum1, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s185"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum2, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s184"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum3, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s186"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum4, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s187"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum5, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s188"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum6, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s187"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum7, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s189"><Data ss:Type="Number">0</Data></Cell>
    <Cell ss:StyleID="s193"><Data ss:Type="Number">0</Data></Cell>
    <Cell ss:StyleID="s194"><Data ss:Type="Number">0</Data></Cell>
   </Row>'
         WHERE x_id1 = 9;

        UPDATE tmp_univ_rpt_data
           SET x_string2 =
                      '
   <Row ss:AutoFitHeight="0" ss:Height="19.8">
    <Cell ss:StyleID="s195"><ss:Data ss:Type="String"
      xmlns="http://www.w3.org/TR/REC-html40">'
                   || x_string1
                   || '</ss:Data></Cell>
    <Cell ss:StyleID="s196"><Data ss:Type="String">'
                   || x_id1
                   || '</Data></Cell>
    <Cell ss:StyleID="s197"><Data ss:Type="Number">'
                   || x_id2
                   || '</Data></Cell>
    <Cell ss:StyleID="s182"><Data ss:Type="Number">'
                   || x_id3
                   || '</Data></Cell>
    <Cell ss:StyleID="s182"><Data ss:Type="Number">'
                   || x_id4
                   || '</Data></Cell>
    <Cell ss:StyleID="s183"><Data ss:Type="Number">'
                   || x_id5
                   || '</Data></Cell>
    <Cell ss:StyleID="s184"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum1, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s185"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum2, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s184"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum3, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s186"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum4, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s187"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum5, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s188"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum6, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s187"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum7, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s189"><Data ss:Type="Number">0</Data></Cell>
    <Cell ss:StyleID="s198"><Data ss:Type="Number">0</Data></Cell>
    <Cell ss:StyleID="s199"><Data ss:Type="Number">0</Data></Cell>
   </Row>'
         WHERE x_id1 = 10;

        UPDATE tmp_univ_rpt_data
           SET x_string2 =
                      '
   <Row ss:AutoFitHeight="0" ss:Height="48.45">
    <Cell ss:StyleID="s200"><Data ss:Type="String">'
                   || x_string1
                   || '</Data></Cell>
    <Cell ss:StyleID="s201"><Data ss:Type="String">'
                   || x_id1
                   || '</Data></Cell>
    <Cell ss:StyleID="s202"><Data ss:Type="Number">'
                   || x_id2
                   || '</Data></Cell>
    <Cell ss:StyleID="s203"><Data ss:Type="Number">'
                   || x_id3
                   || '</Data></Cell>
    <Cell ss:StyleID="s204"><Data ss:Type="Number">'
                   || x_id4
                   || '</Data></Cell>
    <Cell ss:StyleID="s205"><Data ss:Type="Number">'
                   || x_id5
                   || '</Data></Cell>
    <Cell ss:StyleID="s206"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum1, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s207"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum2, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s206"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum3, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s208"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum4, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s209"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum5, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s206"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum6, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s209"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum7, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s210"><Data ss:Type="Number"></Data></Cell>
    <Cell ss:StyleID="s208"><Data ss:Type="Number"></Data></Cell>
    <Cell ss:StyleID="s209"><Data ss:Type="Number"></Data></Cell>
   </Row>'
         WHERE x_id1 = 11;

        UPDATE tmp_univ_rpt_data
           SET x_string2 =
                      '
   <Row ss:AutoFitHeight="0" ss:Height="31.799999999999997">
    <Cell ss:StyleID="s211"><Data ss:Type="String">'
                   || x_string1
                   || '</Data></Cell>
    <Cell ss:StyleID="s171"><Data ss:Type="String">'
                   || x_id1
                   || '</Data></Cell>
    <Cell ss:StyleID="s212"><Data ss:Type="Number">'
                   || x_id2
                   || '</Data></Cell>
    <Cell ss:StyleID="s213"><Data ss:Type="Number">'
                   || x_id3
                   || '</Data></Cell>
    <Cell ss:StyleID="s173"><Data ss:Type="Number">'
                   || x_id4
                   || '</Data></Cell>
    <Cell ss:StyleID="s174"><Data ss:Type="Number">'
                   || x_id5
                   || '</Data></Cell>
    <Cell ss:StyleID="s175"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum1, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s176"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum2, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s175"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum3, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s177"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum4, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s178"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum5, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s175"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum6, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s178"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum7, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s179"><Data ss:Type="Number"></Data></Cell>
    <Cell ss:StyleID="s177"><Data ss:Type="Number"></Data></Cell>
    <Cell ss:StyleID="s178"><Data ss:Type="Number"></Data></Cell>
   </Row>'
         WHERE x_id1 = 12;

        UPDATE tmp_univ_rpt_data
           SET x_string2 =
                      '
   <Row ss:AutoFitHeight="0">
    <Cell ss:StyleID="s180"><Data ss:Type="String">'
                   || x_string1
                   || '</Data></Cell>
    <Cell ss:StyleID="s171"><Data ss:Type="String">'
                   || x_id1
                   || '</Data></Cell>
    <Cell ss:StyleID="s192"><Data ss:Type="Number">'
                   || x_id2
                   || '</Data></Cell>
    <Cell ss:StyleID="s214"><Data ss:Type="Number">'
                   || x_id3
                   || '</Data></Cell>
    <Cell ss:StyleID="s214"><Data ss:Type="Number">'
                   || x_id4
                   || '</Data></Cell>
    <Cell ss:StyleID="s183"><Data ss:Type="Number">'
                   || x_id5
                   || '</Data></Cell>
    <Cell ss:StyleID="s184"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum1, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s185"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum2, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s184"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum3, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s186"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum4, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s187"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum5, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s188"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum6, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s187"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum7, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s189"><Data ss:Type="Number"></Data></Cell>
    <Cell ss:StyleID="s186"><Data ss:Type="Number"></Data></Cell>
    <Cell ss:StyleID="s187"><Data ss:Type="Number"></Data></Cell>
   </Row>'
         WHERE x_id1 = 13;

        UPDATE tmp_univ_rpt_data
           SET x_string2 =
                      '
   <Row ss:AutoFitHeight="0">
    <Cell ss:StyleID="s180"><Data ss:Type="String">'
                   || x_string1
                   || '</Data></Cell>
    <Cell ss:StyleID="s171"><Data ss:Type="String">'
                   || x_id1
                   || '</Data></Cell>
    <Cell ss:StyleID="s192"><Data ss:Type="Number">'
                   || x_id2
                   || '</Data></Cell>
    <Cell ss:StyleID="s214"><Data ss:Type="Number">'
                   || x_id3
                   || '</Data></Cell>
    <Cell ss:StyleID="s214"><Data ss:Type="Number">'
                   || x_id4
                   || '</Data></Cell>
    <Cell ss:StyleID="s183"><Data ss:Type="Number">'
                   || x_id5
                   || '</Data></Cell>
    <Cell ss:StyleID="s184"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum1, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s185"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum2, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s184"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum3, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s186"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum4, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s187"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum5, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s188"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum6, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s187"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum7, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s189"><Data ss:Type="Number"></Data></Cell>
    <Cell ss:StyleID="s186"><Data ss:Type="Number"></Data></Cell>
    <Cell ss:StyleID="s187"><Data ss:Type="Number"></Data></Cell>
   </Row>'
         WHERE x_id1 = 14;

        UPDATE tmp_univ_rpt_data
           SET x_string2 =
                      '
   <Row ss:AutoFitHeight="0">
    <Cell ss:StyleID="s180"><Data ss:Type="String">'
                   || x_string1
                   || '</Data></Cell>
    <Cell ss:StyleID="s171"><Data ss:Type="String">'
                   || x_id1
                   || '</Data></Cell>
    <Cell ss:StyleID="s192"><Data ss:Type="Number">'
                   || x_id2
                   || '</Data></Cell>
    <Cell ss:StyleID="s214"><Data ss:Type="Number">'
                   || x_id3
                   || '</Data></Cell>
    <Cell ss:StyleID="s214"><Data ss:Type="Number">'
                   || x_id4
                   || '</Data></Cell>
    <Cell ss:StyleID="s183"><Data ss:Type="Number">'
                   || x_id5
                   || '</Data></Cell>
    <Cell ss:StyleID="s184"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum1, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s185"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum2, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s184"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum3, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s186"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum4, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s187"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum5, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s188"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum6, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s187"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum7, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s189"><Data ss:Type="Number"></Data></Cell>
    <Cell ss:StyleID="s186"><Data ss:Type="Number"></Data></Cell>
    <Cell ss:StyleID="s187"><Data ss:Type="Number"></Data></Cell>
   </Row>'
         WHERE x_id1 = 15;

        UPDATE tmp_univ_rpt_data
           SET x_string2 =
                      '
   <Row ss:AutoFitHeight="0" ss:Height="21.45">
    <Cell ss:StyleID="s211"><Data ss:Type="String">'
                   || x_string1
                   || '</Data></Cell>
    <Cell ss:StyleID="s171"><Data ss:Type="String">'
                   || x_id1
                   || '</Data></Cell>
    <Cell ss:StyleID="s212"><Data ss:Type="Number">'
                   || x_id2
                   || '</Data></Cell>
    <Cell ss:StyleID="s213"><Data ss:Type="Number">'
                   || x_id3
                   || '</Data></Cell>
    <Cell ss:StyleID="s173"><Data ss:Type="Number">'
                   || x_id4
                   || '</Data></Cell>
    <Cell ss:StyleID="s174"><Data ss:Type="Number">'
                   || x_id5
                   || '</Data></Cell>
    <Cell ss:StyleID="s175"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum1, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s176"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum2, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s175"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum3, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s177"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum4, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s178"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum5, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s175"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum6, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s178"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum7, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s179"><Data ss:Type="Number"></Data></Cell>
    <Cell ss:StyleID="s177"><Data ss:Type="Number"></Data></Cell>
    <Cell ss:StyleID="s178"><Data ss:Type="Number"></Data></Cell>
   </Row>'
         WHERE x_id1 = 16;

        UPDATE tmp_univ_rpt_data
           SET x_string2 =
                      '
   <Row ss:AutoFitHeight="0" ss:Height="20.549999999999997">
    <Cell ss:StyleID="s215"><ss:Data ss:Type="String"
      xmlns="http://www.w3.org/TR/REC-html40">'
                   || x_string1
                   || '</ss:Data></Cell>
    <Cell ss:StyleID="s171"><Data ss:Type="String">'
                   || x_id1
                   || '</Data></Cell>
    <Cell ss:StyleID="s192"><Data ss:Type="Number">'
                   || x_id2
                   || '</Data></Cell>
    <Cell ss:StyleID="s214"><Data ss:Type="Number">'
                   || x_id3
                   || '</Data></Cell>
    <Cell ss:StyleID="s182"><Data ss:Type="Number">'
                   || x_id4
                   || '</Data></Cell>
    <Cell ss:StyleID="s183"><Data ss:Type="Number">'
                   || x_id5
                   || '</Data></Cell>
    <Cell ss:StyleID="s184"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum1, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s185"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum2, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s184"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum3, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s186"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum4, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s187"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum5, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s188"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum6, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s187"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum7, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s189"><Data ss:Type="Number"></Data></Cell>
    <Cell ss:StyleID="s186"><Data ss:Type="Number"></Data></Cell>
    <Cell ss:StyleID="s187"><Data ss:Type="Number"></Data></Cell>
   </Row>'
         WHERE x_id1 = 17;

        UPDATE tmp_univ_rpt_data
           SET x_string2 =
                      '
   <Row ss:AutoFitHeight="0">
    <Cell ss:StyleID="s216"><Data ss:Type="String">'
                   || x_string1
                   || '</Data></Cell>
    <Cell ss:StyleID="s171"><Data ss:Type="String">'
                   || x_id1
                   || '</Data></Cell>
    <Cell ss:StyleID="s192"><Data ss:Type="Number">'
                   || x_id2
                   || '</Data></Cell>
    <Cell ss:StyleID="s214"><Data ss:Type="Number">'
                   || x_id3
                   || '</Data></Cell>
    <Cell ss:StyleID="s182"><Data ss:Type="Number">'
                   || x_id4
                   || '</Data></Cell>
    <Cell ss:StyleID="s183"><Data ss:Type="Number">'
                   || x_id5
                   || '</Data></Cell>
    <Cell ss:StyleID="s184"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum1, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s185"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum2, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s184"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum3, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s186"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum4, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s187"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum5, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s188"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum6, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s187"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum7, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s189"><Data ss:Type="Number"></Data></Cell>
    <Cell ss:StyleID="s186"><Data ss:Type="Number"></Data></Cell>
    <Cell ss:StyleID="s187"><Data ss:Type="Number"></Data></Cell>
   </Row>'
         WHERE x_id1 = 18;

        UPDATE tmp_univ_rpt_data
           SET x_string2 =
                      '
   <Row ss:AutoFitHeight="0" ss:Height="21.45">
    <Cell ss:StyleID="s217"><ss:Data ss:Type="String"
      xmlns="http://www.w3.org/TR/REC-html40">'
                   || x_string1
                   || '</ss:Data></Cell>
    <Cell ss:StyleID="s171"><Data ss:Type="String">'
                   || x_id1
                   || '</Data></Cell>
    <Cell ss:StyleID="s212"><Data ss:Type="Number">'
                   || x_id2
                   || '</Data></Cell>
    <Cell ss:StyleID="s213"><Data ss:Type="Number">'
                   || x_id3
                   || '</Data></Cell>
    <Cell ss:StyleID="s173"><Data ss:Type="Number">'
                   || x_id4
                   || '</Data></Cell>
    <Cell ss:StyleID="s174"><Data ss:Type="Number">'
                   || x_id5
                   || '</Data></Cell>
    <Cell ss:StyleID="s175"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum1, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s176"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum2, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s175"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum3, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s177"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum4, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s178"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum5, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s175"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum6, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s178"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum7, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s179"><Data ss:Type="Number"></Data></Cell>
    <Cell ss:StyleID="s177"><Data ss:Type="Number"></Data></Cell>
    <Cell ss:StyleID="s178"><Data ss:Type="Number"></Data></Cell>
   </Row>'
         WHERE x_id1 = 19;

        UPDATE tmp_univ_rpt_data
           SET x_string2 =
                      '
   <Row ss:AutoFitHeight="0" ss:Height="20.549999999999997">
    <Cell ss:StyleID="s218"><ss:Data ss:Type="String"
      xmlns="http://www.w3.org/TR/REC-html40">'
                   || x_string1
                   || '</ss:Data></Cell>
    <Cell ss:StyleID="s171"><Data ss:Type="String">'
                   || x_id1
                   || '</Data></Cell>
    <Cell ss:StyleID="s192"><Data ss:Type="Number">'
                   || x_id2
                   || '</Data></Cell>
    <Cell ss:StyleID="s214"><Data ss:Type="Number">'
                   || x_id3
                   || '</Data></Cell>
    <Cell ss:StyleID="s182"><Data ss:Type="Number">'
                   || x_id4
                   || '</Data></Cell>
    <Cell ss:StyleID="s183"><Data ss:Type="Number">'
                   || x_id5
                   || '</Data></Cell>
    <Cell ss:StyleID="s184"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum1, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s185"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum2, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s184"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum3, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s186"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum4, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s187"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum5, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s188"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum6, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s187"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum7, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s189"><Data ss:Type="Number"></Data></Cell>
    <Cell ss:StyleID="s186"><Data ss:Type="Number"></Data></Cell>
    <Cell ss:StyleID="s187"><Data ss:Type="Number"></Data></Cell>
   </Row>'
         WHERE x_id1 = 20;

        UPDATE tmp_univ_rpt_data
           SET x_string2 =
                      '
   <Row ss:AutoFitHeight="0">
    <Cell ss:StyleID="s219"><Data ss:Type="String">'
                   || x_string1
                   || '</Data></Cell>
    <Cell ss:StyleID="s171"><Data ss:Type="String">'
                   || x_id1
                   || '</Data></Cell>
    <Cell ss:StyleID="s192"><Data ss:Type="Number">'
                   || x_id2
                   || '</Data></Cell>
    <Cell ss:StyleID="s214"><Data ss:Type="Number">'
                   || x_id3
                   || '</Data></Cell>
    <Cell ss:StyleID="s182"><Data ss:Type="Number">'
                   || x_id4
                   || '</Data></Cell>
    <Cell ss:StyleID="s183"><Data ss:Type="Number">'
                   || x_id5
                   || '</Data></Cell>
    <Cell ss:StyleID="s184"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum1, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s185"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum2, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s184"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum3, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s186"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum4, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s187"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum5, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s188"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum6, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s187"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum7, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s189"><Data ss:Type="Number"></Data></Cell>
    <Cell ss:StyleID="s186"><Data ss:Type="Number"></Data></Cell>
    <Cell ss:StyleID="s187"><Data ss:Type="Number"></Data></Cell>
   </Row>'
         WHERE x_id1 = 21;

        UPDATE tmp_univ_rpt_data
           SET x_string2 =
                      '
   <Row ss:AutoFitHeight="0" ss:Height="31.200000000000003">
    <Cell ss:StyleID="s217"><ss:Data ss:Type="String"
      xmlns="http://www.w3.org/TR/REC-html40">'
                   || x_string1
                   || '</ss:Data></Cell>
    <Cell ss:StyleID="s171"><Data ss:Type="String">'
                   || x_id1
                   || '</Data></Cell>
    <Cell ss:StyleID="s212"><Data ss:Type="Number">'
                   || x_id2
                   || '</Data></Cell>
    <Cell ss:StyleID="s213"><Data ss:Type="Number">'
                   || x_id3
                   || '</Data></Cell>
    <Cell ss:StyleID="s173"><Data ss:Type="Number">'
                   || x_id4
                   || '</Data></Cell>
    <Cell ss:StyleID="s174"><Data ss:Type="Number">'
                   || x_id5
                   || '</Data></Cell>
    <Cell ss:StyleID="s175"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum1, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s176"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum2, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s175"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum3, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s177"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum4, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s178"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum5, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s175"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum6, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s178"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum7, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s179"><Data ss:Type="Number">0</Data></Cell>
    <Cell ss:StyleID="s177"><Data ss:Type="Number">0</Data></Cell>
    <Cell ss:StyleID="s178" ss:Formula="=R[1]C+R[2]C"><Data ss:Type="Number">0</Data></Cell>
   </Row>'
         WHERE x_id1 = 22;

        UPDATE tmp_univ_rpt_data
           SET x_string2 =
                      '
   <Row ss:AutoFitHeight="0" ss:Height="20.549999999999997">
    <Cell ss:StyleID="s218"><ss:Data ss:Type="String"
      xmlns="http://www.w3.org/TR/REC-html40">'
                   || x_string1
                   || '</ss:Data></Cell>
    <Cell ss:StyleID="s171"><Data ss:Type="String">'
                   || x_id1
                   || '</Data></Cell>
    <Cell ss:StyleID="s192"><Data ss:Type="Number">'
                   || x_id2
                   || '</Data></Cell>
    <Cell ss:StyleID="s214"><Data ss:Type="Number">'
                   || x_id3
                   || '</Data></Cell>
    <Cell ss:StyleID="s182"><Data ss:Type="Number">'
                   || x_id4
                   || '</Data></Cell>
    <Cell ss:StyleID="s183"><Data ss:Type="Number">'
                   || x_id5
                   || '</Data></Cell>
    <Cell ss:StyleID="s184"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum1, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s185"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum2, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s184"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum3, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s186"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum4, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s187"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum5, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s188"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum6, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s187"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum7, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s189"><Data ss:Type="Number">0</Data></Cell>
    <Cell ss:StyleID="s186"><Data ss:Type="Number">0</Data></Cell>
    <Cell ss:StyleID="s187"><Data ss:Type="Number">0</Data></Cell>
   </Row>'
         WHERE x_id1 = 23;

        UPDATE tmp_univ_rpt_data
           SET x_string2 =
                      '
   <Row ss:AutoFitHeight="0">
    <Cell ss:StyleID="s219"><Data ss:Type="String">'
                   || x_string1
                   || '</Data></Cell>
    <Cell ss:StyleID="s171"><Data ss:Type="String">'
                   || x_id1
                   || '</Data></Cell>
    <Cell ss:StyleID="s192"><Data ss:Type="Number">'
                   || x_id2
                   || '</Data></Cell>
    <Cell ss:StyleID="s214"><Data ss:Type="Number">'
                   || x_id3
                   || '</Data></Cell>
    <Cell ss:StyleID="s182"><Data ss:Type="Number">'
                   || x_id4
                   || '</Data></Cell>
    <Cell ss:StyleID="s183"><Data ss:Type="Number">'
                   || x_id5
                   || '</Data></Cell>
    <Cell ss:StyleID="s184"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum1, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s185"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum2, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s184"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum3, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s186"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum4, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s187"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum5, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s188"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum6, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s187"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum7, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s189"><Data ss:Type="Number">0</Data></Cell>
    <Cell ss:StyleID="s186"><Data ss:Type="Number">0</Data></Cell>
    <Cell ss:StyleID="s187"><Data ss:Type="Number">0</Data></Cell>
   </Row>'
         WHERE x_id1 = 24;

        UPDATE tmp_univ_rpt_data
           SET x_string2 =
                      '
   <Row ss:AutoFitHeight="0" ss:Height="28.8">
    <Cell ss:StyleID="s217"><ss:Data ss:Type="String"
      xmlns="http://www.w3.org/TR/REC-html40">'
                   || x_string1
                   || '</ss:Data></Cell>
    <Cell ss:StyleID="s171"><Data ss:Type="String">'
                   || x_id1
                   || '</Data></Cell>
    <Cell ss:StyleID="s212"><Data ss:Type="Number">'
                   || x_id2
                   || '</Data></Cell>
    <Cell ss:StyleID="s213"><Data ss:Type="Number">'
                   || x_id3
                   || '</Data></Cell>
    <Cell ss:StyleID="s173"><Data ss:Type="Number">'
                   || x_id4
                   || '</Data></Cell>
    <Cell ss:StyleID="s174"><Data ss:Type="Number">'
                   || x_id5
                   || '</Data></Cell>
    <Cell ss:StyleID="s175"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum1, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s176"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum2, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s175"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum3, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s177"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum4, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s178"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum5, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s175"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum6, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s178"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum7, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s179"><Data ss:Type="Number">0</Data></Cell>
    <Cell ss:StyleID="s177"><Data ss:Type="Number">0</Data></Cell>
    <Cell ss:StyleID="s178"><Data ss:Type="Number">0</Data></Cell>
   </Row>'
         WHERE x_id1 = 25;

        UPDATE tmp_univ_rpt_data
           SET x_string2 =
                      '
   <Row ss:AutoFitHeight="0" ss:Height="20.549999999999997">
    <Cell ss:StyleID="s218"><ss:Data ss:Type="String"
      xmlns="http://www.w3.org/TR/REC-html40">'
                   || x_string1
                   || '</ss:Data></Cell>
    <Cell ss:StyleID="s171"><Data ss:Type="String">'
                   || x_id1
                   || '</Data></Cell>
    <Cell ss:StyleID="s220"><Data ss:Type="Number">'
                   || x_id2
                   || '</Data></Cell>
    <Cell ss:StyleID="s221"><Data ss:Type="Number">'
                   || x_id3
                   || '</Data></Cell>
    <Cell ss:StyleID="s222"><Data ss:Type="Number">'
                   || x_id4
                   || '</Data></Cell>
    <Cell ss:StyleID="s223"><Data ss:Type="Number">'
                   || x_id5
                   || '</Data></Cell>
    <Cell ss:StyleID="s224"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum1, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s225"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum2, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s224"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum3, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s226"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum4, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s227"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum5, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s224"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum6, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s227"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum7, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s228"><Data ss:Type="Number">0</Data></Cell>
    <Cell ss:StyleID="s226"><Data ss:Type="Number">0</Data></Cell>
    <Cell ss:StyleID="s227"><Data ss:Type="Number">0</Data></Cell>
   </Row>'
         WHERE x_id1 = 26;

        UPDATE tmp_univ_rpt_data
           SET x_string2 =
                      '
   <Row ss:AutoFitHeight="0">
    <Cell ss:StyleID="s219"><Data ss:Type="String">'
                   || x_string1
                   || '</Data></Cell>
    <Cell ss:StyleID="s171"><Data ss:Type="String">'
                   || x_id1
                   || '</Data></Cell>
    <Cell ss:StyleID="s220"><Data ss:Type="Number">'
                   || x_id2
                   || '</Data></Cell>
    <Cell ss:StyleID="s221"><Data ss:Type="Number">'
                   || x_id3
                   || '</Data></Cell>
    <Cell ss:StyleID="s222"><Data ss:Type="Number">'
                   || x_id4
                   || '</Data></Cell>
    <Cell ss:StyleID="s223"><Data ss:Type="Number">'
                   || x_id5
                   || '</Data></Cell>
    <Cell ss:StyleID="s224"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum1, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s225"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum2, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s224"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum3, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s226"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum4, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s227"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum5, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s224"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum6, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s227"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum7, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s228"><Data ss:Type="Number">0</Data></Cell>
    <Cell ss:StyleID="s226"><Data ss:Type="Number">0</Data></Cell>
    <Cell ss:StyleID="s227"><Data ss:Type="Number">0</Data></Cell>
   </Row>'
         WHERE x_id1 = 27;

        UPDATE tmp_univ_rpt_data
           SET x_string2 =
                      '
   <Row ss:AutoFitHeight="0" ss:Height="19.2">
    <Cell ss:StyleID="s229"><ss:Data ss:Type="String"
      xmlns="http://www.w3.org/TR/REC-html40">'
                   || x_string1
                   || '</ss:Data></Cell>
    <Cell ss:StyleID="s230"><Data ss:Type="Number">'
                   || x_id1
                   || '</Data></Cell>
    <Cell ss:StyleID="s231"><Data ss:Type="Number">'
                   || x_id2
                   || '</Data></Cell>
    <Cell ss:StyleID="s213"><Data ss:Type="Number">'
                   || x_id3
                   || '</Data></Cell>
    <Cell ss:StyleID="s173"><Data ss:Type="Number">'
                   || x_id4
                   || '</Data></Cell>
    <Cell ss:StyleID="s232"><Data ss:Type="Number">'
                   || x_id5
                   || '</Data></Cell>
    <Cell ss:StyleID="s175"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum1, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s178"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum2, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s179"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum3, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s177"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum4, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s176"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum5, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s175"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum6, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s178"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum7, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s179"><Data ss:Type="Number">0</Data></Cell>
    <Cell ss:StyleID="s177"><Data ss:Type="Number">0</Data></Cell>
    <Cell ss:StyleID="s178"><Data ss:Type="Number">0</Data></Cell>
   </Row>'
         WHERE x_id1 = 28;

        UPDATE tmp_univ_rpt_data
           SET x_string2 =
                      '
   <Row ss:AutoFitHeight="0" ss:Height="20.549999999999997">
    <Cell ss:StyleID="s233"><ss:Data ss:Type="String"
      xmlns="http://www.w3.org/TR/REC-html40">'
                   || x_string1
                   || '</ss:Data></Cell>
    <Cell ss:StyleID="s230"><Data ss:Type="Number">'
                   || x_id1
                   || '</Data></Cell>
    <Cell ss:StyleID="s234"><Data ss:Type="Number">'
                   || x_id2
                   || '</Data></Cell>
    <Cell ss:StyleID="s221"><Data ss:Type="Number">'
                   || x_id3
                   || '</Data></Cell>
    <Cell ss:StyleID="s222"><Data ss:Type="Number">'
                   || x_id4
                   || '</Data></Cell>
    <Cell ss:StyleID="s235"><Data ss:Type="Number">'
                   || x_id5
                   || '</Data></Cell>
    <Cell ss:StyleID="s224"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum1, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s227"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum2, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s228"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum3, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s226"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum4, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s225"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum5, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s224"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum6, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s227"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum7, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s228"><Data ss:Type="Number">0</Data></Cell>
    <Cell ss:StyleID="s226"><Data ss:Type="Number">0</Data></Cell>
    <Cell ss:StyleID="s227"><Data ss:Type="Number">0</Data></Cell>
   </Row>'
         WHERE x_id1 = 29;

        UPDATE tmp_univ_rpt_data
           SET x_string2 =
                      '
   <Row ss:AutoFitHeight="0" ss:Height="15">
    <Cell ss:StyleID="s236"><Data ss:Type="String">'
                   || x_string1
                   || '</Data></Cell>
    <Cell ss:StyleID="s237"><Data ss:Type="Number">'
                   || x_id1
                   || '</Data></Cell>
    <Cell ss:StyleID="s238"><Data ss:Type="Number">'
                   || x_id2
                   || '</Data></Cell>
    <Cell ss:StyleID="s239"><Data ss:Type="Number">'
                   || x_id3
                   || '</Data></Cell>
    <Cell ss:StyleID="s240"><Data ss:Type="Number">'
                   || x_id4
                   || '</Data></Cell>
    <Cell ss:StyleID="s241"><Data ss:Type="Number">'
                   || x_id5
                   || '</Data></Cell>
    <Cell ss:StyleID="s242"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum1, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s243"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum2, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s244"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum3, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s245"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum4, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s246"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum5, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s242"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum6, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s243"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum7, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s244"><Data ss:Type="Number">0</Data></Cell>
    <Cell ss:StyleID="s245"><Data ss:Type="Number">0</Data></Cell>
    <Cell ss:StyleID="s243"><Data ss:Type="Number">0</Data></Cell>
   </Row>'
         WHERE x_id1 = 30;

        UPDATE tmp_univ_rpt_data
           SET x_string2 =
                   '
   <Row ss:AutoFitHeight="0" ss:Height="15">
    <Cell ss:StyleID="s247"><Data ss:Type="String">3. ƒопомога на похованн€  (р€дки 32+36)                      </Data></Cell>
    <Cell ss:StyleID="s248"><Data ss:Type="Number">31</Data></Cell>
    <Cell ss:StyleID="s249" ss:Formula="=R[1]C+R[5]C"><Data ss:Type="Number">0</Data></Cell>
    <Cell ss:StyleID="s203" ss:Formula="=R[1]C+R[5]C"><Data ss:Type="Number">0</Data></Cell>
    <Cell ss:StyleID="s204" ss:Formula="=R[1]C+R[5]C"><Data ss:Type="Number">0</Data></Cell>
    <Cell ss:StyleID="s250" ss:Formula="=R[1]C+R[5]C"><Data ss:Type="Number">0</Data></Cell>
    <Cell ss:StyleID="s206" ss:Formula="=R[1]C+R[5]C"><Data ss:Type="Number">0</Data></Cell>
    <Cell ss:StyleID="s209" ss:Formula="=R[1]C+R[5]C"><Data ss:Type="Number">0</Data></Cell>
    <Cell ss:StyleID="s210" ss:Formula="=R[1]C+R[5]C"><Data ss:Type="Number">0</Data></Cell>
    <Cell ss:StyleID="s208" ss:Formula="=R[1]C+R[5]C"><Data ss:Type="Number">0</Data></Cell>
    <Cell ss:StyleID="s207" ss:Formula="=R[1]C+R[5]C"><Data ss:Type="Number">0</Data></Cell>
    <Cell ss:StyleID="s206" ss:Formula="=R[1]C+R[5]C"><Data ss:Type="Number">0</Data></Cell>
    <Cell ss:StyleID="s209" ss:Formula="=R[1]C+R[5]C"><Data ss:Type="Number">0</Data></Cell>
    <Cell ss:StyleID="s210" ss:Formula="=R[1]C+R[5]C"><Data ss:Type="Number">0</Data></Cell>
    <Cell ss:StyleID="s208" ss:Formula="=R[1]C+R[5]C"><Data ss:Type="Number">0</Data></Cell>
    <Cell ss:StyleID="s209" ss:Formula="=R[1]C+R[5]C"><Data ss:Type="Number">0</Data></Cell>
   </Row>'
         WHERE x_id1 = 31;

        UPDATE tmp_univ_rpt_data
           SET x_string2 =
                   '
   <Row ss:AutoFitHeight="0" ss:Height="31.799999999999997">
    <Cell ss:StyleID="s170"><Data ss:Type="String">у тому числ≥:                                                                                3.1. ќсоба з ≥нвал≥дн≥стю з дитинства (р€дки 33+34+35)</Data></Cell>
    <Cell ss:StyleID="s230"><Data ss:Type="Number">32</Data></Cell>
    <Cell ss:StyleID="s231" ss:Formula="=R[1]C+R[2]C+R[3]C"><Data ss:Type="Number">0</Data></Cell>
    <Cell ss:StyleID="s213" ss:Formula="=R[1]C+R[2]C+R[3]C"><Data ss:Type="Number">0</Data></Cell>
    <Cell ss:StyleID="s173" ss:Formula="=R[1]C+R[2]C+R[3]C"><Data ss:Type="Number">0</Data></Cell>
    <Cell ss:StyleID="s232" ss:Formula="=R[1]C+R[2]C+R[3]C"><Data ss:Type="Number">0</Data></Cell>
    <Cell ss:StyleID="s175" ss:Formula="=R[1]C+R[2]C+R[3]C"><Data ss:Type="Number">0</Data></Cell>
    <Cell ss:StyleID="s178" ss:Formula="=R[1]C+R[2]C+R[3]C"><Data ss:Type="Number">0</Data></Cell>
    <Cell ss:StyleID="s179" ss:Formula="=R[1]C+R[2]C+R[3]C"><Data ss:Type="Number">0</Data></Cell>
    <Cell ss:StyleID="s177" ss:Formula="=R[1]C+R[2]C+R[3]C"><Data ss:Type="Number">0</Data></Cell>
    <Cell ss:StyleID="s176" ss:Formula="=R[1]C+R[2]C+R[3]C"><Data ss:Type="Number">0</Data></Cell>
    <Cell ss:StyleID="s175" ss:Formula="=R[1]C+R[2]C+R[3]C"><Data ss:Type="Number">0</Data></Cell>
    <Cell ss:StyleID="s178" ss:Formula="=R[1]C+R[2]C+R[3]C"><Data ss:Type="Number">0</Data></Cell>
    <Cell ss:StyleID="s179" ss:Formula="=R[1]C+R[2]C+R[3]C"><Data ss:Type="Number">0</Data></Cell>
    <Cell ss:StyleID="s177" ss:Formula="=R[1]C+R[2]C+R[3]C"><Data ss:Type="Number">0</Data></Cell>
    <Cell ss:StyleID="s178" ss:Formula="=R[1]C+R[2]C+R[3]C"><Data ss:Type="Number">0</Data></Cell>
   </Row>'
         WHERE x_id1 = 32;

        UPDATE tmp_univ_rpt_data
           SET x_string2 =
                   '
   <Row ss:AutoFitHeight="0" ss:Height="20.549999999999997">
    <Cell ss:StyleID="s251"><ss:Data ss:Type="String"
      xmlns="http://www.w3.org/TR/REC-html40"><B>з них:  </B><Font>                                                                                                  ≤ групи</Font></ss:Data></Cell>
    <Cell ss:StyleID="s230"><Data ss:Type="Number">33</Data></Cell>
    <Cell ss:StyleID="s252"><Data ss:Type="Number">0</Data></Cell>
    <Cell ss:StyleID="s214"><Data ss:Type="Number">0</Data></Cell>
    <Cell ss:StyleID="s182"><Data ss:Type="Number">0</Data></Cell>
    <Cell ss:StyleID="s253"><Data ss:Type="Number">0</Data></Cell>
    <Cell ss:StyleID="s184"><Data ss:Type="Number">0</Data></Cell>
    <Cell ss:StyleID="s254"><Data ss:Type="Number">0</Data></Cell>
    <Cell ss:StyleID="s255"><Data ss:Type="Number">0</Data></Cell>
    <Cell ss:StyleID="s186"><Data ss:Type="Number">0</Data></Cell>
    <Cell ss:StyleID="s256"><Data ss:Type="Number">0</Data></Cell>
    <Cell ss:StyleID="s188"><Data ss:Type="Number">0</Data></Cell>
    <Cell ss:StyleID="s187"><Data ss:Type="Number">0</Data></Cell>
    <Cell ss:StyleID="s189"><Data ss:Type="Number">0</Data></Cell>
    <Cell ss:StyleID="s186" ss:Formula="=RC[-6]-RC[-8]"><Data ss:Type="Number">0</Data></Cell>
    <Cell ss:StyleID="s187" ss:Formula="=RC[-6]-RC[-8]"><Data ss:Type="Number">0</Data></Cell>
   </Row>'
         WHERE x_id1 = 33;

        UPDATE tmp_univ_rpt_data
           SET x_string2 =
                   '
   <Row ss:AutoFitHeight="0">
    <Cell ss:StyleID="s257"><Data ss:Type="String">≤≤ групи</Data></Cell>
    <Cell ss:StyleID="s230"><Data ss:Type="Number">34</Data></Cell>
    <Cell ss:StyleID="s252"><Data ss:Type="Number">0</Data></Cell>
    <Cell ss:StyleID="s214"><Data ss:Type="Number">0</Data></Cell>
    <Cell ss:StyleID="s182"><Data ss:Type="Number">0</Data></Cell>
    <Cell ss:StyleID="s253"><Data ss:Type="Number">0</Data></Cell>
    <Cell ss:StyleID="s184"><Data ss:Type="Number">0</Data></Cell>
    <Cell ss:StyleID="s254"><Data ss:Type="Number">0</Data></Cell>
    <Cell ss:StyleID="s255"><Data ss:Type="Number">0</Data></Cell>
    <Cell ss:StyleID="s186"><Data ss:Type="Number">0</Data></Cell>
    <Cell ss:StyleID="s256"><Data ss:Type="Number">0</Data></Cell>
    <Cell ss:StyleID="s188"><Data ss:Type="Number">0</Data></Cell>
    <Cell ss:StyleID="s187"><Data ss:Type="Number">0</Data></Cell>
    <Cell ss:StyleID="s189"><Data ss:Type="Number">0</Data></Cell>
    <Cell ss:StyleID="s186" ss:Formula="=RC[-6]-RC[-8]"><Data ss:Type="Number">0</Data></Cell>
    <Cell ss:StyleID="s187" ss:Formula="=RC[-6]-RC[-8]"><Data ss:Type="Number">0</Data></Cell>
   </Row>'
         WHERE x_id1 = 34;

        UPDATE tmp_univ_rpt_data
           SET x_string2 =
                   '
   <Row ss:AutoFitHeight="0">
    <Cell ss:StyleID="s257"><Data ss:Type="String">≤≤≤ групи</Data></Cell>
    <Cell ss:StyleID="s230"><Data ss:Type="Number">35</Data></Cell>
    <Cell ss:StyleID="s252"><Data ss:Type="Number">0</Data></Cell>
    <Cell ss:StyleID="s214"><Data ss:Type="Number">0</Data></Cell>
    <Cell ss:StyleID="s182"><Data ss:Type="Number">0</Data></Cell>
    <Cell ss:StyleID="s253"><Data ss:Type="Number">0</Data></Cell>
    <Cell ss:StyleID="s184"><Data ss:Type="Number">0</Data></Cell>
    <Cell ss:StyleID="s254"><Data ss:Type="Number">0</Data></Cell>
    <Cell ss:StyleID="s255"><Data ss:Type="Number">0</Data></Cell>
    <Cell ss:StyleID="s186"><Data ss:Type="Number">0</Data></Cell>
    <Cell ss:StyleID="s256"><Data ss:Type="Number">0</Data></Cell>
    <Cell ss:StyleID="s188"><Data ss:Type="Number">0</Data></Cell>
    <Cell ss:StyleID="s187"><Data ss:Type="Number">0</Data></Cell>
    <Cell ss:StyleID="s189"><Data ss:Type="Number">0</Data></Cell>
    <Cell ss:StyleID="s186" ss:Formula="=RC[-6]-RC[-8]"><Data ss:Type="Number">0</Data></Cell>
    <Cell ss:StyleID="s187" ss:Formula="=RC[-6]-RC[-8]"><Data ss:Type="Number">0</Data></Cell>
   </Row>'
         WHERE x_id1 = 35;

        UPDATE tmp_univ_rpt_data
           SET x_string2 =
                   '
   <Row ss:AutoFitHeight="0" ss:Height="15">
    <Cell ss:StyleID="s170"><Data ss:Type="String">3.2. ƒ≥ти з ≥нвал≥дн≥стю в≥ком до 18 рок≥в</Data></Cell>
    <Cell ss:StyleID="s258"><Data ss:Type="Number">36</Data></Cell>
    <Cell ss:StyleID="s259"><Data ss:Type="Number">0</Data></Cell>
    <Cell ss:StyleID="s260"><Data ss:Type="Number">0</Data></Cell>
    <Cell ss:StyleID="s261"><Data ss:Type="Number">0</Data></Cell>
    <Cell ss:StyleID="s262"><Data ss:Type="Number">0</Data></Cell>
    <Cell ss:StyleID="s263"><Data ss:Type="Number">0</Data></Cell>
    <Cell ss:StyleID="s264"><Data ss:Type="Number">0</Data></Cell>
    <Cell ss:StyleID="s265"><Data ss:Type="Number">0</Data></Cell>
    <Cell ss:StyleID="s266"><Data ss:Type="Number">0</Data></Cell>
    <Cell ss:StyleID="s267"><Data ss:Type="Number">0</Data></Cell>
    <Cell ss:StyleID="s268"><Data ss:Type="Number">0</Data></Cell>
    <Cell ss:StyleID="s269"><Data ss:Type="Number">0</Data></Cell>
    <Cell ss:StyleID="s270"><Data ss:Type="Number">0</Data></Cell>
    <Cell ss:StyleID="s266" ss:Formula="=RC[-6]-RC[-8]"><Data ss:Type="Number">0</Data></Cell>
    <Cell ss:StyleID="s269" ss:Formula="=RC[-6]-RC[-8]"><Data ss:Type="Number">0</Data></Cell>
   </Row>'
         WHERE x_id1 = 36;

        UPDATE tmp_univ_rpt_data
           SET x_string2 =
                   '
   <Row ss:AutoFitHeight="0" ss:Height="34.199999999999996">
    <Cell ss:StyleID="s271"><Data ss:Type="String">4.ќтримують державну соц≥альну допомогу та пенс≥ю у звТ€зку з втратою годувальника одночасно  (р€дки 38+42)</Data></Cell>
    <Cell ss:StyleID="s272"><Data ss:Type="Number">37</Data></Cell>
    <Cell ss:StyleID="s273" ss:Formula="=R[1]C+R[5]C"><Data ss:Type="Number">0</Data></Cell>
    <Cell ss:StyleID="s274"><Data ss:Type="String">’</Data></Cell>
    <Cell ss:StyleID="s274"><Data ss:Type="String">’</Data></Cell>
    <Cell ss:StyleID="s275"><Data ss:Type="String">’</Data></Cell>
    <Cell ss:StyleID="s276"><Data ss:Type="String">’</Data></Cell>
    <Cell ss:StyleID="s277"><Data ss:Type="String">’</Data></Cell>
    <Cell ss:StyleID="s278"><Data ss:Type="String">’</Data></Cell>
    <Cell ss:StyleID="s279"><Data ss:Type="String">’</Data></Cell>
    <Cell ss:StyleID="s280"><Data ss:Type="String">’</Data></Cell>
    <Cell ss:StyleID="s276"><Data ss:Type="String">’</Data></Cell>
    <Cell ss:StyleID="s277"><Data ss:Type="String">’</Data></Cell>
    <Cell ss:StyleID="s278"><Data ss:Type="String">’</Data></Cell>
    <Cell ss:StyleID="s279"><Data ss:Type="String">’</Data></Cell>
    <Cell ss:StyleID="s277"><Data ss:Type="String">’</Data></Cell>
   </Row>'
         WHERE x_id1 = 37;

        UPDATE tmp_univ_rpt_data
           SET x_string2 =
                   '
   <Row ss:AutoFitHeight="0" ss:Height="31.799999999999997">
    <Cell ss:StyleID="s170"><Data ss:Type="String">у тому числ≥:&#10;4.1  ќсоба з ≥нвал≥дн≥стю з дитинства   (р€дки 39+40+41)</Data></Cell>
    <Cell ss:StyleID="s230"><Data ss:Type="Number">38</Data></Cell>
    <Cell ss:StyleID="s231" ss:Formula="=R[1]C+R[2]C+R[3]C"><Data ss:Type="Number">0</Data></Cell>
    <Cell ss:StyleID="s281"><Data ss:Type="String">’</Data></Cell>
    <Cell ss:StyleID="s281"><Data ss:Type="String">’</Data></Cell>
    <Cell ss:StyleID="s282"><Data ss:Type="String">’</Data></Cell>
    <Cell ss:StyleID="s283"><Data ss:Type="String">’</Data></Cell>
    <Cell ss:StyleID="s284"><Data ss:Type="String">’</Data></Cell>
    <Cell ss:StyleID="s285"><Data ss:Type="String">’</Data></Cell>
    <Cell ss:StyleID="s286"><Data ss:Type="String">’</Data></Cell>
    <Cell ss:StyleID="s287"><Data ss:Type="String">’</Data></Cell>
    <Cell ss:StyleID="s283"><Data ss:Type="String">’</Data></Cell>
    <Cell ss:StyleID="s284"><Data ss:Type="String">’</Data></Cell>
    <Cell ss:StyleID="s285"><Data ss:Type="String">’</Data></Cell>
    <Cell ss:StyleID="s286"><Data ss:Type="String">’</Data></Cell>
    <Cell ss:StyleID="s284"><Data ss:Type="String">’</Data></Cell>
   </Row>'
         WHERE x_id1 = 38;

        UPDATE tmp_univ_rpt_data
           SET x_string2 =
                   '
   <Row ss:AutoFitHeight="0" ss:Height="20.549999999999997">
    <Cell ss:StyleID="s251"><ss:Data ss:Type="String"
      xmlns="http://www.w3.org/TR/REC-html40"><B>з них</B><Font>:&#10;≤ групи</Font></ss:Data></Cell>
    <Cell ss:StyleID="s230"><Data ss:Type="Number">39</Data></Cell>
    <Cell ss:StyleID="s252"><Data ss:Type="Number">0</Data></Cell>
    <Cell ss:StyleID="s288"><Data ss:Type="String">’</Data></Cell>
    <Cell ss:StyleID="s288"><Data ss:Type="String">’</Data></Cell>
    <Cell ss:StyleID="s289"><Data ss:Type="String">’</Data></Cell>
    <Cell ss:StyleID="s290"><Data ss:Type="String">’</Data></Cell>
    <Cell ss:StyleID="s291"><Data ss:Type="String">’</Data></Cell>
    <Cell ss:StyleID="s292"><Data ss:Type="String">’</Data></Cell>
    <Cell ss:StyleID="s293"><Data ss:Type="String">’</Data></Cell>
    <Cell ss:StyleID="s294"><Data ss:Type="String">’</Data></Cell>
    <Cell ss:StyleID="s290"><Data ss:Type="String">’</Data></Cell>
    <Cell ss:StyleID="s291"><Data ss:Type="String">’</Data></Cell>
    <Cell ss:StyleID="s292"><Data ss:Type="String">’</Data></Cell>
    <Cell ss:StyleID="s293"><Data ss:Type="String">’</Data></Cell>
    <Cell ss:StyleID="s291"><Data ss:Type="String">’</Data></Cell>
   </Row>'
         WHERE x_id1 = 39;

        UPDATE tmp_univ_rpt_data
           SET x_string2 = '
   <Row ss:AutoFitHeight="0">
    <Cell ss:StyleID="s257"><Data ss:Type="String">≤≤ групи</Data></Cell>
    <Cell ss:StyleID="s230"><Data ss:Type="Number">40</Data></Cell>
    <Cell ss:StyleID="s252"><Data ss:Type="Number">0</Data></Cell>
    <Cell ss:StyleID="s288"><Data ss:Type="String">’</Data></Cell>
    <Cell ss:StyleID="s288"><Data ss:Type="String">’</Data></Cell>
    <Cell ss:StyleID="s289"><Data ss:Type="String">’</Data></Cell>
    <Cell ss:StyleID="s290"><Data ss:Type="String">’</Data></Cell>
    <Cell ss:StyleID="s291"><Data ss:Type="String">’</Data></Cell>
    <Cell ss:StyleID="s292"><Data ss:Type="String">’</Data></Cell>
    <Cell ss:StyleID="s293"><Data ss:Type="String">’</Data></Cell>
    <Cell ss:StyleID="s294"><Data ss:Type="String">’</Data></Cell>
    <Cell ss:StyleID="s290"><Data ss:Type="String">’</Data></Cell>
    <Cell ss:StyleID="s291"><Data ss:Type="String">’</Data></Cell>
    <Cell ss:StyleID="s292"><Data ss:Type="String">’</Data></Cell>
    <Cell ss:StyleID="s293"><Data ss:Type="String">’</Data></Cell>
    <Cell ss:StyleID="s291"><Data ss:Type="String">’</Data></Cell>
   </Row>'
         WHERE x_id1 = 40;

        UPDATE tmp_univ_rpt_data
           SET x_string2 = '
   <Row ss:AutoFitHeight="0">
    <Cell ss:StyleID="s257"><Data ss:Type="String">≤≤≤ групи</Data></Cell>
    <Cell ss:StyleID="s230"><Data ss:Type="Number">41</Data></Cell>
    <Cell ss:StyleID="s252"><Data ss:Type="Number">0</Data></Cell>
    <Cell ss:StyleID="s288"><Data ss:Type="String">’</Data></Cell>
    <Cell ss:StyleID="s288"><Data ss:Type="String">’</Data></Cell>
    <Cell ss:StyleID="s289"><Data ss:Type="String">’</Data></Cell>
    <Cell ss:StyleID="s290"><Data ss:Type="String">’</Data></Cell>
    <Cell ss:StyleID="s291"><Data ss:Type="String">’</Data></Cell>
    <Cell ss:StyleID="s292"><Data ss:Type="String">’</Data></Cell>
    <Cell ss:StyleID="s293"><Data ss:Type="String">’</Data></Cell>
    <Cell ss:StyleID="s294"><Data ss:Type="String">’</Data></Cell>
    <Cell ss:StyleID="s290"><Data ss:Type="String">’</Data></Cell>
    <Cell ss:StyleID="s291"><Data ss:Type="String">’</Data></Cell>
    <Cell ss:StyleID="s292"><Data ss:Type="String">’</Data></Cell>
    <Cell ss:StyleID="s293"><Data ss:Type="String">’</Data></Cell>
    <Cell ss:StyleID="s291"><Data ss:Type="String">’</Data></Cell>
   </Row>'
         WHERE x_id1 = 41;

        UPDATE tmp_univ_rpt_data
           SET x_string2 =
                   '
   <Row ss:AutoFitHeight="0" ss:Height="15">
    <Cell ss:StyleID="s170"><Data ss:Type="String">4.2 ƒ≥ти з ≥нвал≥дн≥стю в≥ком до 18 рок≥в</Data></Cell>
    <Cell ss:StyleID="s258"><Data ss:Type="Number">42</Data></Cell>
    <Cell ss:StyleID="s259"><Data ss:Type="Number">0</Data></Cell>
    <Cell ss:StyleID="s295"><Data ss:Type="String">’</Data></Cell>
    <Cell ss:StyleID="s295"><Data ss:Type="String">’</Data></Cell>
    <Cell ss:StyleID="s296"><Data ss:Type="String">’</Data></Cell>
    <Cell ss:StyleID="s297"><Data ss:Type="String">’</Data></Cell>
    <Cell ss:StyleID="s298"><Data ss:Type="String">’</Data></Cell>
    <Cell ss:StyleID="s299"><Data ss:Type="String">’</Data></Cell>
    <Cell ss:StyleID="s300"><Data ss:Type="String">’</Data></Cell>
    <Cell ss:StyleID="s301"><Data ss:Type="String">’</Data></Cell>
    <Cell ss:StyleID="s297"><Data ss:Type="String">’</Data></Cell>
    <Cell ss:StyleID="s298"><Data ss:Type="String">’</Data></Cell>
    <Cell ss:StyleID="s299"><Data ss:Type="String">’</Data></Cell>
    <Cell ss:StyleID="s300"><Data ss:Type="String">’</Data></Cell>
    <Cell ss:StyleID="s298"><Data ss:Type="String">’</Data></Cell>
   </Row>'
         WHERE x_id1 = 42;

        UPDATE tmp_univ_rpt_data
           SET x_string2 =
                   '
   <Row ss:AutoFitHeight="0" ss:Height="15">
    <Cell ss:StyleID="s271"><Data ss:Type="String">5. ≤нш≥ виплати</Data></Cell>
    <Cell ss:StyleID="s302"><Data ss:Type="Number">43</Data></Cell>
    <Cell ss:StyleID="s303"><Data ss:Type="String">’</Data></Cell>
    <Cell ss:StyleID="s304"><Data ss:Type="String">’</Data></Cell>
    <Cell ss:StyleID="s304"><Data ss:Type="String">’</Data></Cell>
    <Cell ss:StyleID="s305"><Data ss:Type="String">’</Data></Cell>
    <Cell ss:StyleID="s306"><Data ss:Type="Number">0</Data></Cell>
    <Cell ss:StyleID="s307"><Data ss:Type="Number">0</Data></Cell>
    <Cell ss:StyleID="s308"><Data ss:Type="Number">0</Data></Cell>
    <Cell ss:StyleID="s309"><Data ss:Type="Number">0</Data></Cell>
    <Cell ss:StyleID="s310"><Data ss:Type="Number">0</Data></Cell>
    <Cell ss:StyleID="s311"><Data ss:Type="Number">0</Data></Cell>
    <Cell ss:StyleID="s312"><Data ss:Type="Number">0</Data></Cell>
    <Cell ss:StyleID="s313"><Data ss:Type="Number">0</Data></Cell>
    <Cell ss:StyleID="s309"><Data ss:Type="Number">0</Data></Cell>
    <Cell ss:StyleID="s312"><Data ss:Type="Number">0</Data></Cell>
   </Row>'
         WHERE x_id1 = 43;
    END SET_DSDI_R1;

    -- #91702: ƒан≥ щодо виплати допомоги ¬ѕќ (у розм≥р≥ 2000 грн ≥ 3000 грн)
    PROCEDURE SET_VPO_2000_3000_R1 (p_start_dt   IN DATE,
                                    p_org_id     IN NUMBER,
                                    p_curr_org   IN NUMBER,
                                    p_jbr_id     IN DECIMAL)
    IS
        --l_org_to NUMBER;
        l_user_org   NUMBER;
    BEGIN
        /*SELECT org_to
          INTO l_org_to
          FROM v_opfu
         WHERE org_id = p_curr_org;  */

        IF p_org_id = 0
        THEN
            l_user_org := p_curr_org;
        ELSE
            l_user_org := p_org_id;
        END IF;

        DELETE FROM tmp_univ_rpt_data
              WHERE 1 = 1;

        /* insert into uss_esr.tmp_univ_rpt_data(
             x_dt1,  -- a_dt
             x_sum1, -- pdp_sum
             x_id1,  -- cnt_2K
             x_id2,  -- cnt_3k
             x_id3,  -- cnt_fml
             x_sum2, -- pdp_sum_err
             x_sum3,  -- prc_2K
             x_id5)  -- rn

     WITH
         dt_rep as (select trunc(p_start_dt,'MM') dt_r from dual),
         org AS (SELECT org_id i_org
                   FROM ikis_sys.v_opfu
                CONNECT BY PRIOR org_id = org_org
                  START WITH org_id = CASE WHEN l_user_org = 50001 THEN 50000 ELSE l_user_org END ),
         assign AS (SELECT pc_id     a_pc,
                           pd_id     a_pd,
                           dt_r a_dt,
                           sum(pdp_sum)   pdp_sum
                      FROM   uss_esr.personalcase pc,
                             uss_esr.pc_decision pd,
                             uss_esr.pd_payment pp,
                             uss_esr.pd_accrual_period pdap, dt_rep, org t
                      WHERE pd_pc = pc_id
                        AND pdp_pd = pd_id
                        AND pdap_pd = pd_id
                        AND (pc.com_org = t.i_org)
                        AND pp.history_status = 'A'
                        AND pdap.history_status = 'A'
                        AND dt_r BETWEEN pdap_start_dt AND pdap_stop_dt
                        AND dt_r BETWEEN pdp_start_dt AND pdp_stop_dt
                        AND pdp_stop_dt >= p_start_dt
                        AND pdp_start_dt <= TRUNC(sysdate,'mm')
                        AND pdap_stop_dt >= p_start_dt
                        AND pdap_start_dt <= TRUNC(sysdate,'mm')
                        AND pdp_npt IN (SELECT nptc_npt FROM USS_NDI.v_Ndi_Npt_Config WHERE nptc_nst = 664)
                        group by pc_id, pd_id, dt_r
                        ),

         dt1 AS (SELECT a_pc,
                        a_pd,
                        a_dt,
                        pdp_sum,
                        uss_esr.DNET$PAYMENT_REPORTS.getCntDistr (
                             pdp_sum,
                             (select count(distinct f.pdf_sc) from uss_esr.pd_family f where f.pdf_pd = a_pd),
                             2)  cnt_2k,
                        uss_esr.DNET$PAYMENT_REPORTS.getCntDistr (
                             pdp_sum,
                             (select count(distinct f.pdf_sc) from uss_esr.pd_family f where f.pdf_pd = a_pd),
                             3)  cnt_3k,
                         (select count(distinct f.pdf_sc) from uss_esr.pd_family f where f.pdf_pd = a_pd) cnt_fml
              from assign)

         SELECT  a_dt,
                 sum(pdp_sum)        pdp_sum,
                 sum(cnt_2k)         cnt_2k,
                 sum(cnt_3k)         cnt_3k,
                 sum(cnt_fml)        cnt_fml,
                 sum(pdp_sum) - (2000 * sum(cnt_2k)) - (3000 * sum(cnt_3k)) pdp_sum_err,
                 round(sum(cnt_2k) / (sum(cnt_2k) + sum(cnt_3k)) * 100, 2)  prc_2k,
                 1 rn
             from dt1 group by a_dt
     order by 1;

         insert into tmp_univ_rpt_data(
             x_dt1,  -- a_dt
             x_sum1, -- pdp_sum
             x_id1,  -- cnt_2K
             x_id2,  -- cnt_3k
             x_id3,  -- cnt_fml
             x_sum2, -- pdp_sum_err
             x_sum3,  -- prc_2K
             x_id5)  -- rn

         WITH
             org AS (SELECT org_id i_org
                       FROM ikis_sys.v_opfu
                    CONNECT BY PRIOR org_id = org_org
                      START WITH org_id = CASE WHEN l_user_org = 50001 THEN 50000 ELSE l_user_org END ),
             prdata AS (
                     SELECT prs_pc, pr_month, prsd_month, prsd_tp, prs_st,
                                prsd_sum,
                                uss_esr.DNET$PAYMENT_REPORTS.getCntDistr (
                                     prsd_sum * case when prsd_sum > 0 then 1 else -1 end,
                                     (select count(distinct f.pdf_sc)
                                      from uss_esr.ac_detail ad, uss_esr.pc_decision pd, uss_esr.pd_family f
                                      where ad.acd_pd = pd.pd_id
                                           and pd.pd_id = f.pdf_pd
                                           and ad.acd_prsd = prsd_id),
                                     2) as cnt_2k,
                                uss_esr.DNET$PAYMENT_REPORTS.getCntDistr (
                                     prsd_sum * case when prsd_sum > 0 then 1 else -1 end,
                                     (select count(distinct f.pdf_sc)
                                      from uss_esr.ac_detail ad, uss_esr.pc_decision pd, uss_esr.pd_family f
                                      where ad.acd_pd = pd.pd_id
                                           and pd.pd_id = f.pdf_pd
                                           and ad.acd_prsd = prsd_id),
                                     3)  cnt_3k
                         FROM uss_esr.pr_sheet_detail,
                             uss_esr.pr_sheet,
                             uss_esr.payroll pr,
                             org q
                         WHERE prs_pr = pr_id
                           AND prsd_prs = prs_id
                           AND pr.com_org = q.i_org
                           AND pr_month BETWEEN p_start_dt AND TRUNC(sysdate,'mm')
                           AND pr_month = TRUNC(p_start_dt, 'mm')
                           --AND pr_month BETWEEN trunc(p_start_dt,'MM') AND ADD_MONTHS(trunc(p_start_dt,'MM'),11)
                           AND pr_npc = 24
                           AND pr_st IN ('F')),-- select sum(prsd_sum) from  prdata where prsd_sum != (cnt_2k*2000) + (cnt_3k*3000)

             prdd AS (SELECT pr_month AS s_month,
                                SUM(CASE WHEN prs_st IN ('NA', 'KV1', 'KV2', 'PK1', 'PK2') AND pr_month = prsd_month
                                           THEN CASE WHEN prsd_tp = 'PWI' THEN prsd_sum ELSE -prsd_sum END
                                    ELSE 0 END) AS s_sum_narah_curr,
                                SUM(CASE WHEN prs_st IN ('NA', 'KV1', 'KV2', 'PK1', 'PK2') AND pr_month = prsd_month
                                           THEN cnt_2k
                                    ELSE 0 END) AS s_cnt_narah_curr_2k,
                                SUM(CASE WHEN prs_st IN ('NA', 'KV1', 'KV2', 'PK1', 'PK2') AND pr_month = prsd_month
                                           THEN cnt_3k
                                    ELSE 0 END) AS s_cnt_narah_curr_3k,

                                SUM(CASE WHEN prs_st IN ('NA', 'KV1', 'KV2') AND pr_month = prsd_month
                                           THEN CASE WHEN prsd_tp = 'PWI' THEN prsd_sum ELSE -prsd_sum END
                                    ELSE 0 END) AS s_sum_payed_curr,
                                SUM(CASE WHEN prs_st IN ('NA', 'KV1', 'KV2') AND pr_month = prsd_month
                                           THEN cnt_2k
                                    ELSE 0 END) AS s_cnt_payed_curr_2k,
                                SUM(CASE WHEN prs_st IN ('NA', 'KV1', 'KV2') AND pr_month = prsd_month
                                           THEN cnt_3k
                                    ELSE 0 END) AS s_cnt_payed_curr_3k,

                                SUM(CASE WHEN prs_st IN ('PK1', 'PK2') AND pr_month = prsd_month
                                           THEN CASE WHEN prsd_tp = 'PWI' THEN prsd_sum ELSE -prsd_sum END
                                    ELSE 0 END) AS s_sum_not_payed_curr,
                                SUM(CASE WHEN prs_st IN ('PK1', 'PK2') AND pr_month = prsd_month
                                           THEN cnt_2k
                                    ELSE 0 END) AS s_cnt_not_payed_curr_2k,
                                SUM(CASE WHEN prs_st IN ('PK1', 'PK2') AND pr_month = prsd_month
                                           THEN cnt_3k
                                    ELSE 0 END) AS s_cnt_not_payed_curr_3k,

                                SUM(CASE WHEN prs_st IN ('NA', 'KV1', 'KV2', 'PK1', 'PK2') AND pr_month <> prsd_month
                                           THEN CASE WHEN prsd_tp = 'PWI' THEN prsd_sum ELSE -prsd_sum END
                                    ELSE 0 END) AS s_sum_narah_prev,
                                SUM(CASE WHEN prs_st IN ('NA', 'KV1', 'KV2', 'PK1', 'PK2') AND pr_month <> prsd_month
                                           THEN cnt_2k
                                    ELSE 0 END) AS s_cnt_narah_prev_2k,
                                SUM(CASE WHEN prs_st IN ('NA', 'KV1', 'KV2', 'PK1', 'PK2') AND pr_month <> prsd_month
                                           THEN cnt_3k
                                    ELSE 0 END) AS s_cnt_narah_prev_3k,

                                SUM(CASE WHEN prs_st IN ('NA', 'KV1', 'KV2') AND pr_month <> prsd_month
                                           THEN CASE WHEN prsd_tp = 'PWI' THEN prsd_sum ELSE -prsd_sum END
                                    ELSE 0 END) AS s_sum_payed_prev,
                                SUM(CASE WHEN prs_st IN ('NA', 'KV1', 'KV2') AND pr_month <> prsd_month
                                           THEN cnt_2k
                                    ELSE 0 END) AS s_cnt_payed_prev_2k,
                                SUM(CASE WHEN prs_st IN ('NA', 'KV1', 'KV2') AND pr_month <> prsd_month
                                           THEN cnt_3k
                                    ELSE 0 END) AS s_cnt_payed_prev_3k,

                                SUM(CASE WHEN prs_st IN ('PK1', 'PK2') AND pr_month <> prsd_month
                                           THEN CASE WHEN prsd_tp = 'PWI' THEN prsd_sum ELSE -prsd_sum END
                                    ELSE 0 END) AS s_sum_not_payed_prev,
                                SUM(CASE WHEN prs_st IN ('PK1', 'PK2') AND pr_month <> prsd_month
                                           THEN cnt_2k
                                    ELSE 0 END) AS s_cnt_not_payed_prev_2k,
                                SUM(CASE WHEN prs_st IN ('PK1', 'PK2') AND pr_month <> prsd_month
                                           THEN cnt_3k
                                    ELSE 0 END) AS s_cnt_not_payed_prev_3k,

                                SUM(CASE WHEN prs_st IN ('NA', 'KV1', 'KV2', 'PK1', 'PK2')
                                           THEN CASE WHEN prsd_tp = 'PWI' THEN prsd_sum ELSE -prsd_sum END
                                    ELSE 0 END) AS s_sum_narah_full,
                                SUM(CASE WHEN prs_st IN ('NA', 'KV1', 'KV2', 'PK1', 'PK2')
                                           THEN cnt_2k
                                    ELSE 0 END) AS s_cnt_narah_full_2k,
                                SUM(CASE WHEN prs_st IN ('NA', 'KV1', 'KV2', 'PK1', 'PK2')
                                           THEN cnt_3k
                                    ELSE 0 END) AS s_cnt_narah_full_3k\*,


                                SUM(CASE WHEN prsd_tp = 'PWI' THEN prsd_sum ELSE -prsd_sum END) AS s_full_sum*\
                         FROM prdata
                         GROUP BY pr_month) --select * from prdd

         -- ѕотреба
         -- ќбс€г кошт≥в дл€ виплати, всього
         SELECT  s_month dt,
                 ROUND(
                     SUM(CASE WHEN s_sum_narah_full <> 0 THEN s_sum_narah_full END)
                     )    pdp_sum,
                 SUM(CASE WHEN s_sum_narah_full <> 0 THEN s_cnt_narah_full_2k END) cnt_2K,
                 SUM(CASE WHEN s_sum_narah_full <> 0 THEN s_cnt_narah_full_3k END) cnt_3K,
                 0 cnt_fml,
                 0 pdp_sum_err,
                 0 prc_2K,
                 8 rn
         FROM prdd group by s_month
         UNION ALL
         -- Ќараховано
         -- ќбс€г кошт≥в дл€ виплати, всього
         SELECT  s_month dt,
                 ROUND(
                     SUM(CASE WHEN s_sum_narah_curr <> 0 THEN s_sum_narah_curr END)
                     )    pdp_sum,
                 SUM(CASE WHEN s_sum_narah_curr <> 0 THEN s_cnt_narah_curr_2k END) cnt_2K,
                 SUM(CASE WHEN s_sum_narah_curr <> 0 THEN s_cnt_narah_curr_3k END) cnt_3K,
                 0 cnt_fml,
                 0 pdp_sum_err,
                 0 prc_2K,
                 2 rn
         FROM prdd group by s_month
         UNION ALL
         --'¬иплачено:'
         --'ќбс€г кошт≥в дл€ виплати, всього',
         SELECT  s_month dt,
                 ROUND(
                     SUM(CASE WHEN s_sum_payed_curr <> 0 THEN s_sum_payed_curr END)
                     )    pdp_sum,
                 SUM(CASE WHEN s_sum_payed_curr <> 0 THEN s_cnt_payed_curr_2k END) cnt_2K,
                 SUM(CASE WHEN s_sum_payed_curr <> 0 THEN s_cnt_payed_curr_3k END) cnt_3K,
                 0 cnt_fml,
                 0 pdp_sum_err,
                 0 prc_2K,
                 3 rn
         FROM prdd group by s_month
         UNION ALL
         -- 'Ќе виплачено:'
         -- 'ќбс€г кошт≥в дл€ виплати, всього',
         SELECT  s_month dt,
                 ROUND(
                     SUM(CASE WHEN s_sum_not_payed_curr <> 0 THEN s_sum_not_payed_curr END)
                     )    pdp_sum,
                 SUM(CASE WHEN s_sum_not_payed_curr <> 0 THEN s_cnt_not_payed_curr_2k END) cnt_2K,
                 SUM(CASE WHEN s_sum_not_payed_curr <> 0 THEN s_cnt_not_payed_curr_3k END) cnt_3K,
                 0 cnt_fml,
                 0 pdp_sum_err,
                 0 prc_2K,
                 4 rn
         FROM prdd group by s_month
         UNION ALL
         --'ѕогашенн€ заборгованост≥ за попередн≥й пер≥од:'
         --'ќбс€г кошт≥в дл€ виплати, всього',
         SELECT  s_month dt,
                 ROUND(
                     SUM(CASE WHEN s_sum_narah_prev <> 0 THEN s_sum_narah_prev END)
                     )    pdp_sum,
                 SUM(CASE WHEN s_sum_narah_prev <> 0 THEN s_cnt_narah_prev_2k END) cnt_2K,
                 SUM(CASE WHEN s_sum_narah_prev <> 0 THEN s_cnt_narah_prev_3k END) cnt_3K,
                 0 cnt_fml,
                 0 pdp_sum_err,
                 0 prc_2K,
                 5 rn
         FROM prdd group by s_month
         UNION ALL
         --'¬иплачено:'
         --'ќбс€г кошт≥в дл€ виплати, всього',
         SELECT  s_month dt,
                 ROUND(
                     SUM(CASE WHEN s_sum_payed_prev <> 0 THEN s_sum_payed_prev END)
                     )    pdp_sum,
                 SUM(CASE WHEN s_sum_payed_prev <> 0 THEN s_cnt_payed_prev_2k END) cnt_2K,
                 SUM(CASE WHEN s_sum_payed_prev <> 0 THEN s_cnt_payed_prev_3k END) cnt_3K,
                 0 cnt_fml,
                 0 pdp_sum_err,
                 0 prc_2K,
                 6 rn
         FROM prdd group by s_month
         UNION ALL
         -- ѕовернуто надм≥ру перерахованих/не знайшли отримувач≥в:
         -- ќбс€г кошт≥в дл€ виплати, всього, тис.грн
         SELECT  s_month dt,
                 ROUND(
                     SUM(CASE WHEN s_sum_not_payed_prev <> 0 THEN s_sum_not_payed_prev END)
                     )    pdp_sum,
                 SUM(CASE WHEN s_sum_not_payed_prev <> 0 THEN s_cnt_not_payed_prev_2k END) cnt_2K,
                 SUM(CASE WHEN s_sum_not_payed_prev <> 0 THEN s_cnt_not_payed_prev_3k END) cnt_3K,
                 0 cnt_fml,
                 0 pdp_sum_err,
                 0 prc_2K,
                 7 rn
         FROM prdd group by s_month
         ORDER BY 8, 1;*/

        INSERT INTO uss_esr.tmp_univ_rpt_data (x_dt1,                  -- a_dt
                                               x_sum1,              -- pdp_sum
                                               x_id1,                -- cnt_2K
                                               x_id2,                -- cnt_3k
                                               x_id3,               -- cnt_fml
                                               x_sum2,          -- pdp_sum_err
                                               x_sum3,               -- prc_2K
                                               x_id5)                    -- rn
            WITH
                dt_rep
                AS
                    (    SELECT ADD_MONTHS (TRUNC (p_start_dt, 'MM'), LEVEL - 1)    dt_r
                           FROM DUAL
                     CONNECT BY LEVEL <= 1),
                org
                AS
                    (    SELECT org_id     i_org
                           FROM ikis_sys.v_opfu
                     CONNECT BY PRIOR org_id = org_org
                     START WITH org_id =
                                CASE
                                    WHEN l_user_org = 50001 THEN 50000
                                    ELSE l_user_org
                                END),
                assign
                AS
                    (  SELECT pc_id             a_pc,
                              pd_id             a_pd,
                              dt_r              a_dt,
                              SUM (pdp_sum)     pdp_sum
                         FROM uss_esr.personalcase     pc,
                              uss_esr.pc_decision      pd,
                              uss_esr.pd_payment       pp,
                              uss_esr.pd_accrual_period pdap,
                              dt_rep,
                              org                      t
                        WHERE     pd_pc = pc_id
                              AND pdp_pd = pd_id
                              AND pdap_pd = pd_id
                              AND pp.history_status = 'A'
                              AND pdap.history_status = 'A'
                              AND (pc.com_org = t.i_org)
                              AND pp.pdp_sum > 0
                              AND dt_r BETWEEN TRUNC (pdap_start_dt, 'mm')
                                           AND pdap_stop_dt
                              AND dt_r BETWEEN TRUNC (pdp_start_dt, 'mm')
                                           AND pdp_stop_dt
                              AND pd.pd_nst = 664
                     GROUP BY pc_id, pd_id, dt_r),
                dt1
                AS
                    (SELECT a_pc,
                            a_pd,
                            a_dt,
                            pdp_sum,
                            uss_esr.DNET$PAYMENT_REPORTS.getCntDistr (
                                pdp_sum,
                                (SELECT COUNT (DISTINCT f.pdf_sc)
                                   FROM uss_esr.pd_family f
                                  WHERE f.pdf_pd = a_pd),
                                2,
                                a_pd,
                                a_dt)                   cnt_2k,
                            uss_esr.DNET$PAYMENT_REPORTS.getCntDistr (
                                pdp_sum,
                                (SELECT COUNT (DISTINCT f.pdf_sc)
                                   FROM uss_esr.pd_family f
                                  WHERE f.pdf_pd = a_pd),
                                3,
                                a_pd,
                                a_dt)                   cnt_3k,
                            (SELECT COUNT (DISTINCT f.pdf_sc)
                               FROM uss_esr.pd_family f
                              WHERE f.pdf_pd = a_pd)    cnt_fml
                       FROM assign)
              SELECT a_dt,
                     SUM (pdp_sum)              pdp_sum,
                     SUM (cnt_2k)               cnt_2k,
                     SUM (cnt_3k)               cnt_3k,
                     SUM (cnt_fml)              cnt_fml,
                       SUM (pdp_sum)
                     - (2000 * SUM (cnt_2k))
                     - (3000 * SUM (cnt_3k))    pdp_sum_err,
                     ROUND (SUM (cnt_2k) / (SUM (cnt_2k) + SUM (cnt_3k)) * 100,
                            2)                  prc_2k,
                     1                          rn
                FROM dt1
            GROUP BY a_dt
            ORDER BY 1;

        INSERT INTO uss_esr.tmp_univ_rpt_data (x_dt1,                  -- a_dt
                                               x_sum1,              -- pdp_sum
                                               x_id1,                -- cnt_2K
                                               x_id2,                -- cnt_3k
                                               x_id3,               -- cnt_fml
                                               x_sum2,          -- pdp_sum_err
                                               x_sum3,               -- prc_2K
                                               x_id5)                    -- rn
            WITH
                org
                AS
                    (    SELECT org_id     i_org
                           FROM ikis_sys.v_opfu
                     CONNECT BY PRIOR org_id = org_org
                     START WITH org_id =
                                CASE
                                    WHEN l_user_org = 50001 THEN 50000
                                    ELSE l_user_org
                                END),
                prdata
                AS
                    (SELECT prs_pc,
                            pr_month,
                            prsd_month,
                            prsd_tp,
                            prs_st,
                            prsd_sum,
                            uss_esr.DNET$PAYMENT_REPORTS.getCntDistr (
                                  prsd_sum
                                * CASE WHEN prsd_sum > 0 THEN 1 ELSE -1 END,
                                (SELECT COUNT (DISTINCT f.pdf_sc)
                                   FROM uss_esr.ac_detail    ad,
                                        uss_esr.pc_decision  pd,
                                        uss_esr.pd_family    f
                                  WHERE     ad.acd_pd = pd.pd_id
                                        AND pd.pd_id = f.pdf_pd
                                        AND ad.acd_prsd = prsd_id),
                                2,
                                (SELECT MAX (ad.acd_pd)
                                   FROM uss_esr.ac_detail ad
                                  WHERE ad.acd_prsd = prsd_id),
                                prsd_month)    AS cnt_2k,
                            uss_esr.DNET$PAYMENT_REPORTS.getCntDistr (
                                  prsd_sum
                                * CASE WHEN prsd_sum > 0 THEN 1 ELSE -1 END,
                                (SELECT COUNT (DISTINCT f.pdf_sc)
                                   FROM uss_esr.ac_detail    ad,
                                        uss_esr.pc_decision  pd,
                                        uss_esr.pd_family    f
                                  WHERE     ad.acd_pd = pd.pd_id
                                        AND pd.pd_id = f.pdf_pd
                                        AND ad.acd_prsd = prsd_id),
                                3,
                                (SELECT MAX (ad.acd_pd)
                                   FROM uss_esr.ac_detail ad
                                  WHERE ad.acd_prsd = prsd_id),
                                prsd_month)    cnt_3k
                       FROM uss_esr.pr_sheet_detail,
                            uss_esr.pr_sheet,
                            uss_esr.pc_account  pa,
                            uss_esr.payroll     pr,
                            org                 t
                      WHERE     prs_pr = pr_id
                            AND prsd_prs = prs_id
                            AND prs_pa = pa.pa_id
                            AND prs_tp IN ('PP', 'PB')
                            AND pr_st IN ('F')
                            AND pr.com_org = t.i_org
                            AND pa.pa_nst = 664
                            AND pr_month = p_start_dt), -- select sum(prsd_sum) from  prdata where prsd_sum != (cnt_2k*2000) + (cnt_3k*3000)
                prdd
                AS
                    (  SELECT pr_month     AS s_month,
                              SUM (
                                  CASE
                                      WHEN     prs_st IN ('NA',
                                                          'KV1',
                                                          'KV2',
                                                          'PK1',
                                                          'PK2')
                                           AND pr_month = prsd_month
                                      THEN
                                          CASE
                                              WHEN prsd_tp IN ('PWI', 'RDN')
                                              THEN
                                                  prsd_sum
                                              ELSE
                                                  -prsd_sum
                                          END
                                      ELSE
                                          0
                                  END)     AS s_sum_narah_curr,
                              SUM (CASE
                                       WHEN     prs_st IN ('NA',
                                                           'KV1',
                                                           'KV2',
                                                           'PK1',
                                                           'PK2')
                                            AND pr_month = prsd_month
                                       THEN
                                           cnt_2k
                                       ELSE
                                           0
                                   END)    AS s_cnt_narah_curr_2k,
                              SUM (CASE
                                       WHEN     prs_st IN ('NA',
                                                           'KV1',
                                                           'KV2',
                                                           'PK1',
                                                           'PK2')
                                            AND pr_month = prsd_month
                                       THEN
                                           cnt_3k
                                       ELSE
                                           0
                                   END)    AS s_cnt_narah_curr_3k,
                              SUM (
                                  CASE
                                      WHEN     prs_st IN ('NA', 'KV1', 'KV2')
                                           AND pr_month = prsd_month
                                      THEN
                                          CASE
                                              WHEN prsd_tp IN ('PWI', 'RDN')
                                              THEN
                                                  prsd_sum
                                              ELSE
                                                  -prsd_sum
                                          END
                                      ELSE
                                          0
                                  END)     AS s_sum_payed_curr,
                              SUM (
                                  CASE
                                      WHEN     prs_st IN ('NA', 'KV1', 'KV2')
                                           AND pr_month = prsd_month
                                      THEN
                                          cnt_2k
                                      ELSE
                                          0
                                  END)     AS s_cnt_payed_curr_2k,
                              SUM (
                                  CASE
                                      WHEN     prs_st IN ('NA', 'KV1', 'KV2')
                                           AND pr_month = prsd_month
                                      THEN
                                          cnt_3k
                                      ELSE
                                          0
                                  END)     AS s_cnt_payed_curr_3k,
                              SUM (
                                  CASE
                                      WHEN     prs_st IN ('PK1', 'PK2')
                                           AND pr_month = prsd_month
                                      THEN
                                          CASE
                                              WHEN prsd_tp IN ('PWI', 'RDN')
                                              THEN
                                                  prsd_sum
                                              ELSE
                                                  -prsd_sum
                                          END
                                      ELSE
                                          0
                                  END)     AS s_sum_not_payed_curr,
                              SUM (
                                  CASE
                                      WHEN     prs_st IN ('PK1', 'PK2')
                                           AND pr_month = prsd_month
                                      THEN
                                          cnt_2k
                                      ELSE
                                          0
                                  END)     AS s_cnt_not_payed_curr_2k,
                              SUM (
                                  CASE
                                      WHEN     prs_st IN ('PK1', 'PK2')
                                           AND pr_month = prsd_month
                                      THEN
                                          cnt_3k
                                      ELSE
                                          0
                                  END)     AS s_cnt_not_payed_curr_3k,
                              SUM (
                                  CASE
                                      WHEN     prs_st IN ('NA',
                                                          'KV1',
                                                          'KV2',
                                                          'PK1',
                                                          'PK2')
                                           AND pr_month <> prsd_month
                                      THEN
                                          CASE
                                              WHEN prsd_tp IN ('PWI', 'RDN')
                                              THEN
                                                  prsd_sum
                                              ELSE
                                                  -prsd_sum
                                          END
                                      ELSE
                                          0
                                  END)     AS s_sum_narah_prev,
                              SUM (CASE
                                       WHEN     prs_st IN ('NA',
                                                           'KV1',
                                                           'KV2',
                                                           'PK1',
                                                           'PK2')
                                            AND pr_month <> prsd_month
                                       THEN
                                           cnt_2k
                                       ELSE
                                           0
                                   END)    AS s_cnt_narah_prev_2k,
                              SUM (CASE
                                       WHEN     prs_st IN ('NA',
                                                           'KV1',
                                                           'KV2',
                                                           'PK1',
                                                           'PK2')
                                            AND pr_month <> prsd_month
                                       THEN
                                           cnt_3k
                                       ELSE
                                           0
                                   END)    AS s_cnt_narah_prev_3k,
                              SUM (
                                  CASE
                                      WHEN     prs_st IN ('NA', 'KV1', 'KV2')
                                           AND pr_month <> prsd_month
                                      THEN
                                          CASE
                                              WHEN prsd_tp IN ('PWI', 'RDN')
                                              THEN
                                                  prsd_sum
                                              ELSE
                                                  -prsd_sum
                                          END
                                      ELSE
                                          0
                                  END)     AS s_sum_payed_prev,
                              SUM (
                                  CASE
                                      WHEN     prs_st IN ('NA', 'KV1', 'KV2')
                                           AND pr_month <> prsd_month
                                      THEN
                                          cnt_2k
                                      ELSE
                                          0
                                  END)     AS s_cnt_payed_prev_2k,
                              SUM (
                                  CASE
                                      WHEN     prs_st IN ('NA', 'KV1', 'KV2')
                                           AND pr_month <> prsd_month
                                      THEN
                                          cnt_3k
                                      ELSE
                                          0
                                  END)     AS s_cnt_payed_prev_3k,
                              SUM (
                                  CASE
                                      WHEN     prs_st IN ('PK1', 'PK2')
                                           AND pr_month <> prsd_month
                                      THEN
                                          CASE
                                              WHEN prsd_tp IN ('PWI', 'RDN')
                                              THEN
                                                  prsd_sum
                                              ELSE
                                                  -prsd_sum
                                          END
                                      ELSE
                                          0
                                  END)     AS s_sum_not_payed_prev,
                              SUM (
                                  CASE
                                      WHEN     prs_st IN ('PK1', 'PK2')
                                           AND pr_month <> prsd_month
                                      THEN
                                          cnt_2k
                                      ELSE
                                          0
                                  END)     AS s_cnt_not_payed_prev_2k,
                              SUM (
                                  CASE
                                      WHEN     prs_st IN ('PK1', 'PK2')
                                           AND pr_month <> prsd_month
                                      THEN
                                          cnt_3k
                                      ELSE
                                          0
                                  END)     AS s_cnt_not_payed_prev_3k,
                              SUM (
                                  CASE
                                      WHEN prs_st IN ('NA',
                                                      'KV1',
                                                      'KV2',
                                                      'PK1',
                                                      'PK2')
                                      THEN
                                          CASE
                                              WHEN prsd_tp IN ('PWI', 'RDN')
                                              THEN
                                                  prsd_sum
                                              ELSE
                                                  -prsd_sum
                                          END
                                      ELSE
                                          0
                                  END)     AS s_sum_narah_full,
                              SUM (CASE
                                       WHEN prs_st IN ('NA',
                                                       'KV1',
                                                       'KV2',
                                                       'PK1',
                                                       'PK2')
                                       THEN
                                           cnt_2k
                                       ELSE
                                           0
                                   END)    AS s_cnt_narah_full_2k,
                              SUM (CASE
                                       WHEN prs_st IN ('NA',
                                                       'KV1',
                                                       'KV2',
                                                       'PK1',
                                                       'PK2')
                                       THEN
                                           cnt_3k
                                       ELSE
                                           0
                                   END)    AS s_cnt_narah_full_3k /*,


                            SUM(CASE WHEN prsd_tp = prsd_tp IN ('PWI', 'RDN') THEN prsd_sum ELSE -prsd_sum END) AS s_full_sum*/
                         FROM prdata
                     GROUP BY pr_month)                   --select * from prdd
                  -- ѕотреба
                  -- ќбс€г кошт≥в дл€ виплати, всього
                  SELECT s_month          dt,
                         ROUND (
                             SUM (
                                 CASE
                                     WHEN s_sum_narah_full <> 0
                                     THEN
                                         s_sum_narah_full
                                 END))    pdp_sum,
                         SUM (
                             CASE
                                 WHEN s_sum_narah_full <> 0
                                 THEN
                                     s_cnt_narah_full_2k
                             END)         cnt_2K,
                         SUM (
                             CASE
                                 WHEN s_sum_narah_full <> 0
                                 THEN
                                     s_cnt_narah_full_3k
                             END)         cnt_3K,
                         0                cnt_fml,
                         0                pdp_sum_err,
                         0                prc_2K,
                         8                rn
                    FROM prdd
                GROUP BY s_month
                UNION ALL
                  -- Ќараховано
                  -- ќбс€г кошт≥в дл€ виплати, всього
                  SELECT s_month          dt,
                         ROUND (
                             SUM (
                                 CASE
                                     WHEN s_sum_narah_curr <> 0
                                     THEN
                                         s_sum_narah_curr
                                 END))    pdp_sum,
                         SUM (
                             CASE
                                 WHEN s_sum_narah_curr <> 0
                                 THEN
                                     s_cnt_narah_curr_2k
                             END)         cnt_2K,
                         SUM (
                             CASE
                                 WHEN s_sum_narah_curr <> 0
                                 THEN
                                     s_cnt_narah_curr_3k
                             END)         cnt_3K,
                         0                cnt_fml,
                         0                pdp_sum_err,
                         0                prc_2K,
                         2                rn
                    FROM prdd
                GROUP BY s_month
                UNION ALL
                  --'¬иплачено:'
                  --'ќбс€г кошт≥в дл€ виплати, всього',
                  SELECT s_month          dt,
                         ROUND (
                             SUM (
                                 CASE
                                     WHEN s_sum_payed_curr <> 0
                                     THEN
                                         s_sum_payed_curr
                                 END))    pdp_sum,
                         SUM (
                             CASE
                                 WHEN s_sum_payed_curr <> 0
                                 THEN
                                     s_cnt_payed_curr_2k
                             END)         cnt_2K,
                         SUM (
                             CASE
                                 WHEN s_sum_payed_curr <> 0
                                 THEN
                                     s_cnt_payed_curr_3k
                             END)         cnt_3K,
                         0                cnt_fml,
                         0                pdp_sum_err,
                         0                prc_2K,
                         3                rn
                    FROM prdd
                GROUP BY s_month
                UNION ALL
                  -- 'Ќе виплачено:'
                  -- 'ќбс€г кошт≥в дл€ виплати, всього',
                  SELECT s_month          dt,
                         ROUND (
                             SUM (
                                 CASE
                                     WHEN s_sum_not_payed_curr <> 0
                                     THEN
                                         s_sum_not_payed_curr
                                 END))    pdp_sum,
                         SUM (
                             CASE
                                 WHEN s_sum_not_payed_curr <> 0
                                 THEN
                                     s_cnt_not_payed_curr_2k
                             END)         cnt_2K,
                         SUM (
                             CASE
                                 WHEN s_sum_not_payed_curr <> 0
                                 THEN
                                     s_cnt_not_payed_curr_3k
                             END)         cnt_3K,
                         0                cnt_fml,
                         0                pdp_sum_err,
                         0                prc_2K,
                         4                rn
                    FROM prdd
                GROUP BY s_month
                UNION ALL
                  --'ѕогашенн€ заборгованост≥ за попередн≥й пер≥од:'
                  --'ќбс€г кошт≥в дл€ виплати, всього',
                  SELECT s_month          dt,
                         ROUND (
                             SUM (
                                 CASE
                                     WHEN s_sum_narah_prev <> 0
                                     THEN
                                         s_sum_narah_prev
                                 END))    pdp_sum,
                         SUM (
                             CASE
                                 WHEN s_sum_narah_prev <> 0
                                 THEN
                                     s_cnt_narah_prev_2k
                             END)         cnt_2K,
                         SUM (
                             CASE
                                 WHEN s_sum_narah_prev <> 0
                                 THEN
                                     s_cnt_narah_prev_3k
                             END)         cnt_3K,
                         0                cnt_fml,
                         0                pdp_sum_err,
                         0                prc_2K,
                         5                rn
                    FROM prdd
                GROUP BY s_month
                UNION ALL
                  --'¬иплачено:'
                  --'ќбс€г кошт≥в дл€ виплати, всього',
                  SELECT s_month          dt,
                         ROUND (
                             SUM (
                                 CASE
                                     WHEN s_sum_payed_prev <> 0
                                     THEN
                                         s_sum_payed_prev
                                 END))    pdp_sum,
                         SUM (
                             CASE
                                 WHEN s_sum_payed_prev <> 0
                                 THEN
                                     s_cnt_payed_prev_2k
                             END)         cnt_2K,
                         SUM (
                             CASE
                                 WHEN s_sum_payed_prev <> 0
                                 THEN
                                     s_cnt_payed_prev_3k
                             END)         cnt_3K,
                         0                cnt_fml,
                         0                pdp_sum_err,
                         0                prc_2K,
                         6                rn
                    FROM prdd
                GROUP BY s_month
                UNION ALL
                  -- ѕовернуто надм≥ру перерахованих/не знайшли отримувач≥в:
                  -- ќбс€г кошт≥в дл€ виплати, всього, тис.грн
                  SELECT s_month          dt,
                         ROUND (
                             SUM (
                                 CASE
                                     WHEN s_sum_not_payed_prev <> 0
                                     THEN
                                         s_sum_not_payed_prev
                                 END))    pdp_sum,
                         SUM (
                             CASE
                                 WHEN s_sum_not_payed_prev <> 0
                                 THEN
                                     s_cnt_not_payed_prev_2k
                             END)         cnt_2K,
                         SUM (
                             CASE
                                 WHEN s_sum_not_payed_prev <> 0
                                 THEN
                                     s_cnt_not_payed_prev_3k
                             END)         cnt_3K,
                         0                cnt_fml,
                         0                pdp_sum_err,
                         0                prc_2K,
                         7                rn
                    FROM prdd
                GROUP BY s_month
                ORDER BY 8, 1;


        FOR xx
            IN (WITH
                    dat
                    AS
                        (SELECT 1 AS x_id FROM DUAL
                         UNION ALL
                         SELECT 2 AS x_id FROM DUAL
                         UNION ALL
                         SELECT 3 AS x_id FROM DUAL
                         UNION ALL
                         SELECT 4 AS x_id FROM DUAL
                         UNION ALL
                         SELECT 5 AS x_id FROM DUAL
                         UNION ALL
                         SELECT 6 AS x_id FROM DUAL
                         UNION ALL
                         SELECT 7 AS x_id FROM DUAL)
                  SELECT x_id                     AS tab,
                         SUM (cnt_2K + cnt_3K)    pers_1,
                         SUM (cnt_2K)             pers_1_2000,
                         SUM (cnt_3K)             pers_1_3000,
                         SUM (pdp_sum) / 1000     sum_1,
                         ROUND (
                               SUM (
                                     pdp_sum
                                   * 2
                                   * cnt_2k
                                   / (2 * cnt_2k + 3 * cnt_3k))
                             / 1000,
                             2)                   sum_1_2000,
                         ROUND (
                               SUM (
                                     pdp_sum
                                   * 3
                                   * cnt_3k
                                   / (2 * cnt_2k + 3 * cnt_3k))
                             / 1000,
                             2)                   sum_1_3000
                    FROM (SELECT x_dt1      a_dt,
                                 x_sum1     pdp_sum,
                                 x_id1      cnt_2K,
                                 x_id2      cnt_3k,
                                 x_id3      cnt_fml,
                                 x_sum2     pdp_sum_err,
                                 x_sum3     prc_2K,
                                 x_id5      rn,
                                 q.x_id
                            FROM uss_esr.tmp_univ_rpt_data d
                                 JOIN dat q ON (q.x_id = d.x_id5)--where d.x_id5 = 1
                                                                 )
                GROUP BY x_id)
        LOOP
            RDM$RTFL.AddParam (p_jbr_id, 'pers_' || xx.tab, xx.pers_1);
            RDM$RTFL.AddParam (p_jbr_id,
                               'pers_' || xx.tab || '_2000',
                               xx.pers_1_2000);
            RDM$RTFL.AddParam (p_jbr_id,
                               'pers_' || xx.tab || '_3000',
                               xx.pers_1_3000);

            IF (xx.tab != 1)
            THEN
                RDM$RTFL.AddParam (
                    p_jbr_id,
                    'sum_' || xx.tab || '',
                    TO_CHAR (xx.sum_1,
                             'FM9G999G999G999G999G990D00',
                             'NLS_NUMERIC_CHARACTERS='','''''));
                RDM$RTFL.AddParam (
                    p_jbr_id,
                    'sum_' || xx.tab || '_2000',
                    TO_CHAR (xx.sum_1_2000,
                             'FM9G999G999G999G999G990D00',
                             'NLS_NUMERIC_CHARACTERS='','''''));
                RDM$RTFL.AddParam (
                    p_jbr_id,
                    'sum_' || xx.tab || '_3000',
                    TO_CHAR (xx.sum_1_3000,
                             'FM9G999G999G999G999G990D00',
                             'NLS_NUMERIC_CHARACTERS='','''''));
            END IF;
        END LOOP;

        FOR xx IN (SELECT SUM (pdp_sum) / 1000     sum_1
                     FROM (SELECT x_dt1      a_dt,
                                  x_sum1     pdp_sum,
                                  x_id1      cnt_2K,
                                  x_id2      cnt_3k,
                                  x_id3      cnt_fml,
                                  x_sum2     pdp_sum_err,
                                  x_sum3     prc_2K,
                                  x_id5      rn
                             FROM uss_esr.tmp_univ_rpt_data d
                            WHERE d.x_id5 = 8))
        LOOP
            RDM$RTFL.AddParam (
                p_jbr_id,
                'sum_1',
                TO_CHAR (xx.sum_1,
                         'FM9G999G999G999G999G990D00',
                         'NLS_NUMERIC_CHARACTERS='','''''));
        END LOOP;

        FOR xx
            IN (SELECT ROUND (
                             SUM (
                                   pdp_sum
                                 * 2
                                 * cnt_2k
                                 / (2 * cnt_2k + 3 * cnt_3k))
                           / 1000,
                           2)    sum_1_2000,
                       ROUND (
                             SUM (
                                   pdp_sum
                                 * 3
                                 * cnt_3k
                                 / (2 * cnt_2k + 3 * cnt_3k))
                           / 1000,
                           2)    sum_1_3000
                  FROM (SELECT x_dt1      a_dt,
                               x_sum1     pdp_sum,
                               x_id1      cnt_2K,
                               x_id2      cnt_3k,
                               x_id3      cnt_fml,
                               x_sum2     pdp_sum_err,
                               x_sum3     prc_2K,
                               x_id5      rn
                          FROM uss_esr.tmp_univ_rpt_data d
                         WHERE d.x_id5 IN (2, 5)))
        LOOP
            RDM$RTFL.AddParam (
                p_jbr_id,
                'sum_1_2000',
                TO_CHAR (xx.sum_1_2000,
                         'FM9G999G999G999G999G990D00',
                         'NLS_NUMERIC_CHARACTERS='','''''));
            RDM$RTFL.AddParam (
                p_jbr_id,
                'sum_1_3000',
                TO_CHAR (xx.sum_1_3000,
                         'FM9G999G999G999G999G990D00',
                         'NLS_NUMERIC_CHARACTERS='','''''));
        END LOOP;
    /*
    FOR xx IN (select   SUM(cnt_2K + cnt_3K) pers_2,
                        sum(cnt_2K) pers_2_2000,
                        sum(cnt_3K) pers_2_3000,
                        SUM(pdp_sum) sum_2,
                        round(sum(pdp_sum * 2 * cnt_2k / (2 * cnt_2k + 3 * cnt_3k)), 2) sum_2_2000,
                        round(sum(pdp_sum * 3 * cnt_2k / (2 * cnt_2k + 3 * cnt_3k)), 2) sum_2_3000
                    from (
                select  x_dt1   a_dt,
                        x_sum1  pdp_sum,
                        x_id1   cnt_2K,
                        x_id2   cnt_3k,
                        x_id3   cnt_fml,
                        x_sum2  pdp_sum_err,
                        x_sum3  prc_2K,
                        x_id5   rn
                    from uss_esr.tmp_univ_rpt_data d where d.x_id5 = 2)
              )
    LOOP
      RDM$RTFL.AddParam(p_jbr_id, 'pers_2', xx.pers_2);
      RDM$RTFL.AddParam(p_jbr_id, 'pers_2_2000', xx.pers_2_2000);
      RDM$RTFL.AddParam(p_jbr_id, 'pers_2_3000', xx.pers_2_3000);

      RDM$RTFL.AddParam(p_jbr_id, 'sum_2', xx.sum_2);
      RDM$RTFL.AddParam(p_jbr_id, 'sum_2_2000', xx.sum_2_2000);
      RDM$RTFL.AddParam(p_jbr_id, 'sum_2_3000', xx.sum_2_3000);
    END LOOP;

    FOR xx IN (select   SUM(cnt_2K + cnt_3K) pers_3,
                        sum(cnt_2K) pers_3_2000,
                        sum(cnt_3K) pers_3_3000,
                        SUM(pdp_sum) sum_3,
                        round(sum(pdp_sum * 2 * cnt_2k / (2 * cnt_2k + 3 * cnt_3k)), 2) sum_3_2000,
                        round(sum(pdp_sum * 3 * cnt_2k / (2 * cnt_2k + 3 * cnt_3k)), 2) sum_3_3000
                    from (
                select  x_dt1   a_dt,
                        x_sum1  pdp_sum,
                        x_id1   cnt_2K,
                        x_id2   cnt_3k,
                        x_id3   cnt_fml,
                        x_sum2  pdp_sum_err,
                        x_sum3  prc_2K,
                        x_id5   rn
                    from uss_esr.tmp_univ_rpt_data d where d.x_id5 = 3)
              )
    LOOP
      RDM$RTFL.AddParam(p_jbr_id, 'pers_3', xx.pers_3);
      RDM$RTFL.AddParam(p_jbr_id, 'pers_3_2000', xx.pers_3_2000);
      RDM$RTFL.AddParam(p_jbr_id, 'pers_3_3000', xx.pers_3_3000);

      RDM$RTFL.AddParam(p_jbr_id, 'sum_3', xx.sum_3);
      RDM$RTFL.AddParam(p_jbr_id, 'sum_3_2000', xx.sum_3_2000);
      RDM$RTFL.AddParam(p_jbr_id, 'sum_3_3000', xx.sum_3_3000);
    END LOOP;

    FOR xx IN (select   SUM(cnt_2K + cnt_3K) pers_4,
                        sum(cnt_2K) pers_4_2000,
                        sum(cnt_3K) pers_4_3000,
                        SUM(pdp_sum) sum_4,
                        round(sum(pdp_sum * 2 * cnt_2k / (2 * cnt_2k + 3 * cnt_3k)), 2) sum_4_2000,
                        round(sum(pdp_sum * 3 * cnt_2k / (2 * cnt_2k + 3 * cnt_3k)), 2) sum_4_3000
                    from (
                select  x_dt1   a_dt,
                        x_sum1  pdp_sum,
                        x_id1   cnt_2K,
                        x_id2   cnt_3k,
                        x_id3   cnt_fml,
                        x_sum2  pdp_sum_err,
                        x_sum3  prc_2K,
                        x_id5   rn
                    from uss_esr.tmp_univ_rpt_data d where d.x_id5 = 4)
              )
    LOOP
      RDM$RTFL.AddParam(p_jbr_id, 'pers_4', xx.pers_4);
      RDM$RTFL.AddParam(p_jbr_id, 'pers_4_2000', xx.pers_4_2000);
      RDM$RTFL.AddParam(p_jbr_id, 'pers_4_3000', xx.pers_4_3000);

      RDM$RTFL.AddParam(p_jbr_id, 'sum_4', xx.sum_4);
      RDM$RTFL.AddParam(p_jbr_id, 'sum_4_2000', xx.sum_4_2000);
      RDM$RTFL.AddParam(p_jbr_id, 'sum_4_3000', xx.sum_4_3000);
    END LOOP;

    FOR xx IN (select   SUM(cnt_2K + cnt_3K) pers_5,
                        sum(cnt_2K) pers_5_2000,
                        sum(cnt_3K) pers_5_3000,
                        SUM(pdp_sum) sum_5,
                        round(sum(pdp_sum * 2 * cnt_2k / (2 * cnt_2k + 3 * cnt_3k)), 2) sum_5_2000,
                        round(sum(pdp_sum * 3 * cnt_2k / (2 * cnt_2k + 3 * cnt_3k)), 2) sum_5_3000
                    from (
                select  x_dt1   a_dt,
                        x_sum1  pdp_sum,
                        x_id1   cnt_2K,
                        x_id2   cnt_3k,
                        x_id3   cnt_fml,
                        x_sum2  pdp_sum_err,
                        x_sum3  prc_2K,
                        x_id5   rn
                    from uss_esr.tmp_univ_rpt_data d where d.x_id5 = 5)
              )
    LOOP
      RDM$RTFL.AddParam(p_jbr_id, 'pers_5', xx.pers_5);
      RDM$RTFL.AddParam(p_jbr_id, 'pers_5_2000', xx.pers_5_2000);
      RDM$RTFL.AddParam(p_jbr_id, 'pers_5_3000', xx.pers_5_3000);

      RDM$RTFL.AddParam(p_jbr_id, 'sum_5', xx.sum_5);
      RDM$RTFL.AddParam(p_jbr_id, 'sum_5_2000', xx.sum_5_2000);
      RDM$RTFL.AddParam(p_jbr_id, 'sum_5_3000', xx.sum_5_3000);
    END LOOP;

    FOR xx IN (select   SUM(cnt_2K + cnt_3K) pers_6,
                        sum(cnt_2K) pers_6_2000,
                        sum(cnt_3K) pers_6_3000,
                        SUM(pdp_sum) sum_6,
                        round(sum(pdp_sum * 2 * cnt_2k / (2 * cnt_2k + 3 * cnt_3k)), 2) sum_6_2000,
                        round(sum(pdp_sum * 3 * cnt_2k / (2 * cnt_2k + 3 * cnt_3k)), 2) sum_6_3000
                    from (
                select  x_dt1   a_dt,
                        x_sum1  pdp_sum,
                        x_id1   cnt_2K,
                        x_id2   cnt_3k,
                        x_id3   cnt_fml,
                        x_sum2  pdp_sum_err,
                        x_sum3  prc_2K,
                        x_id5   rn
                    from uss_esr.tmp_univ_rpt_data d where d.x_id5 = 6)
              )
    LOOP
      RDM$RTFL.AddParam(p_jbr_id, 'pers_6', xx.pers_6);
      RDM$RTFL.AddParam(p_jbr_id, 'pers_6_2000', xx.pers_6_2000);
      RDM$RTFL.AddParam(p_jbr_id, 'pers_6_3000', xx.pers_6_3000);

      RDM$RTFL.AddParam(p_jbr_id, 'sum_6', xx.sum_6);
      RDM$RTFL.AddParam(p_jbr_id, 'sum_6_2000', xx.sum_6_2000);
      RDM$RTFL.AddParam(p_jbr_id, 'sum_6_3000', xx.sum_6_3000);
    END LOOP;

    FOR xx IN (select   SUM(cnt_2K + cnt_3K) pers_7,
                        sum(cnt_2K) pers_7_2000,
                        sum(cnt_3K) pers_7_3000,
                        SUM(pdp_sum) sum_7,
                        round(sum(pdp_sum * 2 * cnt_2k / (2 * cnt_2k + 3 * cnt_3k)), 2) sum_7_2000,
                        round(sum(pdp_sum * 3 * cnt_2k / (2 * cnt_2k + 3 * cnt_3k)), 2) sum_7_3000
                    from (
                select  x_dt1   a_dt,
                        x_sum1  pdp_sum,
                        x_id1   cnt_2K,
                        x_id2   cnt_3k,
                        x_id3   cnt_fml,
                        x_sum2  pdp_sum_err,
                        x_sum3  prc_2K,
                        x_id5   rn
                    from uss_esr.tmp_univ_rpt_data d where d.x_id5 = 7)
              )
    LOOP
      RDM$RTFL.AddParam(p_jbr_id, 'pers_7', xx.pers_7);
      RDM$RTFL.AddParam(p_jbr_id, 'pers_7_2000', xx.pers_7_2000);
      RDM$RTFL.AddParam(p_jbr_id, 'pers_7_3000', xx.pers_7_3000);

      RDM$RTFL.AddParam(p_jbr_id, 'sum_7', xx.sum_7);
      RDM$RTFL.AddParam(p_jbr_id, 'sum_7_2000', xx.sum_7_2000);
      RDM$RTFL.AddParam(p_jbr_id, 'sum_7_3000', xx.sum_7_3000);
    END LOOP;
  */


    END SET_VPO_2000_3000_R1;

    -- IC #92714  ¬иплата допомоги ¬ѕќ (реЇстри)
    PROCEDURE SET_PAID_VPO_R5 (p_start_dt   IN DATE,
                               p_org_id     IN NUMBER,
                               p_jbr_id     IN DECIMAL)
    IS
        l_user_org   NUMBER;
    BEGIN
        IF p_org_id = 0
        THEN
            l_user_org := Tools.GetCurrOrg;
        ELSE
            l_user_org := p_org_id;
        END IF;

        DELETE FROM tmp_univ_rpt_data
              WHERE 1 = 1;

        INSERT INTO uss_esr.tmp_univ_rpt_data (x_id1,              --  од ƒ—«Ќ
                                               x_string1,             -- Ќазва
                                               x_dt1,                -- ћ≥с€ць
                                               x_id2, --  ≥льк≥сть ≈ќ— по сумам `в реЇстри`
                                               x_sum1,       -- —ума в реЇстри
                                               x_id3, --  ≥льк≥сть ≈ќ— по `не заблоковано`
                                               x_sum2,  -- —ума не заблоковано
                                               x_id4, --  ≥льк≥сть ≈ќ— 'з зарахуванн€м'
                                               x_sum3)    -- —ума 'зарахована'
            WITH
                org
                AS
                    (    SELECT org_id     i_org
                           FROM ikis_sys.v_opfu
                     CONNECT BY PRIOR org_id = org_org
                     START WITH org_id =
                                CASE
                                    WHEN l_user_org = 50001 THEN 50000
                                    ELSE l_user_org
                                END),
                payed
                AS
                    (  SELECT org_org         AS x_org,
                              pr_month        AS x_month,
                              SUM (
                                  CASE
                                      WHEN prs_st IN ('NA', 'KV1', 'KV2')
                                      THEN
                                          CASE
                                              WHEN prsd_tp IN ('PWI', 'RDN')
                                              THEN
                                                  prsd_sum
                                              ELSE
                                                  -prsd_sum
                                          END
                                  END)        AS x_sum_curr,
                              COUNT (
                                  DISTINCT
                                      CASE
                                          WHEN prs_st IN ('NA', 'KV1', 'KV2')
                                          THEN
                                              prs_pc
                                      END)    AS x_cnt_curr,
                              SUM (
                                  CASE
                                      WHEN prs_st IN ('KV2')
                                      THEN
                                          CASE
                                              WHEN prsd_tp IN ('PWI', 'RDN')
                                              THEN
                                                  prsd_sum
                                              ELSE
                                                  -prsd_sum
                                          END
                                  END)        AS x_sum_kv2,
                              COUNT (
                                  DISTINCT
                                      CASE
                                          WHEN prs_st IN ('KV2') THEN prs_pc
                                      END)    AS x_cnt_kv2              /*,
SUM(CASE WHEN prs_st IN ('NA', 'KV1', 'KV2', 'PK1', 'PK2') THEN CASE WHEN prsd_tp IN ('PWI', 'RDN') THEN prsd_sum ELSE -prsd_sum END END) AS s_sum_full,
COUNT(DISTINCT CASE WHEN prs_st IN ('NA', 'KV1', 'KV2', 'PK1', 'PK2') THEN prs_pc END) AS s_cnt_full*/
                         FROM ikis_sys.v_opfu,
                              uss_esr.pr_sheet_detail,
                              uss_esr.pr_sheet,
                              uss_esr.payroll pr,
                              org
                        WHERE     org_to = 32
                              AND org_id = org.i_org
                              AND pr.com_org = org_id
                              AND prs_pr = pr_id
                              AND prsd_prs = prs_id
                              AND pr_month BETWEEN TRUNC (p_start_dt, 'mm')
                                               AND LAST_DAY (p_start_dt)
                              AND pr_st IN ('F')
                              AND pr_npc = 24
                     GROUP BY org_org, pr_month),
                reestr
                AS
                    (  SELECT org_org              AS s_org,
                              pr_month             AS s_month,
                              SUM (pe_sum)         AS s_sum_full,
                              SUM (pe_row_cnt)     AS s_cnt_full
                         FROM ikis_sys.v_opfu,
                              uss_esr.payroll_reestr,
                              uss_esr.payroll pr,
                              org
                        WHERE     org_to = 32
                              AND org_id = org.i_org
                              AND pr.com_org = org_id
                              AND pe_pr = pr_id
                              AND pr_month BETWEEN TRUNC (p_start_dt, 'mm')
                                               AND LAST_DAY (p_start_dt)
                              AND pr_st IN ('F')
                              AND pr_npc = 24
                              AND pe_class = 'AID'
                              AND pe_rbm_pkt IS NOT NULL
                     GROUP BY org_org, pr_month)
              SELECT org_code       " од ƒ—«Ќ",
                     org_name       "Ќазва",
                     x_month        "ћ≥с€ць",
                     x_cnt_full     " ≥льк≥сть р€дк≥в по сумам `в реЇстри`",
                     x_sum_full     "—ума в реЇстри",
                     s_cnt_curr     " ≥льк≥сть ≈ќ— по `не заблоковано`",
                     s_sum_curr     "—ума не заблоковано",
                     s_cnt_kv2      " ≥льк≥сть ≈ќ— 'з зарахуванн€м'",
                     s_sum_kv2      "—ума 'зарахована'"
                FROM ikis_sys.opfu,
                     (  SELECT x_org,
                               x_month,
                               SUM (x_sum_curr)     s_sum_curr,
                               SUM (x_cnt_curr)     s_cnt_curr,
                               SUM (x_sum_kv2)      s_sum_kv2,
                               SUM (x_cnt_kv2)      s_cnt_kv2,
                               SUM (s_sum_full)     x_sum_full,
                               SUM (s_cnt_full)     x_cnt_full
                          FROM payed
                               LEFT JOIN reestr
                                   ON (x_org = s_org AND x_month = s_month)
                         WHERE 1 = 1
                      GROUP BY x_org, x_month)
               WHERE x_org = org_id
            ORDER BY 3, 1;

        UPDATE uss_esr.tmp_univ_rpt_data
           SET x_string2 =
                      '<Row ss:Height="27.6">
    <Cell ss:Index="2" ss:StyleID="s66"><Data ss:Type="Number">'
                   || x_id1
                   || '</Data></Cell>
    <Cell ss:StyleID="s70"><Data ss:Type="String">'
                   || x_string1
                   || '</Data></Cell>
    <Cell ss:StyleID="s66"><Data ss:Type="String">'
                   || TO_CHAR (x_dt1, 'dd.mm.yyyy')
                   || '</Data></Cell>
    <Cell ss:StyleID="s68"><Data ss:Type="Number">'
                   || x_id2
                   || '</Data></Cell>
    <Cell ss:StyleID="s69"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum1, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s68"><Data ss:Type="Number">'
                   || x_id3
                   || '</Data></Cell>
    <Cell ss:StyleID="s69"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum2, 'FM999999999990.90')
                   || '</Data></Cell>
    <Cell ss:StyleID="s68"><Data ss:Type="Number">'
                   || x_id4
                   || '</Data></Cell>
    <Cell ss:StyleID="s69"><Data ss:Type="Number">'
                   || TO_CHAR (x_sum3, 'FM999999999990.90')
                   || '</Data></Cell>
   </Row>'
         WHERE 1 = 1;
    END SET_PAID_VPO_R5;

    -- IC #94445 «в≥т про непрацюючих працездатних ос≥б
    PROCEDURE SET_REP_INCOM_R1 (p_start_dt   IN DATE,
                                p_org_id     IN NUMBER,
                                p_jbr_id     IN DECIMAL)
    IS
        l_user_org   NUMBER;
        l_org_to     NUMBER := tools.GetCurrOrgTo;
    BEGIN
        IF p_org_id = 0
        THEN
            l_user_org := Tools.GetCurrOrg;
        ELSE
            l_user_org := p_org_id;
        END IF;

        l_user_org :=
            CASE WHEN l_user_org = 50001 THEN 50000 ELSE l_user_org END;

        IF l_org_to = 34
        THEN
            SELECT org_to
              INTO l_org_to
              FROM ikis_sys.v_opfu
             WHERE org_id = l_user_org;
        END IF;

        l_org_to := CASE WHEN l_org_to = 34 THEN 34 ELSE 32 END;

        DELETE FROM tmp_univ_rpt_data
              WHERE 1 = 1;

        INSERT INTO tmp_univ_rpt_data (x_id1,                            -- rn
                                       x_string1,                  -- org_name
                                       x_string2,                       -- PIB
                                       x_string3,                    -- r_addr
                                       x_string4,                    -- f_addr
                                       x_string5)                     -- pd_dt
            WITH
                org
                AS
                    (    SELECT org_id     i_org
                           FROM ikis_sys.v_opfu
                          WHERE l_org_to = 32
                     CONNECT BY PRIOR org_id = org_org
                     START WITH org_id = l_user_org
                     UNION ALL
                     SELECT org_id     i_org
                       FROM ikis_sys.v_opfu
                      WHERE l_org_to = 34 AND org_acc_org = l_user_org),
                assign
                AS
                    (SELECT ROW_NUMBER ()
                                OVER (ORDER BY o.org_id, d.pd_ap, f.pdf_sc)
                                rn,
                            o.org_name,
                            i.sci_ln || ' ' || i.sci_fn || ' ' || i.sci_mn
                                PIB,                    -- ѕ≤Ѕ людини повн≥стю
                               TO_CHAR (d.pd_start_dt, 'dd.mm.yyyy')
                            || ' - '
                            || TO_CHAR (d.pd_stop_dt, 'dd.mm.yyyy')
                                pd_dt,
                            dnet$payment_reports.get_doc_id (NULL,
                                                             d.pd_ap,
                                                             600,
                                                             580)
                                r_kaot, --   ј“ќ““√ адреси реЇстрац≥њ ID V_MF_KOATUU_TEST
                            dnet$payment_reports.get_doc_string (NULL,
                                                                 d.pd_ap,
                                                                 600,
                                                                 591)
                                r_country,  --  рањна адреси реЇстрац≥њ STRING
                            dnet$payment_reports.get_doc_string (NULL,
                                                                 d.pd_ap,
                                                                 600,
                                                                 589)
                                r_region, --  ќбласть адреси реЇстрац≥њ STRING
                            dnet$payment_reports.get_doc_string (NULL,
                                                                 d.pd_ap,
                                                                 600,
                                                                 588)
                                r_district, --  –айон адреси реЇстрац≥њ STRING
                            dnet$payment_reports.get_doc_string (NULL,
                                                                 d.pd_ap,
                                                                 600,
                                                                 587)
                                r_index, --  ≤ндекс адреси реЇстрац≥њ ID v_mf_index
                            dnet$payment_reports.get_doc_string (NULL,
                                                                 d.pd_ap,
                                                                 600,
                                                                 586)
                                r_city,     --  ћ≥сто адреси реЇстрац≥њ STRING
                            NVL (dnet$payment_reports.get_doc_string (
                                     NULL,
                                     d.pd_ap,
                                     600,
                                     585), --  ¬улиц€ адреси реЇстрац≥њ (дов≥дник) ID V_NDI_STREET
                                 dnet$payment_reports.get_doc_string (
                                     NULL,
                                     d.pd_ap,
                                     600,
                                     787) --  ¬улиц€ адреси реЇстрац≥њ STRING V_NDI_STREET
                                         )
                                r_street,
                            dnet$payment_reports.get_doc_string (NULL,
                                                                 d.pd_ap,
                                                                 600,
                                                                 584)
                                r_building, --  Ѕудинок адреси реЇстрац≥њ STRING
                            dnet$payment_reports.get_doc_string (NULL,
                                                                 d.pd_ap,
                                                                 600,
                                                                 583)
                                r_corp,    --   орпус адреси реЇстрац≥њ STRING
                            dnet$payment_reports.get_doc_string (NULL,
                                                                 d.pd_ap,
                                                                 600,
                                                                 582)
                                r_apartment, --   вартира адреси реЇстрац≥њ STRING
                            dnet$payment_reports.get_doc_id (NULL,
                                                             d.pd_ap,
                                                             600,
                                                             604)
                                f_kaot, --   ј“ќ““√ адреси проживанн€ ID V_MF_KOATUU_TEST
                            dnet$payment_reports.get_doc_string (NULL,
                                                                 d.pd_ap,
                                                                 600,
                                                                 603)
                                f_country, --   рањна адреси проживанн€ STRING
                            dnet$payment_reports.get_doc_string (NULL,
                                                                 d.pd_ap,
                                                                 600,
                                                                 601)
                                f_region, --  ќбласть адреси проживанн€ STRING
                            dnet$payment_reports.get_doc_string (NULL,
                                                                 d.pd_ap,
                                                                 600,
                                                                 600)
                                f_district, --  –айон адреси проживанн€ STRING
                            dnet$payment_reports.get_doc_string (NULL,
                                                                 d.pd_ap,
                                                                 600,
                                                                 599)
                                f_index, --  ≤ндекс адреси проживанн€ ID v_mf_index
                            dnet$payment_reports.get_doc_string (NULL,
                                                                 d.pd_ap,
                                                                 600,
                                                                 598)
                                f_city,     --  ћ≥сто адреси проживанн€ STRING
                            NVL (dnet$payment_reports.get_doc_string (
                                     NULL,
                                     d.pd_ap,
                                     600,
                                     597), --  ¬улиц€ адреси проживанн€ (дов≥дник) ID V_NDI_STREET
                                 dnet$payment_reports.get_doc_string (
                                     NULL,
                                     d.pd_ap,
                                     600,
                                     788) --  ¬улиц€ адреси проживанн€ STRING V_NDI_STREET
                                         )
                                f_street,
                            dnet$payment_reports.get_doc_string (NULL,
                                                                 d.pd_ap,
                                                                 600,
                                                                 596)
                                f_building, --  Ѕудинок адреси проживанн€ STRING
                            dnet$payment_reports.get_doc_string (NULL,
                                                                 d.pd_ap,
                                                                 600,
                                                                 595)
                                f_corp,    --   орпус адреси проживанн€ STRING
                            dnet$payment_reports.get_doc_string (NULL,
                                                                 d.pd_ap,
                                                                 600,
                                                                 594)
                                f_apartment --   вартира адреси проживанн€ STRING
                       FROM ikis_sys.v_opfu  o
                            INNER JOIN org ON i_org = org_id
                            INNER JOIN uss_esr.personalcase pc
                                ON pc.com_org = o.org_id
                            INNER JOIN uss_esr.pc_decision d
                                ON d.pd_pc = pc.pc_id
                            INNER JOIN uss_esr.pd_family f
                                ON f.pdf_pd = d.pd_id
                            INNER JOIN uss_esr.ap_person p
                                ON p.app_ap = d.pd_ap AND p.app_sc = f.pdf_sc
                            INNER JOIN uss_esr.pd_payment pp
                                ON pp.pdp_pd = d.pd_id
                            INNER JOIN uss_esr.pd_accrual_period pdap
                                ON pdap.pdap_pd = d.pd_id
                            INNER JOIN uss_ndi.v_Ndi_Npt_Config nnc
                                ON nnc.nptc_npt = pp.pdp_npt
                            INNER JOIN uss_ndi.v_ndi_service_type st
                                ON st.nst_id = nnc.nptc_nst
                            LEFT JOIN uss_person.v_sc_change scc
                                ON     scc.scc_sc = p.app_sc
                                   AND scc.scc_id = p.app_scc
                            LEFT JOIN uss_person.v_sc_identity i
                                ON i.sci_id = scc.scc_sci
                      /*
                      left join uss_person.v_sc_address ar        on ar.sca_sc = p.app_sc
                                                                      and ar.sca_tp = 3 -- ћ≥сце реЇстрац≥њ
                                                                      and ar.history_status = 'A'
                      left join uss_person.v_sc_address af        on af.sca_sc = p.app_sc
                                                                      and af.sca_tp = 2 -- ћ≥сце проживанн€
                                                                      and af.history_status = 'A'
                      */
                      WHERE     o.org_to = 32
                            AND pp.history_status = 'A'
                            AND pdap.history_status = 'A'
                            AND p_start_dt BETWEEN TRUNC (pdap.pdap_start_dt,
                                                          'mm')
                                               AND pdap.pdap_stop_dt
                            AND p_start_dt BETWEEN TRUNC (pp.pdp_start_dt,
                                                          'mm')
                                               AND pp.pdp_stop_dt
                            AND st.nst_id IN (--251, -- ƒопомога у звТ€зку з ваг≥тн≥стю та пологами
                                              --265, -- ƒопомога особ≥, €ка догл€даЇ за хворою дитиною
                                              --267, -- ƒопомога на д≥тей одиноким матер€м
                                              --268, -- ƒопомога на д≥тей, над €кими встановлено оп≥ку чи п≥клуванн€
                                              --269, -- ƒопомога при усиновленн≥ дитини
                                              --862, -- ƒопомога на д≥тей, €к≥ виховуютьс€ у багатод≥тних с≥м'€х
                                              -- #94445 ƒан≥ формуютьс€ у таблиц≥, що додаЇтьс€ за послугою "ƒержавна соц≥альна допомога малозабезпеченим с≥мТ€м" (≤ƒ 249)
                                              249) -- ƒержавна соц≥альна допомога малозабезпеченим с≥мТ€м
                            AND EXISTS
                                    (SELECT 1
                                       FROM uss_esr.ap_document doc
                                      WHERE     doc.apd_app = p.app_id
                                            AND doc.apd_ndt = 10198 -- ƒов≥дка про перебуванн€ на обл≥ку у статус≥ безроб≥тного у центр≥ зайн€тост≥
                                            AND doc.history_status = 'A'))
              SELECT a.rn,
                     a.org_name,
                     a.pib,
                     LTRIM (
                            NVL (a.r_country, '” –јѓЌј')
                         || NVL2 (kr1.kaot_full_name,
                                  ', ' || kr1.kaot_full_name,
                                  '')
                         || NVL2 (kr2.kaot_full_name,
                                  ', ' || kr2.kaot_full_name,
                                  '')
                         || NVL2 (kr.kaot_full_name,
                                  ', ' || kr.kaot_full_name,
                                  '')
                         || NVL2 (a.r_street, ', ' || a.r_street, '')
                         || NVL2 (a.r_building, ', буд.' || a.r_building, '')
                         || NVL2 (a.r_apartment, ', кв.' || a.r_apartment, ''),
                         ', ')    r_addr,
                     LTRIM (
                            NVL (a.f_country, '” –јѓЌј')
                         || NVL2 (kf1.kaot_full_name,
                                  ', ' || kf1.kaot_full_name,
                                  '')
                         || NVL2 (kf2.kaot_full_name,
                                  ', ' || kf2.kaot_full_name,
                                  '')
                         || NVL2 (kf.kaot_full_name,
                                  ', ' || kf.kaot_full_name,
                                  '')
                         || NVL2 (a.f_street, ', ' || a.f_street, '')
                         || NVL2 (a.f_building, ', буд.' || a.f_building, '')
                         || NVL2 (a.f_apartment, ', кв.' || a.f_apartment, ''),
                         ', ')    f_addr,
                     a.pd_dt
                FROM assign a
                     LEFT JOIN uss_ndi.v_ndi_katottg kr
                         ON kr.kaot_id = a.r_kaot
                     LEFT JOIN uss_ndi.v_ndi_katottg kr1
                         ON kr1.kaot_id = kr.kaot_kaot_l1
                     LEFT JOIN uss_ndi.v_ndi_katottg kr2
                         ON kr2.kaot_id = kr.kaot_kaot_l2
                     LEFT JOIN uss_ndi.v_ndi_katottg kf
                         ON kf.kaot_id = a.f_kaot
                     LEFT JOIN uss_ndi.v_ndi_katottg kf1
                         ON kf1.kaot_id = kf.kaot_kaot_l1
                     LEFT JOIN uss_ndi.v_ndi_katottg kf2
                         ON kf2.kaot_id = kf.kaot_kaot_l2
            ORDER BY 1;
    END SET_REP_INCOM_R1;

    -- IC #98585 —кладов≥ суми у в≥домост≥
    PROCEDURE SET_PAYROLL_AMOUNT_R1 (p_start_dt   IN DATE,
                                     p_org_id     IN NUMBER,
                                     p_nst_id     IN NUMBER,
                                     p_pay_type   IN VARCHAR2,
                                     p_jbr_id     IN DECIMAL)
    IS
        l_org_to   NUMBER;
    BEGIN
        SELECT CASE WHEN org_to = 34 THEN 34 ELSE 32 END
          INTO l_org_to
          FROM ikis_sys.v_opfu
         WHERE org_id = p_org_id;

        DELETE FROM tmp_univ_rpt_data
              WHERE 1 = 1;

        INSERT INTO tmp_univ_rpt_data (x_id1, x_string1)
            WITH
                org
                AS
                    (    SELECT org_id     i_org
                           FROM ikis_sys.v_opfu
                          WHERE l_org_to = 32
                     CONNECT BY PRIOR org_id = org_org
                     START WITH org_id = p_org_id
                     UNION ALL
                     SELECT org_id     i_org
                       FROM ikis_sys.v_opfu
                      WHERE l_org_to = 34 AND org_acc_org = p_org_id)
                SELECT 0                          rn,
                          '"¬иплатний пер≥од"'
                       || ';'
                       || '"ƒата створенн€"'
                       || ';'
                       || '"ѕер≥од з"'
                       || ';'
                       || '"ѕер≥од по"'
                       || ';'
                       || '"¬ид в≥домост≥"'
                       || ';'
                       || '"ќрган призначенн€"'
                       || ';'
                       || '"N ≈ќ—"'
                       || ';'
                       || '"N –Ќќ ѕѕ"'
                       || ';'
                       || '"ѕ≤Ѕ"'
                       || ';'
                       || '"—ума у в≥домост≥, всього"'
                       || ';'
                       || '"в т.ч. за поточний м≥с€ць"'
                       || ';'
                       || '"борги за минулий пер≥од"'
                       || ';'
                       || '"невиплата за минулий пер≥од"'
                       || ';'
                       || '"—ума в≥драхувань"'    col_1
                  FROM DUAL
                UNION ALL
                SELECT rn,
                          '"'
                       || pr_month
                       || '";"'
                       || pr_create_dt
                       || '";"'
                       || pr_start_dt
                       || '";"'
                       || pr_stop_dt
                       || '";"'
                       || npt_name
                       || '";"'
                       || org_name
                       || '";"'
                       || prs_pc_num
                       || '";"'
                       || prs_inn
                       || '";"'
                       || pib
                       || '";"'
                       || prsd_sum
                       || '";"'
                       || prsd_sum_plan
                       || '";"'
                       || prsd_sum_borh
                       || '";"'
                       || prsd_sum_non
                       || '";"'
                       || prsd_sum_vrh
                       || '"'    col_1
                  FROM (  SELECT ROW_NUMBER ()
                                     OVER (
                                         ORDER BY
                                             o.org_id,
                                             prs.prs_pc_num,
                                             pt.npt_id)
                                     rn,
                                 TO_CHAR (pr.pr_month, 'mm.yyyy')
                                     pr_month,           --"¬иплатний пер≥од",
                                 TO_CHAR (pr.pr_create_dt, 'dd.mm.yyyy')
                                     pr_create_dt,         --"ƒата створенн€",
                                 TO_CHAR (pr.pr_start_dt, 'dd.mm.yyyy')
                                     pr_start_dt,                --"ѕер≥од з",
                                 TO_CHAR (pr.pr_stop_dt, 'dd.mm.yyyy')
                                     pr_stop_dt,                --"ѕер≥од по",
                                 pt.npt_name
                                     npt_name,              --"¬ид в≥домост≥",
                                 o.org_name
                                     org_name,          --"ќрган призначенн€",
                                 prs.prs_pc_num
                                     prs_pc_num,                    --"N ≈ќ—",
                                 prs.prs_inn
                                     prs_inn,                    --"N –Ќќ ѕѕ",
                                    prs.prs_ln
                                 || ' '
                                 || prs.prs_fn
                                 || ' '
                                 || prs.prs_mn
                                     pib,                             --"ѕ≤Ѕ",
                                 TO_CHAR (
                                     SUM (
                                         CASE
                                             WHEN prsd_tp IN ('PWI', 'RDN')
                                             THEN
                                                 prsd_sum
                                             ELSE
                                                 -prsd_sum
                                         END),
                                     'FM999999999990.90')
                                     prsd_sum,   --"—ума у в≥домост≥, всього",
                                 TO_CHAR (
                                     SUM (
                                         CASE
                                             WHEN pr_month = prsd_month
                                             THEN
                                                 CASE
                                                     WHEN prsd_tp IN
                                                              ('PWI', 'RDN')
                                                     THEN
                                                         prsd_sum
                                                     ELSE
                                                         -prsd_sum
                                                 END
                                             ELSE
                                                 0
                                         END),
                                     'FM999999999990.90')
                                     prsd_sum_plan, --"в т.ч. за поточний м≥с€ць",
                                 TO_CHAR (
                                     SUM (
                                         CASE
                                             WHEN     pr_month != prsd_month
                                                  AND prs_st IN
                                                          ('NA', 'KV1', 'KV2')
                                             THEN
                                                 CASE
                                                     WHEN prsd_tp IN
                                                              ('PWI', 'RDN')
                                                     THEN
                                                         prsd_sum
                                                     ELSE
                                                         -prsd_sum
                                                 END
                                             ELSE
                                                 0
                                         END),
                                     'FM999999999990.90')
                                     prsd_sum_borh, --"борги за минулий пер≥од",
                                 TO_CHAR (
                                     SUM (
                                         CASE
                                             WHEN     pr_month != prsd_month
                                                  AND prs_st NOT IN
                                                          ('NA', 'KV1', 'KV2')
                                             THEN
                                                 CASE
                                                     WHEN prsd_tp IN
                                                              ('PWI', 'RDN')
                                                     THEN
                                                         prsd_sum
                                                     ELSE
                                                         -prsd_sum
                                                 END
                                             ELSE
                                                 0
                                         END),
                                     'FM999999999990.90')
                                     prsd_sum_non, --"невиаплата за минулий пер≥од"
                                 TO_CHAR (
                                     SUM (
                                         CASE
                                             WHEN prsd_tp IN ('PWI', 'RDN')
                                             THEN
                                                 0
                                             ELSE
                                                 prsd_sum
                                         END),
                                     'FM999999999990.90')
                                     prsd_sum_vrh             --"в≥драхуванн€"
                            FROM uss_esr.payroll pr
                                 INNER JOIN uss_esr.pr_sheet prs
                                     ON prs.prs_pr = pr.pr_id
                                 INNER JOIN uss_esr.pr_sheet_detail prsd
                                     ON prsd.prsd_prs = prs.prs_id
                                 INNER JOIN uss_ndi.v_ndi_payment_type pt
                                     ON pt.npt_id = prsd.prsd_npt
                                 INNER JOIN uss_ndi.v_ndi_npt_config nc
                                     ON nc.nptc_npt = pt.npt_id
                                 INNER JOIN uss_ndi.v_ndi_service_type st
                                     ON st.nst_id = nc.nptc_nst
                                 INNER JOIN uss_esr.v_opfu o
                                     ON o.org_id = pr.com_org
                                 INNER JOIN org ON i_org = o.org_id
                           WHERE     pr.pr_st IN ('F')
                                 AND (   pr.pr_pay_tp = p_pay_type
                                      OR NVL (p_pay_type, '0') = '0') -- 'BANK', 'POST'
                                 AND pr.pr_month = p_start_dt
                                 AND st.nst_id = p_nst_id
                        GROUP BY pr.pr_month,
                                 pr.pr_create_dt,
                                 pr.pr_start_dt,
                                 pr.pr_stop_dt,
                                 pt.npt_id,
                                 pt.npt_name,
                                 o.org_id,
                                 o.org_name,
                                 prs.prs_pc_num,
                                 prs.prs_inn,
                                 prs.prs_fn,
                                 prs.prs_ln,
                                 prs.prs_mn) t;
    END SET_PAYROLL_AMOUNT_R1;


    -- #109334 ѕенс≥онери, що отримували допомогу ¬ѕќ (дл€ ѕ‘”)
    PROCEDURE SET_PFU_VPO_R1 (p_start_dt   IN DATE,
                              p_org_id     IN NUMBER,
                              p_jbr_id     IN DECIMAL)
    IS
        l_user_org               NUMBER;

        l_start_dt_mm   CONSTANT DATE := TRUNC (p_start_dt, 'mm');
    BEGIN
        IF p_org_id = 0
        THEN
            l_user_org := Tools.GetCurrOrg;
        ELSE
            l_user_org := p_org_id;
        END IF;

        DELETE FROM tmp_univ_rpt_data
              WHERE 1 = 1;

        INSERT INTO tmp_univ_rpt_data (x_string1,                       -- ѕ≤Ѕ
                                       x_string2,                    -- –Ќќ ѕѕ
                                       x_string3,                  -- ƒокумент
                                       x_string4, -- јдреса м≥сц€ проживанн€ за дов≥дкою ¬ѕќ
                                       x_dt1, -- ƒата видач≥ останньоњ дов≥дки ¬ѕќ
                                       x_dt2)          -- ƒата зн€тт€ з обл≥ку
            WITH
                org
                AS
                    (    SELECT org_id     i_org
                           FROM ikis_sys.v_opfu
                     CONNECT BY PRIOR org_id = org_org
                     START WITH org_id =
                                CASE
                                    WHEN l_user_org = 50001 THEN 50000
                                    ELSE l_user_org
                                END),
                pr_list
                AS
                    (SELECT prs_pc     AS x_pc
                       FROM uss_esr.pr_sheet, uss_esr.payroll
                      WHERE     prs_pr = pr_id
                            AND pr_month BETWEEN l_start_dt_mm
                                             AND LAST_DAY (l_start_dt_mm)
                            AND prs_st = 'KV2'
                            AND pr_npc = 24
                            AND prs_sum > 0),
                sc_list
                AS
                    (SELECT DISTINCT pdf_sc     x_id
                       FROM uss_esr.pc_decision,
                            uss_esr.pd_family,
                            uss_esr.personalcase  pc,
                            org
                      WHERE     pd_nst = 664
                            AND pdf_pd = pd_id
                            AND pd_pc = pc_id
                            AND pc.com_org = i_org
                            AND EXISTS
                                    (SELECT 1
                                       FROM pr_list
                                      WHERE x_pc = pd_pc)
                            AND EXISTS
                                    (SELECT 1
                                       FROM uss_person.v_sc_feature ff
                                      WHERE     ff.scf_sc = pdf_sc
                                            AND scf_is_pension = 'T'))
            SELECT (SELECT MAX (
                                  REPLACE (
                                      INITCAP (
                                          REGEXP_REPLACE (i.sci_ln,
                                                          '[Т''`]',
                                                          '666')),
                                      '666',
                                      'Т')
                               || ' '
                               || REPLACE (
                                      INITCAP (
                                          REGEXP_REPLACE (i.sci_fn,
                                                          '[Т''`]',
                                                          '666')),
                                      '666',
                                      'Т')
                               || ' '
                               || REPLACE (
                                      INITCAP (
                                          REGEXP_REPLACE (i.sci_mn,
                                                          '[Т''`]',
                                                          '666')),
                                      '666',
                                      'Т'))
                      FROM uss_person.v_socialcard  t
                           JOIN uss_person.v_sc_change ch
                               ON ch.scc_id = t.sc_scc
                           JOIN uss_person.v_sc_identity i
                               ON i.sci_id = ch.scc_sci
                     WHERE t.sc_id = x_id)
                       AS "ѕ≤Ѕ",
                   (SELECT MAX (d.scd_number)
                      FROM uss_person.v_sc_document d
                     WHERE     d.scd_st = '1'
                           AND d.scd_ndt = 5
                           AND d.scd_sc = x_id)
                       AS "–Ќќ ѕѕ",
                   (SELECT MAX (t.scd_seria || t.scd_number)
                      FROM uss_person.v_sc_document  t
                           JOIN uss_ndi.v_ndi_document_type pt
                               ON pt.ndt_id = t.scd_ndt AND pt.ndt_ndc = 13
                     WHERE     scd_sc = x_id
                           AND (   l_start_dt_mm >= scd_start_dt
                                OR scd_start_dt IS NULL)
                           AND (   l_start_dt_mm <= scd_stop_dt
                                OR scd_stop_dt IS NULL)
                           AND scd_st IN ('1', 'A')
                     FETCH FIRST ROW ONLY)
                       AS "ƒокумент",
                   NVL (
                       (SELECT LISTAGG (
                                      CASE
                                          WHEN a.da_nda IN (4492, 4485)
                                          THEN
                                              NULL
                                          WHEN a.da_nda = 4487
                                          THEN
                                              'буд. '
                                          WHEN a.da_nda = 4489
                                          THEN
                                              'кв. '
                                          ELSE
                                                 (SELECT t.nda_name
                                                    FROM uss_ndi.v_ndi_document_attr
                                                         t
                                                   WHERE t.nda_id = a.da_nda)
                                              || ': '
                                      END
                                   || a.da_val_string,
                                   '; '
                                   ON OVERFLOW TRUNCATE)
                               WITHIN GROUP (ORDER BY
                                                 DECODE (a.da_nda,
                                                         4492, 1,
                                                         a.da_nda))
                          FROM uss_person.v_sc_document  d,
                               uss_doc.v_doc_attributes  a,
                               uss_doc.v_doc_attr2hist   h
                         WHERE     d.scd_sc = x_id
                               AND d.scd_ndt = 10052
                               AND d.scd_st = '1'
                               AND (   a.da_nda = 4492
                                    OR a.da_nda BETWEEN 4481 AND 4489)
                               AND a.da_id = h.da2h_da
                               AND h.da2h_dh = d.scd_dh),
                       (SELECT MAX (a.da_val_string)
                          FROM uss_person.v_sc_document  d,
                               uss_doc.v_doc_attributes  a,
                               uss_doc.v_doc_attr2hist   h
                         WHERE     d.scd_sc = x_id
                               AND d.scd_ndt = 10052
                               AND d.scd_st = '1'
                               AND a.da_nda = 2457
                               AND a.da_id = h.da2h_da
                               AND h.da2h_dh = d.scd_dh))
                       "јдреса м≥сц€ проживанн€ за дов≥дкою ¬ѕќ",
                   (SELECT MAX (a.da_val_dt)
                      FROM uss_person.v_sc_document  d,
                           uss_doc.v_doc_attributes  a,
                           uss_doc.v_doc_attr2hist   h
                     WHERE     d.scd_sc = x_id
                           AND d.scd_ndt = 10052
                           AND d.scd_st = '1'
                           AND a.da_nda = 1757
                           AND a.da_id = h.da2h_da
                           AND h.da2h_dh = d.scd_dh)
                       "ƒата видач≥ останньоњ дов≥дки ¬ѕќ",
                   (SELECT MAX (a.da_val_dt)
                      FROM uss_person.v_sc_document  d,
                           uss_doc.v_doc_attributes  a,
                           uss_doc.v_doc_attr2hist   h
                     WHERE     d.scd_sc = x_id
                           AND d.scd_ndt = 10052
                           AND d.scd_st = '1'
                           AND a.da_nda = 1760
                           AND a.da_id = h.da2h_da
                           AND h.da2h_dh = d.scd_dh)
                       "ƒата зн€тт€ з обл≥ку"
              FROM sc_list;
    END SET_PFU_VPO_R1;

    -- IC #84394  витанц≥њ банк≥в щодо неоплат
    FUNCTION REESTR_UNPAID_KB2 (p_start_dt   IN DATE,
                                p_org_id     IN NUMBER,
                                p_rt_id      IN rpt_templates.rt_id%TYPE)
        RETURN DECIMAL
    IS
        l_jbr_id      NUMBER;
        l_file_name   VARCHAR2 (128);

        l_start_dt    DATE := TRUNC (p_start_dt, 'MM');
        l_sql         VARCHAR2 (10000);
    BEGIN
        tools.WriteMsg ('DNET$PAYMENT_REPORTS.' || $$PLSQL_UNIT);
        l_jbr_id := RDM$RTFL.InitReport (p_rt_id => p_rt_id);

        l_file_name :=
               'Unpaid_KB2_'
            || TO_CHAR (l_start_dt, 'yyyy')
            || '_'
            || TO_CHAR (l_start_dt, 'mm')
            || '_'
            || p_org_id
            || '.xml.xls';

        ikis_sysweb.REPORTFL_ENGINE_EX.SetFileName (
            p_jbr_id      => l_jbr_id,
            p_file_name   => l_file_name);

        RDM$RTFL.AddParam (l_jbr_id, 'p_year', TO_CHAR (l_start_dt, 'yyyy'));
        RDM$RTFL.AddParam (l_jbr_id, 'p_month', TO_CHAR (l_start_dt, 'mm'));

        RDM$RTFL.AddScript (
            l_jbr_id,
            'constants',
               'begin uss_esr.DNET$PAYMENT_REPORTS.SET_DS_KB2(to_date('''
            || TO_CHAR (l_start_dt, 'dd.mm.yyyy')
            || ''',''dd.mm.yyyy''), '
            || l_jbr_id
            || '); end;');

        l_sql := '
    select  x_id1                           pr_id,
            TO_CHAR(x_dt1,''dd.mm.yyyy'')   pkt_create_dt,
            TO_CHAR(x_dt2,''dd.mm.yyyy'')   pr_month,
            x_id2                           kv2_rows_cnt,
            x_sum1                          kv2_sum,
            x_id3                           kv2_notpay_cnt,
            x_sum2                          kv2_notpay_sum,
            x_id4                           num_rn
        from uss_esr.tmp_univ_rpt_data';

        RDM$RTFL.AddDataSet (l_jbr_id, 'ds', l_sql);

        RDM$RTFL.PutReportToWorkingQueue (p_jbr_id => l_jbr_id);
        RETURN l_jbr_id;
    END REESTR_UNPAID_KB2;

    -- IC #85151 ≤нформац≥€ щодо нарахуванн€ допомоги на проживанн€ ¬ѕќ
    FUNCTION ACCRUAL_VPO_R1 (p_start_dt   IN DATE,
                             p_org_id     IN NUMBER,
                             p_rt_id      IN rpt_templates.rt_id%TYPE)
        RETURN DECIMAL
    IS
        l_jbr_id          NUMBER;
        l_file_name       VARCHAR2 (128);

        l_start_dt        DATE := TRUNC (p_start_dt, 'MM');
        l_cnt_eoc_narah   NUMBER;

        l_sql             VARCHAR2 (10000);
    BEGIN
        tools.WriteMsg ('DNET$PAYMENT_REPORTS.' || $$PLSQL_UNIT);
        l_jbr_id := RDM$RTFL.InitReport (p_rt_id => p_rt_id);

        l_file_name :=
               'ACCRUAL_VPO_R1_'
            || TO_CHAR (l_start_dt, 'yyyy')
            || '_'
            || TO_CHAR (l_start_dt, 'mm')
            || '_'
            || p_org_id
            || '.xml.xls';

        ikis_sysweb.REPORTFL_ENGINE_EX.SetFileName (
            p_jbr_id      => l_jbr_id,
            p_file_name   => l_file_name);

        RDM$RTFL.AddParam (l_jbr_id, 'p_year', TO_CHAR (l_start_dt, 'yyyy'));
        RDM$RTFL.AddParam (l_jbr_id, 'p_month', TO_CHAR (l_start_dt, 'mm'));
        RDM$RTFL.AddParam (
            l_jbr_id,
            'p_ym',
               getMonthName (TO_NUMBER (TO_CHAR (l_start_dt, 'mm')))
            || ' '
            || TO_CHAR (l_start_dt, 'yyyy'));

        RDM$RTFL.AddScript (
            l_jbr_id,
            'constants',
               'begin uss_esr.DNET$PAYMENT_REPORTS.SET_DS_ACD_VPO(to_date('''
            || TO_CHAR (l_start_dt, 'dd.mm.yyyy')
            || ''',''dd.mm.yyyy''), '
            || p_org_id
            || ', '
            || l_jbr_id
            || '); end;');

        l_sql := '
    select  x_id1       org_code,  --" од ƒ—«Ќ"
            x_string1   reg_name,  --"Ќазва рег≥ону"
            x_id2       cnt_eoc_narah,       --" -сть ≈ќ— нарах."
            x_id3       cnt_fam_narah,       --"„лен≥в с≥мей нарах."
            x_sum1      sum_narah            --"Ќараховано"
        from uss_esr.tmp_univ_rpt_data';

        RDM$RTFL.AddDataSet (l_jbr_id, 'ds', l_sql);

        l_sql := '
    select  sum(x_id2)  t_cnt_eoc_narah,       --" -сть ≈ќ— нарах."
            sum(x_id3)  t_cnt_fam_narah,       --"„лен≥в с≥мей нарах."
            sum(x_sum1) t_sum_narah            --"Ќараховано"
        from uss_esr.tmp_univ_rpt_data';

        RDM$RTFL.AddDataSet (l_jbr_id, 'tds', l_sql);

        RDM$RTFL.PutReportToWorkingQueue (p_jbr_id => l_jbr_id);
        RETURN l_jbr_id;
    END ACCRUAL_VPO_R1;

    -- IC #85152 ≤нформац≥€ щодо призначених та нарахованих сум допомог на проживанн€ ¬ѕќ
    FUNCTION ASSIGN_VPO_R1 (p_start_dt   IN DATE,
                            p_org_id     IN NUMBER,
                            p_rt_id      IN rpt_templates.rt_id%TYPE)
        RETURN DECIMAL
    IS
        l_jbr_id          NUMBER;
        l_file_name       VARCHAR2 (128);

        l_start_dt        DATE := TRUNC (p_start_dt, 'MM');
        l_cnt_eoc_narah   NUMBER;

        l_sql             VARCHAR2 (10000);
    BEGIN
        tools.WriteMsg ('DNET$PAYMENT_REPORTS.' || $$PLSQL_UNIT);
        l_jbr_id := RDM$RTFL.InitReport (p_rt_id => p_rt_id);

        l_file_name :=
               'ASSIGN_VPO_R1_'
            || TO_CHAR (l_start_dt, 'yyyy')
            || '_'
            || TO_CHAR (l_start_dt, 'mm')
            || '_'
            || p_org_id
            || '.xml.xls';

        ikis_sysweb.REPORTFL_ENGINE_EX.SetFileName (
            p_jbr_id      => l_jbr_id,
            p_file_name   => l_file_name);

        RDM$RTFL.AddParam (l_jbr_id, 'p_year', TO_CHAR (l_start_dt, 'yyyy'));
        RDM$RTFL.AddParam (l_jbr_id, 'p_month', TO_CHAR (l_start_dt, 'mm'));
        RDM$RTFL.AddParam (
            l_jbr_id,
            'p_ym',
               getMonthName (TO_NUMBER (TO_CHAR (l_start_dt, 'mm')))
            || ' '
            || TO_CHAR (l_start_dt, 'yyyy'));

        RDM$RTFL.AddScript (
            l_jbr_id,
            'constants',
               'begin uss_esr.DNET$PAYMENT_REPORTS.SET_DS_PDP_VPO(to_date('''
            || TO_CHAR (l_start_dt, 'dd.mm.yyyy')
            || ''',''dd.mm.yyyy''), '
            || p_org_id
            || ', '
            || l_jbr_id
            || '); end;');

        l_sql := '
    select  x_id1       org_code,           --" од ƒ—«Ќ"
            x_string1   reg_name,           --"Ќазва рег≥ону"
            x_id2       cnt_eoc_assing,     --" ≥льк≥сть ≈ќ— призн.",
            x_id3       cnt_fam_assing,     --"„лен≥в с≥мей призн.",
            x_sum1      sum_assing,         --"ѕризначено",
            x_id4       cnt_eoc_narah,      --" -сть ≈ќ— нарах.",
            x_id5       cnt_fam_narah,      --"„лен≥в с≥мей нарах.",
            x_sum2      sum_narah,          --"Ќараховано",
            x_id2 - x_id4   cnt_eoc,        -- ≥льк≥сть с≥мей
            x_id3 - x_id5   cnt_fam,        -- ≥льк≥сть ос≥б
            x_sum1 - x_sum2 sum_bal         --—ума, грн
        from uss_esr.tmp_univ_rpt_data';

        RDM$RTFL.AddDataSet (l_jbr_id, 'ds', l_sql);

        l_sql := '
    select  sum(x_id2)  t_cnt_eoc_assing,
            sum(x_id3)  t_cnt_fam_assing,
            sum(x_sum1) t_sum_assing,
            sum(x_id4)  t_cnt_eoc_narah,      --" -сть ≈ќ— нарах.",
            sum(x_id5)  t_cnt_fam_narah,      --"„лен≥в с≥мей нарах.",
            sum(x_sum2) t_sum_narah,          --"Ќараховано",
            sum(x_id2) - sum(x_id4)     t_cnt_eoc,        -- ≥льк≥сть с≥мей
            sum(x_id3) - sum(x_id5)     t_cnt_fam,        -- ≥льк≥сть ос≥б
            sum(x_sum1) - sum(x_sum2)   t_sum_bal         --—ума, грн
        from uss_esr.tmp_univ_rpt_data';

        RDM$RTFL.AddDataSet (l_jbr_id, 'tds', l_sql);

        RDM$RTFL.PutReportToWorkingQueue (p_jbr_id => l_jbr_id);
        RETURN l_jbr_id;
    END ASSIGN_VPO_R1;

    -- IC #85154 ƒов≥дка про стан наданн€ допомоги ¬ѕќ на проживанн€ (з урахуванн€м попередн≥х пер≥од≥в)
    FUNCTION PAID_VPO_R1 (p_start_dt   IN DATE,
                          p_org_id     IN NUMBER,
                          p_rt_id      IN rpt_templates.rt_id%TYPE)
        RETURN DECIMAL
    IS
        l_jbr_id          NUMBER;
        l_file_name       VARCHAR2 (128);

        l_start_dt        DATE := TRUNC (p_start_dt, 'MM');
        l_cnt_eoc_narah   NUMBER;

        l_sql             VARCHAR2 (10000);
    BEGIN
        tools.WriteMsg ('DNET$PAYMENT_REPORTS.' || $$PLSQL_UNIT);
        l_jbr_id := RDM$RTFL.InitReport (p_rt_id => p_rt_id);

        l_file_name :=
               'PAID_VPO_R1_'
            || TO_CHAR (l_start_dt, 'yyyy')
            || '_'
            || TO_CHAR (l_start_dt, 'mm')
            || '_'
            || p_org_id
            || '.xml.xls';

        ikis_sysweb.REPORTFL_ENGINE_EX.SetFileName (
            p_jbr_id      => l_jbr_id,
            p_file_name   => l_file_name);

        RDM$RTFL.AddParam (l_jbr_id, 'p_year', TO_CHAR (l_start_dt, 'yyyy'));
        RDM$RTFL.AddParam (l_jbr_id, 'p_month', TO_CHAR (l_start_dt, 'mm'));
        RDM$RTFL.AddParam (
            l_jbr_id,
            'p_ym',
               getMonthName (TO_NUMBER (TO_CHAR (l_start_dt, 'mm')))
            || ' '
            || TO_CHAR (l_start_dt, 'yyyy'));

        RDM$RTFL.AddScript (
            l_jbr_id,
            'constants',
               'begin uss_esr.DNET$PAYMENT_REPORTS.SET_DS_PAID_VPO(to_date('''
            || TO_CHAR (l_start_dt, 'dd.mm.yyyy')
            || ''',''dd.mm.yyyy''), '
            || p_org_id
            || ', '
            || l_jbr_id
            || '); end;');

        l_sql := '
    select  x_id1       org_code,           --" од ƒ—«Ќ"
            x_string1   reg_name,           --"Ќазва рег≥ону"
            x_sum1      sum_full, --AS "—ума в реЇстри",
            x_id2       cnt_full, --" ≥льк≥сть ≈ќ— по сумам `в реЇстри`"
            x_id3       cnt_fml_full
        from uss_esr.tmp_univ_rpt_data';

        RDM$RTFL.AddDataSet (l_jbr_id, 'ds', l_sql);

        l_sql :=
            '
    select  sum(x_sum1) t_sum_full,     --AS "—ума в реЇстри",
            sum(x_id2)  t_cnt_full,     --" ≥льк≥сть ≈ќ— по сумам `в реЇстри`"
            sum(x_id3)  t_cnt_fml_full  --" ≥льк≥сть ос≥б по сумам `в реЇстри`"
        from uss_esr.tmp_univ_rpt_data';

        RDM$RTFL.AddDataSet (l_jbr_id, 'tds', l_sql);

        RDM$RTFL.PutReportToWorkingQueue (p_jbr_id => l_jbr_id);
        RETURN l_jbr_id;
    END PAID_VPO_R1;

    -- IC #85153 ƒинам≥ка ключових показник≥в, €к≥ характеризують стан наданн€ допомоги ¬ѕќ на проживанн€
    FUNCTION PAID_VPO_R2 (p_start_dt   IN DATE,
                          p_org_id     IN NUMBER,
                          p_rt_id      IN rpt_templates.rt_id%TYPE)
        RETURN DECIMAL
    IS
        l_jbr_id          NUMBER;
        l_file_name       VARCHAR2 (128);

        l_start_dt        DATE := TRUNC (p_start_dt, 'MM');
        l_cnt_eoc_narah   NUMBER;

        l_sql             VARCHAR2 (10000);
    BEGIN
        tools.WriteMsg ('DNET$PAYMENT_REPORTS.' || $$PLSQL_UNIT);
        l_jbr_id := RDM$RTFL.InitReport (p_rt_id => p_rt_id);

        l_file_name :=
               'PAID_VPO_R2_'
            || TO_CHAR (l_start_dt, 'yyyy')
            || '_'
            || TO_CHAR (l_start_dt, 'mm')
            || '_'
            || p_org_id
            || '.xml.xls';

        ikis_sysweb.REPORTFL_ENGINE_EX.SetFileName (
            p_jbr_id      => l_jbr_id,
            p_file_name   => l_file_name);

        RDM$RTFL.AddParam (l_jbr_id, 'p_year', TO_CHAR (l_start_dt, 'yyyy'));

        RDM$RTFL.AddScript (
            l_jbr_id,
            'constants',
               'begin uss_esr.DNET$PAYMENT_REPORTS.SET_DS_PAID2_VPO(to_date('''
            || TO_CHAR (l_start_dt, 'dd.mm.yyyy')
            || ''',''dd.mm.yyyy''), '
            || p_org_id
            || ', '
            || l_jbr_id
            || '); end;');

        l_sql :=
            '
select  x_id1 org_code, x_string1 reg_name,
        sum(case when x_string2 = ''01''
                then x_id2 else 0 end)  cnt_full_01, --" ≥льк≥сть ≈ќ— по сумам `в реЇстри`"
        sum(case when x_string2 = ''01''
                then x_sum1 else 0 end) sum_full_01, --AS "—ума в реЇстри"

        sum(case when x_string2 = ''02''
                then x_id2 else 0 end)  cnt_full_02,
        sum(case when x_string2 = ''02''
                then x_sum1 else 0 end) sum_full_02,
        sum(case when x_string2 = ''03''
                then x_id2 else 0 end)  cnt_full_03,
        sum(case when x_string2 = ''03''
                then x_sum1 else 0 end) sum_full_03,
        sum(case when x_string2 = ''04''
                then x_id2 else 0 end)  cnt_full_04,
        sum(case when x_string2 = ''04''
                then x_sum1 else 0 end) sum_full_04,
        sum(case when x_string2 = ''05''
                then x_id2 else 0 end)  cnt_full_05,
        sum(case when x_string2 = ''05''
                then x_sum1 else 0 end) sum_full_05,
        sum(case when x_string2 = ''06''
                then x_id2 else 0 end)  cnt_full_06,
        sum(case when x_string2 = ''06''
                then x_sum1 else 0 end) sum_full_06,
        sum(case when x_string2 = ''07''
                then x_id2 else 0 end)  cnt_full_07,
        sum(case when x_string2 = ''07''
                then x_sum1 else 0 end) sum_full_07,
        sum(case when x_string2 = ''08''
                then x_id2 else 0 end)  cnt_full_08,
        sum(case when x_string2 = ''08''
                then x_sum1 else 0 end) sum_full_08,
        sum(case when x_string2 = ''09''
                then x_id2 else 0 end)  cnt_full_09,
        sum(case when x_string2 = ''09''
                then x_sum1 else 0 end) sum_full_09,
        sum(case when x_string2 = ''10''
                then x_id2 else 0 end)  cnt_full_10,
        sum(case when x_string2 = ''10''
                then x_sum1 else 0 end) sum_full_10,
        sum(case when x_string2 = ''11''
                then x_id2 else 0 end)  cnt_full_11,
        sum(case when x_string2 = ''11''
                then x_sum1 else 0 end) sum_full_11,
        sum(case when x_string2 = ''12''
                then x_id2 else 0 end)  cnt_full_12,
        sum(case when x_string2 = ''12''
                then x_sum1 else 0 end) sum_full_12,
        sum(x_id2)                      cnt_full,
        sum(x_sum1)                     sum_full
    from uss_esr.tmp_univ_rpt_data group by x_id1, x_string1
    order by 1';

        RDM$RTFL.AddDataSet (l_jbr_id, 'ds', l_sql);

        l_sql :=
            '
select  sum(case when x_string2 = ''01''
                then x_id2 else 0 end)  t_cnt_full_01, --" ≥льк≥сть ≈ќ— по сумам `в реЇстри`"
        sum(case when x_string2 = ''01''
                then x_sum1 else 0 end) t_sum_full_01, --AS "—ума в реЇстри"

        sum(case when x_string2 = ''02''
                then x_id2 else 0 end)  t_cnt_full_02,
        sum(case when x_string2 = ''02''
                then x_sum1 else 0 end) t_sum_full_02,
        sum(case when x_string2 = ''03''
                then x_id2 else 0 end)  t_cnt_full_03,
        sum(case when x_string2 = ''03''
                then x_sum1 else 0 end) t_sum_full_03,
        sum(case when x_string2 = ''04''
                then x_id2 else 0 end)  t_cnt_full_04,
        sum(case when x_string2 = ''04''
                then x_sum1 else 0 end) t_sum_full_04,
        sum(case when x_string2 = ''05''
                then x_id2 else 0 end)  t_cnt_full_05,
        sum(case when x_string2 = ''05''
                then x_sum1 else 0 end) t_sum_full_05,
        sum(case when x_string2 = ''06''
                then x_id2 else 0 end)  t_cnt_full_06,
        sum(case when x_string2 = ''06''
                then x_sum1 else 0 end) t_sum_full_06,
        sum(case when x_string2 = ''07''
                then x_id2 else 0 end)  t_cnt_full_07,
        sum(case when x_string2 = ''07''
                then x_sum1 else 0 end) t_sum_full_07,
        sum(case when x_string2 = ''08''
                then x_id2 else 0 end)  t_cnt_full_08,
        sum(case when x_string2 = ''08''
                then x_sum1 else 0 end) t_sum_full_08,
        sum(case when x_string2 = ''09''
                then x_id2 else 0 end)  t_cnt_full_09,
        sum(case when x_string2 = ''09''
                then x_sum1 else 0 end) t_sum_full_09,
        sum(case when x_string2 = ''10''
                then x_id2 else 0 end)  t_cnt_full_10,
        sum(case when x_string2 = ''10''
                then x_sum1 else 0 end) t_sum_full_10,
        sum(case when x_string2 = ''11''
                then x_id2 else 0 end)  t_cnt_full_11,
        sum(case when x_string2 = ''11''
                then x_sum1 else 0 end) t_sum_full_11,
        sum(case when x_string2 = ''12''
                then x_id2 else 0 end)  t_cnt_full_12,
        sum(case when x_string2 = ''12''
                then x_sum1 else 0 end) t_sum_full_12,
        sum(x_id2)                      t_cnt_full,
        sum(x_sum1)                     t_sum_full
        from uss_esr.tmp_univ_rpt_data';

        RDM$RTFL.AddDataSet (l_jbr_id, 'tds', l_sql);

        RDM$RTFL.PutReportToWorkingQueue (p_jbr_id => l_jbr_id);
        RETURN l_jbr_id;
    END PAID_VPO_R2;

    -- IC #85156 ƒан≥ про нарахован≥ та виплачен≥ суми по окремих видах допомог, п≥льг та субсид≥йї (щодо допомоги на проживанн€ ¬ѕќ)
    FUNCTION PAID_VPO_R3 (p_start_dt   IN DATE,
                          p_org_id     IN NUMBER,
                          p_rt_id      IN rpt_templates.rt_id%TYPE)
        RETURN DECIMAL
    IS
        l_jbr_id          NUMBER;
        l_file_name       VARCHAR2 (128);

        l_start_dt        DATE := TRUNC (p_start_dt, 'MM');
        l_cnt_eoc_narah   NUMBER;

        l_sql             VARCHAR2 (10000);
    BEGIN
        tools.WriteMsg ('DNET$PAYMENT_REPORTS.' || $$PLSQL_UNIT);
        l_jbr_id := RDM$RTFL.InitReport (p_rt_id => p_rt_id);

        l_file_name :=
               'PAID_VPO_R3_'
            || TO_CHAR (l_start_dt, 'yyyy')
            || '_'
            || TO_CHAR (l_start_dt, 'mm')
            || '_'
            || p_org_id
            || '.xml.xls';

        ikis_sysweb.REPORTFL_ENGINE_EX.SetFileName (
            p_jbr_id      => l_jbr_id,
            p_file_name   => l_file_name);

        RDM$RTFL.AddParam (l_jbr_id, 'p_year', TO_CHAR (l_start_dt, 'yyyy'));
        RDM$RTFL.AddParam (l_jbr_id, 'p_month', TO_CHAR (l_start_dt, 'mm'));
        RDM$RTFL.AddParam (
            l_jbr_id,
            'p_ym',
               getMonthName (TO_NUMBER (TO_CHAR (l_start_dt, 'mm')))
            || ' '
            || TO_CHAR (l_start_dt, 'yyyy'));

        RDM$RTFL.AddScript (
            l_jbr_id,
            'constants',
               'begin uss_esr.DNET$PAYMENT_REPORTS.SET_DS_PAID3_VPO(to_date('''
            || TO_CHAR (l_start_dt, 'dd.mm.yyyy')
            || ''',''dd.mm.yyyy''), '
            || p_org_id
            || ', '
            || l_jbr_id
            || '); end;');

        l_sql := '
    select  x_id1       org_code,           --" од ƒ—«Ќ"
            x_string1   reg_name,           --"Ќазва рег≥ону"
            x_id2       cnt_eoc_narah,      --" -сть ≈ќ— нарах."
            x_sum1      sum_narah,          --"Ќараховано",
            x_id3       cnt_eoc_payed,      --" -сть ≈ќ— випл.",
            x_sum2      sum_payed_month     --"¬иплачено м≥с€ць",
        from uss_esr.tmp_univ_rpt_data';

        RDM$RTFL.AddDataSet (l_jbr_id, 'ds', l_sql);

        l_sql := '
    select  sum(x_id2)  t_cnt_eoc_narah,      --" -сть ≈ќ— нарах."
            sum(x_sum1) t_sum_narah,          --"Ќараховано",
            sum(x_id3)  t_cnt_eoc_payed,      --" -сть ≈ќ— випл.",
            sum(x_sum2) t_sum_payed_month     --"¬иплачено м≥с€ць",
        from uss_esr.tmp_univ_rpt_data';

        RDM$RTFL.AddDataSet (l_jbr_id, 'tds', l_sql);

        RDM$RTFL.PutReportToWorkingQueue (p_jbr_id => l_jbr_id);
        RETURN l_jbr_id;
    END PAID_VPO_R3;

    -- IC #87518 ƒан≥ щодо виплати допомоги ¬ѕќ
    FUNCTION PAID_VPO_R4 (p_start_dt   IN DATE,
                          p_org_id     IN NUMBER,
                          p_rt_id      IN rpt_templates.rt_id%TYPE)
        RETURN DECIMAL
    IS
        l_jbr_id          NUMBER;
        l_file_name       VARCHAR2 (128);

        l_start_dt        DATE := TRUNC (p_start_dt, 'MM');
        l_cnt_eoc_narah   NUMBER;

        l_sql             VARCHAR2 (10000);
    BEGIN
        tools.WriteMsg ('DNET$PAYMENT_REPORTS.' || $$PLSQL_UNIT);
        l_jbr_id := RDM$RTFL.InitReport (p_rt_id => p_rt_id);

        l_file_name :=
               'PAID_VPO_R4_'
            || TO_CHAR (l_start_dt, 'yyyy')
            || '_'
            || TO_CHAR (l_start_dt, 'mm')
            || '_'
            || p_org_id
            || '.xml.xls';

        ikis_sysweb.REPORTFL_ENGINE_EX.SetFileName (
            p_jbr_id      => l_jbr_id,
            p_file_name   => l_file_name);

        RDM$RTFL.AddParam (l_jbr_id, 'p_year', TO_CHAR (l_start_dt, 'yyyy'));
        RDM$RTFL.AddParam (l_jbr_id, 'p_month', TO_CHAR (l_start_dt, 'mm'));
        RDM$RTFL.AddParam (
            l_jbr_id,
            'p_ym',
               getMonthName (TO_NUMBER (TO_CHAR (l_start_dt, 'mm')))
            || ' '
            || TO_CHAR (l_start_dt, 'yyyy'));

        RDM$RTFL.AddScript (
            l_jbr_id,
            'constants',
               'begin uss_esr.DNET$PAYMENT_REPORTS.SET_DS_PAID_VPO_R4(to_date('''
            || TO_CHAR (l_start_dt, 'dd.mm.yyyy')
            || ''',''dd.mm.yyyy''), '
            || p_org_id
            || ', '
            || l_jbr_id
            || '); end;');

        l_sql :=
            '
    select  '' ≥льк≥сть отримувач≥в допомоги за даними ƒѕ "≤ќ÷ ћ≥нсоцпол≥тики", всього''  r_name,
        sum(case when to_char(a_dt,''mm'') = ''01''
                then  cnt_2K + cnt_3K else 0 end)           pdp_sum_01,
        sum(case when to_char(a_dt,''mm'') = ''02''
                then  cnt_2K + cnt_3K else 0 end)           pdp_sum_02,
        sum(case when to_char(a_dt,''mm'') = ''03''
                then  cnt_2K + cnt_3K else 0 end)           pdp_sum_03,
        sum(case when to_char(a_dt,''mm'') = ''04''
                then  cnt_2K + cnt_3K else 0 end)           pdp_sum_04,
        sum(case when to_char(a_dt,''mm'') = ''05''
                then  cnt_2K + cnt_3K else 0 end)           pdp_sum_05,
        sum(case when to_char(a_dt,''mm'') = ''06''
                then  cnt_2K + cnt_3K else 0 end)           pdp_sum_06,
        sum(case when to_char(a_dt,''mm'') = ''07''
                then  cnt_2K + cnt_3K else 0 end)           pdp_sum_07,
        sum(case when to_char(a_dt,''mm'') = ''08''
                then  cnt_2K + cnt_3K else 0 end)           pdp_sum_08,
        sum(case when to_char(a_dt,''mm'') = ''09''
                then  cnt_2K + cnt_3K else 0 end)           pdp_sum_09,
        sum(case when to_char(a_dt,''mm'') = ''10''
                then  cnt_2K + cnt_3K else 0 end)           pdp_sum_10,
        sum(case when to_char(a_dt,''mm'') = ''11''
                then  cnt_2K + cnt_3K else 0 end)           pdp_sum_11,
        sum(case when to_char(a_dt,''mm'') = ''12''
                then  cnt_2K + cnt_3K else 0 end)           pdp_sum_12
    from (
select  x_dt1   a_dt,
        x_sum1  pdp_sum,
        x_id1   cnt_2K,
        x_id2   cnt_3k,
        x_id3   cnt_fml,
        x_sum2  pdp_sum_err,
        x_sum3  prc_2K,
        x_id5   rn
    from uss_esr.tmp_univ_rpt_data d where d.x_id5 = 1)';

        RDM$RTFL.AddDataSet (l_jbr_id, 'ds', l_sql);

        l_sql :=
            '
    select  ''з них: мають право на отриманн€ виплати у розм≥р≥ 2000 грн''  r_name,
        sum(case when to_char(a_dt,''mm'') = ''01''
                then  cnt_2K else 0 end)           pdp_sum_01,
        sum(case when to_char(a_dt,''mm'') = ''02''
                then  cnt_2K else 0 end)           pdp_sum_02,
        sum(case when to_char(a_dt,''mm'') = ''03''
                then  cnt_2K else 0 end)           pdp_sum_03,
        sum(case when to_char(a_dt,''mm'') = ''04''
                then  cnt_2K else 0 end)           pdp_sum_04,
        sum(case when to_char(a_dt,''mm'') = ''05''
                then  cnt_2K else 0 end)           pdp_sum_05,
        sum(case when to_char(a_dt,''mm'') = ''06''
                then  cnt_2K else 0 end)           pdp_sum_06,
        sum(case when to_char(a_dt,''mm'') = ''07''
                then  cnt_2K else 0 end)           pdp_sum_07,
        sum(case when to_char(a_dt,''mm'') = ''08''
                then  cnt_2K else 0 end)           pdp_sum_08,
        sum(case when to_char(a_dt,''mm'') = ''09''
                then  cnt_2K else 0 end)           pdp_sum_09,
        sum(case when to_char(a_dt,''mm'') = ''10''
                then  cnt_2K else 0 end)           pdp_sum_10,
        sum(case when to_char(a_dt,''mm'') = ''11''
                then  cnt_2K else 0 end)           pdp_sum_11,
        sum(case when to_char(a_dt,''mm'') = ''12''
                then  cnt_2K else 0 end)           pdp_sum_12
    from (
select  x_dt1   a_dt,
        x_sum1  pdp_sum,
        x_id1   cnt_2K,
        x_id2   cnt_3k,
        x_id3   cnt_fml,
        x_sum2  pdp_sum_err,
        x_sum3  prc_2K,
        x_id5   rn
    from uss_esr.tmp_univ_rpt_data d where d.x_id5 = 1)  union all

select  ''3000 грн''  r_name,
        sum(case when to_char(a_dt,''mm'') = ''01''
                then  cnt_3K else 0 end)           pdp_sum_01,
        sum(case when to_char(a_dt,''mm'') = ''02''
                then  cnt_3K else 0 end)           pdp_sum_02,
        sum(case when to_char(a_dt,''mm'') = ''03''
                then  cnt_3K else 0 end)           pdp_sum_03,
        sum(case when to_char(a_dt,''mm'') = ''04''
                then  cnt_3K else 0 end)           pdp_sum_04,
        sum(case when to_char(a_dt,''mm'') = ''05''
                then  cnt_3K else 0 end)           pdp_sum_05,
        sum(case when to_char(a_dt,''mm'') = ''06''
                then  cnt_3K else 0 end)           pdp_sum_06,
        sum(case when to_char(a_dt,''mm'') = ''07''
                then  cnt_3K else 0 end)           pdp_sum_07,
        sum(case when to_char(a_dt,''mm'') = ''08''
                then  cnt_3K else 0 end)           pdp_sum_08,
        sum(case when to_char(a_dt,''mm'') = ''09''
                then  cnt_3K else 0 end)           pdp_sum_09,
        sum(case when to_char(a_dt,''mm'') = ''10''
                then  cnt_3K else 0 end)           pdp_sum_10,
        sum(case when to_char(a_dt,''mm'') = ''11''
                then  cnt_3K else 0 end)           pdp_sum_11,
        sum(case when to_char(a_dt,''mm'') = ''12''
                then  cnt_3K else 0 end)           pdp_sum_12
    from (
select  x_dt1   a_dt,
        x_sum1  pdp_sum,
        x_id1   cnt_2K,
        x_id2   cnt_3k,
        x_id3   cnt_fml,
        x_sum2  pdp_sum_err,
        x_sum3  prc_2K,
        x_id5   rn
    from uss_esr.tmp_univ_rpt_data d where d.x_id5 = 1)';

        RDM$RTFL.AddDataSet (l_jbr_id, 'ds1', l_sql);

        l_sql :=
            '
    select  ''ѕотреба в коштах, всього, тис.грн''  r_name,
        sum(case when to_char(a_dt,''mm'') = ''01''
                then  (cnt_2K*2000) + (cnt_3K*3000) else 0 end)           pdp_sum_01,
        sum(case when to_char(a_dt,''mm'') = ''02''
                then  (cnt_2K*2000) + (cnt_3K*3000) else 0 end)           pdp_sum_02,
        sum(case when to_char(a_dt,''mm'') = ''03''
                then  (cnt_2K*2000) + (cnt_3K*3000) else 0 end)           pdp_sum_03,
        sum(case when to_char(a_dt,''mm'') = ''04''
                then  (cnt_2K*2000) + (cnt_3K*3000) else 0 end)           pdp_sum_04,
        sum(case when to_char(a_dt,''mm'') = ''05''
                then  (cnt_2K*2000) + (cnt_3K*3000) else 0 end)           pdp_sum_05,
        sum(case when to_char(a_dt,''mm'') = ''06''
                then  (cnt_2K*2000) + (cnt_3K*3000) else 0 end)           pdp_sum_06,
        sum(case when to_char(a_dt,''mm'') = ''07''
                then  (cnt_2K*2000) + (cnt_3K*3000) else 0 end)           pdp_sum_07,
        sum(case when to_char(a_dt,''mm'') = ''08''
                then  (cnt_2K*2000) + (cnt_3K*3000) else 0 end)           pdp_sum_08,
        sum(case when to_char(a_dt,''mm'') = ''09''
                then  (cnt_2K*2000) + (cnt_3K*3000) else 0 end)           pdp_sum_09,
        sum(case when to_char(a_dt,''mm'') = ''10''
                then  (cnt_2K*2000) + (cnt_3K*3000) else 0 end)           pdp_sum_10,
        sum(case when to_char(a_dt,''mm'') = ''11''
                then  (cnt_2K*2000) + (cnt_3K*3000) else 0 end)           pdp_sum_11,
        sum(case when to_char(a_dt,''mm'') = ''12''
                then  (cnt_2K*2000) + (cnt_3K*3000) else 0 end)           pdp_sum_12
    from (
select  x_dt1   a_dt,
        x_sum1  pdp_sum,
        x_id1   cnt_2K,
        x_id2   cnt_3k,
        x_id3   cnt_fml,
        x_sum2  pdp_sum_err,
        x_sum3  prc_2K,
        x_id5   rn
    from uss_esr.tmp_univ_rpt_data d where d.x_id5 = 1)';

        RDM$RTFL.AddDataSet (l_jbr_id, 'ds2', l_sql);

        l_sql := '
    select  ''з них: дл€ виплати в розм≥р≥ 2000,0 грн''  r_name,
        sum(case when to_char(a_dt,''mm'') = ''01''
                then  cnt_2K*2000 else 0 end)           pdp_sum_01,
        sum(case when to_char(a_dt,''mm'') = ''02''
                then  cnt_2K*2000 else 0 end)           pdp_sum_02,
        sum(case when to_char(a_dt,''mm'') = ''03''
                then  cnt_2K*2000 else 0 end)           pdp_sum_03,
        sum(case when to_char(a_dt,''mm'') = ''04''
                then  cnt_2K*2000 else 0 end)           pdp_sum_04,
        sum(case when to_char(a_dt,''mm'') = ''05''
                then  cnt_2K*2000 else 0 end)           pdp_sum_05,
        sum(case when to_char(a_dt,''mm'') = ''06''
                then  cnt_2K*2000 else 0 end)           pdp_sum_06,
        sum(case when to_char(a_dt,''mm'') = ''07''
                then  cnt_2K*2000 else 0 end)           pdp_sum_07,
        sum(case when to_char(a_dt,''mm'') = ''08''
                then  cnt_2K*2000 else 0 end)           pdp_sum_08,
        sum(case when to_char(a_dt,''mm'') = ''09''
                then  cnt_2K*2000 else 0 end)           pdp_sum_09,
        sum(case when to_char(a_dt,''mm'') = ''10''
                then  cnt_2K*2000 else 0 end)           pdp_sum_10,
        sum(case when to_char(a_dt,''mm'') = ''11''
                then  cnt_2K*2000 else 0 end)           pdp_sum_11,
        sum(case when to_char(a_dt,''mm'') = ''12''
                then  cnt_2K*2000 else 0 end)           pdp_sum_12
    from (
select  x_dt1   a_dt,
        x_sum1  pdp_sum,
        x_id1   cnt_2K,
        x_id2   cnt_3k,
        x_id3   cnt_fml,
        x_sum2  pdp_sum_err,
        x_sum3  prc_2K,
        x_id5   rn
    from uss_esr.tmp_univ_rpt_data d where d.x_id5 = 1) union all

select  '' дл€ виплати в розм≥р≥ 3000 грн''  r_name,
        sum(case when to_char(a_dt,''mm'') = ''01''
                then  cnt_3K*3000 else 0 end)           pdp_sum_01,
        sum(case when to_char(a_dt,''mm'') = ''02''
                then  cnt_3K*3000 else 0 end)           pdp_sum_02,
        sum(case when to_char(a_dt,''mm'') = ''03''
                then  cnt_3K*3000 else 0 end)           pdp_sum_03,
        sum(case when to_char(a_dt,''mm'') = ''04''
                then  cnt_3K*3000 else 0 end)           pdp_sum_04,
        sum(case when to_char(a_dt,''mm'') = ''05''
                then  cnt_3K*3000 else 0 end)           pdp_sum_05,
        sum(case when to_char(a_dt,''mm'') = ''06''
                then  cnt_3K*3000 else 0 end)           pdp_sum_06,
        sum(case when to_char(a_dt,''mm'') = ''07''
                then  cnt_3K*3000 else 0 end)           pdp_sum_07,
        sum(case when to_char(a_dt,''mm'') = ''08''
                then  cnt_3K*3000 else 0 end)           pdp_sum_08,
        sum(case when to_char(a_dt,''mm'') = ''09''
                then  cnt_3K*3000 else 0 end)           pdp_sum_09,
        sum(case when to_char(a_dt,''mm'') = ''10''
                then  cnt_3K*3000 else 0 end)           pdp_sum_10,
        sum(case when to_char(a_dt,''mm'') = ''11''
                then  cnt_3K*3000 else 0 end)           pdp_sum_11,
        sum(case when to_char(a_dt,''mm'') = ''12''
                then  cnt_3K*3000 else 0 end)           pdp_sum_12
    from (
select  x_dt1   a_dt,
        x_sum1  pdp_sum,
        x_id1   cnt_2K,
        x_id2   cnt_3k,
        x_id3   cnt_fml,
        x_sum2  pdp_sum_err,
        x_sum3  prc_2K,
        x_id5   rn
    from uss_esr.tmp_univ_rpt_data d where d.x_id5 = 1)';
        RDM$RTFL.AddDataSet (l_jbr_id, 'ds3', l_sql);

        -- Ќараховано
        l_sql := '
    select  ''ќбс€г кошт≥в дл€ виплати, всього, тис.грн''  r_name,
        sum(case when to_char(a_dt,''mm'') = ''01''
                then  pdp_sum else 0 end)           pdp_sum_01,
        sum(case when to_char(a_dt,''mm'') = ''02''
                then  pdp_sum else 0 end)           pdp_sum_02,
        sum(case when to_char(a_dt,''mm'') = ''03''
                then  pdp_sum else 0 end)           pdp_sum_03,
        sum(case when to_char(a_dt,''mm'') = ''04''
                then  pdp_sum else 0 end)           pdp_sum_04,
        sum(case when to_char(a_dt,''mm'') = ''05''
                then  pdp_sum else 0 end)           pdp_sum_05,
        sum(case when to_char(a_dt,''mm'') = ''06''
                then  pdp_sum else 0 end)           pdp_sum_06,
        sum(case when to_char(a_dt,''mm'') = ''07''
                then  pdp_sum else 0 end)           pdp_sum_07,
        sum(case when to_char(a_dt,''mm'') = ''08''
                then  pdp_sum else 0 end)           pdp_sum_08,
        sum(case when to_char(a_dt,''mm'') = ''09''
                then  pdp_sum else 0 end)           pdp_sum_09,
        sum(case when to_char(a_dt,''mm'') = ''10''
                then  pdp_sum else 0 end)           pdp_sum_10,
        sum(case when to_char(a_dt,''mm'') = ''11''
                then  pdp_sum else 0 end)           pdp_sum_11,
        sum(case when to_char(a_dt,''mm'') = ''12''
                then  pdp_sum else 0 end)           pdp_sum_12
    from (
select  x_dt1   a_dt,
        x_sum1  pdp_sum,
        x_id1   cnt_2K,
        x_id2   cnt_3k,
        x_id3   cnt_fml,
        x_sum2  pdp_sum_err,
        x_sum3  prc_2K,
        x_id5   rn
    from uss_esr.tmp_univ_rpt_data d where d.x_id5 = 2)';
        RDM$RTFL.AddDataSet (l_jbr_id, 'ds4', l_sql);

        l_sql := '
    select  ''к≥льк≥сть отримувач≥в , всього''  r_name,
        sum(case when to_char(a_dt,''mm'') = ''01''
                then  cnt_2K+cnt_3K else 0 end)           pdp_sum_01,
        sum(case when to_char(a_dt,''mm'') = ''02''
                then  cnt_2K+cnt_3K else 0 end)           pdp_sum_02,
        sum(case when to_char(a_dt,''mm'') = ''03''
                then  cnt_2K+cnt_3K else 0 end)           pdp_sum_03,
        sum(case when to_char(a_dt,''mm'') = ''04''
                then  cnt_2K+cnt_3K else 0 end)           pdp_sum_04,
        sum(case when to_char(a_dt,''mm'') = ''05''
                then  cnt_2K+cnt_3K else 0 end)           pdp_sum_05,
        sum(case when to_char(a_dt,''mm'') = ''06''
                then  cnt_2K+cnt_3K else 0 end)           pdp_sum_06,
        sum(case when to_char(a_dt,''mm'') = ''07''
                then  cnt_2K+cnt_3K else 0 end)           pdp_sum_07,
        sum(case when to_char(a_dt,''mm'') = ''08''
                then  cnt_2K+cnt_3K else 0 end)           pdp_sum_08,
        sum(case when to_char(a_dt,''mm'') = ''09''
                then  cnt_2K+cnt_3K else 0 end)           pdp_sum_09,
        sum(case when to_char(a_dt,''mm'') = ''10''
                then  cnt_2K+cnt_3K else 0 end)           pdp_sum_10,
        sum(case when to_char(a_dt,''mm'') = ''11''
                then  cnt_2K+cnt_3K else 0 end)           pdp_sum_11,
        sum(case when to_char(a_dt,''mm'') = ''12''
                then  cnt_2K+cnt_3K else 0 end)           pdp_sum_12
    from (
select  x_dt1   a_dt,
        x_sum1  pdp_sum,
        x_id1   cnt_2K,
        x_id2   cnt_3k,
        x_id3   cnt_fml,
        x_sum2  pdp_sum_err,
        x_sum3  prc_2K,
        x_id5   rn
    from uss_esr.tmp_univ_rpt_data d where d.x_id5 = 2)';
        RDM$RTFL.AddDataSet (l_jbr_id, 'ds41', l_sql);

        l_sql := '
    select  ''з них: дл€ виплати в розм≥р≥ 2000,0 грн''  r_name,
        sum(case when to_char(a_dt,''mm'') = ''01''
                then  cnt_2K else 0 end)           pdp_sum_01,
        sum(case when to_char(a_dt,''mm'') = ''02''
                then  cnt_2K else 0 end)           pdp_sum_02,
        sum(case when to_char(a_dt,''mm'') = ''03''
                then  cnt_2K else 0 end)           pdp_sum_03,
        sum(case when to_char(a_dt,''mm'') = ''04''
                then  cnt_2K else 0 end)           pdp_sum_04,
        sum(case when to_char(a_dt,''mm'') = ''05''
                then  cnt_2K else 0 end)           pdp_sum_05,
        sum(case when to_char(a_dt,''mm'') = ''06''
                then  cnt_2K else 0 end)           pdp_sum_06,
        sum(case when to_char(a_dt,''mm'') = ''07''
                then  cnt_2K else 0 end)           pdp_sum_07,
        sum(case when to_char(a_dt,''mm'') = ''08''
                then  cnt_2K else 0 end)           pdp_sum_08,
        sum(case when to_char(a_dt,''mm'') = ''09''
                then  cnt_2K else 0 end)           pdp_sum_09,
        sum(case when to_char(a_dt,''mm'') = ''10''
                then  cnt_2K else 0 end)           pdp_sum_10,
        sum(case when to_char(a_dt,''mm'') = ''11''
                then  cnt_2K else 0 end)           pdp_sum_11,
        sum(case when to_char(a_dt,''mm'') = ''12''
                then  cnt_2K else 0 end)           pdp_sum_12
    from (
select  x_dt1   a_dt,
        x_sum1  pdp_sum,
        x_id1   cnt_2K,
        x_id2   cnt_3k,
        x_id3   cnt_fml,
        x_sum2  pdp_sum_err,
        x_sum3  prc_2K,
        x_id5   rn
    from uss_esr.tmp_univ_rpt_data d where d.x_id5 = 2) union all

    select  '' дл€ виплати в розм≥р≥ 3000 грн''  r_name,
        sum(case when to_char(a_dt,''mm'') = ''01''
                then  cnt_3K else 0 end)           pdp_sum_01,
        sum(case when to_char(a_dt,''mm'') = ''02''
                then  cnt_3K else 0 end)           pdp_sum_02,
        sum(case when to_char(a_dt,''mm'') = ''03''
                then  cnt_3K else 0 end)           pdp_sum_03,
        sum(case when to_char(a_dt,''mm'') = ''04''
                then  cnt_3K else 0 end)           pdp_sum_04,
        sum(case when to_char(a_dt,''mm'') = ''05''
                then  cnt_3K else 0 end)           pdp_sum_05,
        sum(case when to_char(a_dt,''mm'') = ''06''
                then  cnt_3K else 0 end)           pdp_sum_06,
        sum(case when to_char(a_dt,''mm'') = ''07''
                then  cnt_3K else 0 end)           pdp_sum_07,
        sum(case when to_char(a_dt,''mm'') = ''08''
                then  cnt_3K else 0 end)           pdp_sum_08,
        sum(case when to_char(a_dt,''mm'') = ''09''
                then  cnt_3K else 0 end)           pdp_sum_09,
        sum(case when to_char(a_dt,''mm'') = ''10''
                then  cnt_3K else 0 end)           pdp_sum_10,
        sum(case when to_char(a_dt,''mm'') = ''11''
                then  cnt_3K else 0 end)           pdp_sum_11,
        sum(case when to_char(a_dt,''mm'') = ''12''
                then  cnt_3K else 0 end)           pdp_sum_12
    from (
select  x_dt1   a_dt,
        x_sum1  pdp_sum,
        x_id1   cnt_2K,
        x_id2   cnt_3k,
        x_id3   cnt_fml,
        x_sum2  pdp_sum_err,
        x_sum3  prc_2K,
        x_id5   rn
    from uss_esr.tmp_univ_rpt_data d where d.x_id5 = 2)';

        --    RDM$RTFL.AddDataSet(l_jbr_id, 'ds42', l_sql);

        -- ¬иплачено
        l_sql := '
    select  ''ќбс€г кошт≥в дл€ виплати, всього, тис.грн''  r_name,
        sum(case when to_char(a_dt,''mm'') = ''01''
                then  pdp_sum else 0 end)           pdp_sum_01,
        sum(case when to_char(a_dt,''mm'') = ''02''
                then  pdp_sum else 0 end)           pdp_sum_02,
        sum(case when to_char(a_dt,''mm'') = ''03''
                then  pdp_sum else 0 end)           pdp_sum_03,
        sum(case when to_char(a_dt,''mm'') = ''04''
                then  pdp_sum else 0 end)           pdp_sum_04,
        sum(case when to_char(a_dt,''mm'') = ''05''
                then  pdp_sum else 0 end)           pdp_sum_05,
        sum(case when to_char(a_dt,''mm'') = ''06''
                then  pdp_sum else 0 end)           pdp_sum_06,
        sum(case when to_char(a_dt,''mm'') = ''07''
                then  pdp_sum else 0 end)           pdp_sum_07,
        sum(case when to_char(a_dt,''mm'') = ''08''
                then  pdp_sum else 0 end)           pdp_sum_08,
        sum(case when to_char(a_dt,''mm'') = ''09''
                then  pdp_sum else 0 end)           pdp_sum_09,
        sum(case when to_char(a_dt,''mm'') = ''10''
                then  pdp_sum else 0 end)           pdp_sum_10,
        sum(case when to_char(a_dt,''mm'') = ''11''
                then  pdp_sum else 0 end)           pdp_sum_11,
        sum(case when to_char(a_dt,''mm'') = ''12''
                then  pdp_sum else 0 end)           pdp_sum_12
    from (
select  x_dt1   a_dt,
        x_sum1  pdp_sum,
        x_id1   cnt_2K,
        x_id2   cnt_3k,
        x_id3   cnt_fml,
        x_sum2  pdp_sum_err,
        x_sum3  prc_2K,
        x_id5   rn
    from uss_esr.tmp_univ_rpt_data d where d.x_id5 = 3)';
        RDM$RTFL.AddDataSet (l_jbr_id, 'ds5', l_sql);

        -- Ќе виплачено
        l_sql := '
    select  ''ќбс€г кошт≥в дл€ виплати, всього, тис.грн''  r_name,
        sum(case when to_char(a_dt,''mm'') = ''01''
                then  pdp_sum else 0 end)           pdp_sum_01,
        sum(case when to_char(a_dt,''mm'') = ''02''
                then  pdp_sum else 0 end)           pdp_sum_02,
        sum(case when to_char(a_dt,''mm'') = ''03''
                then  pdp_sum else 0 end)           pdp_sum_03,
        sum(case when to_char(a_dt,''mm'') = ''04''
                then  pdp_sum else 0 end)           pdp_sum_04,
        sum(case when to_char(a_dt,''mm'') = ''05''
                then  pdp_sum else 0 end)           pdp_sum_05,
        sum(case when to_char(a_dt,''mm'') = ''06''
                then  pdp_sum else 0 end)           pdp_sum_06,
        sum(case when to_char(a_dt,''mm'') = ''07''
                then  pdp_sum else 0 end)           pdp_sum_07,
        sum(case when to_char(a_dt,''mm'') = ''08''
                then  pdp_sum else 0 end)           pdp_sum_08,
        sum(case when to_char(a_dt,''mm'') = ''09''
                then  pdp_sum else 0 end)           pdp_sum_09,
        sum(case when to_char(a_dt,''mm'') = ''10''
                then  pdp_sum else 0 end)           pdp_sum_10,
        sum(case when to_char(a_dt,''mm'') = ''11''
                then  pdp_sum else 0 end)           pdp_sum_11,
        sum(case when to_char(a_dt,''mm'') = ''12''
                then  pdp_sum else 0 end)           pdp_sum_12
    from (
select  x_dt1   a_dt,
        x_sum1  pdp_sum,
        x_id1   cnt_2K,
        x_id2   cnt_3k,
        x_id3   cnt_fml,
        x_sum2  pdp_sum_err,
        x_sum3  prc_2K,
        x_id5   rn
    from uss_esr.tmp_univ_rpt_data d where d.x_id5 = 4)';
        RDM$RTFL.AddDataSet (l_jbr_id, 'ds6', l_sql);

        -- ѕогашенн€ заборгованост≥ за попередн≥й пер≥од:
        l_sql := '
    select  ''ќбс€г кошт≥в дл€ виплати, всього, тис.грн''  r_name,
        sum(case when to_char(a_dt,''mm'') = ''01''
                then  pdp_sum else 0 end)           pdp_sum_01,
        sum(case when to_char(a_dt,''mm'') = ''02''
                then  pdp_sum else 0 end)           pdp_sum_02,
        sum(case when to_char(a_dt,''mm'') = ''03''
                then  pdp_sum else 0 end)           pdp_sum_03,
        sum(case when to_char(a_dt,''mm'') = ''04''
                then  pdp_sum else 0 end)           pdp_sum_04,
        sum(case when to_char(a_dt,''mm'') = ''05''
                then  pdp_sum else 0 end)           pdp_sum_05,
        sum(case when to_char(a_dt,''mm'') = ''06''
                then  pdp_sum else 0 end)           pdp_sum_06,
        sum(case when to_char(a_dt,''mm'') = ''07''
                then  pdp_sum else 0 end)           pdp_sum_07,
        sum(case when to_char(a_dt,''mm'') = ''08''
                then  pdp_sum else 0 end)           pdp_sum_08,
        sum(case when to_char(a_dt,''mm'') = ''09''
                then  pdp_sum else 0 end)           pdp_sum_09,
        sum(case when to_char(a_dt,''mm'') = ''10''
                then  pdp_sum else 0 end)           pdp_sum_10,
        sum(case when to_char(a_dt,''mm'') = ''11''
                then  pdp_sum else 0 end)           pdp_sum_11,
        sum(case when to_char(a_dt,''mm'') = ''12''
                then  pdp_sum else 0 end)           pdp_sum_12
    from (
select  x_dt1   a_dt,
        x_sum1  pdp_sum,
        x_id1   cnt_2K,
        x_id2   cnt_3k,
        x_id3   cnt_fml,
        x_sum2  pdp_sum_err,
        x_sum3  prc_2K,
        x_id5   rn
    from uss_esr.tmp_univ_rpt_data d where d.x_id5 = 5)';
        RDM$RTFL.AddDataSet (l_jbr_id, 'ds7', l_sql);

        -- ѕовернуто надм≥ру перерахованих/не знайшли отримувач≥в:
        l_sql := '
    select  ''ќбс€г кошт≥в дл€ виплати, всього, тис.грн''  r_name,
        sum(case when to_char(a_dt,''mm'') = ''01''
                then  pdp_sum else 0 end)           pdp_sum_01,
        sum(case when to_char(a_dt,''mm'') = ''02''
                then  pdp_sum else 0 end)           pdp_sum_02,
        sum(case when to_char(a_dt,''mm'') = ''03''
                then  pdp_sum else 0 end)           pdp_sum_03,
        sum(case when to_char(a_dt,''mm'') = ''04''
                then  pdp_sum else 0 end)           pdp_sum_04,
        sum(case when to_char(a_dt,''mm'') = ''05''
                then  pdp_sum else 0 end)           pdp_sum_05,
        sum(case when to_char(a_dt,''mm'') = ''06''
                then  pdp_sum else 0 end)           pdp_sum_06,
        sum(case when to_char(a_dt,''mm'') = ''07''
                then  pdp_sum else 0 end)           pdp_sum_07,
        sum(case when to_char(a_dt,''mm'') = ''08''
                then  pdp_sum else 0 end)           pdp_sum_08,
        sum(case when to_char(a_dt,''mm'') = ''09''
                then  pdp_sum else 0 end)           pdp_sum_09,
        sum(case when to_char(a_dt,''mm'') = ''10''
                then  pdp_sum else 0 end)           pdp_sum_10,
        sum(case when to_char(a_dt,''mm'') = ''11''
                then  pdp_sum else 0 end)           pdp_sum_11,
        sum(case when to_char(a_dt,''mm'') = ''12''
                then  pdp_sum else 0 end)           pdp_sum_12
    from (
select  x_dt1   a_dt,
        x_sum1  pdp_sum,
        x_id1   cnt_2K,
        x_id2   cnt_3k,
        x_id3   cnt_fml,
        x_sum2  pdp_sum_err,
        x_sum3  prc_2K,
        x_id5   rn
    from uss_esr.tmp_univ_rpt_data d where d.x_id5 = 6)';
        RDM$RTFL.AddDataSet (l_jbr_id, 'ds8', l_sql);

        RDM$RTFL.PutReportToWorkingQueue (p_jbr_id => l_jbr_id);
        RETURN l_jbr_id;
    END PAID_VPO_R4;

    -- IC #85156 ƒан≥ про нарахован≥ та виплачен≥ суми по окремих видах допомог, п≥льг та субсид≥йї (щодо допомоги на проживанн€ ¬ѕќ)
    FUNCTION VPO_2000_3000_R1 (p_start_dt   IN DATE,
                               p_org_id     IN NUMBER,
                               p_rt_id      IN rpt_templates.rt_id%TYPE)
        RETURN DECIMAL
    IS
        l_jbr_id       NUMBER;
        l_file_name    VARCHAR2 (128);
        l_month_NAME   VARCHAR2 (100);
        l_org_id       NUMBER := tools.getcurrorg;
    BEGIN
        tools.WriteMsg ('DNET$PAYMENT_REPORTS.' || $$PLSQL_UNIT);
        l_jbr_id := RDM$RTFL.InitReport (p_rt_id => p_rt_id);

        l_file_name :=
               'VPO_2000_3000_R1_'
            || TO_CHAR (p_start_dt, 'yyyy')
            || '_'
            || TO_CHAR (p_start_dt, 'mm')
            || '_'
            || p_org_id
            || '.rtf';

        ikis_sysweb.REPORTFL_ENGINE_EX.SetFileName (
            p_jbr_id      => l_jbr_id,
            p_file_name   => l_file_name);

        SELECT LOWER (MAX (t.dic_name))
          INTO l_month_NAME
          FROM uss_ndi.v_ddn_month_names t
         WHERE t.DIC_VALUE = TO_CHAR (p_start_dt, 'mm');

        RDM$RTFL.AddParam (l_jbr_id, 'year', TO_CHAR (p_start_dt, 'yyyy'));
        RDM$RTFL.AddParam (l_jbr_id, 'month', l_month_NAME);

        RDM$RTFL.AddScript (
            l_jbr_id,
            'constants',
               'begin uss_esr.DNET$PAYMENT_REPORTS.SET_VPO_2000_3000_R1(to_date('''
            || TO_CHAR (p_start_dt, 'dd.mm.yyyy')
            || ''',''dd.mm.yyyy''), '
            || p_org_id
            || ', '
            || l_org_id
            || ', '
            || l_jbr_id
            || '); end;');


        RDM$RTFL.PutReportToWorkingQueue (p_jbr_id => l_jbr_id);
        RETURN l_jbr_id;
    END VPO_2000_3000_R1;

    -- IC #85123 «в≥тн≥сть про к≥льк≥сть ¬ѕќ з ƒонецькоњ, Ћуганськоњ областей,  риму та м. —евастопол€, €к≥ отримують допомогу ¬ѕќ
    FUNCTION DLK_CNT_VPO_R1 (p_start_dt   IN DATE,
                             p_org_id     IN NUMBER,
                             p_rt_id      IN rpt_templates.rt_id%TYPE)
        RETURN DECIMAL
    IS
        l_jbr_id          NUMBER;
        l_file_name       VARCHAR2 (128);

        l_start_dt        DATE := TRUNC (p_start_dt, 'MM');
        l_cnt_eoc_narah   NUMBER;

        l_sql             VARCHAR2 (10000);
    BEGIN
        tools.WriteMsg ('DNET$PAYMENT_REPORTS.' || $$PLSQL_UNIT);
        l_jbr_id := RDM$RTFL.InitReport (p_rt_id => p_rt_id);

        l_file_name :=
               'DLK_CNT_VPO_R1_'
            || TO_CHAR (l_start_dt, 'yyyy')
            || '_'
            || TO_CHAR (l_start_dt, 'mm')
            || '_'
            || p_org_id
            || '.xml.xls';

        ikis_sysweb.REPORTFL_ENGINE_EX.SetFileName (
            p_jbr_id      => l_jbr_id,
            p_file_name   => l_file_name);

        RDM$RTFL.AddParam (l_jbr_id, 'p_year', TO_CHAR (l_start_dt, 'yyyy'));
        RDM$RTFL.AddParam (l_jbr_id, 'p_month', TO_CHAR (l_start_dt, 'mm'));
        RDM$RTFL.AddParam (
            l_jbr_id,
            'p_ym',
               getMonthName (TO_NUMBER (TO_CHAR (l_start_dt, 'mm')))
            || ' '
            || TO_CHAR (l_start_dt, 'yyyy'));

        RDM$RTFL.AddScript (
            l_jbr_id,
            'constants',
               'begin uss_esr.DNET$PAYMENT_REPORTS.SET_DS_DLK_VPO(to_date('''
            || TO_CHAR (l_start_dt, 'dd.mm.yyyy')
            || ''',''dd.mm.yyyy''), '
            || p_org_id
            || ', '
            || l_jbr_id
            || '); end;');

        l_sql := '
    select  x_id1       org_code,           --" од ƒ—«Ќ"
            x_string1   reg_name,           --"Ќазва рег≥ону"
            x_id2       cnt_fam_payed,      --" -сть „лен≥в с≥мей випл."
            x_id3       cnt_fam_payed_dk,
            x_id4       cnt_fam_payed_lg,
            x_id5       cnt_fam_payed_kr,
            x_id6       cnt_fam_payed_sv
        from uss_esr.tmp_univ_rpt_data';

        RDM$RTFL.AddDataSet (l_jbr_id, 'ds', l_sql);

        l_sql := '
    select  sum(x_id2)  t_cnt_fam_payed,     --" -сть „лен≥в с≥мей випл."
            sum(x_id3)  t_cnt_fam_payed_dk,
            sum(x_id4)  t_cnt_fam_payed_lg,
            sum(x_id5)  t_cnt_fam_payed_kr,
            sum(x_id6)  t_cnt_fam_payed_sv
        from uss_esr.tmp_univ_rpt_data';

        RDM$RTFL.AddDataSet (l_jbr_id, 'tds', l_sql);

        RDM$RTFL.PutReportToWorkingQueue (p_jbr_id => l_jbr_id);
        RETURN l_jbr_id;
    END DLK_CNT_VPO_R1;

    -- IC #85725 –еестр на  азначейство (6 допомог)
    FUNCTION KAZNA_REG_6DOP (p_po_id   IN NUMBER,
                             p_rt_id   IN rpt_templates.rt_id%TYPE)
        RETURN DECIMAL
    IS
        l_jbr_id      NUMBER;
        l_file_name   VARCHAR2 (128);

        l_b_dt        VARCHAR2 (8);
        l_e_dt        VARCHAR2 (8);
        l_npc_code    uss_ndi.v_ndi_payment_codes.npc_code%TYPE;
        l_npc_name    uss_ndi.v_ndi_payment_codes.npc_name%TYPE;
        l_err         VARCHAR2 (128);
        l_sql         VARCHAR2 (10000);
    BEGIN
        tools.WriteMsg ('DNET$PAYMENT_REPORTS.' || $$PLSQL_UNIT);
        l_jbr_id := RDM$RTFL.InitReport (p_rt_id => p_rt_id);

        SELECT    'vf'
               || b.nbg_kpk_code
               || '1070' -- IC #93510 —оц≥альний захист ≥нших категор≥й населенн€
               || a.acs_dksu_main_code
               || a.acs_dksu_code
               || TO_CHAR (t.po_pay_dt, 'YY')
               || TO_CHAR (t.po_pay_dt, 'MM')
               || TO_CHAR (t.po_pay_dt, 'DD')
               || pp.dpp_tax_code
               || LPAD (NVL (t.po_num, '00'), 2, '0')
               || '.xls'                                          f_name,
               TO_CHAR (TRUNC (t.po_pay_dt, 'mm'), 'dd\mm\yy')    b_date,
               TO_CHAR (LAST_DAY (po_pay_dt), 'dd\mm\yy')         e_date,
               pc.npc_code,
               pc.npc_name,
               CASE
                   WHEN a.acs_dksu_main_code IS NULL
                   THEN
                       'ЌемаЇ даних по головному управл≥нню ƒ —” по розпор€днику бюджетних кошт≥в'
                   WHEN a.acs_dksu_code IS NULL
                   THEN
                       'ЌемаЇ даних по управл≥нню ƒ —” по розпор€днику бюджетних кошт≥в'
                   ELSE
                       '0'
               END                                                err
          INTO l_file_name,
               l_b_dt,
               l_e_dt,
               l_npc_code,
               l_npc_name,
               l_err
          FROM pay_order  t
               JOIN payroll_reestr r ON r.pe_po = t.po_id
               JOIN uss_ndi.v_ndi_budget_program b ON b.nbg_id = r.pe_nbg
               LEFT JOIN uss_ndi.v_ndi_acc_setup a
                   ON a.com_org = t.com_org_src
               LEFT JOIN uss_ndi.v_ndi_pay_person pp
                   ON pp.dpp_tp = 'OSZN' AND pp.dpp_org = t.com_org_src
               LEFT JOIN uss_ndi.v_ndi_payment_codes pc
                   ON pc.npc_id = r.pe_npc
         WHERE t.po_id = p_po_id
         FETCH FIRST ROW ONLY;

        IF l_err != '0'
        THEN
            raise_application_error (-20000, l_err);
        END IF;

        ikis_sysweb.REPORTFL_ENGINE_EX.SetFileName (
            p_jbr_id      => l_jbr_id,
            p_file_name   => l_file_name);

        RDM$RTFL.AddParam (l_jbr_id, 'b_dt', l_b_dt);
        RDM$RTFL.AddParam (l_jbr_id, 'e_dt', l_e_dt);
        RDM$RTFL.AddParam (l_jbr_id, 'e_npc_code', l_npc_code);
        RDM$RTFL.AddParam (l_jbr_id, 'e_npc_name', l_npc_name);

        RDM$RTFL.AddScript (
            l_jbr_id,
            'constants',
               'begin uss_esr.DNET$PAYMENT_REPORTS.SET_DS_REG_6DOP('
            || p_po_id
            || ', '
            || l_jbr_id
            || '); end;');

        l_sql := '
    select  x_id1       rn,
            x_string1   prs_account,
            x_string2   nb_name,
            x_id2       nb_mfo,
            x_string3   nb_edrpou,
            to_char(x_sum1,
                ''FM9999999990D00'',
                ''NLS_NUMERIC_CHARACTERS='''',''''''''''
                    )   prs_sum,
            x_string4   pib,
            x_string5   rnokpp,
            REGEXP_SUBSTR(x_string6,''[^$]+'',1,1)    prs_doc_num,
            REGEXP_SUBSTR(x_string6,''[^$]+'',1,2)    prs_address
        from uss_esr.tmp_univ_rpt_data';

        RDM$RTFL.AddDataSet (l_jbr_id, 'ds', l_sql);

        l_sql := '
    select   count(*)       t_cnt
            ,to_char(sum(x_sum1),
                ''FM9999999990D00'',
                ''NLS_NUMERIC_CHARACTERS='''',''''''''''
                    )       t_prs_sum
        from uss_esr.tmp_univ_rpt_data';

        RDM$RTFL.AddDataSet (l_jbr_id, 'tds', l_sql);

        RDM$RTFL.PutReportToWorkingQueue (p_jbr_id => l_jbr_id);
        RETURN l_jbr_id;
    END KAZNA_REG_6DOP;

    -- IC #93510 –еестр на  азначейство по утриманн€м
    FUNCTION KAZNA_REG_DED (p_po_id   IN NUMBER,
                            p_rt_id   IN rpt_templates.rt_id%TYPE)
        RETURN DECIMAL
    IS
        l_jbr_id      NUMBER;
        l_file_name   VARCHAR2 (128);

        l_b_dt        VARCHAR2 (8);
        l_e_dt        VARCHAR2 (8);
        l_npc_code    uss_ndi.v_ndi_payment_codes.npc_code%TYPE;
        l_npc_name    uss_ndi.v_ndi_payment_codes.npc_name%TYPE;
        l_err         VARCHAR2 (128);
        l_sql         VARCHAR2 (10000);
    BEGIN
        tools.WriteMsg ('DNET$PAYMENT_REPORTS.' || $$PLSQL_UNIT);
        l_jbr_id := RDM$RTFL.InitReport (p_rt_id => p_rt_id);

        SELECT    'vf'
               || b.nbg_kpk_code
               || '1070' -- IC #93510 —оц≥альний захист ≥нших категор≥й населенн€
               || a.acs_dksu_main_code
               || a.acs_dksu_code
               || TO_CHAR (t.po_pay_dt, 'YY')
               || TO_CHAR (t.po_pay_dt, 'MM')
               || TO_CHAR (t.po_pay_dt, 'DD')
               || pp.dpp_tax_code
               || LPAD (NVL (t.po_num, '00'), 2, '0')
               || '.xls'                                          f_name,
               TO_CHAR (TRUNC (t.po_pay_dt, 'mm'), 'dd\mm\yy')    b_date,
               TO_CHAR (LAST_DAY (po_pay_dt), 'dd\mm\yy')         e_date,
               pc.npc_code,
               pc.npc_name,
               CASE
                   WHEN a.acs_dksu_main_code IS NULL
                   THEN
                       'ЌемаЇ даних по головному управл≥нню ƒ —” по розпор€днику бюджетних кошт≥в'
                   WHEN a.acs_dksu_code IS NULL
                   THEN
                       'ЌемаЇ даних по управл≥нню ƒ —” по розпор€днику бюджетних кошт≥в'
                   ELSE
                       '0'
               END                                                err
          INTO l_file_name,
               l_b_dt,
               l_e_dt,
               l_npc_code,
               l_npc_name,
               l_err
          FROM pay_order  t
               JOIN payroll_reestr r ON r.pe_po = t.po_id
               JOIN uss_ndi.v_ndi_budget_program b ON b.nbg_id = r.pe_nbg
               LEFT JOIN uss_ndi.v_ndi_acc_setup a
                   ON a.com_org = t.com_org_src
               LEFT JOIN uss_ndi.v_ndi_pay_person pp
                   ON pp.dpp_tp = 'OSZN' AND pp.dpp_org = t.com_org_src
               LEFT JOIN uss_ndi.v_ndi_payment_codes pc
                   ON pc.npc_id = r.pe_npc
         WHERE t.po_id = p_po_id
         FETCH FIRST ROW ONLY;

        IF l_err != '0'
        THEN
            raise_application_error (-20000, l_err);
        END IF;

        ikis_sysweb.REPORTFL_ENGINE_EX.SetFileName (
            p_jbr_id      => l_jbr_id,
            p_file_name   => l_file_name);

        RDM$RTFL.AddParam (l_jbr_id, 'b_dt', l_b_dt);
        RDM$RTFL.AddParam (l_jbr_id, 'e_dt', l_e_dt);
        RDM$RTFL.AddParam (l_jbr_id, 'e_npc_code', l_npc_code);
        RDM$RTFL.AddParam (l_jbr_id, 'e_npc_name', l_npc_name);

        RDM$RTFL.AddScript (
            l_jbr_id,
            'constants',
               'begin uss_esr.DNET$PAYMENT_REPORTS.SET_DS_REG_DED('
            || p_po_id
            || ', '
            || l_jbr_id
            || '); end;');

        l_sql := '
    select  x_id1       a3,
            x_id2       rn,
            x_string1   prs_account,
            x_string2   nb_name,
            x_id3       nb_mfo,
            x_string3   nb_edrpou,
            to_char(x_sum1,
                ''FM9999999990D00'',
                ''NLS_NUMERIC_CHARACTERS='''',''''''''''
                    )   prs_sum,
            x_string4   pib,
            x_string5   rnokpp,
            REGEXP_SUBSTR(x_string6,''[^$]+'',1,1)    prs_doc_num,
            REGEXP_SUBSTR(x_string6,''[^$]+'',1,2)    prs_address
        from uss_esr.tmp_univ_rpt_data order by 2';

        RDM$RTFL.AddDataSet (l_jbr_id, 'ds', l_sql);

        l_sql := '
    select   count(*)       t_cnt
            ,to_char(sum(x_sum1),
                ''FM9999999990D00'',
                ''NLS_NUMERIC_CHARACTERS='''',''''''''''
                    )       t_prs_sum
        from uss_esr.tmp_univ_rpt_data';

        RDM$RTFL.AddDataSet (l_jbr_id, 'tds', l_sql);

        RDM$RTFL.PutReportToWorkingQueue (p_jbr_id => l_jbr_id);
        RETURN l_jbr_id;
    END KAZNA_REG_DED;

    -- IC #86322  ≥льк≥сть отримувач≥в допомоги за категор≥€ми
    FUNCTION CNT_RECIP_DOP (p_start_dt   IN DATE,
                            p_nst_id     IN NUMBER := 664,              -- ¬ѕќ
                            p_org_id     IN NUMBER,
                            p_rt_id      IN rpt_templates.rt_id%TYPE)
        RETURN DECIMAL
    IS
        l_jbr_id      NUMBER;
        l_file_name   VARCHAR2 (128);

        l_start_dt    DATE := TRUNC (p_start_dt, 'MM');
        l_nst_name    VARCHAR2 (128);

        l_sql         VARCHAR2 (10000);
    BEGIN
        tools.WriteMsg ('DNET$PAYMENT_REPORTS.' || $$PLSQL_UNIT);
        l_jbr_id := RDM$RTFL.InitReport (p_rt_id => p_rt_id);

        l_file_name :=
               'CNT_RECIP_DOP_'
            || TO_CHAR (l_start_dt, 'yyyy')
            || '_'
            || TO_CHAR (l_start_dt, 'mm')
            || '_'
            || p_org_id
            || '.xml.xls';

        ikis_sysweb.REPORTFL_ENGINE_EX.SetFileName (
            p_jbr_id      => l_jbr_id,
            p_file_name   => l_file_name);

        SELECT SUBSTR (MAX (nst_name), 1, 128)
          INTO l_nst_name
          FROM uss_ndi.v_NDI_SERVICE_TYPE
         WHERE NST_ID = NVL (p_nst_id, 664);

        RDM$RTFL.AddParam (l_jbr_id, 'p_year', TO_CHAR (l_start_dt, 'yyyy'));
        RDM$RTFL.AddParam (l_jbr_id, 'p_month', TO_CHAR (l_start_dt, 'mm'));
        RDM$RTFL.AddParam (
            l_jbr_id,
            'p_ym',
               getMonthName (TO_NUMBER (TO_CHAR (l_start_dt, 'mm')))
            || ' '
            || TO_CHAR (l_start_dt, 'yyyy'));
        RDM$RTFL.AddParam (l_jbr_id, 'p_nst_name', l_nst_name);


        RDM$RTFL.AddScript (
            l_jbr_id,
            'constants',
               'begin uss_esr.DNET$PAYMENT_REPORTS.SET_CNT_RECIP_DOP(to_date('''
            || TO_CHAR (l_start_dt, 'dd.mm.yyyy')
            || ''',''dd.mm.yyyy''), '
            || p_nst_id
            || ', '
            || p_org_id
            || ', '
            || l_jbr_id
            || '); end;');

        l_sql := '
    select  x_id1       org_code,     --  од ќ—«Ќ
            x_string1   org_name,     -- Ќазва ќ—«Ќ
            x_id2       eos_cnt,      -- ≈ќ—
            x_id3       persons_cnt,  -- ќтримувач≥в, ос≥б
            x_id4       mans,         -- „олов≥к≥в
            x_id5       womans,       -- ∆≥нок
            x_id6       work,         -- ѕрацездан≥
            x_sum1      pensions,     -- ѕенс≥онери
            x_sum2      inv,          -- ≤нвал≥ди
            x_sum3      childs        -- ƒ≥ти
        from uss_esr.tmp_univ_rpt_data';

        RDM$RTFL.AddDataSet (l_jbr_id, 'ds', l_sql);

        l_sql :=
               '
    select  1 rec
        from dual where 1 = '
            || CASE WHEN p_org_id IN (0, 50000, 50001) THEN '1' ELSE '0' END;

        RDM$RTFL.AddDataSet (l_jbr_id, 'rec', l_sql);

        l_sql := '
    select  sum(x_id2)  t_eos_cnt,      -- ≈ќ—
            sum(x_id3)  t_persons_cnt,  -- ќтримувач≥в, ос≥б
            sum(x_id4)  t_mans,         -- „олов≥к≥в
            sum(x_id5)  t_womans,       -- ∆≥нок
            sum(x_id6)  t_work,         -- ѕрацездан≥
            sum(x_sum1) t_pensions,     -- ѕенс≥онери
            sum(x_sum2) t_inv,          -- ≤нвал≥ди
            sum(x_sum3) t_childs        -- ƒ≥ти
        from uss_esr.tmp_univ_rpt_data';

        RDM$RTFL.AddDataSet (l_jbr_id, 'tds', l_sql);

        RDM$RTFL.PutReportToWorkingQueue (p_jbr_id => l_jbr_id);
        RETURN l_jbr_id;
    END CNT_RECIP_DOP;

    -- IC #86737 ўодо багатод≥тних с≥мей з числа малозабезпечених
    FUNCTION CNT_MCHILD_FML (p_start_dt   IN DATE,
                             p_nst_id     IN NUMBER := 249, -- ƒержавна соц≥альна допомога малозабезпеченим с≥мТ€м
                             p_org_id     IN NUMBER,
                             p_rt_id      IN rpt_templates.rt_id%TYPE)
        RETURN DECIMAL
    IS
        l_jbr_id      NUMBER;
        l_file_name   VARCHAR2 (128);

        l_start_dt    DATE := TRUNC (p_start_dt, 'MM');
        l_nst_name    VARCHAR2 (128);

        l_sql         VARCHAR2 (10000);
    BEGIN
        tools.WriteMsg ('DNET$PAYMENT_REPORTS.' || $$PLSQL_UNIT);
        l_jbr_id := RDM$RTFL.InitReport (p_rt_id => p_rt_id);

        l_file_name :=
               'CNT_MCHILD_FML_'
            || TO_CHAR (l_start_dt, 'yyyy')
            || '_'
            || TO_CHAR (l_start_dt, 'mm')
            || '_'
            || p_org_id
            || '.xml.xls';

        ikis_sysweb.REPORTFL_ENGINE_EX.SetFileName (
            p_jbr_id      => l_jbr_id,
            p_file_name   => l_file_name);

        SELECT SUBSTR (MAX (nst_name), 1, 128)
          INTO l_nst_name
          FROM uss_ndi.v_NDI_SERVICE_TYPE
         WHERE NST_ID = NVL (p_nst_id, 249);

        RDM$RTFL.AddParam (l_jbr_id, 'p_year', TO_CHAR (l_start_dt, 'yyyy'));
        RDM$RTFL.AddParam (l_jbr_id, 'p_month', TO_CHAR (l_start_dt, 'mm'));
        --    RDM$RTFL.AddParam(l_jbr_id, 'p_ym',  getMonthName(TO_NUMBER(TO_CHAR(l_start_dt,'mm')))
        --                                                || ' '
        --                                                || to_char(l_start_dt,'yyyy'));
        RDM$RTFL.AddParam (l_jbr_id,
                           'p_ym',
                           TO_CHAR (l_start_dt, 'dd.mm.yyyy'));
        RDM$RTFL.AddParam (l_jbr_id, 'p_nst_name', l_nst_name);


        RDM$RTFL.AddScript (
            l_jbr_id,
            'constants',
               'begin uss_esr.DNET$PAYMENT_REPORTS.SET_CNT_MCHILD_FML(to_date('''
            || TO_CHAR (l_start_dt, 'dd.mm.yyyy')
            || ''',''dd.mm.yyyy''), '
            || NVL (p_nst_id, 249)
            || ', '
            || p_org_id
            || ', '
            || l_jbr_id
            || '); end;');

        l_sql := '
    select  x_id1       org_code,       --  од ќ—«Ќ
            x_string1   org_name,       -- Ќазва ќ—«Ќ
            x_id2       x_eos_cnt,      --  ≥льк≥сть с≥мей
            x_id3       x_fml_more,     -- с≥мей багатод≥дних
            x_id4       x_childs,       --  ≥льк≥сть д≥тей
            x_id5       x_childs_more,  -- д≥тей в багатод≥тних
            x_sum1      x_avg_pay_sum,  -- середн≥й розм≥р допомоги
            x_string2 -- xml_row
        from uss_esr.tmp_univ_rpt_data order by 1';

        RDM$RTFL.AddDataSet (l_jbr_id, 'ds', l_sql);

        l_sql :=
            '
    select  sum(x_id2)  t_eos_cnt,      --  ≥льк≥сть с≥мей
            sum(x_id3)  t_fml_more,     -- с≥мей багатод≥дних
            sum(x_id4)  t_childs,       --  ≥льк≥сть д≥тей
            sum(x_id5)  t_childs_more,  -- д≥тей в багатод≥тних
            sum(x_sum1) t_avg_pay_sum,  -- середн≥й розм≥р допомоги
            ''
   <Row>
    <Cell ss:MergeAcross="1" ss:StyleID="s29"><Data ss:Type="String">¬сього</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s78"><Data ss:Type="Number">''||sum(x_id2)||''</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s78"><Data ss:Type="Number">''||sum(x_id3)||''</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s78"><Data ss:Type="Number">''||sum(x_id4)||''</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s78"><Data ss:Type="Number">''||sum(x_id5)||''</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s79"><Data ss:Type="Number">''|| TO_CHAR(nvl(sum(x_sum2),0),''FM9999999999990.00'') ||''</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
    <Cell ss:StyleID="s79"><Data ss:Type="Number">''|| TO_CHAR(nvl(case when nvl(sum(x_id3),0) = 0
                                                                        then 0 else
                                                                    round(nvl(sum(x_sum2),0) / nvl(sum(x_id3),0),2) end,0),''FM9999999999990.00'') ||''</Data><NamedCell
      ss:Name="Print_Area"/></Cell>
   </Row>''              x_string2
        from uss_esr.tmp_univ_rpt_data';

        RDM$RTFL.AddDataSet (l_jbr_id, 'tds', l_sql);

        RDM$RTFL.PutReportToWorkingQueue (p_jbr_id => l_jbr_id);
        RETURN l_jbr_id;
    END CNT_MCHILD_FML;

    -- IC #93410 «в≥т про державну допомогу с≥м'€м з д≥тьми (наказ ћ—ѕ є 272 р≥чна)
    FUNCTION REP_CHILDREN_272 (p_start_dt   IN DATE,
                               p_org_id     IN NUMBER,
                               p_rt_id      IN rpt_templates.rt_id%TYPE)
        RETURN DECIMAL
    IS
        l_jbr_id      NUMBER;
        l_file_name   VARCHAR2 (128);
        l_sql         VARCHAR2 (10000);
        l_start_dt    DATE := TRUNC (p_start_dt, 'MM');
        l_org_name    v_opfu.org_name%TYPE;
    BEGIN
        tools.WriteMsg ('DNET$PAYMENT_REPORTS.' || $$PLSQL_UNIT);
        l_jbr_id := RDM$RTFL.InitReport (p_rt_id => p_rt_id);

        l_file_name :=
               'REP_CHILDREN_272_'
            || TO_CHAR (l_start_dt, 'yyyy')
            || '_'
            || TO_CHAR (l_start_dt, 'mm')
            || '_'
            || p_org_id
            || '.xml.xls';

        ikis_sysweb.REPORTFL_ENGINE_EX.SetFileName (
            p_jbr_id      => l_jbr_id,
            p_file_name   => l_file_name);

        SELECT MAX (org_name)
          INTO l_org_name
          FROM v_opfu
         WHERE org_id =
               CASE
                   WHEN NVL (p_org_id, 0) = 0 THEN Tools.GetCurrOrg
                   ELSE p_org_id
               END;

        RDM$RTFL.AddParam (l_jbr_id, 'p_year', TO_CHAR (l_start_dt, 'yyyy'));
        RDM$RTFL.AddParam (l_jbr_id, 'p_month', TO_CHAR (l_start_dt, 'mm'));
        RDM$RTFL.AddParam (l_jbr_id, 'p_uszn', l_org_name);
        RDM$RTFL.AddParam (l_jbr_id,
                           'p_ym',
                           TO_CHAR (TRUNC (l_start_dt), 'dd.mm.yyyy'));

        RDM$RTFL.AddScript (
            l_jbr_id,
            'constants',
               'begin uss_esr.DNET$PAYMENT_REPORTS.SET_CHILDREN_272(to_date('''
            || TO_CHAR (l_start_dt, 'dd.mm.yyyy')
            || ''',''dd.mm.yyyy''), '
            || p_org_id
            || ', '
            || l_jbr_id
            || '); end;');

        l_sql := '
    select  x_string2
        from uss_esr.tmp_univ_rpt_data where x_sum1 < 100 order by x_sum1';

        RDM$RTFL.AddDataSet (l_jbr_id, 'ds', l_sql);

        l_sql := '
    select  x_string2
        from uss_esr.tmp_univ_rpt_data where x_sum1 >= 100 order by x_sum1';

        RDM$RTFL.AddDataSet (l_jbr_id, 'tds', l_sql);

        RDM$RTFL.PutReportToWorkingQueue (p_jbr_id => l_jbr_id);
        RETURN l_jbr_id;
    END REP_CHILDREN_272;

    -- IC #96873 «в≥т з нарахуванн€ та виплати допомоги
    FUNCTION REP_PRSD_R1 (p_start_dt   IN DATE,
                          p_nst_id     IN NUMBER := 249,
                          p_org_id     IN NUMBER,
                          p_rt_id      IN rpt_templates.rt_id%TYPE)
        RETURN DECIMAL
    IS
        l_jbr_id      NUMBER;
        l_file_name   VARCHAR2 (128);
        l_sql         VARCHAR2 (10000);
        l_start_dt    DATE := TRUNC (p_start_dt, 'MM');
        l_org_name    v_opfu.org_name%TYPE;
        l_nst_name    VARCHAR2 (128);
    BEGIN
        tools.WriteMsg ('DNET$PAYMENT_REPORTS.' || $$PLSQL_UNIT);
        l_jbr_id := RDM$RTFL.InitReport (p_rt_id => p_rt_id);

        l_file_name :=
               'REP_PRSD_R1_'
            || TO_CHAR (l_start_dt, 'yyyy')
            || '_'
            || TO_CHAR (l_start_dt, 'mm')
            || '_'
            || p_org_id
            || '.xml.xls';

        ikis_sysweb.REPORTFL_ENGINE_EX.SetFileName (
            p_jbr_id      => l_jbr_id,
            p_file_name   => l_file_name);

        SELECT MAX (org_name)
          INTO l_org_name
          FROM v_opfu
         WHERE org_id =
               CASE
                   WHEN NVL (p_org_id, 0) = 0 THEN Tools.GetCurrOrg
                   ELSE p_org_id
               END;

        SELECT SUBSTR (MAX (nst_name), 1, 128)
          INTO l_nst_name
          FROM uss_ndi.v_NDI_SERVICE_TYPE
         WHERE NST_ID = NVL (p_nst_id, 249);

        RDM$RTFL.AddParam (l_jbr_id, 'p_uszn', l_org_name);
        RDM$RTFL.AddParam (l_jbr_id, 'p_nst_name', l_nst_name);
        RDM$RTFL.AddParam (l_jbr_id,
                           'p_ym',
                           TO_CHAR (TRUNC (l_start_dt), 'dd.mm.yyyy'));
        RDM$RTFL.AddParam (l_jbr_id,
                           'p_dr',
                           TO_CHAR (SYSDATE, 'dd.mm.yyyy hh24:mi:ss'));

        RDM$RTFL.AddScript (
            l_jbr_id,
            'constants',
               'begin uss_esr.DNET$PAYMENT_REPORTS.SET_PRSD_R1(to_date('''
            || TO_CHAR (l_start_dt, 'dd.mm.yyyy')
            || ''',''dd.mm.yyyy''), '
            || NVL (p_nst_id, 249)
            || ', '
            || p_org_id
            || ', '
            || l_jbr_id
            || '); end;');

        l_sql := '
    select  x_string2
        from uss_esr.tmp_univ_rpt_data where x_id1 >= 1 order by x_id1';

        RDM$RTFL.AddDataSet (l_jbr_id, 'ds', l_sql);

        RDM$RTFL.PutReportToWorkingQueue (p_jbr_id => l_jbr_id);
        RETURN l_jbr_id;
    END REP_PRSD_R1;

    -- IC #108718 «в≥т по в≥домост€м (€к ми рахуЇмо дан≥ по ¬ѕќ) - лист 3859/0/290-24/51 в≥д 03.09.24
    FUNCTION REP_PRSD_R2 (p_start_dt   IN DATE,
                          p_stop_dt    IN DATE,
                          p_nst_id     IN NUMBER,
                          p_org_id     IN NUMBER,
                          p_rt_id      IN rpt_templates.rt_id%TYPE)
        RETURN DECIMAL
    IS
        l_jbr_id      NUMBER;
        l_file_name   VARCHAR2 (128);
        l_sql         VARCHAR2 (10000);
        l_start_dt    DATE := TRUNC (p_start_dt, 'MM');
        l_stop_dt     DATE := TRUNC (p_stop_dt, 'MM');
        l_nst_name    VARCHAR2 (128);
    BEGIN
        tools.WriteMsg ('DNET$PAYMENT_REPORTS.' || $$PLSQL_UNIT);
        l_jbr_id := RDM$RTFL.InitReport (p_rt_id => p_rt_id);

        l_file_name :=
               'REP_PRSD_R2_'
            || TO_CHAR (l_start_dt, 'yyyymmdd')
            || '_'
            || TO_CHAR (l_stop_dt, 'yyyymmdd')
            || '_'
            || TO_CHAR (p_nst_id)
            || '_'
            || p_org_id
            || '.xml.xls';

        ikis_sysweb.REPORTFL_ENGINE_EX.SetFileName (
            p_jbr_id      => l_jbr_id,
            p_file_name   => l_file_name);

        SELECT SUBSTR (MAX (nst_name), 1, 128)
          INTO l_nst_name
          FROM uss_ndi.v_NDI_SERVICE_TYPE
         WHERE NST_ID = NVL (p_nst_id, 249);

        RDM$RTFL.AddParam (l_jbr_id, 'p_nst_name', l_nst_name);

        RDM$RTFL.AddScript (
            l_jbr_id,
            'constants',
               'begin uss_esr.DNET$PAYMENT_REPORTS.SET_PRSD_R2(to_date('''
            || TO_CHAR (l_start_dt, 'dd.mm.yyyy')
            || ''',''dd.mm.yyyy''), '
            || 'to_date('''
            || TO_CHAR (l_stop_dt, 'dd.mm.yyyy')
            || ''',''dd.mm.yyyy''), '
            || NVL (p_nst_id, 249)
            || ', '
            || p_org_id
            || ', '
            || l_jbr_id
            || '); end;');

        l_sql := '
    select  x_dt1       nm_month,
            x_string1   nm_name,
            x_string2   reg_name,
            x_id1       cnt_nrh,
            TO_CHAR(x_sum1,''FM9999999999990.00'')
                        sum_nrh,
            x_id2       cnt_vpl,
            TO_CHAR(x_sum2,''FM9999999999990.00'')
                        sum_vpl
        from uss_esr.tmp_univ_rpt_data order by 1, 3';

        RDM$RTFL.AddDataSet (l_jbr_id, 'ds', l_sql);

        RDM$RTFL.PutReportToWorkingQueue (p_jbr_id => l_jbr_id);
        RETURN l_jbr_id;
    END REP_PRSD_R2;

    -- IC #91166 «в≥т про наданн€ державноњ соц≥альноњ допомоги ≥нвал≥дам з дитинства та д≥т€м-≥нвал≥дам
    FUNCTION DSDI_R1 (p_start_dt   IN DATE,
                      p_org_id     IN NUMBER,
                      p_rt_id      IN rpt_templates.rt_id%TYPE)
        RETURN DECIMAL
    IS
        l_jbr_id      NUMBER;
        l_file_name   VARCHAR2 (128);
        l_sql         VARCHAR2 (10000);
        l_start_dt    DATE := TRUNC (p_start_dt, 'MM');
        l_org_name    v_opfu.org_name%TYPE;
    BEGIN
        tools.WriteMsg ('DNET$PAYMENT_REPORTS.' || $$PLSQL_UNIT);
        l_jbr_id := RDM$RTFL.InitReport (p_rt_id => p_rt_id);

        l_file_name :=
               'DSDI_R1_'
            || TO_CHAR (l_start_dt, 'yyyy')
            || '_'
            || TO_CHAR (l_start_dt, 'mm')
            || '_'
            || p_org_id
            || '.xml.xls';

        ikis_sysweb.REPORTFL_ENGINE_EX.SetFileName (
            p_jbr_id      => l_jbr_id,
            p_file_name   => l_file_name);


        SELECT MAX (org_name)
          INTO l_org_name
          FROM v_opfu
         WHERE org_id =
               CASE
                   WHEN NVL (p_org_id, 0) = 0 THEN Tools.GetCurrOrg
                   ELSE p_org_id
               END;

        RDM$RTFL.AddParam (l_jbr_id, 'p_year', TO_CHAR (l_start_dt, 'yyyy'));
        RDM$RTFL.AddParam (l_jbr_id, 'p_month', TO_CHAR (l_start_dt, 'mm'));
        RDM$RTFL.AddParam (l_jbr_id, 'p_uszn', l_org_name);
        RDM$RTFL.AddParam (
            l_jbr_id,
            'p_mname',
            getMonthName (TO_NUMBER (TO_CHAR (l_start_dt, 'mm'))));
        RDM$RTFL.AddParam (
            l_jbr_id,
            'p_ym',
               getMonthName (TO_NUMBER (TO_CHAR (l_start_dt, 'mm')))
            || ' '
            || TO_CHAR (l_start_dt, 'yyyy'));

        RDM$RTFL.AddScript (
            l_jbr_id,
            'constants',
               'begin uss_esr.DNET$PAYMENT_REPORTS.SET_DSDI_R1(to_date('''
            || TO_CHAR (l_start_dt, 'dd.mm.yyyy')
            || ''',''dd.mm.yyyy''), '
            || p_org_id
            || ', '
            || l_jbr_id
            || '); end;');

        l_sql := '
    select  x_string2
        from uss_esr.tmp_univ_rpt_data order by x_id1';

        RDM$RTFL.AddDataSet (l_jbr_id, 'ds', l_sql);

        RDM$RTFL.PutReportToWorkingQueue (p_jbr_id => l_jbr_id);
        RETURN l_jbr_id;
    END DSDI_R1;

    -- IC #92714 ¬иплата допомоги ¬ѕќ (реЇстри)
    FUNCTION PAID_VPO_R5 (p_start_dt   IN DATE,
                          p_org_id     IN NUMBER,
                          p_rt_id      IN rpt_templates.rt_id%TYPE)
        RETURN DECIMAL
    IS
        l_jbr_id      NUMBER;
        l_file_name   VARCHAR2 (128);
        l_sql         VARCHAR2 (10000);
        l_start_dt    DATE := TRUNC (p_start_dt, 'MM');
        l_org_name    v_opfu.org_name%TYPE;
    BEGIN
        tools.WriteMsg ('DNET$PAYMENT_REPORTS.' || $$PLSQL_UNIT);
        l_jbr_id := RDM$RTFL.InitReport (p_rt_id => p_rt_id);

        l_file_name :=
               'PAID_VPO_R5_'
            || TO_CHAR (l_start_dt, 'yyyy')
            || '_'
            || TO_CHAR (l_start_dt, 'mm')
            || '_'
            || p_org_id
            || '.xml.xls';

        ikis_sysweb.REPORTFL_ENGINE_EX.SetFileName (
            p_jbr_id      => l_jbr_id,
            p_file_name   => l_file_name);

        RDM$RTFL.AddParam (l_jbr_id, 'p_year', TO_CHAR (l_start_dt, 'yyyy'));
        RDM$RTFL.AddParam (l_jbr_id, 'p_month', TO_CHAR (l_start_dt, 'mm'));
        RDM$RTFL.AddParam (
            l_jbr_id,
            'p_ym',
               getMonthName (TO_NUMBER (TO_CHAR (l_start_dt, 'mm')))
            || ' '
            || TO_CHAR (l_start_dt, 'yyyy'));

        RDM$RTFL.AddScript (
            l_jbr_id,
            'constants',
               'begin uss_esr.DNET$PAYMENT_REPORTS.SET_PAID_VPO_R5(to_date('''
            || TO_CHAR (l_start_dt, 'dd.mm.yyyy')
            || ''',''dd.mm.yyyy''), '
            || p_org_id
            || ', '
            || l_jbr_id
            || '); end;');

        l_sql := '
    select  x_string2
        from uss_esr.tmp_univ_rpt_data order by x_dt1, x_id1';

        RDM$RTFL.AddDataSet (l_jbr_id, 'ds', l_sql);

        RDM$RTFL.PutReportToWorkingQueue (p_jbr_id => l_jbr_id);
        RETURN l_jbr_id;
    END PAID_VPO_R5;

    -- IC #94445 «в≥т про непрацюючих працездатних ос≥б
    FUNCTION REP_INCOM_R1 (p_start_dt   IN DATE,
                           p_org_id     IN NUMBER,
                           p_rt_id      IN rpt_templates.rt_id%TYPE)
        RETURN DECIMAL
    IS
        l_jbr_id      NUMBER;
        l_file_name   VARCHAR2 (128);
        l_sql         VARCHAR2 (10000);
        l_start_dt    DATE := TRUNC (p_start_dt, 'mm');
    BEGIN
        tools.WriteMsg ('DNET$PAYMENT_REPORTS.' || $$PLSQL_UNIT);
        l_jbr_id := RDM$RTFL.InitReport (p_rt_id => p_rt_id);

        l_file_name :=
               'REP_INCOM_R1_'
            || TO_CHAR (l_start_dt, 'yyyy')
            || '_'
            || TO_CHAR (l_start_dt, 'mm')
            || '_'
            || p_org_id
            || '.xml.xls';

        ikis_sysweb.REPORTFL_ENGINE_EX.SetFileName (
            p_jbr_id      => l_jbr_id,
            p_file_name   => l_file_name);

        RDM$RTFL.AddParam (l_jbr_id, 'p_year', TO_CHAR (l_start_dt, 'yyyy'));
        RDM$RTFL.AddParam (l_jbr_id, 'p_month', TO_CHAR (l_start_dt, 'mm'));
        RDM$RTFL.AddParam (
            l_jbr_id,
            'p_dtrep',
               getMonthName (TO_NUMBER (TO_CHAR (l_start_dt, 'mm')))
            || ' '
            || TO_CHAR (l_start_dt, 'yyyy'));

        SELECT org_name
          INTO l_sql
          FROM ikis_sys.v_opfu
         WHERE org_id =
               CASE
                   WHEN p_org_id = 0 THEN Tools.GetCurrOrg
                   WHEN p_org_id = 50001 THEN 50000
                   ELSE p_org_id
               END;

        RDM$RTFL.AddParam (l_jbr_id, 'p_orgname', l_sql);
        l_sql := '';

        --l_start_dt := ADD_MONTHS(l_start_dt,12);
        --l_start_dt := LEAST(l_start_dt, TRUNC(sysdate,'mm'));

        RDM$RTFL.AddScript (
            l_jbr_id,
            'constants',
               'begin uss_esr.DNET$PAYMENT_REPORTS.SET_REP_INCOM_R1(to_date('''
            || TO_CHAR (l_start_dt, 'dd.mm.yyyy')
            || ''',''dd.mm.yyyy''), '
            || p_org_id
            || ', '
            || l_jbr_id
            || '); end;');

        l_sql := '
    select  x_id1       rn,
            x_string1   org_name,
            x_string2   pib,
            x_string3   r_addr,
            x_string4   f_addr,
            x_string5   pd_dt
        from uss_esr.tmp_univ_rpt_data order by x_id1';

        RDM$RTFL.AddDataSet (l_jbr_id, 'ds', l_sql);

        RDM$RTFL.PutReportToWorkingQueue (p_jbr_id => l_jbr_id);
        RETURN l_jbr_id;
    END REP_INCOM_R1;

    -- IC #98585 —кладов≥ суми у в≥домост≥
    FUNCTION REP_PAYROLL_AMOUNT_R1 (p_start_dt   IN DATE,
                                    p_org_id     IN NUMBER,
                                    p_val_1      IN VARCHAR2,
                                    p_val_2      IN VARCHAR2,
                                    p_rt_id      IN rpt_templates.rt_id%TYPE)
        RETURN DECIMAL
    IS
        l_jbr_id      NUMBER;
        l_file_name   VARCHAR2 (128);
        l_sql         VARCHAR2 (10000);
        l_start_dt    DATE := TRUNC (p_start_dt, 'mm');
        l_nst_id      NUMBER;
        l_pay_type    uss_esr.payroll.pr_pay_tp%TYPE;
    BEGIN
        tools.WriteMsg ('DNET$PAYMENT_REPORTS.' || $$PLSQL_UNIT);
        l_jbr_id := RDM$RTFL.InitReport (p_rt_id => p_rt_id);

        l_file_name :=
               'REP_PAYROLL_AMOUNT_R1_'
            || TO_CHAR (l_start_dt, 'yyyy')
            || '_'
            || TO_CHAR (l_start_dt, 'mm')
            || '_'
            || p_org_id
            || '.csv';

        ikis_sysweb.REPORTFL_ENGINE_EX.SetFileName (
            p_jbr_id      => l_jbr_id,
            p_file_name   => l_file_name);

        l_nst_id := TO_NUMBER (p_val_1);
        l_pay_type := NVL (p_val_2, '0');

        RDM$RTFL.AddScript (
            l_jbr_id,
            'constants',
               'begin uss_esr.DNET$PAYMENT_REPORTS.SET_PAYROLL_AMOUNT_R1(to_date('''
            || TO_CHAR (l_start_dt, 'dd.mm.yyyy')
            || ''',''dd.mm.yyyy''), '
            || p_org_id
            || ', '
            || l_nst_id
            || ', '''
            || l_pay_type
            || ''', '
            || l_jbr_id
            || '); end;');

        l_sql := '
    select  x_string1
        from uss_esr.tmp_univ_rpt_data order by x_id1';

        RDM$RTFL.AddDataSet (l_jbr_id, 'ds', l_sql);

        RDM$RTFL.PutReportToWorkingQueue (p_jbr_id => l_jbr_id);
        RETURN l_jbr_id;
    END REP_PAYROLL_AMOUNT_R1;


    FUNCTION sm_all (p_date    DATE,
                     p_sum1    NUMBER,
                     p_sum2    NUMBER,
                     p_sum3    NUMBER,
                     p_sum4    NUMBER,
                     p_sum5    NUMBER,
                     p_sum6    NUMBER,
                     p_sum7    NUMBER,
                     p_sum8    NUMBER,
                     p_sum9    NUMBER,
                     p_sum10   NUMBER,
                     p_sum11   NUMBER,
                     p_sum12   NUMBER)
        RETURN NUMBER
    IS
        l_period   NUMBER := EXTRACT (MONTH FROM p_date);
        l_sum      NUMBER := 0;
    BEGIN
        IF l_period >= 1
        THEN
            l_sum := l_sum + NVL (p_sum1, 0);
        ELSE
            RETURN l_sum;
        END IF;

        IF l_period >= 2
        THEN
            l_sum := l_sum + NVL (p_sum2, 0);
        ELSE
            RETURN l_sum;
        END IF;

        IF l_period >= 3
        THEN
            l_sum := l_sum + NVL (p_sum3, 0);
        ELSE
            RETURN l_sum;
        END IF;

        IF l_period >= 4
        THEN
            l_sum := l_sum + NVL (p_sum4, 0);
        ELSE
            RETURN l_sum;
        END IF;

        IF l_period >= 5
        THEN
            l_sum := l_sum + NVL (p_sum5, 0);
        ELSE
            RETURN l_sum;
        END IF;

        IF l_period >= 6
        THEN
            l_sum := l_sum + NVL (p_sum6, 0);
        ELSE
            RETURN l_sum;
        END IF;

        IF l_period >= 7
        THEN
            l_sum := l_sum + NVL (p_sum7, 0);
        ELSE
            RETURN l_sum;
        END IF;

        IF l_period >= 8
        THEN
            l_sum := l_sum + NVL (p_sum8, 0);
        ELSE
            RETURN l_sum;
        END IF;

        IF l_period >= 9
        THEN
            l_sum := l_sum + NVL (p_sum9, 0);
        ELSE
            RETURN l_sum;
        END IF;

        IF l_period >= 10
        THEN
            l_sum := l_sum + NVL (p_sum10, 0);
        ELSE
            RETURN l_sum;
        END IF;

        IF l_period >= 11
        THEN
            l_sum := l_sum + NVL (p_sum11, 0);
        ELSE
            RETURN l_sum;
        END IF;

        IF l_period = 12
        THEN
            l_sum := l_sum + NVL (p_sum12, 0);
        END IF;

        RETURN l_sum;
    END;

    FUNCTION cnt_all (p_date DATE, p_period NUMBER, p_sum NUMBER)
        RETURN NUMBER
    IS
    BEGIN
        IF EXTRACT (MONTH FROM p_date) >= p_period AND p_sum > 0
        THEN
            RETURN 1;
        END IF;

        RETURN 0;
    END;

    FUNCTION INCOME_CERT_R1 (p_rt_id      IN NUMBER,
                             p_start_dt   IN DATE,
                             p_stop_dt    IN DATE,
                             p_pc_id      IN NUMBER)
        RETURN DECIMAL
    IS
        l_jbr_id     DECIMAL;
        l_start_dt   DATE := p_start_dt;
        l_stop_dt    DATE := p_stop_dt;
    BEGIN
        SELECT CASE WHEN tools.GetCurrOrg != t.com_org THEN 1 END
          INTO l_jbr_id
          FROM personalcase t
         WHERE t.pc_id = p_pc_id;

        /*IF (l_jbr_id = 1) THEN
          raise_application_error(-20000, '«в≥т будуЇтьс€ лише по ≈ќ— €к≥ знаход€тьс€ в поточному ќ—«Ќ!');
        END IF;*/

        l_jbr_id := RDM$RTFL.InitReport (p_rt_id => p_rt_id);

        IF (l_start_dt IS NULL)
        THEN
            l_start_dt := ADD_MONTHS (TRUNC (SYSDATE, 'MM'), -6);
            l_stop_dt := TRUNC (SYSDATE, 'MM') - 1;
        END IF;


        Rdm$rtfl.AddDataSet (
            l_jbr_id,
            'ds_nst',
               'SELECT nst_id, nst_name
            FROM (SELECT DISTINCT nst_id, nst_name
                             FROM uss_esr.v_pc_decision z
                               JOIN uss_esr.v_pd_payment pp         ON (pp.pdp_pd = z.pd_id
                                                                        AND pp.history_status = ''A''
                                                                        )
                               JOIN uss_esr.v_pd_accrual_period pdap    ON (pdap.pdap_pd = z.pd_id
                                                                            AND pdap.history_status = ''A''
                                                                            )
                               JOIN uss_ndi.v_ndi_service_type zt   ON (zt.nst_id = z.pd_nst)
                               JOIN uss_ndi.v_ndi_months m          ON m.nm_month BETWEEN TRUNC(to_date('''
            || TO_CHAR (l_start_dt, 'DD.MM.YYYY')
            || ''', ''DD.MM.YYYY''),''MM'')
                                                                                        AND to_date('''
            || TO_CHAR (l_stop_dt, 'DD.MM.YYYY')
            || ''', ''DD.MM.YYYY'')
                             WHERE z.pd_pc = '
            || p_pc_id
            || '
                                   AND m.nm_month BETWEEN trunc(pp.pdp_start_dt,''MM'') AND pp.pdp_stop_dt
                                   AND m.nm_month BETWEEN trunc(pdap.pdap_start_dt,''MM'') AND pdap.pdap_stop_dt
                        union all
                    SELECT 99999 nst_id, ''–ј«ќћ'' nst_name from dual
                               ) a WHERE 1=1');

        Rdm$rtfl.AddDataSet (
            l_jbr_id,
            'ds',
               'SELECT (select lower(dic_name) from uss_ndi.v_ddn_month_names z where z.dic_value = to_char(p_month, ''MM'')) || '' '' || to_char(p_month, ''YYYY'') || '' p.'' AS ds_month,
               to_char(nvl(SUM(s1),0), ''FM9G999G999G999G999G990D00'', ''NLS_NUMERIC_CHARACTERS='''','''''''''')  AS amount,
               to_char(nvl(SUM(s2),0), ''FM9G999G999G999G999G990D00'', ''NLS_NUMERIC_CHARACTERS='''','''''''''')  AS alimony,
               row_number() over(order by p_month) rn,
               ds_nst_id
          --FROM (SELECT TRUNC(t.acd_ac_start_dt, ''MM'') AS p_month,
          FROM (SELECT TRUNC(t.acd_start_dt, ''MM'') AS p_month,
                       t.acd_payed_sum AS s1,
                       -- CASE WHEN t.acd_npt in (332, 333, 334) THEN acd_payed_sum ELSE 0 END AS s2,
                       0 AS s2,
                       zt.nst_id AS ds_nst_id
                  FROM uss_esr.v_ac_detail t
                  JOIN uss_esr.v_accrual r ON (r.ac_id = t.acd_ac)
                  JOIN uss_esr.v_pc_decision z ON (z.pd_id = t.acd_pd)
                  JOIN uss_ndi.v_ndi_service_type zt ON (zt.nst_id = z.pd_nst)
                 WHERE 1 = 1
                   AND r.ac_pc = '
            || p_pc_id
            || '
                   --AND t.acd_imp_pr_num IS NOT NULL
                   AND t.history_status = ''A''
                   and t.acd_ac_start_dt between to_date('''
            || TO_CHAR (l_start_dt, 'DD.MM.YYYY')
            || ''', ''DD.MM.YYYY'')
                       and to_date('''
            || TO_CHAR (l_stop_dt, 'DD.MM.YYYY')
            || ''', ''DD.MM.YYYY'')
                UNION ALL
                SELECT TRUNC(pr_fix_dt, ''MM'') AS p_month,
                       --d.prsd_sum AS s1,
                       0 AS s1,
                       --CASE WHEN t.acd_npt in (332, 333, 334) THEN d.prsd_sum ELSE 0 END AS s2,
                       d.prsd_sum AS s2,
                       zt.nst_id AS ds_nst_id
                  FROM uss_esr.v_ac_detail t
                  JOIN uss_esr.v_accrual r ON (r.ac_id = t.acd_ac)
                  JOIN uss_esr.v_pr_sheet_detail d ON (d.prsd_id = t.acd_prsd)
                  JOIN uss_esr.v_pr_sheet ps ON (ps.prs_id = d.prsd_prs)
                  join uss_esr.v_payroll p on (p.pr_id = d.prsd_pr)
                  JOIN uss_esr.v_pc_decision z ON (z.pd_id = t.acd_pd)
                  JOIN uss_ndi.v_ndi_service_type zt ON (zt.nst_id = z.pd_nst)
                 WHERE 1 = 1
                   AND r.ac_pc = '
            || p_pc_id
            || '
                   AND t.acd_prsd IS NOT NULL
                   and ps.prs_st = ''KV2''
                   AND t.history_status = ''A''
                   AND t.acd_npt in (332, 333, 334)
                   and d.prsd_month between to_date('''
            || TO_CHAR (l_start_dt, 'DD.MM.YYYY')
            || ''', ''DD.MM.YYYY'')
                       and to_date('''
            || TO_CHAR (l_stop_dt, 'DD.MM.YYYY')
            || ''', ''DD.MM.YYYY'')

                UNION ALL -- TOTAL
                --SELECT TRUNC(t.acd_ac_start_dt, ''MM'') AS p_month,
                SELECT TRUNC(t.acd_start_dt, ''MM'') AS p_month,
                       t.acd_payed_sum AS s1,
                       -- CASE WHEN t.acd_npt in (332, 333, 334) THEN acd_payed_sum ELSE 0 END AS s2,
                       0 AS s2,
                       99999 AS ds_nst_id
                  FROM uss_esr.v_ac_detail t
                  JOIN uss_esr.v_accrual r ON (r.ac_id = t.acd_ac)
                 WHERE 1 = 1
                   AND r.ac_pc = '
            || p_pc_id
            || '
                   --AND t.acd_imp_pr_num IS NOT NULL
                   AND t.history_status = ''A''
                   and t.acd_ac_start_dt between to_date('''
            || TO_CHAR (l_start_dt, 'DD.MM.YYYY')
            || ''', ''DD.MM.YYYY'')
                       and to_date('''
            || TO_CHAR (l_stop_dt, 'DD.MM.YYYY')
            || ''', ''DD.MM.YYYY'')
                UNION ALL
                SELECT TRUNC(pr_fix_dt, ''MM'') AS p_month,
                       --d.prsd_sum AS s1,
                       0 AS s1,
                       --CASE WHEN t.acd_npt in (332, 333, 334) THEN d.prsd_sum ELSE 0 END AS s2,
                       d.prsd_sum AS s2,
                       99999 AS ds_nst_id
                  FROM uss_esr.v_ac_detail t
                  JOIN uss_esr.v_accrual r ON (r.ac_id = t.acd_ac)
                  JOIN uss_esr.v_pr_sheet_detail d ON (d.prsd_id = t.acd_prsd)
                  JOIN uss_esr.v_pr_sheet ps ON (ps.prs_id = d.prsd_prs)
                  join uss_esr.v_payroll p on (p.pr_id = d.prsd_pr)
                 WHERE 1 = 1
                   AND r.ac_pc = '
            || p_pc_id
            || '
                   AND t.acd_prsd IS NOT NULL
                   and ps.prs_st = ''KV2''
                   AND t.history_status = ''A''
                   AND t.acd_npt in (332, 333, 334)
                   and d.prsd_month between to_date('''
            || TO_CHAR (l_start_dt, 'DD.MM.YYYY')
            || ''', ''DD.MM.YYYY'')
                       and to_date('''
            || TO_CHAR (l_stop_dt, 'DD.MM.YYYY')
            || ''', ''DD.MM.YYYY'')
              ) t
          GROUP BY p_month, ds_nst_id
          HAVING 1=1');


        Rdm$rtfl.AddDataSet (
            l_jbr_id,
            'ds_tot',
               'SELECT to_char(nvl(SUM(s1),0), ''FM9G999G999G999G999G990D00'', ''NLS_NUMERIC_CHARACTERS='''','''''''''')  AS amount_all,
               to_char(nvl(SUM(s2),0), ''FM9G999G999G999G999G990D00'', ''NLS_NUMERIC_CHARACTERS='''','''''''''')  AS alimony_all,
               lower(uss_esr.tools.SUM_TO_TEXT((nvl(sum(s1), 0) - nvl(sum(s2), 0)), P_COP_AS_TEXT => ''F'')) as amount_clear
          --FROM (SELECT TRUNC(t.acd_ac_start_dt, ''MM'') AS p_month,
          FROM (SELECT TRUNC(t.acd_start_dt, ''MM'') AS p_month,
                       t.acd_payed_sum AS s1,
                       --CASE WHEN t.acd_npt in (332, 333, 334) THEN acd_payed_sum ELSE 0 END AS s2
                       0 AS s2
                  FROM uss_esr.v_ac_detail t
                  JOIN uss_esr.v_accrual r ON (r.ac_id = t.acd_ac)
                 WHERE 1 = 1
                   AND r.ac_pc = '
            || p_pc_id
            || '
                   --AND t.acd_imp_pr_num IS NOT NULL
                   AND t.history_status = ''A''
                   and t.acd_ac_start_dt between to_date('''
            || TO_CHAR (l_start_dt, 'DD.MM.YYYY')
            || ''', ''DD.MM.YYYY'')
                       and to_date('''
            || TO_CHAR (l_stop_dt, 'DD.MM.YYYY')
            || ''', ''DD.MM.YYYY'')
                UNION ALL
                SELECT TRUNC(d.prsd_month, ''MM'') AS p_month,
                       --d.prsd_sum AS s1,
                       0 AS s1,
                       --CASE WHEN t.acd_npt in (332, 333, 334) THEN d.prsd_sum ELSE 0 END AS s2
                       d.prsd_sum AS s2
                  FROM uss_esr.v_ac_detail t
                  JOIN uss_esr.v_accrual r ON (r.ac_id = t.acd_ac)
                  JOIN uss_esr.v_pr_sheet_detail d ON (d.prsd_id = t.acd_prsd)
                  JOIN  uss_esr.v_pr_sheet ps ON (ps.prs_id = d.prsd_prs)
                  join  uss_esr.v_payroll p on (p.pr_id = d.prsd_pr)
                 WHERE 1 = 1
                   AND r.ac_pc = '
            || p_pc_id
            || '
                   AND t.acd_prsd IS NOT NULL
                   and ps.prs_st = ''KV2''
                   AND t.history_status = ''A''
                   AND t.acd_npt in (332, 333, 334)
                   and d.prsd_month between to_date('''
            || TO_CHAR (l_start_dt, 'DD.MM.YYYY')
            || ''', ''DD.MM.YYYY'')
                       and to_date('''
            || TO_CHAR (l_stop_dt, 'DD.MM.YYYY')
            || ''', ''DD.MM.YYYY'')
              ) t WHERE 1=1');

        RDM$RTFL.AddRelation (l_jbr_id,
                              'ds_nst',
                              'nst_id',
                              'ds',
                              'ds_nst_id');

        FOR xx
            IN (SELECT    uss_person.api$sc_tools.GET_PIB (t.pc_sc)
                       || ' '
                       || uss_person.api$sc_tools.get_numident (t.pc_sc)
                           AS pib,
                       uss_person.api$sc_tools.get_address (t.pc_sc, 3)
                           AS addr,
                       p.org_name
                           AS org_name,
                       (SELECT LISTAGG (nst_name, ', ')
                                   WITHIN GROUP (ORDER BY 1)
                          FROM (SELECT DISTINCT nst_name
                                  FROM pc_decision  z
                                       JOIN uss_esr.pd_payment pp
                                           ON (    pp.pdp_pd = z.pd_id
                                               AND pp.history_status = 'A')
                                       JOIN uss_esr.pd_accrual_period pdap
                                           ON (    pdap.pdap_pd = z.pd_id
                                               AND pdap.history_status = 'A')
                                       JOIN uss_ndi.v_ndi_service_type zt
                                           ON (zt.nst_id = z.pd_nst)
                                       JOIN uss_ndi.v_ndi_months m
                                           ON m.nm_month BETWEEN TRUNC (
                                                                     l_start_dt,
                                                                     'MM')
                                                             AND l_stop_dt
                                 WHERE     z.pd_pc = t.pc_id
                                       AND m.nm_month BETWEEN TRUNC (
                                                                  pp.pdp_start_dt,
                                                                  'MM')
                                                          AND pp.pdp_stop_dt
                                       AND m.nm_month BETWEEN TRUNC (
                                                                  pdap.pdap_start_dt,
                                                                  'MM')
                                                          AND pdap.pdap_stop_dt))
                           AS dblbzm_1,
                       (SELECT LISTAGG (nst_legal_act, ', ')
                                   WITHIN GROUP (ORDER BY 1)
                          FROM (SELECT DISTINCT nst_legal_act
                                  FROM pc_decision  z
                                       JOIN uss_esr.pd_payment pp
                                           ON (    pp.pdp_pd = z.pd_id
                                               AND pp.history_status = 'A')
                                       JOIN uss_esr.pd_accrual_period pdap
                                           ON (    pdap.pdap_pd = z.pd_id
                                               AND pdap.history_status = 'A')
                                       JOIN uss_ndi.v_ndi_service_type zt
                                           ON (zt.nst_id = z.pd_nst)
                                       JOIN uss_ndi.v_ndi_months m
                                           ON m.nm_month BETWEEN TRUNC (
                                                                     l_start_dt,
                                                                     'MM')
                                                             AND l_stop_dt
                                 WHERE     z.pd_pc = t.pc_id
                                       AND m.nm_month BETWEEN TRUNC (
                                                                  pp.pdp_start_dt,
                                                                  'MM')
                                                          AND pp.pdp_stop_dt
                                       AND m.nm_month BETWEEN TRUNC (
                                                                  pdap.pdap_start_dt,
                                                                  'MM')
                                                          AND pdap.pdap_stop_dt))
                           AS dblbzm_2,
                       (SELECT    TO_CHAR (SYSDATE, 'DD')
                               || ' '
                               || LOWER (dic_sname)
                               || ' '
                               || TO_CHAR (SYSDATE, 'YYYY')
                          FROM uss_ndi.v_ddn_month_names z
                         WHERE z.dic_value = TO_CHAR (SYSDATE, 'MM'))
                           dt_now
                  FROM personalcase t JOIN v_opfu p ON (p.org_id = t.com_org)
                 WHERE t.pc_id = p_pc_id)
        LOOP
            RDM$RTFL.AddParam (l_jbr_id, 'pib', xx.pib);
            RDM$RTFL.AddParam (l_jbr_id, 'address_r', xx.addr);
            RDM$RTFL.AddParam (l_jbr_id, 'uszn', xx.org_name);
            RDM$RTFL.AddParam (l_jbr_id, 'help_name', xx.dblbzm_1);
            RDM$RTFL.AddParam (l_jbr_id, 'help_legal', xx.dblbzm_2);
            RDM$RTFL.AddParam (l_jbr_id,
                               'start_dt',
                               TO_CHAR (l_start_dt, 'DD.MM.YYYY'));
            RDM$RTFL.AddParam (l_jbr_id,
                               'stop_dt',
                               TO_CHAR (l_stop_dt, 'DD.MM.YYYY'));
            RDM$RTFL.AddParam (l_jbr_id,
                               'date_now',
                               TO_CHAR (SYSDATE, 'DD.MM.YYYY'));
            RDM$RTFL.AddParam (l_jbr_id, 'dd_month_year', xx.dt_now);
        END LOOP;

        RDM$RTFL.PutReportToWorkingQueue (p_jbr_id => l_jbr_id);
        RETURN l_jbr_id;
    END;

    -- IC #104161
    FUNCTION INCOME_CERT_R1_QQ (p_rt_id      IN NUMBER,
                                p_start_dt   IN DATE,
                                p_stop_dt    IN DATE,
                                p_pc_id      IN NUMBER)
        RETURN DECIMAL
    IS
        l_jbr_id     DECIMAL;
        l_start_dt   DATE := p_start_dt;
        l_stop_dt    DATE := p_stop_dt;
    BEGIN
        SELECT CASE WHEN tools.GetCurrOrg != t.com_org THEN 1 END
          INTO l_jbr_id
          FROM personalcase t
         WHERE t.pc_id = p_pc_id;

        /*IF (l_jbr_id = 1) THEN
          raise_application_error(-20000, '«в≥т будуЇтьс€ лише по ≈ќ— €к≥ знаход€тьс€ в поточному ќ—«Ќ!');
        END IF;*/

        l_jbr_id := RDM$RTFL.InitReport (p_rt_id => p_rt_id);

        IF (l_start_dt IS NULL)
        THEN
            l_start_dt := ADD_MONTHS (TRUNC (SYSDATE, 'MM'), -6);
            l_stop_dt := TRUNC (SYSDATE, 'MM') - 1;
        END IF;


        Rdm$rtfl.AddDataSet (
            l_jbr_id,
            'ds_nst',
               'SELECT nst_id, nst_name
            FROM (SELECT DISTINCT nst_id, nst_name
                             FROM uss_esr.v_pc_decision z
                               JOIN uss_ndi.v_ndi_service_type zt ON (zt.nst_id = z.pd_nst)
                             WHERE z.pd_pc = '
            || p_pc_id
            || '
                               AND z.pd_dt BETWEEN to_date('''
            || TO_CHAR (l_start_dt, 'DD.MM.YYYY')
            || ''', ''DD.MM.YYYY'')
                               AND to_date('''
            || TO_CHAR (l_stop_dt, 'DD.MM.YYYY')
            || ''', ''DD.MM.YYYY'')
                        union all
                    SELECT 99999 nst_id, ''–ј«ќћ'' nst_name from dual
                               ) a WHERE 1=1');

        Rdm$rtfl.AddDataSet (
            l_jbr_id,
            'ds',
               'SELECT (select lower(dic_name) from uss_ndi.v_ddn_month_names z where z.dic_value = to_char(p_month, ''MM'')) || '' '' || to_char(p_month, ''YYYY'') || '' p.'' AS ds_month,
               to_char(SUM(s1), ''FM9G999G999G999G999G990D00'', ''NLS_NUMERIC_CHARACTERS='''','''''''''')  AS amount,
               to_char(SUM(s2), ''FM9G999G999G999G999G990D00'', ''NLS_NUMERIC_CHARACTERS='''','''''''''')  AS alimony,
               row_number() over(order by p_month) rn,
               ds_nst_id
          FROM (SELECT TRUNC(t.acd_start_dt, ''MM'') AS p_month,
                       t.acd_sum AS s1,
                       0 AS s2,
                       zt.nst_id AS ds_nst_id
                  FROM uss_esr.v_ac_detail t
                  JOIN uss_esr.v_accrual r ON (r.ac_id = t.acd_ac)
                  JOIN uss_esr.v_pc_decision z ON (z.pd_id = t.acd_pd)
                  JOIN uss_ndi.v_ndi_op op    ON op.op_id = t.acd_op
                  JOIN uss_ndi.v_ndi_service_type zt ON (zt.nst_id = z.pd_nst)
                 WHERE 1 = 1
                   AND r.ac_pc = '
            || p_pc_id
            || '
                   AND (t.acd_op IN (1, 2, 3) OR op.op_tp1 IN (''NR''))
                   AND t.history_status = ''A''
                   and t.acd_ac_start_dt between to_date('''
            || TO_CHAR (l_start_dt, 'DD.MM.YYYY')
            || ''', ''DD.MM.YYYY'')
                       and to_date('''
            || TO_CHAR (l_stop_dt, 'DD.MM.YYYY')
            || ''', ''DD.MM.YYYY'')
                UNION ALL
                SELECT TRUNC(pr_fix_dt, ''MM'') AS p_month,
                       0 AS s1,
                       d.prsd_sum AS s2,
                       zt.nst_id AS ds_nst_id
                  FROM uss_esr.v_ac_detail t
                  JOIN uss_esr.v_accrual r ON (r.ac_id = t.acd_ac)
                  JOIN uss_esr.v_pr_sheet_detail d ON (d.prsd_id = t.acd_prsd)
                  JOIN uss_esr.v_pr_sheet ps ON (ps.prs_id = d.prsd_prs)
                  join uss_esr.v_payroll p on (p.pr_id = d.prsd_pr)
                  JOIN uss_esr.v_pc_decision z ON (z.pd_id = t.acd_pd)
                  JOIN uss_ndi.v_ndi_service_type zt ON (zt.nst_id = z.pd_nst)
                 WHERE 1 = 1
                   AND r.ac_pc = '
            || p_pc_id
            || '
                   AND t.acd_prsd IS NOT NULL
                   and t.acd_npt in (332, 333, 334)
                   AND prs_st IN (''NA'', ''KV1'', ''KV2'', ''PK1'', ''PK2'', ''PP'')
                   AND prsd_tp IN (''PWI'', ''RDN'') -- т≥льки виплата
                   AND pr_st IN (''F'')
                   AND prs_tp IN (''PB'', ''PP'')
                   AND t.history_status = ''A''
                   and d.prsd_month between to_date('''
            || TO_CHAR (l_start_dt, 'DD.MM.YYYY')
            || ''', ''DD.MM.YYYY'')
                       and to_date('''
            || TO_CHAR (l_stop_dt, 'DD.MM.YYYY')
            || ''', ''DD.MM.YYYY'')

                UNION ALL -- TOTAL
                SELECT TRUNC(t.acd_start_dt, ''MM'') AS p_month,
                       t.acd_sum AS s1,
                       0 AS s2,
                       99999 AS ds_nst_id
                  FROM uss_esr.v_ac_detail t
                  JOIN uss_esr.v_accrual r ON (r.ac_id = t.acd_ac)
                  JOIN uss_ndi.v_ndi_op op    ON op.op_id = t.acd_op
                 WHERE 1 = 1
                   AND r.ac_pc = '
            || p_pc_id
            || '
                   AND (t.acd_op IN (1, 2, 3) OR op.op_tp1 IN (''NR''))
                   AND t.history_status = ''A''
                   and t.acd_ac_start_dt between to_date('''
            || TO_CHAR (l_start_dt, 'DD.MM.YYYY')
            || ''', ''DD.MM.YYYY'')
                       and to_date('''
            || TO_CHAR (l_stop_dt, 'DD.MM.YYYY')
            || ''', ''DD.MM.YYYY'')
                UNION ALL
                SELECT TRUNC(pr_fix_dt, ''MM'') AS p_month,
                       0 AS s1,
                       d.prsd_sum AS s2,
                       99999 AS ds_nst_id
                  FROM uss_esr.v_ac_detail t
                  JOIN uss_esr.v_accrual r ON (r.ac_id = t.acd_ac)
                  JOIN uss_esr.v_pr_sheet_detail d ON (d.prsd_id = t.acd_prsd)
                  JOIN uss_esr.v_pr_sheet ps ON (ps.prs_id = d.prsd_prs)
                  join uss_esr.v_payroll p on (p.pr_id = d.prsd_pr)
                 WHERE 1 = 1
                   AND r.ac_pc = '
            || p_pc_id
            || '
                   AND t.acd_prsd IS NOT NULL
                   and t.acd_npt in (332, 333, 334)
                   AND prs_st IN (''NA'', ''KV1'', ''KV2'', ''PK1'', ''PK2'', ''PP'')
                   AND prsd_tp IN (''PWI'', ''RDN'') -- т≥льки виплата
                   AND pr_st IN (''F'')
                   AND prs_tp IN (''PB'', ''PP'')
                   AND t.history_status = ''A''
                   and d.prsd_month between to_date('''
            || TO_CHAR (l_start_dt, 'DD.MM.YYYY')
            || ''', ''DD.MM.YYYY'')
                       and to_date('''
            || TO_CHAR (l_stop_dt, 'DD.MM.YYYY')
            || ''', ''DD.MM.YYYY'')
              ) t
          GROUP BY p_month, ds_nst_id
          HAVING 1=1');


        Rdm$rtfl.AddDataSet (
            l_jbr_id,
            'ds_tot',
               'SELECT to_char(SUM(s1), ''FM9G999G999G999G999G990D00'', ''NLS_NUMERIC_CHARACTERS='''','''''''''')  AS amount_all,
               to_char(SUM(s2), ''FM9G999G999G999G999G990D00'', ''NLS_NUMERIC_CHARACTERS='''','''''''''')  AS alimony_all,
               lower(uss_esr.tools.SUM_TO_TEXT((nvl(sum(s1), 0) - nvl(sum(s2), 0)), P_COP_AS_TEXT => ''F'')) as amount_clear
          FROM (SELECT TRUNC(t.acd_start_dt, ''MM'') AS p_month,
                       t.acd_sum AS s1,
                       0 AS s2
                  FROM uss_esr.v_ac_detail t
                  JOIN uss_esr.v_accrual r ON (r.ac_id = t.acd_ac)
                  JOIN uss_ndi.v_ndi_op op    ON op.op_id = t.acd_op
                 WHERE 1 = 1
                   AND r.ac_pc = '
            || p_pc_id
            || '
                   AND (t.acd_op IN (1, 2, 3) OR op.op_tp1 IN (''NR''))
                   AND t.history_status = ''A''
                   and t.acd_ac_start_dt between to_date('''
            || TO_CHAR (l_start_dt, 'DD.MM.YYYY')
            || ''', ''DD.MM.YYYY'')
                       and to_date('''
            || TO_CHAR (l_stop_dt, 'DD.MM.YYYY')
            || ''', ''DD.MM.YYYY'')
                UNION ALL
                SELECT TRUNC(d.prsd_month, ''MM'') AS p_month,
                       0 AS s1,
                       d.prsd_sum AS s2
                  FROM uss_esr.v_ac_detail t
                  JOIN uss_esr.v_accrual r ON (r.ac_id = t.acd_ac)
                  JOIN uss_esr.v_pr_sheet_detail d ON (d.prsd_id = t.acd_prsd)
                  JOIN  uss_esr.v_pr_sheet ps ON (ps.prs_id = d.prsd_prs)
                  join  uss_esr.v_payroll p on (p.pr_id = d.prsd_pr)
                 WHERE 1 = 1
                   AND r.ac_pc = '
            || p_pc_id
            || '
                   AND t.acd_prsd IS NOT NULL
                   and t.acd_npt in (332, 333, 334)
                   AND prs_st IN (''NA'', ''KV1'', ''KV2'', ''PK1'', ''PK2'', ''PP'')
                   AND prsd_tp IN (''PWI'', ''RDN'') -- т≥льки виплата
                   AND pr_st IN (''F'')
                   AND prs_tp IN (''PB'', ''PP'')
                   AND t.history_status = ''A''
                   and d.prsd_month between to_date('''
            || TO_CHAR (l_start_dt, 'DD.MM.YYYY')
            || ''', ''DD.MM.YYYY'')
                       and to_date('''
            || TO_CHAR (l_stop_dt, 'DD.MM.YYYY')
            || ''', ''DD.MM.YYYY'')
              ) t WHERE 1=1');

        RDM$RTFL.AddRelation (l_jbr_id,
                              'ds_nst',
                              'nst_id',
                              'ds',
                              'ds_nst_id');

        FOR xx
            IN (SELECT    uss_person.api$sc_tools.GET_PIB (t.pc_sc)
                       || ' '
                       || uss_person.api$sc_tools.get_numident (t.pc_sc)
                           AS pib,
                       uss_person.api$sc_tools.get_address (t.pc_sc, 3)
                           AS addr,
                       p.org_name
                           AS org_name,
                       (SELECT LISTAGG (nst_name, ', ')
                                   WITHIN GROUP (ORDER BY 1)
                          FROM (SELECT DISTINCT nst_name
                                  FROM pc_decision  z
                                       JOIN uss_ndi.v_ndi_service_type zt
                                           ON (zt.nst_id = z.pd_nst)
                                 WHERE     z.pd_pc = t.pc_id
                                       AND z.pd_dt BETWEEN l_start_dt
                                                       AND l_stop_dt))
                           AS dblbzm_1,
                       (SELECT LISTAGG (nst_legal_act, ', ')
                                   WITHIN GROUP (ORDER BY 1)
                          FROM (SELECT DISTINCT nst_legal_act
                                  FROM pc_decision  z
                                       JOIN uss_ndi.v_ndi_service_type zt
                                           ON (zt.nst_id = z.pd_nst)
                                 WHERE     z.pd_pc = t.pc_id
                                       AND z.pd_dt BETWEEN l_start_dt
                                                       AND l_stop_dt))
                           AS dblbzm_2,
                       (SELECT    TO_CHAR (SYSDATE, 'DD')
                               || ' '
                               || LOWER (dic_sname)
                               || ' '
                               || TO_CHAR (SYSDATE, 'YYYY')
                          FROM uss_ndi.v_ddn_month_names z
                         WHERE z.dic_value = TO_CHAR (SYSDATE, 'MM'))
                           dt_now
                  FROM personalcase t JOIN v_opfu p ON (p.org_id = t.com_org)
                 WHERE t.pc_id = p_pc_id)
        LOOP
            RDM$RTFL.AddParam (l_jbr_id, 'pib', xx.pib);
            RDM$RTFL.AddParam (l_jbr_id, 'address_r', xx.addr);
            RDM$RTFL.AddParam (l_jbr_id, 'uszn', xx.org_name);
            RDM$RTFL.AddParam (l_jbr_id, 'help_name', xx.dblbzm_1);
            RDM$RTFL.AddParam (l_jbr_id, 'help_legal', xx.dblbzm_2);
            RDM$RTFL.AddParam (l_jbr_id,
                               'start_dt',
                               TO_CHAR (l_start_dt, 'DD.MM.YYYY'));
            RDM$RTFL.AddParam (l_jbr_id,
                               'stop_dt',
                               TO_CHAR (l_stop_dt, 'DD.MM.YYYY'));
            RDM$RTFL.AddParam (l_jbr_id,
                               'date_now',
                               TO_CHAR (SYSDATE, 'DD.MM.YYYY'));
            RDM$RTFL.AddParam (l_jbr_id, 'dd_month_year', xx.dt_now);
        END LOOP;

        RDM$RTFL.PutReportToWorkingQueue (p_jbr_id => l_jbr_id);
        RETURN l_jbr_id;
    END;

    --#91031 «в≥т щодо в≥дпрацюванн€ рекомендац≥й ћ≥нф≥ну
    FUNCTION REC_WORK_REPORTS_R1 (p_start_dt   IN DATE,
                                  p_org_id     IN NUMBER,
                                  p_rt_id      IN rpt_templates.rt_id%TYPE)
        RETURN DECIMAL
    IS
        l_jbr_id   NUMBER;
        l_date     DATE := TRUNC (p_start_dt, 'mm');
        l_sql      VARCHAR2 (32000);
        l_org      NUMBER := tools.getcurrorg;
        l_org_to   NUMBER := tools.GetCurrOrgTo;
    BEGIN
        l_jbr_id := RDM$RTFL.InitReport (p_rt_id => p_rt_id);
        RDM$RTFL.AddParam (l_jbr_id,
                           'c_gen_dt',
                           TO_CHAR (SYSDATE, 'dd.mm.yyyy'));
        RDM$RTFL.AddParam (l_jbr_id,
                           'c_period',
                           TO_CHAR (p_start_dt, 'mm.yyyy'));


        RDM$RTFL.AddDataSet (
            l_jbr_id,
            'ds',
               'select t.*,
              round(cnt_2 / cnt_1 * 100, 2) as percent
         from (select '
            || CASE
                   WHEN    p_org_id IS NOT NULL AND p_org_id != 0
                        OR l_org_to IN (31, 32, 34)
                   THEN
                       'p1.org_id || '' '' || p1.org_name'
                   ELSE
                       'p2.org_id || '' '' || p2.org_name'
               END
            || ' as org,
                      me_month as month,
                      count(distinct merc_id) as cnt_1,
                      count(case when merc_st = ''V'' then 1 end) as cnt_2
                      --sum((select count(*) from uss_esr.v_me_minfin_result_rows where mesr_merc = merc_id and mesr_st = ''P'')) as cnt_2
                 from uss_esr.v_mass_exchanges,
                      uss_esr.v_me_minfin_request_rows,
                      uss_esr.v_me_minfin_recomm_rows,
                      uss_esr.v_personalcase pc,
                      uss_esr.v_opfu p1,
                      uss_esr.v_opfu p2
                where me_month in (to_date('''
            || TO_CHAR (p_start_dt, 'DD.MM.YYYY')
            || ''', ''DD.MM.YYYY'') )
                  and memr_me = me_id
                  and merc_me = me_id
                  and merc_memr = memr_id
                  and memr_pc = pc_id
                  and p1.org_org = p2.org_id
                  and pc.com_org = p1.org_id
                  '
            || CASE
                   WHEN l_org_to IN (31)
                   THEN
                       ' and p2.org_id = ' || l_org
                   WHEN l_org_to IN (32)
                   THEN
                       ' and p1.org_id = ' || l_org
                   WHEN l_org_to IN (34)
                   THEN
                       ' and p1.org_acc_org = ' || l_org
                   WHEN p_org_id IS NOT NULL AND p_org_id != 0
                   THEN
                       ' and p1.org_id = ' || p_org_id
               END
            || '
                group by '
            || CASE
                   WHEN    p_org_id IS NOT NULL AND p_org_id != 0
                        OR l_org_to IN (31, 32, 34)
                   THEN
                       'p1.org_id, p1.org_name,'
                   ELSE
                       'p2.org_id, p2.org_name,'
               END
            || ' me_month
                order by 1, 2) t
        ');

        RDM$RTFL.PutReportToWorkingQueue (p_jbr_id => l_jbr_id);
        RETURN l_jbr_id;
    END;

    --#92003: «в≥т щодо в≥дпрацюванн€ рекомендац≥й ћ≥нф≥ну за кодами нев≥дпов≥дностей
    FUNCTION RECOMEND_WORK_BY_CODE_R1 (
        p_start_dt   IN DATE,
        p_rt_id      IN rpt_templates.rt_id%TYPE)
        RETURN DECIMAL
    IS
        l_jbr_id   NUMBER;
        l_month    VARCHAR2 (50);
        l_org_id   NUMBER := tools.getcurrorg;
        l_org_to   NUMBER := tools.GetCurrOrgTo;
    BEGIN
        l_jbr_id := RDM$RTFL.InitReport (p_rt_id => p_rt_id);

        SELECT LOWER (dic_name)
          INTO l_month
          FROM uss_ndi.v_ddn_month_names t
         WHERE dic_value = TO_CHAR (p_start_dt, 'mm');

        RDM$RTFL.AddParam (
            l_jbr_id,
            'c_month_year',
            l_month || ' ' || TO_CHAR (p_start_dt, 'yyyy') || 'р.');

        RDM$RTFL.AddDataSet (
            l_jbr_id,
            'ds',
               'select org_id,
               org_name,
               row_number() OVER (ORDER BY org_id) AS rn,
               SUM(CASE WHEN t.d15_type_rec = 464 THEN x_cnt_1 ELSE 0 END) AS all_c01,
               SUM(CASE WHEN t.d15_type_rec = 463 THEN x_cnt_1 ELSE 0 END) AS all_c02,
               SUM(CASE WHEN t.d15_type_rec = 461 THEN x_cnt_1 ELSE 0 END) AS all_c03,
               SUM(CASE WHEN t.d15_type_rec = 460 THEN x_cnt_1 ELSE 0 END) AS all_c04,
               SUM(CASE WHEN t.d15_type_rec = 459 THEN x_cnt_1 ELSE 0 END) AS all_c05,
               SUM(CASE WHEN t.d15_type_rec = 458 THEN x_cnt_1 ELSE 0 END) AS all_c06,
               SUM(CASE WHEN t.d15_type_rec = 455 THEN x_cnt_1 ELSE 0 END) AS all_c07,
               SUM(CASE WHEN t.d15_type_rec = 448 THEN x_cnt_1 ELSE 0 END) AS all_c08,
               SUM(CASE WHEN t.d15_type_rec = 447 THEN x_cnt_1 ELSE 0 END) AS all_c09,
               SUM(CASE WHEN t.d15_type_rec = 446 THEN x_cnt_1 ELSE 0 END) AS all_c10,
               SUM(CASE WHEN t.d15_type_rec = 445 THEN x_cnt_1 ELSE 0 END) AS all_c11,
               SUM(CASE WHEN t.d15_type_rec = 444 THEN x_cnt_1 ELSE 0 END) AS all_c12,
               SUM(CASE WHEN t.d15_type_rec = 443 THEN x_cnt_1 ELSE 0 END) AS all_c13,
               SUM(CASE WHEN t.d15_type_rec = 442 THEN x_cnt_1 ELSE 0 END) AS all_c14,
               SUM(CASE WHEN t.d15_type_rec = 441 THEN x_cnt_1 ELSE 0 END) AS all_c15,
               SUM(CASE WHEN t.d15_type_rec = 440 THEN x_cnt_1 ELSE 0 END) AS all_c16,
               SUM(CASE WHEN t.d15_type_rec = 439 THEN x_cnt_1 ELSE 0 END) AS all_c17,
               SUM(CASE WHEN t.d15_type_rec = 435 THEN x_cnt_1 ELSE 0 END) AS all_c18,
               SUM(CASE WHEN t.d15_type_rec = 434 THEN x_cnt_1 ELSE 0 END) AS all_c19,
               SUM(CASE WHEN t.d15_type_rec = 432 THEN x_cnt_1 ELSE 0 END) AS all_c20,
               SUM(CASE WHEN t.d15_type_rec = 430 THEN x_cnt_1 ELSE 0 END) AS all_c21,
               SUM(CASE WHEN t.d15_type_rec = 428 THEN x_cnt_1 ELSE 0 END) AS all_c22,
               SUM(CASE WHEN t.d15_type_rec = 419 THEN x_cnt_1 ELSE 0 END) AS all_c23,
               SUM(CASE WHEN t.d15_type_rec = 408 THEN x_cnt_1 ELSE 0 END) AS all_c24,
               SUM(CASE WHEN t.d15_type_rec = 403 THEN x_cnt_1 ELSE 0 END) AS all_c25,
               SUM(CASE WHEN t.d15_type_rec = 385 THEN x_cnt_1 ELSE 0 END) AS all_c26,
               SUM(CASE WHEN t.d15_type_rec = 358 THEN x_cnt_1 ELSE 0 END) AS all_c27,
               SUM(CASE WHEN t.d15_type_rec = 334 THEN x_cnt_1 ELSE 0 END) AS all_c28,
               SUM(CASE WHEN t.d15_type_rec = 141 THEN x_cnt_1 ELSE 0 END) AS all_c29,
               SUM(CASE WHEN t.d15_type_rec = 137 THEN x_cnt_1 ELSE 0 END) AS all_c30,
               SUM(CASE WHEN t.d15_type_rec = 135 THEN x_cnt_1 ELSE 0 END) AS all_c31,
               SUM(CASE WHEN t.d15_type_rec = 134 THEN x_cnt_1 ELSE 0 END) AS all_c32,
               SUM(CASE WHEN t.d15_type_rec = 129 THEN x_cnt_1 ELSE 0 END) AS all_c33,
               SUM(CASE WHEN t.d15_type_rec = 128 THEN x_cnt_1 ELSE 0 END) AS all_c34,
               SUM(CASE WHEN t.d15_type_rec = 127 THEN x_cnt_1 ELSE 0 END) AS all_c35,
               SUM(CASE WHEN t.d15_type_rec = 115 THEN x_cnt_1 ELSE 0 END) AS all_c36,
               SUM(CASE WHEN t.d15_type_rec = 111 THEN x_cnt_1 ELSE 0 END) AS all_c37,
               SUM(CASE WHEN t.d15_type_rec = 100 THEN x_cnt_1 ELSE 0 END) AS all_c38,
               SUM(CASE WHEN t.d15_type_rec = 99  THEN x_cnt_1 ELSE 0 END) AS all_c39,
               SUM(CASE WHEN t.d15_type_rec = 98  THEN x_cnt_1 ELSE 0 END) AS all_c40,
               SUM(CASE WHEN t.d15_type_rec = 96  THEN x_cnt_1 ELSE 0 END) AS all_c41,
               SUM(CASE WHEN t.d15_type_rec = 73  THEN x_cnt_1 ELSE 0 END) AS all_c42,

               SUM(CASE WHEN t.d15_type_rec = 464 THEN x_cnt_2 ELSE 0 END) AS vidpr_c01,
               SUM(CASE WHEN t.d15_type_rec = 463 THEN x_cnt_2 ELSE 0 END) AS vidpr_c02,
               SUM(CASE WHEN t.d15_type_rec = 461 THEN x_cnt_2 ELSE 0 END) AS vidpr_c03,
               SUM(CASE WHEN t.d15_type_rec = 460 THEN x_cnt_2 ELSE 0 END) AS vidpr_c04,
               SUM(CASE WHEN t.d15_type_rec = 459 THEN x_cnt_2 ELSE 0 END) AS vidpr_c05,
               SUM(CASE WHEN t.d15_type_rec = 458 THEN x_cnt_2 ELSE 0 END) AS vidpr_c06,
               SUM(CASE WHEN t.d15_type_rec = 455 THEN x_cnt_2 ELSE 0 END) AS vidpr_c07,
               SUM(CASE WHEN t.d15_type_rec = 448 THEN x_cnt_2 ELSE 0 END) AS vidpr_c08,
               SUM(CASE WHEN t.d15_type_rec = 447 THEN x_cnt_2 ELSE 0 END) AS vidpr_c09,
               SUM(CASE WHEN t.d15_type_rec = 446 THEN x_cnt_2 ELSE 0 END) AS vidpr_c10,
               SUM(CASE WHEN t.d15_type_rec = 445 THEN x_cnt_2 ELSE 0 END) AS vidpr_c11,
               SUM(CASE WHEN t.d15_type_rec = 444 THEN x_cnt_2 ELSE 0 END) AS vidpr_c12,
               SUM(CASE WHEN t.d15_type_rec = 443 THEN x_cnt_2 ELSE 0 END) AS vidpr_c13,
               SUM(CASE WHEN t.d15_type_rec = 442 THEN x_cnt_2 ELSE 0 END) AS vidpr_c14,
               SUM(CASE WHEN t.d15_type_rec = 441 THEN x_cnt_2 ELSE 0 END) AS vidpr_c15,
               SUM(CASE WHEN t.d15_type_rec = 440 THEN x_cnt_2 ELSE 0 END) AS vidpr_c16,
               SUM(CASE WHEN t.d15_type_rec = 439 THEN x_cnt_2 ELSE 0 END) AS vidpr_c17,
               SUM(CASE WHEN t.d15_type_rec = 435 THEN x_cnt_2 ELSE 0 END) AS vidpr_c18,
               SUM(CASE WHEN t.d15_type_rec = 434 THEN x_cnt_2 ELSE 0 END) AS vidpr_c19,
               SUM(CASE WHEN t.d15_type_rec = 432 THEN x_cnt_2 ELSE 0 END) AS vidpr_c20,
               SUM(CASE WHEN t.d15_type_rec = 430 THEN x_cnt_2 ELSE 0 END) AS vidpr_c21,
               SUM(CASE WHEN t.d15_type_rec = 428 THEN x_cnt_2 ELSE 0 END) AS vidpr_c22,
               SUM(CASE WHEN t.d15_type_rec = 419 THEN x_cnt_2 ELSE 0 END) AS vidpr_c23,
               SUM(CASE WHEN t.d15_type_rec = 408 THEN x_cnt_2 ELSE 0 END) AS vidpr_c24,
               SUM(CASE WHEN t.d15_type_rec = 403 THEN x_cnt_2 ELSE 0 END) AS vidpr_c25,
               SUM(CASE WHEN t.d15_type_rec = 385 THEN x_cnt_2 ELSE 0 END) AS vidpr_c26,
               SUM(CASE WHEN t.d15_type_rec = 358 THEN x_cnt_2 ELSE 0 END) AS vidpr_c27,
               SUM(CASE WHEN t.d15_type_rec = 334 THEN x_cnt_2 ELSE 0 END) AS vidpr_c28,
               SUM(CASE WHEN t.d15_type_rec = 141 THEN x_cnt_2 ELSE 0 END) AS vidpr_c29,
               SUM(CASE WHEN t.d15_type_rec = 137 THEN x_cnt_2 ELSE 0 END) AS vidpr_c30,
               SUM(CASE WHEN t.d15_type_rec = 135 THEN x_cnt_2 ELSE 0 END) AS vidpr_c31,
               SUM(CASE WHEN t.d15_type_rec = 134 THEN x_cnt_2 ELSE 0 END) AS vidpr_c32,
               SUM(CASE WHEN t.d15_type_rec = 129 THEN x_cnt_2 ELSE 0 END) AS vidpr_c33,
               SUM(CASE WHEN t.d15_type_rec = 128 THEN x_cnt_2 ELSE 0 END) AS vidpr_c34,
               SUM(CASE WHEN t.d15_type_rec = 127 THEN x_cnt_2 ELSE 0 END) AS vidpr_c35,
               SUM(CASE WHEN t.d15_type_rec = 115 THEN x_cnt_2 ELSE 0 END) AS vidpr_c36,
               SUM(CASE WHEN t.d15_type_rec = 111 THEN x_cnt_2 ELSE 0 END) AS vidpr_c37,
               SUM(CASE WHEN t.d15_type_rec = 100 THEN x_cnt_2 ELSE 0 END) AS vidpr_c38,
               SUM(CASE WHEN t.d15_type_rec = 99  THEN x_cnt_2 ELSE 0 END) AS vidpr_c39,
               SUM(CASE WHEN t.d15_type_rec = 98  THEN x_cnt_2 ELSE 0 END) AS vidpr_c40,
               SUM(CASE WHEN t.d15_type_rec = 96  THEN x_cnt_2 ELSE 0 END) AS vidpr_c41,
               SUM(CASE WHEN t.d15_type_rec = 73  THEN x_cnt_2 ELSE 0 END) AS vidpr_c42
        from v_opfu, (select '
            || CASE
                   WHEN l_org_to IN (30, 40) THEN 'org_org'
                   ELSE 'org_id'
               END
            || ' x_org, d15_type_rec,
                           count(distinct merc_id) x_cnt_1,
                           sum(CASE WHEN merc_st IN (''V'', ''P'')  THEN 1 ELSE 0 END) x_cnt_2
                    from uss_esr.v_mass_exchanges, uss_esr.v_me_minfin_request_rows, uss_esr.v_me_minfin_recomm_rows,
                         uss_esr.v_personalcase p, v_opfu, uss_ndi.v_ndi_minfin_d15 z
                    where me_month in (to_date('''
            || TO_CHAR (TRUNC (p_start_dt, 'MM'), 'DD.MM.YYYY')
            || ''', ''DD.MM.YYYY'') )
                      and memr_me = me_id
                      and merc_me = me_id
                      and merc_memr = memr_id
                      and memr_pc = pc_id
                      and p.com_org = org_id
                      '
            || CASE
                   WHEN l_org_to IN (30, 40) THEN ''
                   ELSE ' and org_org = ' || l_org_id
               END
            || '
                      and MERC_TYPE_REC = d15_id(+)
                    group by '
            || CASE
                   WHEN l_org_to IN (30, 40) THEN 'org_org'
                   ELSE 'org_id'
               END
            || ', d15_type_rec) t
        WHERE x_org = org_id
        GROUP BY org_id, org_name
        ');

        RDM$RTFL.AddDataSet (
            l_jbr_id,
            'ds_total',
               'select SUM(CASE WHEN t.d15_type_rec = 464 THEN x_cnt_1 ELSE 0 END) AS all_c01,
               SUM(CASE WHEN t.d15_type_rec = 463 THEN x_cnt_1 ELSE 0 END) AS all_c02,
               SUM(CASE WHEN t.d15_type_rec = 461 THEN x_cnt_1 ELSE 0 END) AS all_c03,
               SUM(CASE WHEN t.d15_type_rec = 460 THEN x_cnt_1 ELSE 0 END) AS all_c04,
               SUM(CASE WHEN t.d15_type_rec = 459 THEN x_cnt_1 ELSE 0 END) AS all_c05,
               SUM(CASE WHEN t.d15_type_rec = 458 THEN x_cnt_1 ELSE 0 END) AS all_c06,
               SUM(CASE WHEN t.d15_type_rec = 455 THEN x_cnt_1 ELSE 0 END) AS all_c07,
               SUM(CASE WHEN t.d15_type_rec = 448 THEN x_cnt_1 ELSE 0 END) AS all_c08,
               SUM(CASE WHEN t.d15_type_rec = 447 THEN x_cnt_1 ELSE 0 END) AS all_c09,
               SUM(CASE WHEN t.d15_type_rec = 446 THEN x_cnt_1 ELSE 0 END) AS all_c10,
               SUM(CASE WHEN t.d15_type_rec = 445 THEN x_cnt_1 ELSE 0 END) AS all_c11,
               SUM(CASE WHEN t.d15_type_rec = 444 THEN x_cnt_1 ELSE 0 END) AS all_c12,
               SUM(CASE WHEN t.d15_type_rec = 443 THEN x_cnt_1 ELSE 0 END) AS all_c13,
               SUM(CASE WHEN t.d15_type_rec = 442 THEN x_cnt_1 ELSE 0 END) AS all_c14,
               SUM(CASE WHEN t.d15_type_rec = 441 THEN x_cnt_1 ELSE 0 END) AS all_c15,
               SUM(CASE WHEN t.d15_type_rec = 440 THEN x_cnt_1 ELSE 0 END) AS all_c16,
               SUM(CASE WHEN t.d15_type_rec = 439 THEN x_cnt_1 ELSE 0 END) AS all_c17,
               SUM(CASE WHEN t.d15_type_rec = 435 THEN x_cnt_1 ELSE 0 END) AS all_c18,
               SUM(CASE WHEN t.d15_type_rec = 434 THEN x_cnt_1 ELSE 0 END) AS all_c19,
               SUM(CASE WHEN t.d15_type_rec = 432 THEN x_cnt_1 ELSE 0 END) AS all_c20,
               SUM(CASE WHEN t.d15_type_rec = 430 THEN x_cnt_1 ELSE 0 END) AS all_c21,
               SUM(CASE WHEN t.d15_type_rec = 428 THEN x_cnt_1 ELSE 0 END) AS all_c22,
               SUM(CASE WHEN t.d15_type_rec = 419 THEN x_cnt_1 ELSE 0 END) AS all_c23,
               SUM(CASE WHEN t.d15_type_rec = 408 THEN x_cnt_1 ELSE 0 END) AS all_c24,
               SUM(CASE WHEN t.d15_type_rec = 403 THEN x_cnt_1 ELSE 0 END) AS all_c25,
               SUM(CASE WHEN t.d15_type_rec = 385 THEN x_cnt_1 ELSE 0 END) AS all_c26,
               SUM(CASE WHEN t.d15_type_rec = 358 THEN x_cnt_1 ELSE 0 END) AS all_c27,
               SUM(CASE WHEN t.d15_type_rec = 334 THEN x_cnt_1 ELSE 0 END) AS all_c28,
               SUM(CASE WHEN t.d15_type_rec = 141 THEN x_cnt_1 ELSE 0 END) AS all_c29,
               SUM(CASE WHEN t.d15_type_rec = 137 THEN x_cnt_1 ELSE 0 END) AS all_c30,
               SUM(CASE WHEN t.d15_type_rec = 135 THEN x_cnt_1 ELSE 0 END) AS all_c31,
               SUM(CASE WHEN t.d15_type_rec = 134 THEN x_cnt_1 ELSE 0 END) AS all_c32,
               SUM(CASE WHEN t.d15_type_rec = 129 THEN x_cnt_1 ELSE 0 END) AS all_c33,
               SUM(CASE WHEN t.d15_type_rec = 128 THEN x_cnt_1 ELSE 0 END) AS all_c34,
               SUM(CASE WHEN t.d15_type_rec = 127 THEN x_cnt_1 ELSE 0 END) AS all_c35,
               SUM(CASE WHEN t.d15_type_rec = 115 THEN x_cnt_1 ELSE 0 END) AS all_c36,
               SUM(CASE WHEN t.d15_type_rec = 111 THEN x_cnt_1 ELSE 0 END) AS all_c37,
               SUM(CASE WHEN t.d15_type_rec = 100 THEN x_cnt_1 ELSE 0 END) AS all_c38,
               SUM(CASE WHEN t.d15_type_rec = 99 THEN x_cnt_1 ELSE 0 END) AS all_c39,
               SUM(CASE WHEN t.d15_type_rec = 98 THEN x_cnt_1 ELSE 0 END) AS all_c40,
               SUM(CASE WHEN t.d15_type_rec = 96 THEN x_cnt_1 ELSE 0 END) AS all_c41,
               SUM(CASE WHEN t.d15_type_rec = 73 THEN x_cnt_1 ELSE 0 END) AS all_c42,

               SUM(CASE WHEN t.d15_type_rec = 464 THEN x_cnt_2 ELSE 0 END) AS vidpr_c01,
               SUM(CASE WHEN t.d15_type_rec = 463 THEN x_cnt_2 ELSE 0 END) AS vidpr_c02,
               SUM(CASE WHEN t.d15_type_rec = 461 THEN x_cnt_2 ELSE 0 END) AS vidpr_c03,
               SUM(CASE WHEN t.d15_type_rec = 460 THEN x_cnt_2 ELSE 0 END) AS vidpr_c04,
               SUM(CASE WHEN t.d15_type_rec = 459 THEN x_cnt_2 ELSE 0 END) AS vidpr_c05,
               SUM(CASE WHEN t.d15_type_rec = 458 THEN x_cnt_2 ELSE 0 END) AS vidpr_c06,
               SUM(CASE WHEN t.d15_type_rec = 455 THEN x_cnt_2 ELSE 0 END) AS vidpr_c07,
               SUM(CASE WHEN t.d15_type_rec = 448 THEN x_cnt_2 ELSE 0 END) AS vidpr_c08,
               SUM(CASE WHEN t.d15_type_rec = 447 THEN x_cnt_2 ELSE 0 END) AS vidpr_c09,
               SUM(CASE WHEN t.d15_type_rec = 446 THEN x_cnt_2 ELSE 0 END) AS vidpr_c10,
               SUM(CASE WHEN t.d15_type_rec = 445 THEN x_cnt_2 ELSE 0 END) AS vidpr_c11,
               SUM(CASE WHEN t.d15_type_rec = 444 THEN x_cnt_2 ELSE 0 END) AS vidpr_c12,
               SUM(CASE WHEN t.d15_type_rec = 443 THEN x_cnt_2 ELSE 0 END) AS vidpr_c13,
               SUM(CASE WHEN t.d15_type_rec = 442 THEN x_cnt_2 ELSE 0 END) AS vidpr_c14,
               SUM(CASE WHEN t.d15_type_rec = 441 THEN x_cnt_2 ELSE 0 END) AS vidpr_c15,
               SUM(CASE WHEN t.d15_type_rec = 440 THEN x_cnt_2 ELSE 0 END) AS vidpr_c16,
               SUM(CASE WHEN t.d15_type_rec = 439 THEN x_cnt_2 ELSE 0 END) AS vidpr_c17,
               SUM(CASE WHEN t.d15_type_rec = 435 THEN x_cnt_2 ELSE 0 END) AS vidpr_c18,
               SUM(CASE WHEN t.d15_type_rec = 434 THEN x_cnt_2 ELSE 0 END) AS vidpr_c19,
               SUM(CASE WHEN t.d15_type_rec = 432 THEN x_cnt_2 ELSE 0 END) AS vidpr_c20,
               SUM(CASE WHEN t.d15_type_rec = 430 THEN x_cnt_2 ELSE 0 END) AS vidpr_c21,
               SUM(CASE WHEN t.d15_type_rec = 428 THEN x_cnt_2 ELSE 0 END) AS vidpr_c22,
               SUM(CASE WHEN t.d15_type_rec = 419 THEN x_cnt_2 ELSE 0 END) AS vidpr_c23,
               SUM(CASE WHEN t.d15_type_rec = 408 THEN x_cnt_2 ELSE 0 END) AS vidpr_c24,
               SUM(CASE WHEN t.d15_type_rec = 403 THEN x_cnt_2 ELSE 0 END) AS vidpr_c25,
               SUM(CASE WHEN t.d15_type_rec = 385 THEN x_cnt_2 ELSE 0 END) AS vidpr_c26,
               SUM(CASE WHEN t.d15_type_rec = 358 THEN x_cnt_2 ELSE 0 END) AS vidpr_c27,
               SUM(CASE WHEN t.d15_type_rec = 334 THEN x_cnt_2 ELSE 0 END) AS vidpr_c28,
               SUM(CASE WHEN t.d15_type_rec = 141 THEN x_cnt_2 ELSE 0 END) AS vidpr_c29,
               SUM(CASE WHEN t.d15_type_rec = 137 THEN x_cnt_2 ELSE 0 END) AS vidpr_c30,
               SUM(CASE WHEN t.d15_type_rec = 135 THEN x_cnt_2 ELSE 0 END) AS vidpr_c31,
               SUM(CASE WHEN t.d15_type_rec = 134 THEN x_cnt_2 ELSE 0 END) AS vidpr_c32,
               SUM(CASE WHEN t.d15_type_rec = 129 THEN x_cnt_2 ELSE 0 END) AS vidpr_c33,
               SUM(CASE WHEN t.d15_type_rec = 128 THEN x_cnt_2 ELSE 0 END) AS vidpr_c34,
               SUM(CASE WHEN t.d15_type_rec = 127 THEN x_cnt_2 ELSE 0 END) AS vidpr_c35,
               SUM(CASE WHEN t.d15_type_rec = 115 THEN x_cnt_2 ELSE 0 END) AS vidpr_c36,
               SUM(CASE WHEN t.d15_type_rec = 111 THEN x_cnt_2 ELSE 0 END) AS vidpr_c37,
               SUM(CASE WHEN t.d15_type_rec = 100 THEN x_cnt_2 ELSE 0 END) AS vidpr_c38,
               SUM(CASE WHEN t.d15_type_rec = 99  THEN x_cnt_2 ELSE 0 END) AS vidpr_c39,
               SUM(CASE WHEN t.d15_type_rec = 98  THEN x_cnt_2 ELSE 0 END) AS vidpr_c40,
               SUM(CASE WHEN t.d15_type_rec = 96  THEN x_cnt_2 ELSE 0 END) AS vidpr_c41,
               SUM(CASE WHEN t.d15_type_rec = 73  THEN x_cnt_2 ELSE 0 END) AS vidpr_c42
        from v_opfu, (select '
            || CASE
                   WHEN l_org_to IN (30, 40) THEN 'org_org'
                   ELSE 'org_id'
               END
            || ' x_org, d15_type_rec,
                           count(distinct merc_id) x_cnt_1,
                           sum(CASE WHEN merc_st IN (''V'', ''P'')  THEN 1 ELSE 0 END) x_cnt_2
                    from uss_esr.v_mass_exchanges, uss_esr.v_me_minfin_request_rows, uss_esr.v_me_minfin_recomm_rows,
                         uss_esr.v_personalcase p, v_opfu, uss_ndi.v_ndi_minfin_d15 z
                    where me_month in (to_date('''
            || TO_CHAR (TRUNC (p_start_dt, 'MM'), 'DD.MM.YYYY')
            || ''', ''DD.MM.YYYY'') )
                      and memr_me = me_id
                      and merc_me = me_id
                      and merc_memr = memr_id
                      and memr_pc = pc_id
                      and p.com_org = org_id
                      '
            || CASE
                   WHEN l_org_to IN (30, 40) THEN ''
                   ELSE ' and org_org = ' || l_org_id
               END
            || '
                      and MERC_TYPE_REC = d15_id(+)
                    group by '
            || CASE
                   WHEN l_org_to IN (30, 40) THEN 'org_org'
                   ELSE 'org_id'
               END
            || ', d15_type_rec) t
        WHERE x_org = org_id
        ');

        RDM$RTFL.PutReportToWorkingQueue (p_jbr_id => l_jbr_id);
        RETURN l_jbr_id;
    END;

    -- #109334 ѕенс≥онери, що отримували допомогу ¬ѕќ (дл€ ѕ‘”)
    FUNCTION PFU_VPO_R1 (p_start_dt   IN DATE,
                         p_org_id     IN NUMBER,
                         p_rt_id      IN rpt_templates.rt_id%TYPE)
        RETURN DECIMAL
    IS
        l_jbr_id      NUMBER;
        l_file_name   VARCHAR2 (128);
        l_start_dt    DATE := TRUNC (p_start_dt, 'MM');
        l_sql         VARCHAR2 (10000);
    BEGIN
        tools.WriteMsg ('DNET$PAYMENT_REPORTS.' || $$PLSQL_UNIT);
        l_jbr_id := RDM$RTFL.InitReport (p_rt_id => p_rt_id);

        l_file_name :=
               'PFU_VPO_R1_'
            || TO_CHAR (l_start_dt, 'yyyy"_"mm')
            || '_'
            || p_org_id
            || '.csv';
        ikis_sysweb.REPORTFL_ENGINE_EX.SetFileName (
            p_jbr_id      => l_jbr_id,
            p_file_name   => l_file_name);

        RDM$RTFL.AddParam (l_jbr_id, 'p_year', TO_CHAR (l_start_dt, 'yyyy'));
        RDM$RTFL.AddParam (l_jbr_id, 'p_month', TO_CHAR (l_start_dt, 'mm'));

        RDM$RTFL.AddScript (
            l_jbr_id,
            'constants',
               'begin uss_esr.DNET$PAYMENT_REPORTS.SET_PFU_VPO_R1(to_date('''
            || TO_CHAR (l_start_dt, 'dd.mm.yyyy')
            || ''',''dd.mm.yyyy''), '
            || p_org_id
            || ', '
            || l_jbr_id
            || '); end;');

        l_sql := q'{
    select '"' || REPLACE(x_string1, '"', '""') || '"' AS x_string1,
           '"' || REPLACE(x_string2, '"', '""') || '"' AS x_string2,
           '"' || REPLACE(x_string3, '"', '""') || '"' AS x_string3,
           '"' || REPLACE(x_string4, '"', '""') || '"' AS x_string4,
           '"' || to_char(x_dt1, 'dd.mm.yyyy') || '"' AS x_dt1,
           '"' || to_char(x_dt2, 'dd.mm.yyyy') || '"' AS x_dt2
        from uss_esr.tmp_univ_rpt_data}';
        RDM$RTFL.AddDataSet (l_jbr_id, 'ds', l_sql);

        RDM$RTFL.PutReportToWorkingQueue (p_jbr_id => l_jbr_id);
        RETURN l_jbr_id;
    END PFU_VPO_R1;

    PROCEDURE RegisterReport (p_rt_id      IN     NUMBER,
                              p_start_dt   IN     DATE,
                              p_stop_dt    IN     DATE,
                              p_org_id     IN     NUMBER,
                              p_val_1      IN     VARCHAR2,
                              p_val_2      IN     VARCHAR2,
                              p_jbr_id        OUT DECIMAL)
    IS
        l_code       VARCHAR2 (50);
        l_user_org   NUMBER;
    BEGIN
        SELECT t.rt_code
          INTO l_code
          FROM rpt_templates t
         WHERE t.rt_id = p_rt_id;

        IF p_org_id = 0
        THEN
            l_user_org := Tools.GetCurrOrg;
        ELSE
            l_user_org := p_org_id;
        END IF;

        l_user_org :=
            CASE WHEN l_user_org = 50001 THEN 50000 ELSE l_user_org END;

        p_jbr_id :=
            CASE
                WHEN l_code = 'NEED_CONS_R1'
                THEN
                    NEED_CONS_R1 (p_rt_id,
                                  p_start_dt,
                                  p_org_id,
                                  p_val_1)
                WHEN l_code = 'SOC_HELP_R1'
                THEN
                    SOC_HELP_R1 (p_rt_id,
                                 p_start_dt,
                                 p_stop_dt,
                                 p_org_id)
                WHEN l_code = 'PAY_ORDER_R1'
                THEN
                    PAY_ORDER_R1 (p_val_1, p_rt_id)
                WHEN l_code = 'PAY_ORDER_R2'
                THEN
                    PAY_ORDER_R1 (p_val_1, p_rt_id)
                WHEN l_code = 'KAZNA_R1'
                THEN
                    KAZNA_R1 (p_val_1, p_rt_id)
                WHEN l_code = 'REESTR_VPO_R1'
                THEN
                    REESTR_VPO_R1 (p_val_1, p_rt_id)
                WHEN l_code = 'FIN_OBLIG_R1'
                THEN
                    FIN_OBLIG_R1 (p_val_1, p_rt_id)                   --#74740
                WHEN l_code = 'LEG_OBLIG_R1'
                THEN
                    LEG_OBLIG_R1 (p_val_1, p_rt_id)                   --#74145
                WHEN l_code = 'REESTR_KAZNA_R1'
                THEN
                    REESTR_KAZNA_R1 (p_val_1, p_rt_id)                --#77002
                WHEN l_code = 'REESTR_UNPAID_R1'
                THEN
                    REESTR_UNPAID_R1 (p_start_dt,
                                      p_stop_dt,
                                      p_org_id,
                                      p_rt_id)                        --#84010
                WHEN l_code = 'REESTR_UNPAID_KB2'
                THEN
                    REESTR_UNPAID_KB2 (p_start_dt, p_org_id, 382)     --#84394
                WHEN l_code = 'ACCRUAL_VPO_R1'
                THEN
                    ACCRUAL_VPO_R1 (p_start_dt, p_org_id, 383)        --#85151
                WHEN l_code = 'ASSIGN_VPO_R1'
                THEN
                    ASSIGN_VPO_R1 (p_start_dt, p_org_id, 384)         --#85152
                WHEN l_code = 'PAID_VPO_R1'
                THEN
                    PAID_VPO_R1 (p_start_dt, p_org_id, 385)           --#85154
                WHEN l_code = 'PAID_VPO_R2'
                THEN
                    PAID_VPO_R2 (p_start_dt, p_org_id, 386)           --#85153
                WHEN l_code = 'DLK_CNT_VPO_R1'
                THEN
                    DLK_CNT_VPO_R1 (p_start_dt, p_org_id, 387)        --#85123
                WHEN l_code = 'PAID_VPO_R3'
                THEN
                    PAID_VPO_R3 (p_start_dt, p_org_id, 388)           --#85156
                WHEN l_code = 'KAZNA_REG_6DOP'
                THEN
                    KAZNA_REG_6DOP (p_val_1, 225)                     --#85725
                WHEN l_code = 'KAZNA_REG_DED'
                THEN
                    KAZNA_REG_DED (p_val_1, 226)                      --#93510
                WHEN l_code = 'CNT_RECIP_DOP'
                THEN
                    CNT_RECIP_DOP (p_start_dt,
                                   p_val_1,
                                   l_user_org,
                                   170)                               --#86322
                WHEN l_code = 'CNT_MCHILD_FML'
                THEN
                    CNT_MCHILD_FML (p_start_dt,
                                    p_val_1,
                                    l_user_org,
                                    171)                              --#86737
                WHEN l_code = 'REP_CHILDREN_FML'
                THEN
                    dnet$rpt_help_family.REP_CHILDREN_FML (p_start_dt,
                                                           l_user_org,
                                                           p_rt_id)   --#88696
                --WHEN l_code = 'DSDI_R1' THEN DSDI_R1(p_start_dt, l_user_org, 173)--#91166
                WHEN l_code = 'REP_CHILDREN_272'
                THEN
                    REP_CHILDREN_272 (p_start_dt, l_user_org, 174)    --#93410
                WHEN l_code = 'REP_PRSD_R1'
                THEN
                    REP_PRSD_R1 (p_start_dt,
                                 p_val_1,
                                 l_user_org,
                                 175)                                 --#96873
                WHEN l_code = 'REP_PRSD_R2'
                THEN
                    REP_PRSD_R2 (p_start_dt,
                                 TRUNC (SYSDATE, 'mm'),
                                 p_val_1,
                                 l_user_org,
                                 177)                                --#108718
                WHEN l_code = 'PAYROLL_AMOUNT_R1'
                THEN
                    REP_PAYROLL_AMOUNT_R1 (p_start_dt,
                                           l_user_org,
                                           p_val_1,
                                           p_val_2,
                                           176)                       --#98585
                WHEN l_code = 'PAID_VPO_R4'
                THEN
                    PAID_VPO_R4 (p_start_dt, p_org_id, 389)           --#87518
                WHEN l_code = 'PAID_VPO_R5'
                THEN
                    PAID_VPO_R5 (p_start_dt, p_org_id, 390)           --#92714
                WHEN l_code = 'REP_INCOM_R1'
                THEN
                    REP_INCOM_R1 (p_start_dt, p_org_id, 190)          --#94445
                WHEN l_code = 'CONSOLIDATE_PAY_REESTR_R1'
                THEN
                    CONSOLIDATE_PAY_REESTR_R1 (p_val_1, p_rt_id)
                WHEN l_code = 'INCOME_CERTIFICATE_R1'
                THEN
                    INCOME_CERT_R1 (p_rt_id,
                                    p_start_dt,
                                    p_stop_dt,
                                    p_org_id)
                WHEN l_code = 'VPO_2000_3000_R1'
                THEN
                    VPO_2000_3000_R1 (p_start_dt, p_org_id, p_rt_id) -- #91702
                WHEN l_code = 'RECOMEND_WORK_BY_CODE_R1'
                THEN
                    RECOMEND_WORK_BY_CODE_R1 (p_start_dt, p_rt_id)   -- #92003
                WHEN l_code = 'PAY_ORDER_R3'
                THEN
                    dnet$pd_reports.reg_pay_order_report (p_val_1)
                WHEN l_code = 'REC_WORK_REPORTS_R1'
                THEN
                    REC_WORK_REPORTS_R1 (p_start_dt, p_org_id, p_rt_id)
                WHEN l_code = 'PFU_VPO_R1'
                THEN
                    PFU_VPO_R1 (p_start_dt, l_user_org, p_rt_id)    -- #109334
                WHEN l_code = 'REP_CHILD_ORPHANS'
                THEN
                    dnet$rpt_help_family.REP_CHILD_ORPHANS (p_start_dt,
                                                            l_user_org,
                                                            p_rt_id) -- #109361
                WHEN l_code = 'REP_CHILD_ORPHANS_R2'
                THEN
                    dnet$rpt_help_family.REP_CHILD_ORPHANS_R2 (p_start_dt,
                                                               l_user_org,
                                                               p_rt_id) -- #109460
                WHEN l_code = 'REP_CHILD_ORPHANS_R3'
                THEN
                    dnet$rpt_help_family.REP_CHILD_ORPHANS_R3 (p_start_dt,
                                                               l_user_org,
                                                               p_rt_id) -- #109460
                WHEN l_code = 'REP_CHILD_ORPHANS_R4'
                THEN
                    dnet$rpt_help_family.REP_CHILD_ORPHANS_R4 (p_start_dt,
                                                               l_user_org,
                                                               p_rt_id) -- #109460
                WHEN l_code = 'REP_CHILD_ORPHANS_R5'
                THEN
                    dnet$rpt_help_family.REP_CHILD_ORPHANS_R5 (p_start_dt,
                                                               l_user_org,
                                                               p_rt_id) -- #109460
                WHEN l_code = 'REP_CHILD_ORPHANS_R6'
                THEN
                    dnet$rpt_help_family.REP_CHILD_ORPHANS_R6 (p_start_dt,
                                                               l_user_org,
                                                               p_rt_id) -- #109460
                ELSE
                    NULL
            END;
    END;

    PROCEDURE build_ca_pdr_report (P_NNF_ID   IN     NUMBER,
                                   P_IDS      IN     VARCHAR2,
                                   P_FILE        OUT BLOB)
    IS
        l_org   NUMBER := tools.getcurrorg;
    /*TYPE t_rec IS RECORD (
      x_nkv    VARCHAR2(4),
      x_sum    NUMBER
    );
    TYPE t_arr IS TABLE OF t_rec;
    l_arr t_arr;*/
    --l_cnt NUMBER;
    BEGIN
        DELETE FROM tmp_treasury;

        /*FOR zz IN (select regexp_substr(text ,'[^(\,)]+', 1, level)  as ud_id
                       from (select P_UD_IDS as text from dual)
                    connect by length(regexp_substr(text ,'[^(\,)]+', 1, level)) > 0)
        LOOP*/
        /*l_arr := t_arr();

        FOR xx IN (SELECT t.*,
                          k.nkv_code,
                          rownum AS rn
                     FROM ud_Detail t
                     JOIN v_ndi_kekv k ON (k.nkv_id = t.udd_nkv)
                    WHERE t.udd_ud = zz.ud_id)
        LOOP
          l_arr.extend();
          l_arr(xx.rn).x_nkv := substr(xx.nkv_code, 1, 4);
          l_arr(xx.rn).x_sum := xx.udd_sum;
        END LOOP;
        l_cnt := l_arr.count;
        if l_cnt < 3 then
          l_arr.extend(3-l_cnt);
        end if;*/

        INSERT INTO tmp_treasury z (X_RIV,
                                    X_NOM10,
                                    X_TEXT10,
                                    X_DAGL,
                                    X_DK4,
                                    X_NLSK19,
                                    X_TEXT12,
                                    X_SUM1_17_2,
                                    X_NUM1,
                                    X_KOBL2,
                                    X_KRAJ2,
                                    X_KSEL2,
                                    X_KPK7,
                                    X_KFK6,
                                    X_KVK3,
                                    X_KEKV4,
                                    X_DT1,
                                    X_NUM9,
                                    X_SUM2_17_2,
                                    X_KEKVD4,
                                    X_SUM3_17_2,
                                    X_KFK4,
                                    X_SUM4_17_2,
                                    X_KFKD4,
                                    X_SUM5_17_2,
                                    X_TEXT1,
                                    X_TEXT15,
                                    X_NOB38,
                                    X_MFO9,
                                    X_NLSA19,
                                    X_KOKPO35,
                                    X_NRA140,
                                    X_SK1,
                                    X_UDK2,
                                    X_VDK2,
                                    X_KPOL6,
                                    X_TEXT160,
                                    X_TEXT32,
                                    X_DT2,
                                    X_KOD8,
                                    X_NUMB9,
                                    X_KOKPOR35,
                                    X_POLUT38,
                                    X_TEXT2_140,
                                    X_TEXT2_32,
                                    X_DT3,
                                    X_TEXT29,
                                    X_TEXT2_29,
                                    x_TEXT3_35,
                                    X_TEXT140,
                                    X_TEXT3_140,
                                    X_TEXT4_140,
                                    X_TEXT5_140)
            SELECT 0                                          AS X_RIV,
                   SUBSTR (t.po_number, 1, 10)                AS X_NOM10,
                   NULL                                       AS X_TEXT10,
                   t.po_pay_dt                                AS X_DAGL,
                   SUBSTR (t.po_number, 1, 4)                 AS X_DK4,
                   NULL                                       AS X_NLSK19,
                   NULL                                     /*'000000141373'*/
                                                              AS X_TEXT12,
                   t.po_sum                                   AS X_SUM1_17_2,
                   TO_CHAR (t.po_pay_dt, 'Q')                 AS X_NUM1,
                   NULL                                       AS X_KOBL2,
                   0                                          AS X_KRAJ2,
                   0                                          AS X_KSEL2,
                   SUBSTR (bp.nbg_kpk_code, 1, 7)             AS X_KPK7,
                   '0'                                        AS X_KFK6,
                   '250'                                      AS X_KVK3,
                   '2730 '                                    AS X_KEKV4,
                   TRUNC (SYSDATE)                            AS X_DT1,
                   1                                          AS X_NUM9,
                   NULL                                       AS X_SUM2_17_2,
                   NULL                                       AS X_KEKVD4,
                   NULL                                       AS X_SUM3_17_2,
                   NULL                                       AS X_KFK4,
                   NULL                                       AS X_SUM4_17_2,
                   NULL                                       AS X_KFKD4,
                   0                                          AS X_SUM5_17_2,
                   0                                          AS X_TEXT1,
                   NULL                                       AS X_TEXT15,
                   SUBSTR (t.po_bank_name_dest, 1, 38)        AS X_NOB38,
                   '0'                                        AS X_MFO9,
                   NULL                                       AS X_NLSA19,
                   t.po_tax_code_dest                         AS X_KOKPO35,
                   SUBSTR (t.po_name_dest, 1, 140)            AS X_NRA140,
                   1                                                     /*9*/
                                                              AS X_SK1,
                   1                                          AS X_UDK2,
                   6                                          AS X_VDK2,
                   SUBSTR (s.acs_adm_code, 1, 6)              AS X_KPOL6,
                   SUBSTR (t.po_purpose, 1, 160)              AS X_TEXT160,
                   o.cto_num                                  AS X_TEXT32,
                   o.cto_dt                                   AS X_DT2,
                   NULL                                       AS X_KOD8,
                   '0'                                   /*t.po_bank_mfo_src*/
                                                              AS X_NUMB9,
                   t.po_tax_code_src                          AS X_KOKPOR35,
                   NULL                                       AS X_POLUT38,
                   SUBSTR (t.po_name_src, 1, 140)             AS X_TEXT2_140,
                   uo.cto_num                                 AS X_TEXT2_32,
                   uo.cto_dt                                  AS X_DT3,
                   SUBSTR (t.po_bank_account_src, 1, 29)      AS X_TEXT29,
                   SUBSTR (t.po_bank_account_dest, 1, 29)     AS X_TEXT2_29,
                   NULL                                       AS X_TEXT3_35,
                   NULL                                       AS x_TEXT_140,
                   SUBSTR (t.po_purpose, 1, 140)              AS X_TEXT3_140,
                   SUBSTR (t.po_purpose, 141, 140)            AS X_TEXT4_140,
                   SUBSTR (t.po_purpose, 281, 140)            AS X_TEXT5_140
              FROM v_pay_order  t
                   LEFT JOIN uss_ndi.v_ndi_acc_setup s ON (s.com_org = l_org)
                   LEFT JOIN v_obligation o ON (o.cto_id = t.po_cto)
                   LEFT JOIN v_obligation uo ON (uo.cto_id = o.cto_cto_ur)
                   LEFT JOIN uss_ndi.v_ndi_pay_person_acc pa
                       ON (pa.dppa_id = t.po_dppa_payer)
                   LEFT JOIN uss_ndi.v_ndi_budget_program bp
                       ON (bp.nbg_id = pa.dppa_nbg)
             WHERE t.po_id IN (    SELECT REGEXP_SUBSTR (text,
                                                         '[^(\,)]+',
                                                         1,
                                                         LEVEL)    AS ud_id
                                     FROM (SELECT P_IDS AS text FROM DUAL)
                               CONNECT BY LENGTH (REGEXP_SUBSTR (text,
                                                                 '[^(\,)]+',
                                                                 1,
                                                                 LEVEL)) > 0);

        --END LOOP;

        P_FILE := API$EXPORTS.GetFile (P_NNF_ID);
    --raise_application_error(-20000, dbms_lob.getlength(l_file));
    /*OPEN RES_CUR FOR
      SELECT P_FILE_NAME AS blob_name,
             l_file AS blob_data,
             dbms_lob.getlength(l_file) AS blob_length
        FROM dual;*/
    END;

    --kolio #74145
    PROCEDURE BUILD_LEG_OBL_DBF_REPORT (P_NNF_ID   IN     NUMBER,
                                        P_IDS      IN     VARCHAR2,
                                        P_FILE        OUT BLOB)
    IS
        CURSOR ids IS
                SELECT REGEXP_SUBSTR (text,
                                      '[^(\,)]+',
                                      1,
                                      LEVEL)    AS cto
                  FROM (SELECT p_ids AS text FROM DUAL)
            CONNECT BY LENGTH (REGEXP_SUBSTR (text,
                                              '[^(\,)]+',
                                              1,
                                              LEVEL)) > 0;

        p_cto_reestr_num    obligation.cto_reestr_num%TYPE;
        p_cto_reestr_dt     obligation.cto_reestr_dt%TYPE;
        p_cto_reestr_num2   obligation.cto_reestr_num%TYPE;
        p_cto_reestr_dt2    obligation.cto_reestr_dt%TYPE;
        i                   NUMBER;
    BEGIN
        DELETE FROM TMP_OBLIGATION;

        p_cto_reestr_num2 := NULL;
        p_cto_reestr_dt2 := NULL;

        FOR id IN ids
        LOOP
            SELECT cto_reestr_num, cto_reestr_dt
              INTO p_cto_reestr_num, p_cto_reestr_dt
              FROM obligation
             WHERE cto_id = id.cto AND com_org = tools.getcurrorg;

            IF p_cto_reestr_num2 IS NULL
            THEN
                p_cto_reestr_num2 := p_cto_reestr_num;
            END IF;

            IF p_cto_reestr_dt2 IS NULL
            THEN
                p_cto_reestr_dt2 := p_cto_reestr_dt;
            END IF;

            IF p_cto_reestr_num <> p_cto_reestr_num2
            THEN
                raise_application_error (
                    -20000,
                    'Ќомери реЇстру вс≥х обраних зобов`€зань повинн≥ бути однаков≥!');
                EXIT;
            END IF;

            IF p_cto_reestr_dt <> p_cto_reestr_dt2
            THEN
                raise_application_error (
                    -20000,
                    'ƒати реЇстру вс≥х обраних зобов`€зань повинн≥ бути однаков≥!');
                EXIT;
            END IF;
        END LOOP;

        i := 1;

        FOR id IN ids
        LOOP
            INSERT INTO TMP_OBLIGATION (OP,
                                        NP,
                                        DATER,
                                        RRAX29,
                                        KPK,
                                        KFK,
                                        KVK,
                                        KPOL,
                                        KEKV,
                                        NDOC,
                                        DATEDOC,
                                        S,
                                        SO,
                                        EDRPOUK,
                                        POLUT,
                                        DATETERM,
                                        EDRPOUR,
                                        NAMER,
                                        BUDGET,
                                        NOTE20,
                                        NREE,
                                        DATEPOCH,
                                        SK,
                                        OZNTN)
                SELECT 0                                      AS OP,
                       i                                      AS NP,
                       cto_dksu_unload_dt                     AS DATER,
                       SUBSTR ( (SELECT dppa_account
                                   FROM USS_NDI.v_ndi_pay_person_acc
                                  WHERE dppa_id = cto_dppa_own),
                               1,
                               29)                            AS RRAX29,
                       (SELECT b.nbg_kpk_code
                          FROM USS_NDI.V_NDI_FUNDING_SOURCE  f
                               JOIN USS_NDI.v_Ndi_Budget_Program b
                                   ON f.nfs_nbg = b.nbg_id
                         WHERE f.nfs_id = cto_nfs)            AS KPK,
                       NULL                                   AS KFK,
                       (SELECT acs_kvk_code
                          FROM USS_NDI.v_Ndi_Acc_Setup
                         WHERE com_org = tools.getcurrorg)    AS KVK,
                       (SELECT acs_adm_code
                          FROM USS_NDI.v_Ndi_Acc_Setup
                         WHERE com_org = tools.getcurrorg)    AS KPOL,
                       (SELECT nkv_code
                          FROM USS_NDI.V_NDI_KEKV
                         WHERE nkv_id = cto_nkv)              AS KEKV,
                       SUBSTR (cto_num, 1, 32)                AS NDOC,
                       cto_dt                                 AS DATEDOC,
                       (CASE cto_acc_oper
                            WHEN 'GET' THEN cto_sum
                            ELSE -cto_sum
                        END)                                  AS S,
                       0.00                                   AS SO,
                       SUBSTR ( (SELECT dpp_tax_code
                                   FROM USS_NDI.V_NDI_PAY_PERSON
                                  WHERE dpp_id = cto_dpp),
                               1,
                               14)                            AS EDRPOUK,
                       SUBSTR ( (SELECT dpp_name
                                   FROM USS_NDI.v_NDI_PAY_PERSON
                                  WHERE dpp_id = cto_dpp),
                               1,
                               38)                            AS POLUT,
                       cto_term_dt                            AS DATETERM,
                       SUBSTR (
                           (SELECT dpp_tax_code
                              FROM USS_NDI.v_NDI_PAY_PERSON
                             WHERE     dpp_tp = 'OSZN'
                                   AND dpp_org = tools.getcurrorg),
                           1,
                           14)                                AS EDRPOUR,
                       SUBSTR (
                           (SELECT dpp_name
                              FROM USS_NDI.v_NDI_PAY_PERSON
                             WHERE     dpp_tp = 'OSZN'
                                   AND dpp_org = tools.getcurrorg),
                           1,
                           38)                                AS NAMER,
                       SUBSTR (
                           (SELECT b.nbu_code
                              FROM USS_NDI.V_NDI_FUNDING_SOURCE  f
                                   JOIN USS_NDI.v_Ndi_Budget b
                                       ON f.nfs_nbu = b.nbu_id
                             WHERE f.nfs_id = cto_nfs),
                           1,
                           10)                                AS BUDGET,
                       SUBSTR (cto_ess_conditions, 1, 20)     AS NOTE20,
                       cto_reestr_num                         AS NREE,
                       cto_reestr_dt                          AS DATEPOCH,
                       (SELECT dic_srtordr
                          FROM USS_NDI.V_NDI_FUNDING_SOURCE  f
                               JOIN USS_NDI.v_ddn_nfs_tp ON nfs_id = cto_nfs
                         WHERE f.nfs_tp = dic_value)          AS SK,
                       '00'                                   AS OZNTN
                  FROM obligation
                 WHERE     cto_id = id.cto
                       AND cto_st = 'AP'
                       AND com_org = tools.getcurrorg;

            i := i + 1;
        END LOOP;

        P_FILE := API$EXPORTS.GetFile (P_NNF_ID);
    END;

    PROCEDURE BUILD_FIN_OBL_DBF_REPORT (P_NNF_ID   IN     NUMBER,
                                        P_IDS      IN     VARCHAR2,
                                        P_FILE        OUT BLOB)
    IS
        CURSOR ids IS
                SELECT REGEXP_SUBSTR (text,
                                      '[^(\,)]+',
                                      1,
                                      LEVEL)    AS cto
                  FROM (SELECT p_ids AS text FROM DUAL)
            CONNECT BY LENGTH (REGEXP_SUBSTR (text,
                                              '[^(\,)]+',
                                              1,
                                              LEVEL)) > 0;

        --l_dt DATE;
        p_cto_reestr_num    obligation.cto_reestr_num%TYPE;
        p_cto_reestr_dt     obligation.cto_reestr_dt%TYPE;
        p_cto_reestr_num2   obligation.cto_reestr_num%TYPE;
        p_cto_reestr_dt2    obligation.cto_reestr_dt%TYPE;
        i                   NUMBER;
    BEGIN
        DELETE FROM TMP_OBLIGATION;

        p_cto_reestr_num2 := NULL;
        p_cto_reestr_dt2 := NULL;

        FOR id IN ids
        LOOP
            SELECT cto_reestr_num, cto_reestr_dt
              INTO p_cto_reestr_num, p_cto_reestr_dt
              FROM obligation
             WHERE cto_id = id.cto AND com_org = tools.getcurrorg;

            IF p_cto_reestr_num2 IS NULL
            THEN
                p_cto_reestr_num2 := p_cto_reestr_num;
            END IF;

            IF p_cto_reestr_dt2 IS NULL
            THEN
                p_cto_reestr_dt2 := p_cto_reestr_dt;
            END IF;

            IF p_cto_reestr_num <> p_cto_reestr_num2
            THEN
                raise_application_error (
                    -20000,
                    'Ќомери реЇстру вс≥х обраних зобов`€зань повинн≥ бути однаков≥!');
                EXIT;
            END IF;

            IF p_cto_reestr_dt <> p_cto_reestr_dt2
            THEN
                raise_application_error (
                    -20000,
                    'ƒати реЇстру вс≥х обраних зобов`€зань повинн≥ бути однаков≥!');
                EXIT;
            END IF;
        END LOOP;

        i := 1;

        FOR id IN ids
        LOOP
            INSERT INTO TMP_OBLIGATION (OP,
                                        NP,
                                        DATER,
                                        EDRPOUR,
                                        RRAX30,
                                        KPK,
                                        KPOL,
                                        KVK,
                                        KFK,
                                        KEKV,
                                        DATEDOC,
                                        NDOC,
                                        DATEDOCF,
                                        NDOCF,
                                        S,
                                        EDRPOUK,
                                        POLUT,
                                        NAZB,
                                        MFOK,
                                        NLSK,
                                        SK,
                                        DATERZ,
                                        NPRZ,
                                        NAMER,
                                        SO,
                                        BUDGET,
                                        NREE,
                                        NOTE8,
                                        FLAGS,
                                        IBANK)
                SELECT 0                                      AS OP,
                       i                                      AS NP,
                       cto_dksu_unload_dt                     AS DATER,
                       SUBSTR (
                           (SELECT dpp_tax_code
                              FROM USS_NDI.v_NDI_PAY_PERSON
                             WHERE     dpp_tp = 'OSZN'
                                   AND dpp_org = tools.getcurrorg),
                           1,
                           14)                                AS EDRPOUR,
                       SUBSTR ( (SELECT dppa_account
                                   FROM USS_NDI.v_ndi_pay_person_acc
                                  WHERE dppa_id = cto_dppa_own),
                               1,
                               30)                            AS RRAX30,
                       (SELECT b.nbg_kpk_code
                          FROM USS_NDI.V_NDI_FUNDING_SOURCE  f
                               JOIN USS_NDI.v_Ndi_Budget_Program b
                                   ON f.nfs_nbg = b.nbg_id
                         WHERE f.nfs_id = cto_nfs)            AS KPK,
                       (SELECT acs_adm_code
                          FROM USS_NDI.v_Ndi_Acc_Setup
                         WHERE com_org = tools.getcurrorg)    AS KPOL,
                       (SELECT acs_kvk_code
                          FROM USS_NDI.v_Ndi_Acc_Setup
                         WHERE com_org = tools.getcurrorg)    AS KVK,
                       0                                      AS KFK,
                       (SELECT nkv_code
                          FROM USS_NDI.V_NDI_KEKV
                         WHERE nkv_id = cto_nkv)              AS KEKV,
                       (SELECT o3.cto_dt
                          FROM obligation o3
                         WHERE o3.cto_id = o.cto_cto_ur)      AS DATEDOC,
                       SUBSTR ( (SELECT o2.cto_num
                                   FROM obligation o2
                                  WHERE o2.cto_id = o.cto_cto_ur),
                               1,
                               32)                            AS NDOC,
                       cto_dt                                 AS DATEDOCF,
                       SUBSTR (cto_num, 1, 32)                AS NDOCF,
                       (CASE cto_acc_oper
                            WHEN 'GET' THEN cto_sum
                            ELSE -cto_sum
                        END)                                  AS S,
                       SUBSTR ( (SELECT dpp_tax_code
                                   FROM USS_NDI.V_NDI_PAY_PERSON
                                  WHERE dpp_id = cto_dpp),
                               1,
                               14)                            AS EDRPOUK,
                       SUBSTR ( (SELECT dpp_name
                                   FROM USS_NDI.v_NDI_PAY_PERSON
                                  WHERE dpp_id = cto_dpp),
                               1,
                               38)                            AS POLUT,
                       SUBSTR (
                           (SELECT nb_sname
                              FROM USS_NDI.v_ndi_pay_person_acc
                                   LEFT JOIN USS_NDI.v_ndi_bank
                                       ON dppa_nb = nb_id
                             WHERE dppa_id = cto_dppa_ca),
                           1,
                           38)                                AS NAZB,
                       0                                      AS MFOK,
                       NULL                                   AS NLSK,
                       (SELECT dic_srtordr
                          FROM USS_NDI.V_NDI_FUNDING_SOURCE  f
                               JOIN USS_NDI.v_ddn_nfs_tp ON nfs_id = cto_nfs
                         WHERE f.nfs_tp = dic_value)          AS SK,
                       cto_reestr_dt                          AS DATERZ,
                       i                                      AS NPRZ,
                       SUBSTR (
                           (SELECT dpp_name
                              FROM USS_NDI.v_NDI_PAY_PERSON
                             WHERE     dpp_tp = 'OSZN'
                                   AND dpp_org = tools.getcurrorg),
                           1,
                           38)                                AS NAMER,
                       0                                      AS SO,
                       SUBSTR (
                           (SELECT b.nbu_code
                              FROM USS_NDI.V_NDI_FUNDING_SOURCE  f
                                   JOIN USS_NDI.v_Ndi_Budget b
                                       ON f.nfs_nbu = b.nbu_id
                             WHERE f.nfs_id = cto_nfs),
                           1,
                           10)                                AS BUDGET,
                       cto_reestr_num                         AS NREE,
                       cto_term_dt                            AS NOTE8,
                       '00'                                   AS FLAGS,
                       SUBSTR ( (SELECT dppa_account
                                   FROM USS_NDI.v_ndi_pay_person_acc
                                  WHERE dppa_id = cto_dppa_ca),
                               1,
                               29)                            AS IBANK
                  FROM obligation o
                 WHERE     cto_id = id.cto
                       AND cto_st = 'AP'
                       AND com_org = tools.getcurrorg;

            i := i + 1;
        END LOOP;

        P_FILE := API$EXPORTS.GetFile (P_NNF_ID);
    END;

    PROCEDURE BUILD_TAX_1DF_DBF_REPORT (                          -- IC #90202
                                        P_NNF_ID   IN     NUMBER,
                                        P_DT       IN     DATE,
                                        P_FILE        OUT BLOB)
    IS
        l_tax_code   USS_NDI.v_NDI_PAY_PERSON.dpp_tax_code%TYPE;
        l_rep_date   DATE;
        l_org        NUMBER := tools.getcurrorg;
        l_org_to     NUMBER := tools.GetCurrOrgTo;
    BEGIN
        l_org := CASE WHEN l_org = 50001 THEN 50000 ELSE l_org END;
        l_rep_date := P_DT;

        IF l_rep_date IS NULL
        THEN
            raise_application_error (-20000,
                                     '¬вед≥ть дату в формат≥ DD.MM.YYYY');
        ELSE
            l_rep_date := TRUNC (l_rep_date, 'mm');
        END IF;

        SELECT dpp_tax_code
          INTO l_tax_code
          FROM USS_NDI.v_NDI_PAY_PERSON
         WHERE dpp_tp = 'OSZN' AND dpp_org = tools.getcurrorg;

        DELETE FROM uss_esr.tmp_tax_1df;

        INSERT INTO uss_esr.tmp_tax_1df
            WITH
                org
                AS
                    (    SELECT org_id
                           FROM ikis_sys.v_opfu
                          WHERE l_org_to != 34
                     CONNECT BY PRIOR org_id = org_org
                     START WITH org_id = l_org
                     UNION ALL
                     SELECT org_id
                       FROM ikis_sys.v_opfu
                      WHERE l_org_to = 34 AND org_acc_org = l_org)
              SELECT ROW_NUMBER () OVER (ORDER BY t.pc_sc)    NP -- номер за пор€дком р€дка
                                                                ,
                     2                                        PERIOD -- пишемо 2 дл€ вс≥х
                                                                    ,
                     TO_CHAR (l_rep_date, 'yyyy')             RIK -- р≥к з параметр≥в
                                                                 ,
                     l_tax_code                               KOD -- код ™ƒ–ѕќ” ќ—«Ќ, в €кому формуЇмо зв≥т
                                                                 ,
                     0                                        TYP -- пишемо 0 дл€ вс≥х
                                                                 ,
                     (  SELECT d.scd_seria || d.scd_number
                          FROM uss_person.v_sc_document d,
                               USS_NDI.v_ndi_document_type dt
                         WHERE     scd_sc = t.pc_sc
                               AND d.scd_ndt = dt.ndt_id
                               AND dt.ndt_ndc IN (2, 13)
                               AND d.scd_st IN ('1', 'A')
                               AND d.scd_number IS NOT NULL
                      ORDER BY ndt_order NULLS LAST, ndt_id
                         FETCH FIRST ROW ONLY)                TIN -- –Ќќ ѕѕ за€вника. якщо –Ќќ ѕѕ порожн≥й, тод≥ вносимо сер≥ю та є паспорту (без проб≥л≥в, 8 символ≥в) або ID-картку (9 символ≥в) або сер≥ю та є св≥доцтва про народженн€ (в залежност≥ того, €к≥ Ї документи по за€внику)
                                                                 ,
                     SUM (t.S_NAR)                            S_NAR -- сума нарахуванн€ у м≥с€ц≥
                                                                   ,
                     SUM (t.S_DOX)                            S_DOX -- сума виплати у м≥с€ц≥
                                                                   ,
                     0                                        S_TAXN    -- = 0
                                                                    ,
                     0                                        S_TAXP    -- = 0
                                                                    ,
                     128                                      OZN_DOX -- пишемо 128
                                                                     ,
                     NULL                                     D_PRIYN -- не заповнюЇмо
                                                                     ,
                     NULL                                     D_ZVILN -- не заповнюЇмо
                                                                     ,
                     0                                        OZN_PILG  -- = 0
                                                                      ,
                     0                                        OZNAKA    -- = 0
                                                                    ,
                     0                                        A051      -- = 0
                                                                  ,
                     0                                        A05        --= 0
                FROM (  SELECT c.pc_sc,
                               SUM (uss_esr.api$accrual.xsign (acd_op) * acd_sum)
                                   S_NAR          -- сума нарахуванн€ у м≥с€ц≥
                                        ,
                               0
                                   S_DOX
                          FROM uss_esr.ac_detail ad
                               INNER JOIN uss_esr.accrual a
                                   ON a.ac_id = ad.acd_ac
                               INNER JOIN uss_ndi.v_ndi_op op
                                   ON op.op_id = ad.acd_op
                               INNER JOIN uss_esr.personalcase c
                                   ON c.pc_id = a.ac_pc
                               INNER JOIN uss_ndi.v_ndi_payment_type pt
                                   ON pt.npt_id = ad.acd_npt
                         WHERE     l_rep_date BETWEEN TRUNC (ad.acd_ac_start_dt,
                                                             'mm')
                                                  AND LAST_DAY (
                                                          ad.acd_ac_stop_dt)
                               -- AND a.ac_month = to_date('01.09.2023','dd.mm.yyyy')
                               AND (ad.acd_op IN (1, 2, 3) OR op.op_tp1 IN ('NR'))
                               AND ad.history_status = 'A'
                               AND ad.acd_imp_pr_num IS NULL -- Tania, 12:43 виключати з сум зв≥ту т≥, де заповнено ACD_IMP_PR_NUM (таблиц€ ac_detail)
                               /*
                               AND EXISTS (SELECT 1 -- IC #97518
                                                FROM org,
                                                    uss_esr.pc_account pa,
                                                    uss_ndi.v_ndi_npt_config nc
                                                WHERE pa.pa_pc = c.pc_id
                                                    AND pa.pa_nst = nc.nptc_nst
                                                    AND nc.nptc_npt = pt.npt_id
                                                    AND pa.pa_org = org.org_id)
                               */
                               AND EXISTS
                                       (SELECT 1                  -- IC #97518
                                          FROM org
                                               INNER JOIN uss_esr.pc_account pa
                                                   ON pa.pa_pc = c.pc_id
                                               INNER JOIN
                                               uss_ndi.v_ndi_npt_config nc
                                                   ON     nc.nptc_nst = pa.pa_nst
                                                      AND nc.nptc_npt = pt.npt_id
                                               LEFT JOIN
                                               uss_ndi.v_ndi_decoding_config o
                                                   ON     o.nddc_code_dest =
                                                          org.org_id
                                                      AND o.nddc_tp = 'ORG_MIGR'
                                         WHERE NVL (o.nddc_code_src, org.org_id) =
                                               pa.pa_org)
                               AND pt.npt_include_pdfo_rpt = 'T'
                      GROUP BY c.pc_sc
                      UNION ALL
                        SELECT c.pc_sc, 0 S_NAR   -- сума нарахуванн€ у м≥с€ц≥
                                               , SUM (sd.prsd_sum) S_DOX
                          FROM uss_esr.payroll pr
                               INNER JOIN uss_esr.pr_sheet s
                                   ON s.prs_pr = pr.pr_id
                               INNER JOIN uss_esr.personalcase c
                                   ON c.pc_id = s.prs_pc
                               INNER JOIN uss_esr.pr_sheet_detail sd
                                   ON sd.prsd_prs = s.prs_id
                               INNER JOIN uss_ndi.v_ndi_payment_type pt
                                   ON pt.npt_id = sd.prsd_npt
                         WHERE     l_rep_date BETWEEN TRUNC (s.prs_pay_dt, 'mm')
                                                  AND LAST_DAY (s.prs_pay_dt)
                               AND s.prs_st IN ('KV1', 'KV2')
                               AND pr.pr_st IN ('F')
                               AND sd.prsd_tp IN ('PWI', 'RDN')
                               /*
                               AND EXISTS (SELECT 1 -- IC #97518
                                               FROM org,
                                                   uss_esr.pc_account pa
                                               WHERE pa.pa_id = sd.prsd_pa
                                                   AND pa.pa_org = org.org_id)
                               */
                               AND EXISTS
                                       (SELECT 1                  -- IC #97518
                                          FROM org
                                               INNER JOIN uss_esr.pc_account pa
                                                   ON pa.pa_id = sd.prsd_pa
                                               LEFT JOIN
                                               uss_ndi.v_ndi_decoding_config o
                                                   ON     o.nddc_code_dest =
                                                          org.org_id
                                                      AND o.nddc_tp = 'ORG_MIGR'
                                         WHERE NVL (o.nddc_code_src, org.org_id) =
                                               pa.pa_org)
                               AND pt.npt_include_pdfo_rpt = 'T'
                      GROUP BY c.pc_sc) t
            GROUP BY t.pc_sc;

        P_FILE := API$EXPORTS.GetFile (P_NNF_ID);
    END BUILD_TAX_1DF_DBF_REPORT;


    PROCEDURE BUILD_NRH_ESV_DBF_REPORT (                          -- IC #90138
                                        P_NNF_ID   IN     NUMBER,
                                        P_DT       IN     DATE,
                                        P_FILE        OUT BLOB)
    IS
        l_rep_date   DATE;
        l_min_zp     NUMBER;
        l_max_zp     NUMBER;
        l_org        NUMBER := tools.getcurrorg;
        l_org_to     NUMBER := tools.GetCurrOrgTo;
    BEGIN
        l_org := CASE WHEN l_org = 50001 THEN 50000 ELSE l_org END;
        l_rep_date := P_DT;

        IF l_rep_date IS NULL
        THEN
            raise_application_error (-20000,
                                     '¬вед≥ть дату в формат≥ DD.MM.YYYY');
        ELSE
            l_rep_date := TRUNC (l_rep_date, 'mm');
        END IF;

        SELECT   MAX (nmz_month_sum)
               / TO_NUMBER (TO_CHAR (LAST_DAY (l_rep_date), 'dd')),
                 MAX (nmz_month_sum * 15)
               / TO_NUMBER (TO_CHAR (LAST_DAY (l_rep_date), 'dd'))
          INTO l_min_zp,       -- м≥н≥мальна сума «ѕ за день в зв≥тному м≥с€ц≥
                         l_max_zp -- Ќа вс€ випадок закласти ≥ максимальну базу - 15*ћ≥н«ѕ. «агальна сума по допомогам не повинна перевищувати цю суму.
          FROM uss_ndi.v_ndi_min_zp
         WHERE TRUNC (l_rep_date) BETWEEN nmz_start_dt
                                      AND NVL (nmz_stop_dt,
                                               TO_DATE ('2999', 'yyyy'));

        DELETE FROM uss_esr.tmp_nrh_esv;

        INSERT INTO uss_esr.tmp_nrh_esv
            WITH
                dat
                AS
                    (    SELECT l_rep_date + LEVEL - 1     dt
                           FROM DUAL
                     CONNECT BY LEVEL <=
                                TO_CHAR (LAST_DAY (l_rep_date), 'dd')),
                org
                AS
                    (    SELECT org_id
                           FROM ikis_sys.v_opfu
                          WHERE l_org_to != 34
                     CONNECT BY PRIOR org_id = org_org
                     START WITH org_id = l_org
                     UNION ALL
                     SELECT org_id
                       FROM ikis_sys.v_opfu
                      WHERE l_org_to = 34 AND org_acc_org = l_org),
                nrh
                AS
                    (SELECT CASE
                                WHEN pt.npt_id = 37 THEN 20
                                WHEN pt.npt_id IN (1, 219) THEN 21
                                ELSE 0
                            END
                                npt_id,
                            COUNT (DISTINCT dat.dt)
                                OVER (
                                    PARTITION BY a.ac_pc,
                                                 CASE
                                                     WHEN pt.npt_id = 37
                                                     THEN
                                                         20
                                                     WHEN pt.npt_id IN
                                                              (1, 219)
                                                     THEN
                                                         21
                                                     ELSE
                                                         0
                                                 END)
                                cnt_dt,
                            ROW_NUMBER ()
                                OVER (PARTITION BY ad.acd_id ORDER BY NULL)
                                rn,
                            uss_esr.api$accrual.xsign (acd_op) * ad.acd_sum
                                acd_sum,
                            ad.acd_start_dt,
                            ad.acd_stop_dt,
                            c.pc_sc
                       FROM uss_esr.accrual  a
                            INNER JOIN uss_esr.personalcase c
                                ON c.pc_id = a.ac_pc
                            INNER JOIN uss_esr.ac_detail ad
                                ON ad.acd_ac = a.ac_id
                            INNER JOIN uss_ndi.v_ndi_op op
                                ON op.op_id = ad.acd_op
                            INNER JOIN dat
                                ON dat.dt BETWEEN ad.acd_start_dt
                                              AND ad.acd_stop_dt
                            INNER JOIN uss_ndi.v_ndi_payment_type pt
                                ON pt.npt_id = ad.acd_npt
                      WHERE     (   ad.acd_op IN (1, 2, 3)
                                 OR op.op_tp1 IN ('NR'))
                            AND ad.history_status = 'A'
                            AND pt.npt_include_esv_rpt = 'T'
                            AND ad.acd_imp_pr_num IS NULL -- Tania, 12:43 виключати з сум зв≥ту т≥, де заповнено ACD_IMP_PR_NUM (таблиц€ ac_detail)
                            /*
                            AND EXISTS (SELECT 1 -- IC #97518
                                             FROM org,
                                                 uss_esr.pc_account pa,
                                                 uss_ndi.v_ndi_npt_config nc
                                             WHERE pa.pa_pc = c.pc_id
                                                 AND pa.pa_nst = nc.nptc_nst
                                                 AND nc.nptc_npt = pt.npt_id
                                                 AND pa.pa_org = org.org_id)
                            */
                            AND EXISTS
                                    (SELECT 1                     -- IC #97518
                                       FROM org
                                            INNER JOIN uss_esr.pc_account pa
                                                ON pa.pa_pc = c.pc_id
                                            INNER JOIN
                                            uss_ndi.v_ndi_npt_config nc
                                                ON     nc.nptc_nst =
                                                       pa.pa_nst
                                                   AND nc.nptc_npt =
                                                       pt.npt_id
                                            LEFT JOIN
                                            uss_ndi.v_ndi_decoding_config o
                                                ON     o.nddc_code_dest =
                                                       org.org_id
                                                   AND o.nddc_tp = 'ORG_MIGR'
                                      WHERE NVL (o.nddc_code_src, org.org_id) =
                                            pa.pa_org)
                            -- ѕо допомоз≥ по ≥нвал≥дам потр≥бно брати лише тих ос≥б, по €ким Ї надбавка на догл€д (NPT_ID = 48), суму також лише по ц≥й надбавц≥.
                            AND pt.npt_id NOT IN
                                    (SELECT npt_id
                                       FROM uss_ndi.v_ndi_payment_codes  pc
                                            JOIN
                                            uss_ndi.v_ndi_payment_type pt
                                                ON (pt.npt_npc = pc.npc_id)
                                            JOIN uss_ndi.v_ndi_npt_config nc
                                                ON (nc.nptc_npt = pt.npt_id)
                                            JOIN
                                            uss_ndi.v_ndi_service_type st
                                                ON (st.nst_id = nc.nptc_nst)
                                      WHERE     pc.history_status = 'A'
                                            AND pt.history_status = 'A'
                                            AND st.history_status = 'A'
                                            AND pt.npt_id != 48
                                            AND st.nst_id = 248)
                            AND (   EXISTS
                                        (SELECT 1
                                           FROM uss_esr.pc_decision,
                                                uss_esr.pd_payment   pp,
                                                uss_esr.pd_accrual_period
                                                pdap,
                                                uss_esr.pd_features  pf
                                          WHERE     pd_id = ad.acd_pd
                                                AND pdp_pd = pd_id
                                                AND pdap_pd = pd_id
                                                AND pf.pde_pd = pd_id
                                                AND pp.history_status = 'A'
                                                AND pdap.history_status = 'A'
                                                AND pf.pde_nft IN (88, 89) -- в≥дпустка без збереженн€ «ѕ
                                                AND l_rep_date BETWEEN TRUNC (
                                                                           pdap_start_dt,
                                                                           'mm')
                                                                   AND pdap_stop_dt
                                                AND l_rep_date BETWEEN TRUNC (
                                                                           pdp_start_dt,
                                                                           'mm')
                                                                   AND pdp_stop_dt)
                                 OR pt.npt_id != 48) -- перев≥рка т≥льки по допомоз≥ по ≥нвал≥дам
                                                    )
              SELECT TO_CHAR (l_rep_date, 'mm')                     PERIOD_M -- числове значенн€ м≥с€ц€ (з параметр≥в)
                                                                            ,
                     TO_CHAR (l_rep_date, 'yyyy')                   PERIOD_Y -- числове значенн€ року (з параметр≥в)
                                                                            ,
                     1                                              UKR_GROMAD -- виводимо 1 дл€ вс≥х
                                                                              ,
                     (  SELECT d.scd_seria || d.scd_number
                          FROM uss_person.v_sc_document d,
                               USS_NDI.v_ndi_document_type dt
                         WHERE     scd_sc = nrh.pc_sc
                               AND d.scd_ndt = dt.ndt_id
                               AND dt.ndt_ndc IN (2, 13)
                               AND d.scd_st IN ('1', 'A')
                               AND d.scd_number IS NOT NULL
                      ORDER BY ndt_order NULLS LAST, ndt_id
                         FETCH FIRST ROW ONLY)                      NUMIDENT -- –Ќќ ѕѕ за€вника. якщо –Ќќ ѕѕ порожн≥й, тод≥ вносимо сер≥ю та є паспорту (без проб≥л≥в, 8 символ≥в) або ID-картку (9 символ≥в) або сер≥ю та є св≥доцтва про народженн€ (в залежност≥ того, €к≥ Ї документи по за€внику)
                                                                            ,
                     sci_ln                                         LN -- пр≥звище
                                                                      ,
                     sci_fn                                         NM -- ≥м'€
                                                                      ,
                     sci_mn                                         FTN -- по батьков≥
                                                                       ,
                     nrh.npt_id                                     ZO -- вар≥анти: 20 - по допомоз≥ по догл€ду за дитиною (NPT_ID = 37);21 - по догл€ду за д≥тьми-≥нвал≥дами (NPT_ID = 1, 219)
                                                                      ,
                     TO_CHAR (MIN (nrh.acd_start_dt), 'dd')         START_DT -- число з пол€ ACD_Start_DT (м≥н≥мальне, €кщо дек≥лька р€дк≥в по м≥с€цю)
                                                                            ,
                     TO_CHAR (MAX (nrh.acd_stop_dt), 'dd')          STOP_DT -- число з пол€ ACD_Stop_DT (максимальне, €кщо дек≥лька р€дк≥в по м≥с€цю)
                                                                           ,
                     0                                              PAY_TP -- заповнюЇмо вс≥м 0
                                                                          ,
                     TO_CHAR (MIN (nrh.acd_start_dt), 'mm')         PAY_MNTH -- номер м≥с€ц€ з пол€ ACD_Start_DT
                                                                            ,
                     TO_CHAR (MIN (nrh.acd_start_dt), 'yyyy')       PAY_YEAR -- р≥к з пол€ ACD_Start_DT
                                                                            -- IC #94638
                                                                            ,
                     LEAST (
                         GREATEST (SUM (nrh.acd_sum),
                                   ROUND (MIN (nrh.cnt_dt) * l_min_zp, 2)),
                         ROUND (MIN (nrh.cnt_dt) * l_max_zp, 2))    SUM_TOTAL -- нарахована сума за м≥с€ць
                                                                             ,
                     SUM (nrh.acd_sum)                              SUM_MAX -- нарахована сума за м≥с€ць
                                                                           ,
                     ROUND (SUM (nrh.acd_sum) * 0.22, 2)            SUM_INS -- нарахована сума за м≥с€ць * 0,22 (округленн€ до 2 знак≥в п≥сл€ коми)
                                                                           ,
                     NULL                                           OZN -- порожне значенн
                FROM nrh
                     LEFT JOIN uss_person.v_socialcard sc
                         ON sc.sc_id = nrh.pc_sc
                     LEFT JOIN uss_person.v_sc_change scc
                         ON scc.scc_sc = sc_id AND scc_id = sc_scc
                     LEFT JOIN uss_person.v_sc_identity ON sci_id = scc_sci
               WHERE nrh.rn = 1
            GROUP BY nrh.pc_sc,
                     sci_ln,
                     sci_fn,
                     sci_mn,
                     nrh.npt_id;

        UPDATE uss_esr.tmp_nrh_esv
           SET sum_max = sum_total, sum_ins = ROUND (sum_total * 0.22, 2)
         WHERE 1 = 1;

        P_FILE := API$EXPORTS.GetFile (P_NNF_ID);
    END BUILD_NRH_ESV_DBF_REPORT;

    PROCEDURE GET_DBF_REPORT (P_NNF_ID      IN     NUMBER,
                              P_IDS         IN     VARCHAR2,
                              P_DT          IN     DATE,
                              P_FILE           OUT BLOB,
                              P_FILE_NAME      OUT VARCHAR2)
    IS
        l_net_code   VARCHAR2 (10);
        l_filename   VARCHAR2 (50);
        l_org        NUMBER := tools.getcurrorg;
    --l_dt DATE;
    BEGIN
        SELECT CASE
                   WHEN t.nnf_naming_alg = 'CDT'
                   THEN
                       TO_CHAR (SYSDATE, 'YYYY_MM_DD_HH24_MI_SS') || '.DBF'
                   WHEN t.nnf_naming_alg = 'Fp'
                   THEN
                          'Fp'
                       || NVL (s.acs_adm_code, '141373')
                       || TO_CHAR (SYSDATE, 'DDMMYYYY')
                       || '.DBF'
                   WHEN t.nnf_naming_alg = 'Ff'                       --#74740
                   THEN
                          'Ff'
                       || s.acs_adm_code
                       || TO_CHAR (SYSDATE, 'DDMMYYYY')
                       || '.DBF'
                   WHEN t.nnf_naming_alg = 'Fu'                       --#74145
                   THEN
                          'Fu'
                       || s.acs_adm_code
                       || TO_CHAR (SYSDATE, 'DDMMYYYY')
                       || '.DBF'
                   WHEN t.nnf_naming_alg = 'JQ'                      -- #90202
                   THEN
                       'J0510408.DBF'
                   WHEN t.nnf_naming_alg = 'JJ'                      -- #90138
                   THEN
                       'J0510208.DBF'
               END,
               e.net_data_tp
          INTO l_filename, l_net_code
          FROM uss_ndi.v_ndi_net_files  t
               JOIN uss_ndi.v_ndi_export_type e ON (e.net_id = t.nnf_net)
               LEFT JOIN uss_ndi.v_ndi_acc_setup s ON (s.com_org = l_org)
         WHERE t.nnf_id = P_NNF_ID;

        P_FILE_NAME := l_filename;

        IF (l_net_code IN ('CA_PDR'))
        THEN
            build_ca_pdr_report (p_nnf_id, P_IDS, P_FILE);
        ELSIF (l_net_code IN ('FIN_OBLIG'))
        THEN                                                          --#74740
            BUILD_FIN_OBL_DBF_REPORT (p_nnf_id, P_IDS, P_FILE);
        ELSIF (l_net_code IN ('LEG_OBLIG'))
        THEN                                                          --#74145
            BUILD_LEG_OBL_DBF_REPORT (p_nnf_id, P_IDS, P_FILE);
        ELSIF (l_net_code IN ('TAX_1DF'))
        THEN                                                          --#90202
            BUILD_TAX_1DF_DBF_REPORT (p_nnf_id, P_DT, P_FILE);
        ELSIF (l_net_code IN ('NRH_ESV'))
        THEN                                                          --#90138
            BUILD_NRH_ESV_DBF_REPORT (p_nnf_id, P_DT, P_FILE);
        END IF;
    END;

    -- info:   ≤н≥ц≥ал≥зац≥€ процесу п≥дготовки друкованоњ форми в≥домост≥
    -- params: p_pr_id - ≥дентиф≥катор в≥домост≥ на виплату
    -- note:   #70734, #71097
    PROCEDURE reg_payroll_report (p_pr_id IN NUMBER, p_jbr_id OUT DECIMAL)
    IS
        v_base_sql   VARCHAR2 (4000);
    BEGIN
        --≥дентиф≥кац≥€ процесу
        DBMS_APPLICATION_INFO.set_module (
            module_name   => $$PLSQL_UNIT || '.REG_PAYROLL_REPORT',
            action_name   => 'p_pr_id=' || TO_CHAR (p_pr_id));

        --#71102 наб≥р документ≥в €к≥ необх≥дно сформувати залежить в≥д типу виплати в в≥домост≥
        FOR pr_cur
            IN (SELECT p.pr_month,
                       p.pr_start_dt,
                       p.pr_stop_dt,
                       p.pr_start_day,
                       p.pr_stop_day,
                       p.pr_pay_tp,
                       p.pr_st,
                       pc.npc_name,
                       pc.npc_code,
                       p.com_org,
                       o.org_name,
                       o.org_code
                  FROM v_payroll  p
                       JOIN uss_ndi.v_ndi_payment_codes pc
                           ON pc.npc_id = p.pr_npc
                       JOIN v_opfu o ON o.org_id = p.com_org
                 WHERE pr_id = p_pr_id)
        LOOP
            IF pr_cur.pr_pay_tp = 'BANK'          --виплатна в≥дом≥сть на банк
            THEN
                --≥н≥ц≥ал≥зац≥€ завданн€ на п≥дготовку зв≥ту
                p_jbr_id :=
                    rdm$rtfl.initreport (get_rt_by_code ('PAYROLL_R1'));

                rdm$rtfl.addparam (p_jbr_id, 'org_name1', pr_cur.org_name);
                rdm$rtfl.addparam (p_jbr_id, 'inform_type', pr_cur.npc_name);
                rdm$rtfl.addparam (p_jbr_id,
                                   'inform_type1',
                                   UPPER (pr_cur.npc_name));
                rdm$rtfl.addparam (p_jbr_id,
                                   'inform_type_num',
                                   pr_cur.npc_code);
                rdm$rtfl.addparam (
                    p_jbr_id,
                    'supl_desc_dt',
                       UPPER (
                           TO_CHAR (pr_cur.pr_month,
                                    'MONTH',
                                    'NLS_DATE_LANGUAGE = UKRAINIAN'))
                    || ' '
                    || TO_CHAR (pr_cur.pr_month, 'YYYY'));

                rdm$rtfl.adddataset (
                    p_jbr_id,
                    'main_ds3',
                       q'[SELECT (CASE grp_lvl
         WHEN 0 THEN
          nb_name
         ELSE
          '–ј«ќћ:'
       END) AS c1,
       (CASE grp_lvl
         WHEN 0 THEN
          '1'
       END) AS c2,
       c3,
       c4
  FROM (SELECT prs_nb,
               TRIM(nb_mfo) || ' ' || TRIM(nb_name) AS nb_name,
               COUNT(DISTINCT(prs_pc)) AS c3,
               to_char(SUM(prs_sum), 'FM9G999G999G999G999G990D00', 'NLS_NUMERIC_CHARACTERS=''.''''') AS c4,
               (GROUPING(prs_nb) + GROUPING(TRIM(nb_mfo) || ' ' || TRIM(nb_name))) AS grp_lvl
          FROM uss_esr.v_pr_sheet
          JOIN uss_ndi.v_ndi_bank ON nb_id = prs_nb
         WHERE prs_pr = ]'
                    || p_pr_id
                    || q'[
           AND coalesce(prs_st, 'NULL') != 'PP'
           and prs_tp not in ('ABU', 'ADV', 'AUU')
         GROUP BY ROLLUP(TRIM(nb_mfo) || ' ' || TRIM(nb_name), prs_nb))
 WHERE grp_lvl IN (0, 1)
 ORDER BY nb_name, grp_lvl]');

                rdm$rtfl.adddataset (
                    p_jbr_id,
                    'total_ds3',
                       q'[SELECT COUNT(DISTINCT(prs_pc)) AS c1, to_char(SUM(prs_sum), 'FM9G999G999G999G999G990D00', 'NLS_NUMERIC_CHARACTERS=''.''''') AS c2
  FROM uss_esr.v_pr_sheet
  JOIN uss_ndi.v_ndi_bank ON nb_id = prs_nb
 WHERE prs_pr = ]'
                    || p_pr_id
                    || q'[
   AND coalesce(prs_st, 'NULL') != 'PP'
   and prs_tp not in ('ABU', 'ADV', 'AUU')]');

                rdm$rtfl.adddataset (
                    p_jbr_id,
                    'ds',
                       q'[SELECT pst.nb_id,
             coalesce((CASE WHEN TRIM(pst.bank_name) IS NOT NULL THEN TRIM(pst.bank_name) || '  од ф≥л≥њ ' || TRIM(pst.nb_mfo) END), '____________________________________________________________________') AS bank_name,
             coalesce((CASE WHEN TRIM(pst.bank_name) IS NOT NULL THEN 'в ' || TRIM(pst.bank_name) || '  од ф≥л≥њ ' || TRIM(pst.nb_mfo) END), '____________________________________________________________________') AS bank_name1,
             (CASE WHEN TRIM(pst.bank_name) IS NULL THEN ']'
                    || '(найменуванн€ уповноваженого банку)'
                    || q'[' END) AS bank_name_lbl,
             coalesce(TRIM(o.org_name), '________________________________________________________________________________
      ________________________________________________________________________________') AS org_name,
             (CASE WHEN TRIM(o.org_name) IS NULL THEN ']'
                    || '(найменуванн€ органу ѕенс≥йного фонду або органу соц≥ального захисту населенн€)'
                    || q'[' END) AS org_name_lbl,
             coalesce(TRIM(bp.nbg_sname), '________________________________________________________________') AS nbg_name,
             (CASE WHEN TRIM(bp.nbg_sname) IS NULL THEN ']'
                    || '(назва органу, що зд≥йснюЇ ф≥нансуванн€)'
                    || q'[' END) AS nbg_name_lbl,
             coalesce(to_char(p.pr_start_dt, 'DD.MM.YYYY'), '______________________________') AS start_dt,
             coalesce(to_char(p.pr_stop_dt, 'DD.MM.YYYY'), '____________________________________') AS stop_dt,
             coalesce(to_char(pst.pers_cnt), '___________') AS pers_cnt,
             coalesce((to_char(pst.tot_sum, 'FM9G999G999G999G999G990D00', 'NLS_NUMERIC_CHARACTERS=''.''''') || (CASE WHEN pst.tot_sum IS NOT NULL THEN ' ' || uss_esr.dnet$payment_reports.sum_in_words(pst.tot_sum, 'гривн€', 'гривн≥', 'гривень', 'коп.') END)), '____________') AS tot_sum,
             pst1.tot_lines AS total_lines, --дата виплати, к≥льк≥сть поточних рахунк≥в, загальна сума по ос.рахунках на обрану дату
             '1' AS list_num,
             ROW_NUMBER() OVER (ORDER BY pst.bank_name) AS rn
        FROM uss_esr.v_payroll p
        JOIN (SELECT b.nb_id,
                     b.nb_name AS bank_name,
                     b.nb_mfo,
                     COUNT(DISTINCT(ps.prs_pc)) AS pers_cnt,
                     SUM(ps.prs_sum) AS tot_sum,
                     --MAX(ps.prs_npt) AS prs_npt #85222
                     MAX((SELECT MAX(d.prsd_npt) FROM uss_esr.v_pr_sheet_detail d WHERE d.prsd_prs = ps.prs_id AND d.prsd_tp IN ('PWI', 'RDN'))) AS prs_npt
                FROM uss_esr.v_pr_sheet ps
                JOIN uss_ndi.v_ndi_bank b ON b.nb_id = ps.prs_nb
               WHERE ps.prs_pr = ]'
                    || p_pr_id
                    || q'[
                 AND coalesce(ps.prs_st, 'NULL') != 'PP'
                 and ps.prs_tp not in ('ABU', 'ADV', 'AUU')
              GROUP BY b.nb_id, b.nb_name, b.nb_mfo) pst ON 1 = 1
        JOIN (SELECT prs_nb, listagg(tot_lines, '\par ') within GROUP(ORDER BY tot_lines) AS tot_lines
                FROM (SELECT ps.prs_nb,
                             to_char(ps.prs_pay_dt, 'MM.YYYY') || ', ' || COUNT(DISTINCT(ps.prs_pc)) || ', ' ||
                             to_char(SUM(ps.prs_sum), 'FM9G999G999G999G999G990D00', 'NLS_NUMERIC_CHARACTERS=''.''''') AS tot_lines
                        FROM uss_esr.v_pr_sheet ps
                       WHERE ps.prs_pr = ]'
                    || p_pr_id
                    || q'[
                         AND coalesce(ps.prs_st, 'NULL') != 'PP'
                         and ps.prs_tp not in ('ABU', 'ADV', 'AUU')
                       GROUP BY ps.prs_nb, to_char(ps.prs_pay_dt, 'MM.YYYY'))
               GROUP BY prs_nb) pst1 ON pst1.prs_nb = pst.nb_id
        LEFT JOIN v_opfu o ON o.org_id = p.com_org
        LEFT JOIN uss_ndi.v_ndi_npt_config nc
                  JOIN uss_ndi.v_ndi_service_type st ON st.nst_id = nc.nptc_nst
                  JOIN uss_ndi.v_ndi_budget_program bp ON bp.nbg_id = st.nst_nbg ON nc.nptc_npt = pst.prs_npt
       WHERE p.pr_id = ]'
                    || p_pr_id);

                rdm$rtfl.adddataset (
                    p_jbr_id,
                    'main_ds1',
                       q'[SELECT c1 AS c1, --ƒата виплати
             TRIM(nb_mfo) AS c2, --Ќомер установи (ф≥л≥њ) банку
             1 AS c3, --Ќомер списку
             c4,
             c5
        FROM (SELECT ps.prs_nb,
                     to_char(prs_pay_dt, 'MM.YYYY') as c1,
                     COUNT(DISTINCT(ps.prs_pc)) AS c4, -- ≥льк≥сть одержувач≥в
                     to_char(SUM(ps.prs_sum), 'FM9G999G999G999G999G990D00', 'NLS_NUMERIC_CHARACTERS=''.''''') AS c5 --—ума, гривень
                FROM uss_esr.v_pr_sheet ps
               WHERE ps.prs_pr = ]'
                    || p_pr_id
                    || q'[
                 AND coalesce(ps.prs_st, 'NULL') != 'PP'
                 and prs_tp not in ('ABU', 'ADV', 'AUU')
               GROUP BY ps.prs_nb, to_char(prs_pay_dt, 'MM.YYYY'))
        JOIN uss_ndi.v_ndi_bank ON nb_id = prs_nb
       WHERE 1 = 1]');

                rdm$rtfl.addrelation (p_jbr_id,
                                      'ds',
                                      'nb_id',
                                      'main_ds1',
                                      'prs_nb');

                rdm$rtfl.adddataset (
                    p_jbr_id,
                    'main_ds',
                       q'[SELECT c1, --ƒата виплати
       row_number() over(ORDER BY c1_ord, c4) AS c2, --є п/п
       c3, --Ќомер поточного рахунку
       c4, --ѕр≥звище ≥мТ€ та по батьков≥
       c5, --—ума
       c6, --Ќомер ≈ќ—
       c7, --–Ќќ ѕѕ
       NULL AS c8, --ѕозначка про перебуванн€ на обл≥ку внутр≥шньо перем≥щених ос≥б
       NULL AS c9 --ѕричина незарахуванн€
  FROM (SELECT ps.prs_nb,
               to_char(ps.prs_pay_dt, 'MM.YYYY') AS c1, --ƒата виплати
               to_char(ps.prs_pay_dt, 'YYYYMMDD') AS c1_ord, --ƒата виплати дл€ сортуванн€
               ps.prs_account AS c3, --Ќомер поточного рахунку
               ps.prs_ln || ' ' || ps.prs_fn || ' ' || ps.prs_mn AS c4, --ѕр≥звище ≥мТ€ та по батьков≥
               to_char(SUM(ps.prs_sum), 'FM9G999G999G999G999G990D00', 'NLS_NUMERIC_CHARACTERS=''.''''') AS c5, --—ума
               ps.prs_pc_num AS c6, --Ќомер ≈ќ—
               ps.prs_inn AS c7 --–Ќќ ѕѕ
          FROM uss_esr.v_pr_sheet ps
         WHERE ps.prs_pr = ]'
                    || p_pr_id
                    || q'[
           AND coalesce(ps.prs_st, 'NULL') != 'PP'
           and prs_tp not in ('ABU', 'ADV', 'AUU')
         GROUP BY ps.prs_nb, ps.prs_pay_dt, ps.prs_account, ps.prs_ln || ' ' || ps.prs_fn || ' ' || ps.prs_mn, ps.prs_pc_num, ps.prs_inn)
 WHERE 1 = 1]');

                rdm$rtfl.addrelation (p_jbr_id,
                                      'ds',
                                      'nb_id',
                                      'main_ds',
                                      'prs_nb');

                rdm$rtfl.adddataset (
                    p_jbr_id,
                    'main_ds2',
                       q'[SELECT c1, --ƒата виплати
       row_number() over(ORDER BY c1, c3) AS c2, --є п/п
       c3, --Ќомер поточного рахунку
       c4, --ѕр≥звище ≥мТ€ та по батьков≥
       c5, --—ума
       c6, --Ќомер ≈ќ—
       c7, --–Ќќ ѕѕ
       NULL AS c8, --ѕозначка про перебуванн€ на обл≥ку внутр≥шньо перем≥щених ос≥б
       NULL AS c9 --ѕричина незарахуванн€
  FROM (SELECT ps.prs_nb,
               to_char(ps.prs_pay_dt, 'DD.MM.YYYY') AS c1, --ƒата виплати
               ps.prs_account AS c3, --Ќомер поточного рахунку
               ps.prs_ln || ' ' || ps.prs_fn || ' ' || ps.prs_mn AS c4, --ѕр≥звище ≥мТ€ та по батьков≥
               to_char(SUM(ps.prs_sum), 'FM9G999G999G999G999G990D00', 'NLS_NUMERIC_CHARACTERS=''.''''') AS c5, --—ума
               ps.prs_pc_num AS c6, --Ќомер ≈ќ—
               ps.prs_inn AS c7 --–Ќќ ѕѕ
          FROM uss_esr.v_pr_sheet ps
         WHERE ps.prs_pr = ]'
                    || p_pr_id
                    || q'[
           AND coalesce(ps.prs_st, 'NULL') != 'PP'
           and prs_tp not in ('ABU', 'ADV', 'AUU')
         GROUP BY ps.prs_nb, ps.prs_pay_dt, ps.prs_account, ps.prs_ln || ' ' || ps.prs_fn || ' ' || ps.prs_mn, ps.prs_pc_num, ps.prs_inn)
 WHERE 1 = 1]');

                rdm$rtfl.addrelation (p_jbr_id,
                                      'ds',
                                      'nb_id',
                                      'main_ds2',
                                      'prs_nb');
            ELSIF pr_cur.pr_pay_tp = 'POST'      --виплатна в≥дом≥сть на пошту
            THEN
                --≥н≥ц≥ал≥зац≥€ завданн€ на п≥дготовку зв≥ту
                p_jbr_id :=
                    rdm$rtfl.initreport (get_rt_by_code ('POST_PAYROLL_R1'));

                rdm$rtfl.addparam (
                    p_jbr_id,
                    'period_start',
                    TRIM (
                           TO_CHAR (pr_cur.pr_start_day)
                        || ' '
                        || get_month_name (pr_cur.pr_start_dt)));
                rdm$rtfl.addparam (
                    p_jbr_id,
                    'period_stop',
                    TRIM (
                           TO_CHAR (pr_cur.pr_stop_day)
                        || ' '
                        || get_month_name (pr_cur.pr_stop_dt)));
                rdm$rtfl.addparam (
                    p_jbr_id,
                    'period_year',
                    COALESCE (TO_CHAR (pr_cur.pr_month, 'YY'), '__'));
                rdm$rtfl.addparam (
                    p_jbr_id,
                    'org_name',
                    COALESCE (
                        pr_cur.org_name,
                        '____________________________________________________________'));
                rdm$rtfl.addparam (p_jbr_id, 'org_name1', pr_cur.org_name);
                rdm$rtfl.addparam (p_jbr_id, 'org_code', pr_cur.org_code);
                rdm$rtfl.addparam (p_jbr_id, 'inform_type', pr_cur.npc_name);
                rdm$rtfl.addparam (p_jbr_id,
                                   'inform_type1',
                                   UPPER (pr_cur.npc_name));
                rdm$rtfl.addparam (p_jbr_id,
                                   'inform_type_num',
                                   pr_cur.npc_code);
                rdm$rtfl.addparam (
                    p_jbr_id,
                    'supl_desc_dt',
                       UPPER (
                           TO_CHAR (pr_cur.pr_month,
                                    'MONTH',
                                    'NLS_DATE_LANGUAGE = UKRAINIAN'))
                    || ' '
                    || TO_CHAR (pr_cur.pr_month, 'YYYY'));
                rdm$rtfl.addparam (
                    p_jbr_id,
                    'fnl_stmnt_dt',
                       UPPER (
                           TO_CHAR (pr_cur.pr_month,
                                    'MONTH',
                                    'NLS_DATE_LANGUAGE = UKRAINIAN'))
                    || ' ћ≤—я÷№ '
                    || TO_CHAR (pr_cur.pr_month, 'YYYY')
                    || ' –≤ ');

                v_base_sql :=
                       q'[FROM uss_esr.v_pr_sheet s
          JOIN uss_ndi.v_ndi_post_office po ON po.npo_index = s.prs_index
                                           AND po.history_status = 'A'
                                           /*AND po.npo_kaot = nvl(s.prs_kaot, po.npo_kaot)*/
                                           /*AND po.npo_org = ]'
                    || pr_cur.com_org
                    || q'[*/
          left JOIN uss_ndi.v_ndi_comm_node cn ON cn.ncn_id = po.npo_ncn
                                         AND cn.history_status = 'A'
                                         AND substr(to_char(coalesce(cn.ncn_org, ]'
                    || TO_CHAR (pr_cur.com_org)
                    || ')), 1, 3) = substr(to_char('
                    || TO_CHAR (pr_cur.com_org)
                    || '), 1, 3)
         WHERE s.prs_pr = '
                    || p_pr_id
                    || q'[
           AND coalesce(s.prs_st, 'NULL') != 'PP'
           and prs_tp not in ('ABU', 'ADV', 'AUU')]';

                --#71180 cтор≥нки супров≥дного опису формуютьс€ по ndi_comm_node, групуванн€ по ncn_id, в одному зв≥т≥ може бути дек≥лька супров≥дних опис≥в
                rdm$rtfl.adddataset (
                    p_jbr_id,
                    'group_ds',
                       q'[SELECT po.npo_id,
       (']'
                    || TO_CHAR (p_pr_id)
                    || '/'
                    || q'[' || MAX(po.npo_index)) AS accomp_desc_num,
       null AS post_name,
       (to_char(SUM(s.prs_sum), 'FM9G999G999G999G999G990D00', 'NLS_NUMERIC_CHARACTERS=''.''''') || ' ' || uss_esr.dnet$payment_reports.sum_in_words(SUM(s.prs_sum), 'гривн€', 'гривн≥', 'гривень', 'коп.')) AS total_sum
       ]'
                    || v_base_sql
                    || '
       GROUP BY po.npo_id');

                /*rdm$rtfl.adddataset(p_jbr_id, 'group_ds', q'[SELECT cn.ncn_id,
                  (']' || to_char(p_pr_id) || '/' || q'[' || MAX(cn.ncn_code)) AS accomp_desc_num,
                  coalesce(MAX(TRIM(cn.ncn_name)), '________________________________________________________________') AS post_name,
                  (to_char(SUM(s.prs_sum), 'FM9G999G999G999G999G990D00', 'NLS_NUMERIC_CHARACTERS=''.''''') || ' ' || uss_esr.dnet$payment_reports.sum_in_words(SUM(s.prs_sum), 'гривн€', 'гривн≥', 'гривень', 'коп.')) AS total_sum
                  ]' || v_base_sql || '
                  GROUP BY cn.ncn_id');*/

                rdm$rtfl.adddataset (
                    p_jbr_id,
                    'main_ds1',
                       q'[SELECT (CASE grp_lvl
         WHEN 0 THEN
          to_char(row_number() over(ORDER BY grp_lvl, prs_index))
         ELSE
          '”сього'
       END) AS c1, --ѕор€дковий номер
       prs_index AS c2, --Ќайменуванн€ виплатного обТЇкта
       (CASE grp_lvl
         WHEN 0 THEN
           prs_cnt
         ELSE
           SUM(CASE grp_lvl WHEN 0 THEN prs_cnt ELSE 0 END) OVER ()
       END) AS c3, -- ≥льк≥сть в≥домостей
       inn_cnt AS c4, -- ≥льк≥сть одержувач≥в
       to_char(tot_sum, 'FM9G999G999G999G999G990D00', 'NLS_NUMERIC_CHARACTERS=''.''''') AS c5, --—ума пенс≥й, грошовоњ допомоги за в≥домост€ми
       NULL AS c5 --ѕрим≥тка
  FROM (SELECT po.npo_id as npo_child,
               s.prs_index,
               MAX(s.prs_num) AS prs_cnt,
               COUNT(DISTINCT(s.prs_pc)) AS inn_cnt,
               SUM(s.prs_sum) AS tot_sum,
               GROUPING(po.npo_id) + GROUPING(s.prs_index) AS grp_lvl
          ]'
                    || v_base_sql
                    || '
         GROUP BY ROLLUP(po.npo_id, s.prs_index))
 WHERE grp_lvl IN (0, 1)');
                --rdm$rtfl.addrelation(p_jbr_id, 'group_ds', 'ncn_id', 'main_ds1', 'npo_ncn');
                rdm$rtfl.addrelation (p_jbr_id,
                                      'group_ds',
                                      'npo_id',
                                      'main_ds1',
                                      'npo_child');

                -- #73809 Ђ—упров≥дний описї 2 екземпл€ра по кажному поштамту, вузлу (центру) поштового зв'€зку
                rdm$rtfl.adddataset (p_jbr_id,
                                     'group_ds3',
                                     'SELECT 1
  FROM (SELECT DISTINCT po.npo_id as npo_child
          ' || v_base_sql || '
        UNION ALL
        SELECT DISTINCT po.npo_id as npo_child
          ' || v_base_sql || ')
  WHERE 1 = 1');
                --rdm$rtfl.addrelation(p_jbr_id, 'group_ds', 'npo_id', 'group_ds3', 'npo_ncn');
                rdm$rtfl.addrelation (p_jbr_id,
                                      'group_ds',
                                      'npo_id',
                                      'group_ds3',
                                      'npo_child');

                --#71269 —”ѕ–ќ¬IƒЌј  ¬IƒќћI—“№
                rdm$rtfl.adddataset (
                    p_jbr_id,
                    'main_ds4',
                       q'[SELECT prs_index AS c1, c2, c3, c4, row_number() over(ORDER BY prs_index) AS sd_rn
  FROM (SELECT po.npo_id as npo_child,
               s.prs_index,
               (MIN(s.prs_num) || ' - ' || MAX(s.prs_num)) AS c2,
               COUNT(DISTINCT(s.prs_pc)) AS c3,
               to_char(SUM(s.prs_sum), 'FM9G999G999G999G999G990D00', 'NLS_NUMERIC_CHARACTERS=''.''''') AS c4
          ]'
                    || v_base_sql
                    || '
         GROUP BY po.npo_id, s.prs_index)
         WHERE 1 = 1');
                --rdm$rtfl.addrelation(p_jbr_id, 'group_ds', 'ncn_id', 'main_ds4', 'npo_ncn');
                rdm$rtfl.addrelation (p_jbr_id,
                                      'group_ds',
                                      'npo_id',
                                      'main_ds4',
                                      'npo_child');

                rdm$rtfl.adddataset (
                    p_jbr_id,
                    'total_ds4',
                       q'[SELECT SUM(c1) AS c1, SUM(c2) AS c2, to_char(SUM(c3), 'FM9G999G999G999G999G990D00', 'NLS_NUMERIC_CHARACTERS=''.''''')  AS c3
  FROM (SELECT po.npo_id as npo_child, s.prs_index, MAX(s.prs_num) c1, COUNT(DISTINCT(s.prs_pc)) AS c2, SUM(s.prs_sum) AS c3
          ]'
                    || v_base_sql
                    || '
         GROUP BY po.npo_id, s.prs_index)
         WHERE 1 = 1');
                --rdm$rtfl.addrelation(p_jbr_id, 'group_ds', 'ncn_id', 'total_ds4', 'npo_ncn');
                rdm$rtfl.addrelation (p_jbr_id,
                                      'group_ds',
                                      'npo_id',
                                      'total_ds4',
                                      'npo_child');

                --#71181 реЇстр≥в будуЇтьс€ ст≥льки, ск≥льки ун≥кальних prs_index в в≥домост≥
                rdm$rtfl.adddataset (
                    p_jbr_id,
                    'group_ds1',
                       q'[SELECT npo_index, (npo_index) AS post_info, row_number() over(ORDER BY npo_index)
  FROM (SELECT DISTINCT po.npo_id as npo_child, s.prs_index AS npo_index
          ]'
                    || v_base_sql
                    || ')
 WHERE 1 = 1');
                --rdm$rtfl.addrelation(p_jbr_id, 'group_ds', 'ncn_id', 'group_ds1', 'npo_ncn');
                rdm$rtfl.addrelation (p_jbr_id,
                                      'group_ds',
                                      'npo_id',
                                      'group_ds1',
                                      'npo_child');

                rdm$rtfl.adddataset (
                    p_jbr_id,
                    'main_ds2',
                       q'[SELECT (CASE grp_lvl
         WHEN 0 THEN
          to_char(prs_pay_dt, 'DD.MM.YYYY')
         ELSE
          '”сього'
       END) AS c1, --ƒата виплати
       prs_num AS c2, --Ќомер в≥домост≥
       inn_cnt AS c3, -- ≥льк≥сть одержувач≥в
       to_char(tot_sum, 'FM9G999G999G999G999G990D00', 'NLS_NUMERIC_CHARACTERS=''.''''') AS c4, --«агальна сума до виплати
       NULL AS c5, --ѕрим≥тки
       row_number() over(ORDER BY grp_lvl, prs_num, prs_pay_dt) AS rn
  FROM (SELECT s.prs_index,
               s.prs_pay_dt,
               s.prs_num,
               COUNT(DISTINCT(s.prs_pc)) AS inn_cnt,
               SUM(s.prs_sum) AS tot_sum,
               GROUPING(s.prs_index) + GROUPING(s.prs_pay_dt) + GROUPING(s.prs_num) AS grp_lvl
          FROM uss_esr.v_pr_sheet s
         WHERE s.prs_pr = ]'
                    || p_pr_id
                    || q'[
           AND coalesce(s.prs_st, 'NULL') != 'PP'
           and prs_tp not in ('ABU', 'ADV', 'AUU')
         GROUP BY ROLLUP(s.prs_index, s.prs_pay_dt, s.prs_num))
 WHERE grp_lvl IN (0, 2)]');
                rdm$rtfl.addrelation (p_jbr_id,
                                      'group_ds1',
                                      'npo_index',
                                      'main_ds2',
                                      'prs_index');

                --#71516 ѕ≥дсумкова в≥дом≥сть ≥ «в≥т (8 тип в≥домост≥) будуютьс€ ст≥льки, ск≥льки ун≥кальних prs_index в в≥домост≥
                rdm$rtfl.adddataset (
                    p_jbr_id,
                    'main_ds5',
                       q'[SELECT row_number() over(ORDER BY prs_cnt, inn_cnt, tot_sum) AS c1,
       ']'
                    || TO_CHAR (pr_cur.pr_start_day)
                    || '-'
                    || TO_CHAR (pr_cur.pr_stop_day)
                    || q'[' AS c2,
       prs_cnt AS c3,
       inn_cnt AS c4,
       to_char(tot_sum, 'FM9G999G999G999G999G990D00', 'NLS_NUMERIC_CHARACTERS=''.''''') AS c5
  FROM (SELECT s.prs_index,
               MAX(s.prs_num) AS prs_cnt,
               COUNT(DISTINCT(s.prs_pc)) AS inn_cnt,
               SUM(s.prs_sum) AS tot_sum
          FROM uss_esr.v_pr_sheet s
         WHERE s.prs_pr = ]'
                    || p_pr_id
                    || q'[
          /* AND 'C' = ']'
                    || pr_cur.pr_st
                    || q'['*/
           AND coalesce(s.prs_st, 'NULL') != 'PP'
           and prs_tp not in ('ABU', 'ADV', 'AUU')
         GROUP BY s.prs_index)
 WHERE 1 = 1]');
                rdm$rtfl.addrelation (p_jbr_id,
                                      'group_ds1',
                                      'npo_index',
                                      'main_ds5',
                                      'prs_index');

                rdm$rtfl.adddataset (
                    p_jbr_id,
                    'total_ds5',
                       q'[SELECT MAX(prs_num) AS c1,
       COUNT(DISTINCT(prs_pc)) AS c2,
       to_char(SUM(prs_sum), 'FM9G999G999G999G999G990D00', 'NLS_NUMERIC_CHARACTERS=''.''''') AS c3
  FROM (SELECT s.prs_index, s.prs_num, s.prs_inn, s.prs_sum, prs_pc
          FROM uss_esr.v_pr_sheet s
         WHERE s.prs_pr = ]'
                    || p_pr_id
                    || q'[
           /*AND 'C' = ']'
                    || pr_cur.pr_st
                    || q'['*/
           AND coalesce(s.prs_st, 'NULL') != 'PP'
           and prs_tp not in ('ABU', 'ADV', 'AUU'))
 WHERE 1 = 1]');
                rdm$rtfl.addrelation (p_jbr_id,
                                      'group_ds1',
                                      'npo_index',
                                      'total_ds5',
                                      'prs_index');

                rdm$rtfl.adddataset (
                    p_jbr_id,
                    'total_ds6',
                       q'[SELECT COUNT(DISTINCT(prs_inn)) AS c1,
       regexp_substr(to_char(SUM(prs_sum), 'FM9G999G999G999G999G990D00', 'NLS_NUMERIC_CHARACTERS=''.'''''), '[^.]*') AS c2,
       REPLACE(to_char(SUM(prs_sum), 'FM9G999G999G999G999G990D00', 'NLS_NUMERIC_CHARACTERS=''.'''''),
               regexp_substr(to_char(SUM(prs_sum), 'FM9G999G999G999G999G990D00', 'NLS_NUMERIC_CHARACTERS=''.'''''), '[^.]*') || '.') AS c3,
       NULL AS c4,
       NULL AS c5,
       NULL AS c6,
       NULL AS c7,
       NULL AS c8,
       NULL AS c9,
       NULL AS c10
  FROM (SELECT s.prs_index, s.prs_inn, s.prs_sum
          FROM uss_esr.v_pr_sheet s
         WHERE s.prs_pr = ]'
                    || p_pr_id
                    || q'[
          /* AND 'C' = ']'
                    || pr_cur.pr_st
                    || q'['*/
           AND coalesce(s.prs_st, 'NULL') != 'PP'
           and prs_tp not in ('ABU', 'ADV', 'AUU'))
 WHERE 1 = 1]');
                rdm$rtfl.addrelation (p_jbr_id,
                                      'group_ds1',
                                      'npo_index',
                                      'total_ds6',
                                      'prs_index');

                --#71183 в≥дом≥сть будуЇтьс€ по ун≥кальним prs_num в в≥домост≥ - тобто повинно бути ст≥льки екземпл€р≥в форми, ск≥льки ун≥кальних prs_num
                rdm$rtfl.adddataset (
                    p_jbr_id,
                    'group_ds2',
                       q'[SELECT prs_grp_key,
       prs_num AS desc_num,
       (lower(to_char(prs_pay_dt, 'MONTH', 'NLS_DATE_LANGUAGE = UKRAINIAN')) || ' ' || to_char(prs_pay_dt, 'YYYY')) AS desc_date,
       to_char(prs_pay_dt, 'DD.MM.YYYY') AS desc_pay_date,
       prs_index AS del_station_info,
       nd_code as dd_info,
       tot_acc_cnt,
       (to_char(tot_sum, 'FM9G999G999G999G999G990D00', 'NLS_NUMERIC_CHARACTERS=''.''''') || ' ' || uss_esr.dnet$payment_reports.sum_in_words(tot_sum, 'гривн€', 'гривн≥', 'гривень', 'коп.')) AS tot_sum_to_pay,
       row_number() over(ORDER BY rnk) AS rn
  FROM (SELECT DISTINCT s.prs_index || '/' || s.prs_num || '/' || to_char(s.prs_pay_dt, 'DDMMYYYY') || '/' || dl.nd_code AS prs_grp_key,
                        s.prs_num,
                        s.prs_pay_dt,
                        s.prs_index,
                        dl.nd_code,
                        COUNT(DISTINCT(s.prs_pc)) over(PARTITION BY s.prs_index || '/' || s.prs_num || '/' || to_char(s.prs_pay_dt, 'DDMMYYYY') || '/' || dl.nd_code) AS tot_acc_cnt,
                        SUM(s.prs_sum) over(PARTITION BY s.prs_index || '/' || s.prs_num || '/' || to_char(s.prs_pay_dt, 'DDMMYYYY') || '/' || dl.nd_code) AS tot_sum,
                        rank() over(ORDER BY s.prs_index, s.prs_num, to_char(s.prs_pay_dt, 'YYYYMMDD')) AS rnk
          FROM uss_esr.v_pr_sheet s
          left join uss_ndi.v_ndi_delivery dl on (dl.nd_id = s.prs_nd)
         WHERE s.prs_pr = ]'
                    || p_pr_id
                    || q'[
           AND coalesce(s.prs_st, 'NULL') != 'PP'
           and prs_tp not in ('ABU', 'ADV', 'AUU'))
 WHERE 1 = 1]');
                rdm$rtfl.addrelation (p_jbr_id,
                                      'group_ds1',
                                      'npo_index',
                                      'group_ds2',
                                      'prs_index');

                rdm$rtfl.adddataset (
                    p_jbr_id,
                    'main_ds3',
                       q'[SELECT prs_pc_num AS c1, --Ќомер особового рахунка одержувача
       (prs_ln || ' ' || prs_fn || ' ' || prs_mn) AS c2, --ѕр≥звище, власне ≥мТ€, по батьков≥ (за на€вност≥)
       prs_address AS c3, --ћ≥сце проживанн€
       to_char(prs_sum, 'FM9G999G999G999G999G990D00', 'NLS_NUMERIC_CHARACTERS=''.''''') AS c4, --—ума пенс≥њ, грошовоњ допомоги (цифрами)
       prs_doc_num AS c5, --ѕаспорт громад€нина ”крањни або документ, що посв≥дчуЇ особу (сер≥€, номер)
       to_char(prs_pay_dt, 'DD.MM.YYYY') AS c6, --ƒата виплати
       NULL AS c7, --ѕ≥дпис одержувача
       NULL AS c8, --ѕ≥дпис прац≥вника виплатного обТЇкта
       to_char(prs_sum, 'FM9G999G999G999G999G990D00', 'NLS_NUMERIC_CHARACTERS=''.''''') AS c9, --—ума пенс≥њ, грошовоњ допомоги (цифрами)
       prs_pc_num AS c10, --Ќомер особового рахунка одержувача
       NULL AS c11, --ѕрим≥тка
       row_number() over(ORDER BY(prs_ln || ' ' || prs_fn || ' ' || prs_mn), prs_pay_dt) AS trn
  FROM (SELECT s.prs_index || '/' || s.prs_num || '/' || to_char(s.prs_pay_dt, 'DDMMYYYY') || '/' || dl.nd_code AS prs_row_key,
               s.prs_pc_num,
               s.prs_ln,
               s.prs_fn,
               s.prs_mn,
               s.prs_address,
               s.prs_doc_num,
               s.prs_pay_dt,
               SUM(s.prs_sum) AS prs_sum
          FROM uss_esr.v_pr_sheet s
          left join uss_ndi.v_ndi_delivery dl on (dl.nd_id = s.prs_nd)
         WHERE s.prs_pr = ]'
                    || p_pr_id
                    || q'[
           AND coalesce(s.prs_st, 'NULL') != 'PP'
           and prs_tp not in ('ABU', 'ADV', 'AUU')
         GROUP BY s.prs_index || '/' || s.prs_num || '/' || to_char(s.prs_pay_dt, 'DDMMYYYY'),
                  s.prs_pc_num,
                  s.prs_ln,
                  s.prs_fn,
                  s.prs_mn,
                  s.prs_address,
                  s.prs_doc_num,
                  dl.nd_code,
                  s.prs_pay_dt)
 WHERE 1 = 1]');
                rdm$rtfl.addrelation (p_jbr_id,
                                      'group_ds2',
                                      'prs_grp_key',
                                      'main_ds3',
                                      'prs_row_key');
            END IF;
        END LOOP;


        RDM$RTFL.AddParam (p_jbr_id,
                           'c_main_pib_short',
                           tools.get_acc_setup_pib (0));
        RDM$RTFL.AddParam (p_jbr_id,
                           'c_main_buch_pib',
                           tools.get_acc_setup_pib (1));

        --позначенн€ зв≥ту €к готового до формуванн€ файлу ≥з данними
        IF p_jbr_id > 0
        THEN
            rdm$rtfl.putreporttoworkingqueue (p_jbr_id);
        END IF;
    END;

    -- info:   частина друкованоњ форми в≥домост≥ в CSV
    -- params: p_pr_id - ≥дентиф≥катор в≥домост≥ на виплату
    -- note:   #79643
    PROCEDURE reg_payroll_csv_report (p_pr_id    IN     NUMBER,
                                      p_rt_id    IN     NUMBER,
                                      p_jbr_id      OUT DECIMAL)
    IS
    BEGIN
        --≥дентиф≥кац≥€ процесу
        DBMS_APPLICATION_INFO.set_module (
            module_name   => $$PLSQL_UNIT || '.REG_PAYROLL_CSV_REPORT',
            action_name   => 'p_pr_id=' || TO_CHAR (p_pr_id));

        p_jbr_id := rdm$rtfl.InitReport (p_rt_id);

        rdm$rtfl.adddataset (
            p_jbr_id,
            'ds',
               q'[SELECT c1, --ƒата виплати
       row_number() over(ORDER BY c1, c3) AS c2, --є п/п
       c3, --Ќомер поточного рахунку
       c4, --ѕр≥звище ≥мТ€ та по батьков≥
       c5, --—ума
       c6, --Ќомер ≈ќ—
       c7, --–Ќќ ѕѕ
       c8, --- —татус
       c9, --- ƒата блокуванн€
       c10 -- є дов≥дки ¬ѕќ
  FROM (SELECT ps.prs_nb,
               to_char(ps.prs_pay_dt, 'DD.MM.YYYY') AS c1, --ƒата виплати
               ps.prs_account AS c3, --Ќомер поточного рахунку
               ps.prs_ln || ' ' || ps.prs_fn || ' ' || ps.prs_mn AS c4, --ѕр≥звище ≥мТ€ та по батьков≥
               to_char(SUM(ps.prs_sum), 'FM9999999999999990D00', 'NLS_NUMERIC_CHARACTERS='',''''') AS c5, --—ума
               ps.prs_pc_num AS c6, --Ќомер ≈ќ—
               ps.prs_inn AS c7, --–Ќќ ѕѕ
               st.dic_name as c8,
               to_char(ps.prs_transfer_dt, 'DD.MM.YYYY') as c9,
               uss_person.api$sc_tools.get_vpo_num(pc.pc_sc) as c10
          FROM uss_esr.v_pr_sheet ps
          left join uss_esr.v_personalcase pc on (pc.pc_id = ps.prs_pc)
          left join uss_ndi.v_ddn_prs_st st on (st.dic_value = ps.prs_st)
         WHERE ps.prs_pr = ]'
            || p_pr_id
            || q'[
           and prs_tp not in ('ABU', 'ADV', 'AUU')
           /*AND coalesce(ps.prs_st, 'NULL') != 'PP'*/
         GROUP BY pc.pc_sc, ps.prs_nb, ps.prs_pay_dt, ps.prs_account, ps.prs_ln || ' ' || ps.prs_fn || ' ' || ps.prs_mn, ps.prs_pc_num, ps.prs_inn, st.dic_name, ps.prs_transfer_dt, prs_pc)
 WHERE 1 = 1]');

        FOR xx
            IN (SELECT    'PAYROLL_'
                       || c.npc_code
                       || t.COM_ORG
                       || (SELECT MAX (zb.nb_mfo)
                             FROM pr_sheet  z
                                  JOIN uss_ndi.v_ndi_bank zb
                                      ON (zb.nb_id = z.prs_nb)
                            WHERE z.prs_pr = t.pr_id)
                       || '_'
                       || TO_CHAR (t.pr_month, 'YYYYMM')
                       || '.csv'    AS x_name
                  FROM payroll  t
                       LEFT JOIN uss_ndi.v_ndi_payment_codes c
                           ON (c.npc_id = t.PR_NPC)
                 WHERE pr_id = p_pr_id)
        LOOP
            RDM$RTFL.SetFileName (p_jbr_id, xx.x_name);
        END LOOP;

        --позначенн€ зв≥ту €к готового до формуванн€ файлу ≥з данними
        IF p_jbr_id > 0
        THEN
            rdm$rtfl.putreporttoworkingqueue (p_jbr_id);
        END IF;
    END;

    -- info:   ≤н≥ц≥ал≥зац≥€ процесу п≥дготовки друкованоњ форми списк≥в виплатноњ в≥домост≥
    -- params: p_rt_id - ≥дентиф≥катор шаблону зв≥ту
    --         p_pr_id - ≥дентиф≥катор в≥домост≥ на виплату
    -- note:   #75935
    FUNCTION accrual_r1 (p_rt_id    IN rpt_templates.rt_id%TYPE,
                         p_pr_id    IN payroll.pr_id%TYPE,
                         p_prs_tp   IN VARCHAR2)
        RETURN DECIMAL
    IS
        v_jbr_id     DECIMAL;
        v_curr_emp   VARCHAR2 (255);
    BEGIN
        --≥н≥ц≥ал≥зац≥€ завданн€ на п≥дготовку зв≥ту
        v_jbr_id := rdm$rtfl.initreport (p_rt_id);

        FOR pr_cur IN (SELECT p.com_org,
                              (SELECT o.org_name
                                 FROM v_opfu o
                                WHERE o.org_id = p.com_org)    AS org_name,
                              p.pr_pib_bookkeeper
                         FROM v_payroll p
                        WHERE pr_id = p_pr_id)
        LOOP
            rdm$rtfl.addparam (
                v_jbr_id,
                'org_name',
                COALESCE (
                    pr_cur.org_name,
                    '\fs24_______________________________________________________________
\fs20\qc(найменуванн€ органу ѕенс≥йного фонду ”крањни
\fs24________________________________________________________________________________
\fs20\qcабо структурного п≥дрозд≥лу з питань соц≥ального захисту населенн€)'));
            rdm$rtfl.addparam (v_jbr_id,
                               'mbookkeeper_spib',
                               pr_cur.pr_pib_bookkeeper);

            rdm$rtfl.adddataset (
                v_jbr_id,
                'group_ds',
                   q'[SELECT grp_key,
       post_name,
       row_number() over(ORDER BY post_name, supl_desc_dt, dpp_name) || '/' || prs_num as accomp_desc_num,
       supl_desc_dt,
       dpp_name,
       dpp_info,
       bank_name,
       bank_mfo,
       tot_sum,
       row_number() over(ORDER BY post_name, supl_desc_dt, dpp_name) AS grp_rn
  FROM (SELECT (s.prs_index || '/' || to_char(s.prs_pay_dt, 'DDMMYYYY') || '/' || COALESCE(to_char(s.prs_dpp), s.prs_ln || ' ' || s.prs_fn || ' ' || s.prs_mn)) AS grp_key,
               MAX(cn.ncn_name) AS post_name,
               MAX(s.prs_num) as prs_num,
               MAX(to_char(r.Pr_Create_Dt, 'DD.MM.YYYY')) AS supl_desc_dt,
               coalesce(MAX(pp.dpp_name), max(s.prs_ln || ' ' || s.prs_fn || ' ' || s.prs_mn)) AS dpp_name,
               case when max(dpp_id) is null then max (prs_address || (CASE
                     WHEN prs_address IS NOT NULL THEN
                      '; '
                   END) || prs_account)
                 else MAX(pp.dpp_address || (CASE
                     WHEN pp.dpp_address IS NOT NULL THEN
                      '; '
                   END) || ppa.dppa_account)
               end AS dpp_info,
               MAX(b.nb_name) AS bank_name,
               MAX(b.nb_mfo) AS bank_mfo,
               (to_char(SUM(d.prsd_sum), 'FM9G999G999G999G999G990D00', 'NLS_NUMERIC_CHARACTERS=''.''''') || ' ' ||
               uss_esr.dnet$payment_reports.sum_in_words(SUM(d.prsd_sum), 'гривн€', 'гривн≥', 'гривень', 'коп.')) AS tot_sum
          FROM uss_esr.v_pr_sheet s
          join uss_esr.v_payroll r on (r.pr_id = s.prs_pr)
          left JOIN uss_ndi.v_ndi_post_office po ON po.npo_index = s.prs_index
                                           AND po.history_status = 'A'
                                           AND coalesce(po.npo_kaot, s.prs_kaot, -1) = coalesce(s.prs_kaot, -1)
                                           AND coalesce(po.npo_org, ]'
                || TO_CHAR (pr_cur.com_org)
                || ') = '
                || TO_CHAR (pr_cur.com_org)
                || q'[
          left JOIN uss_ndi.v_ndi_comm_node cn ON cn.ncn_id = po.npo_ncn
                                         AND cn.history_status = 'A'
                                         AND substr(to_char(coalesce(cn.ncn_org, ]'
                || TO_CHAR (pr_cur.com_org)
                || q'[)), 1, 3) = substr(']'
                || TO_CHAR (pr_cur.com_org)
                || q'[', 1, 3)
          left JOIN uss_ndi.v_ndi_pay_person pp ON pp.dpp_id = s.prs_dpp
          left JOIN uss_ndi.v_ndi_pay_person_acc ppa ON ppa.dppa_dpp = s.prs_dpp
                                               AND ppa.history_status = 'A'
                                               AND ppa.dppa_is_main = 1
          left JOIN uss_ndi.v_ndi_bank b ON b.nb_id = coalesce(ppa.dppa_nb, prs_nb)
          left JOIN uss_esr.v_pr_sheet_detail d ON d.prsd_prs_dn = s.prs_id
                                          AND d.prsd_pr = ]'
                || TO_CHAR (p_pr_id)
                || '
                                          AND d.prsd_prs_dn IS NOT NULL
         WHERE s.prs_pr = '
                || TO_CHAR (p_pr_id)
                || q'[
           AND coalesce(s.prs_st, 'NULL') != 'PP'
           /*and prs_tp in ('AP', 'ABP', 'ABU', 'PMT', 'AUU')*/
           and prs_tp in (']'
                || p_prs_tp
                || q'[')
         GROUP BY s.prs_index || '/' || to_char(s.prs_pay_dt, 'DDMMYYYY') || '/' || COALESCE(to_char(s.prs_dpp), s.prs_ln || ' ' || s.prs_fn || ' ' || s.prs_mn))
 WHERE 1 = 1]');

            rdm$rtfl.adddataset (
                v_jbr_id,
                'main_ds',
                   q'[SELECT row_number() over(ORDER BY pib) AS c1, --ѕор€дковий номер
       pib AS c2, --ѕр≥звище, ≥мТ€ та по батьков≥
       pa_num AS c3, --Ќомер особового рахунка (пенс≥йного посв≥дченн€)
       to_char(tot_sum, 'FM9G999G999G999G999G990D00', 'NLS_NUMERIC_CHARACTERS=''.''''') AS c4 --—ума, що п≥дл€гаЇ перерахуванню
  FROM (SELECT (s.prs_index || '/' || to_char(s.prs_pay_dt, 'DDMMYYYY') || '/' || COALESCE(to_char(s.prs_dpp), s.prs_ln || ' ' || s.prs_fn || ' ' || s.prs_mn)) AS mds_key,
               uss_person.api$sc_tools.GET_PIB(pc.pc_sc) as pib,
               a.pa_num,
               SUM(d.prsd_sum) AS tot_sum
          FROM uss_esr.v_pr_sheet s
          JOIN uss_esr.v_pr_sheet_detail d ON d.prsd_prs_dn = s.prs_id
                                          AND d.prsd_pr = ]'
                || TO_CHAR (p_pr_id)
                || '
                                          AND d.prsd_prs_dn IS NOT NULL
          JOIN uss_esr.v_personalcase pc ON (pc.pc_id = d.prsd_pc)
          JOIN uss_esr.v_pc_account a ON a.pa_id = d.prsd_pa
         WHERE s.prs_pr = '
                || TO_CHAR (p_pr_id)
                || q'[
           AND coalesce(s.prs_st, 'NULL') != 'PP'
           /*and prs_tp in ('AP', 'ABP', 'ABU', 'PMT', 'AUU')*/
           and prs_tp in (']'
                || p_prs_tp
                || q'[')
         GROUP BY (s.prs_index || '/' || to_char(s.prs_pay_dt, 'DDMMYYYY') || '/' || COALESCE(to_char(s.prs_dpp), s.prs_ln || ' ' || s.prs_fn || ' ' || s.prs_mn)), uss_person.api$sc_tools.GET_PIB(pc.pc_sc), a.pa_num)
 WHERE 1 = 1]');
            rdm$rtfl.addrelation (v_jbr_id,
                                  'group_ds',
                                  'grp_key',
                                  'main_ds',
                                  'mds_key');
        END LOOP;

        rdm$rtfl.addparam (v_jbr_id, 'bank_code', NULL);
        rdm$rtfl.addparam (v_jbr_id, 'emp_pos_name', NULL);

        BEGIN
            v_curr_emp := tools.getcurruserpib;
        EXCEPTION
            WHEN OTHERS
            THEN
                NULL;
        END;

        --rdm$rtfl.addparam(v_jbr_id, 'emp_spib', v_curr_emp);
        rdm$rtfl.addparam (v_jbr_id, 'pay_order_dt', '____ __________ 20___');
        rdm$rtfl.addparam (v_jbr_id, 'pay_order_num', '_______');

        RDM$RTFL.AddParam (v_jbr_id,
                           'c_main_pib_short',
                           tools.get_acc_setup_pib (0));
        RDM$RTFL.AddParam (v_jbr_id,
                           'c_main_pos_name',
                           tools.get_acc_setup_pos (0));

        rdm$rtfl.putreporttoworkingqueue (v_jbr_id);

        RETURN v_jbr_id;
    END;

    FUNCTION suprovid_r1 (p_rt_id    IN rpt_templates.rt_id%TYPE,
                          p_pr_id    IN payroll.pr_id%TYPE,
                          p_prs_tp   IN VARCHAR2)
        RETURN DECIMAL
    IS
        l_jbr_id     DECIMAL;
        l_org_name   VARCHAR2 (300);
        l_month      VARCHAR2 (10);
        l_year       VARCHAR2 (4);
    BEGIN
        --≥н≥ц≥ал≥зац≥€ завданн€ на п≥дготовку зв≥ту
        l_jbr_id := rdm$rtfl.initreport (p_rt_id);

        rdm$rtfl.adddataset (
            l_jbr_id,
            'main_ds',
               'SELECT row_number() OVER (order BY 1) as c1,
              t.prs_num as c2,
              t.prs_fn as c3,
              to_char(SUM(d.prsd_sum), ''FM9G999G999G999G999G990D00'', ''NLS_NUMERIC_CHARACTERS='''','''''''''')  as c4,
              count(distinct d.prsd_pc) as c5,
              ceil((count(distinct d.prsd_pc) - 6) / 44) + 1 as c6
         FROM uss_esr.v_pr_sheet t
         JOIN uss_esr.v_pr_sheet_detail d ON (d.prsd_prs_dn = t.prs_id
                                               AND d.prsd_pr = t.prs_pr
                                               AND d.prsd_prs_dn IS NOT NULL)
         JOIN uss_esr.v_personalcase pc ON (pc.pc_id = d.prsd_pc)
        WHERE t.prs_pr = '
            || p_pr_id
            || '
          AND t.prs_tp = '''
            || p_prs_tp
            || '''
        GROUP BY prs_num, t.prs_fn, t.prs_id
        ');

        rdm$rtfl.adddataset (
            l_jbr_id,
            'total_ds',
               'select to_char(SUM(c4_tot), ''FM9G999G999G999G999G990D00'', ''NLS_NUMERIC_CHARACTERS='''','''''''''') as c4_tot,
              sum(c5_tot) as c5_tot,
              sum(c6_tot) as c6_tot
        from (SELECT prs_id,
                     SUM(d.prsd_sum)  as c4_tot,
                     count(distinct d.prsd_pc) as c5_tot,
                     ceil((count(distinct d.prsd_pc) - 6) / 44) + 1 as c6_tot
                FROM uss_esr.v_pr_sheet t
                JOIN uss_esr.v_pr_sheet_detail d ON (d.prsd_prs_dn = t.prs_id
                                                      AND d.prsd_pr = t.prs_pr
                                                      AND d.prsd_prs_dn IS NOT NULL)
                JOIN uss_esr.v_personalcase pc ON (pc.pc_id = d.prsd_pc)
               WHERE t.prs_pr = '
            || p_pr_id
            || '
                 AND t.prs_tp = '''
            || p_prs_tp
            || '''
               GROUP BY prs_id
              )
        ');

        SELECT com_org || ' ' || org_name
          INTO l_org_name
          FROM uss_esr.v_payroll JOIN v_opfu ON (org_id = com_org)
         WHERE pr_id = p_pr_id;

        rdm$rtfl.addparam (l_jbr_id, 'post_name', l_org_name);

        SELECT LOWER (
                   TO_CHAR (pr_start_dt,
                            'Month',
                            'NLS_DATE_LANGUAGE = ukrainian')),
               TO_CHAR (pr_start_dt, 'yyyy')
          INTO l_month, l_year
          FROM uss_esr.v_payroll
         WHERE pr_id = p_pr_id;

        rdm$rtfl.addparam (l_jbr_id,
                           'month_year_dt',
                           l_month || ' ' || l_year);

        RDM$RTFL.AddParam (l_jbr_id,
                           'c_main_buch_pib',
                           tools.get_acc_setup_pib (1));

        rdm$rtfl.putreporttoworkingqueue (l_jbr_id);
        RETURN l_jbr_id;
    END;

    FUNCTION DEPARTMENT_INFO_R1 (p_rt_id   IN rpt_templates.rt_id%TYPE,
                                 p_pr_id   IN payroll.pr_id%TYPE)
        RETURN DECIMAL
    IS
        l_jbr_id     DECIMAL;
        l_org_name   VARCHAR2 (300);
        l_month      VARCHAR2 (10);
        l_year       VARCHAR2 (4);
    BEGIN
        --≥н≥ц≥ал≥зац≥€ завданн€ на п≥дготовку зв≥ту
        l_jbr_id := rdm$rtfl.initreport (p_rt_id);

        rdm$rtfl.adddataset (
            l_jbr_id,
            'ds',
               'select c1,
               c2,
               c3,
               c4,
               c5,
               SUM(x_sign * prsd_sum) AS c6,
               c7
          from (
        SELECT s.nis_name AS c1,
                       uss_person.api$sc_tools.GET_PIB(pc.pc_sc) AS c2,
                       uss_person.api$sc_tools.get_numident(pc.pc_sc) AS c3,
                       pc.pc_num AS c4,
                       uss_person.api$sc_tools.get_vpo_num(pc.pc_sc) AS c5,
                       max(uss_esr.dnet$accrual.xsign(acd_op)) as x_sign,
                       sd.prsd_id,
                       sd.prsd_sum,
                       t.prs_account AS c7
                FROM uss_esr.v_pr_sheet t
                JOIN uss_esr.v_payroll p ON (p.pr_id = t.prs_pr)
                JOIN uss_esr.v_pr_sheet_detail sd ON (sd.prsd_prs = t.prs_id)
                JOIN uss_esr.v_ac_detail ad ON (ad.acd_prsd = sd.prsd_id)
                JOIN uss_esr.v_pc_decision d ON (d.pd_id = ad.acd_pd)
                left JOIN uss_ndi.v_ndi_nis_users nu ON (nu.nisu_wu = d.com_wu)
                left JOIN uss_ndi.v_ndi_site s ON (s.nis_id = nu.nisu_nis)
                left join uss_esr.v_personalcase pc on (pc.pc_id = t.prs_pc)
                WHERE prs_pr = '
            || p_pr_id
            || '
                  AND p.pr_pay_tp = ''BANK''
                GROUP BY s.nis_name, pc.pc_sc, pc.pc_num, prs_account, sd.prsd_id, sd.prsd_sum
                ) t
              GROUP BY c1, c2, c3, c4, c5, c7
         ');

        rdm$rtfl.putreporttoworkingqueue (l_jbr_id);
        RETURN l_jbr_id;
    END;

    FUNCTION DEPARTMENT_INFO_R2 (p_rt_id   IN rpt_templates.rt_id%TYPE,
                                 p_pr_id   IN payroll.pr_id%TYPE)
        RETURN DECIMAL
    IS
        l_jbr_id     DECIMAL;
        l_org_name   VARCHAR2 (300);
        l_month      VARCHAR2 (10);
        l_year       VARCHAR2 (4);
    BEGIN
        --≥н≥ц≥ал≥зац≥€ завданн€ на п≥дготовку зв≥ту
        l_jbr_id := rdm$rtfl.initreport (p_rt_id);

        rdm$rtfl.adddataset (
            l_jbr_id,
            'ds',
               'select c1,
               c2,
               c3,
               c4,
               c5,
               SUM(x_sign * prsd_sum) AS c6,
               c7,
               c8
          from (
        SELECT s.nis_name AS c1,
                       uss_person.api$sc_tools.GET_PIB(pc.pc_sc) AS c2,
                       uss_person.api$sc_tools.get_numident(pc.pc_sc) AS c3,
                       pc.pc_num AS c4,
                       uss_person.api$sc_tools.get_vpo_num(pc.pc_sc) AS c5,
                       max(uss_esr.dnet$accrual.xsign(acd_op)) as x_sign,
                       sd.prsd_id,
                       sd.prsd_sum,
                       t.prs_index AS c7,
                       nd.nd_comment AS c8
                FROM uss_esr.v_pr_sheet t
                JOIN uss_esr.v_payroll p ON (p.pr_id = t.prs_pr)
                JOIN uss_esr.v_pr_sheet_detail sd ON (sd.prsd_prs = t.prs_id)
                JOIN uss_esr.v_ac_detail ad ON (ad.acd_prsd = sd.prsd_id)
                JOIN uss_esr.v_pc_decision d ON (d.pd_id = ad.acd_pd)
                left JOIN uss_ndi.v_ndi_nis_users nu ON (nu.nisu_wu = d.com_wu)
                left JOIN uss_ndi.v_ndi_site s ON (s.nis_id = nu.nisu_nis)
                left join uss_esr.v_personalcase pc on (pc.pc_id = t.prs_pc)
                LEFT JOIN uss_ndi.v_ndi_delivery nd ON (nd.nd_id = t.prs_nd)
                --LEFT JOIN uss_ndi.v_ndi_post_office po ON (po.npo_id = nd.nd_npo)
                WHERE prs_pr = '
            || p_pr_id
            || '
                  AND p.pr_pay_tp = ''POST''
                GROUP BY s.nis_name, pc.pc_sc, pc.pc_num, prs_index, nd_comment, sd.prsd_id, sd.prsd_sum
                ) t
              GROUP BY c1, c2, c3, c4, c5, c7, c8
         ');

        rdm$rtfl.putreporttoworkingqueue (l_jbr_id);
        RETURN l_jbr_id;
    END;

    FUNCTION payroll_deduction_report (p_pr_id    IN NUMBER,
                                       p_rt_id    IN NUMBER,
                                       p_prs_tp      VARCHAR2)
        RETURN DECIMAL
    IS
        l_jbr_id     NUMBER;
        l_sql        VARCHAR2 (32000);
        l_org_name   VARCHAR2 (300);
        l_com_org    NUMBER;
        l_month      VARCHAR2 (10);
        l_year       VARCHAR2 (4);
    BEGIN
        l_jbr_id := rdm$rtfl.InitReport (p_rt_id);

        rdm$rtfl.adddataset (
            l_jbr_id,
            'main_ds',
               'SELECT row_number() OVER (order BY 1) as c1,
              a.pa_num as c2,
              uss_person.api$sc_tools.GET_PIB(pc.pc_sc) as c3,
             /* case when dpp_id is null then t.prs_index||'', ''|| t.prs_address
                       else pp.dpp_address
                     end*/
               uss_person.api$sc_tools.get_address(pc.pc_sc, 3) AS c4,
              to_char(SUM(d.prsd_sum), ''FM9G999G999G999G999G990D00'', ''NLS_NUMERIC_CHARACTERS='''','''''''''')  as c5,
              t.prs_fn as c6,
              ( SELECT t.prs_account||'' ''||nb_name||'' ''||nb_mfo||'' ''||pp.dpp_tax_code  --nb_edrpou
                  FROM uss_ndi.v_ndi_pay_person pp
                  left join uss_ndi.v_ndi_pay_person_acc ppa on (ppa.dppa_dpp = t.prs_dpp
                      AND ppa.history_status = ''A''
                      AND ppa.dppa_is_main = 1)
                  left JOIN uss_ndi.v_ndi_bank b ON (b.nb_id = coalesce(ppa.dppa_nb, t.prs_nb))
                 WHERE pp.dpp_id = t.prs_dpp
              ) AS c7
         FROM uss_esr.v_pr_sheet t
         JOIN uss_esr.v_pr_sheet_detail d ON (d.prsd_prs_dn = t.prs_id
                                               AND d.prsd_pr = t.prs_pr
                                               AND d.prsd_prs_dn IS NOT NULL)
         JOIN uss_esr.v_personalcase pc ON (pc.pc_id = d.prsd_pc)
         JOIN uss_esr.v_pc_account a ON (a.pa_id = d.prsd_pa)
        WHERE t.prs_pr = '
            || p_pr_id
            || '
          AND t.prs_tp = '''
            || p_prs_tp
            || '''
        GROUP BY a.pa_num, pc_sc, t.prs_fn, t.prs_nb, t.prs_dpp, t.prs_account
        ');

        SELECT com_org
          INTO l_com_org
          FROM uss_esr.v_payroll
         WHERE pr_id = p_pr_id;

        SELECT org_name
          INTO l_org_name
          FROM ikis_sys.OPFU
         WHERE org_id = l_com_org;

        rdm$rtfl.addparam (l_jbr_id,
                           'post_name',
                           l_com_org || ' ' || l_org_name);

        SELECT LOWER (
                   TO_CHAR (pr_start_dt,
                            'Month',
                            'NLS_DATE_LANGUAGE = ukrainian')),
               TO_CHAR (pr_start_dt, 'yyyy')
          INTO l_month, l_year
          FROM uss_esr.v_payroll
         WHERE pr_id = p_pr_id;

        rdm$rtfl.addparam (l_jbr_id,
                           'month_year_dt',
                           l_month || ' ' || l_year);

        rdm$rtfl.addparam (l_jbr_id, 'accomp_desc_num', p_pr_id);

        rdm$rtfl.putreporttoworkingqueue (l_jbr_id);

        RETURN l_jbr_id;
    END;

    -- info:   формуванн€ друкованих форм документ≥в дл€ картки в≥домост≥
    -- params: p_rt_id - ≥дентиф≥катор шаблону зв≥ту
    --         p_pr_id - ≥дентиф≥катор в≥домост≥ на виплату
    -- note:
    PROCEDURE reg_payroll_rpt (p_rt_id    IN     rpt_templates.rt_id%TYPE,
                               p_pr_id    IN     payroll.pr_id%TYPE,
                               p_jbr_id      OUT DECIMAL)
    IS
    BEGIN
        --≥дентиф≥кац≥€ процесу
        DBMS_APPLICATION_INFO.set_module (
            module_name   => $$PLSQL_UNIT || '.REG_PAYROLL_RPT',
            action_name   =>
                   'p_rt_id='
                || TO_CHAR (p_rt_id)
                || ';'
                || 'p_pr_id='
                || TO_CHAR (p_pr_id));

        CASE get_rt_code (p_rt_id)
            WHEN 'PAYROLL_R1'
            THEN
                reg_payroll_report (p_pr_id, p_jbr_id);
            WHEN 'PAYROLL_R2'
            THEN
                reg_payroll_csv_report (p_pr_id, p_rt_id, p_jbr_id);
            WHEN 'DEDUCTION_R1'
            THEN
                p_jbr_id :=
                    payroll_deduction_report (p_pr_id, p_rt_id, 'ABU');
            WHEN 'STATE_MAINTENANCE_R1'
            THEN
                p_jbr_id :=
                    payroll_deduction_report (p_pr_id, p_rt_id, 'AUU');
            WHEN 'ACCRUAL_R1'
            THEN
                p_jbr_id := accrual_r1 (p_rt_id, p_pr_id, 'AUU');
            WHEN 'ACCRUAL_R2'
            THEN
                p_jbr_id := accrual_r1 (p_rt_id, p_pr_id, 'ABU');
            WHEN 'SUPROVID_R1'
            THEN
                p_jbr_id := suprovid_r1 (p_rt_id, p_pr_id, 'AUU');
            WHEN 'SUPROVID_R2'
            THEN
                p_jbr_id := suprovid_r1 (p_rt_id, p_pr_id, 'ABU');
            WHEN 'DEPARTMENT_INFO_R1'
            THEN
                p_jbr_id := DEPARTMENT_INFO_R1 (p_rt_id, p_pr_id);
            WHEN 'DEPARTMENT_INFO_R2'
            THEN
                p_jbr_id := DEPARTMENT_INFO_R2 (p_rt_id, p_pr_id);
            ELSE
                NULL;
        END CASE;
    END;

    FUNCTION getMonthName (p_mnum NUMBER, p_vidm CHAR:= 'N' -- N,R,D,Z,O,M,K (називний, родовий, давальний...)
                                                           )
        RETURN VARCHAR2
    IS
        l_mname   VARCHAR2 (16);
    BEGIN
        SELECT CASE p_mnum
                   WHEN 1 THEN 'с≥чень'
                   WHEN 2 THEN 'лютий'
                   WHEN 3 THEN 'березень'
                   WHEN 4 THEN 'кв≥тень'
                   WHEN 5 THEN 'травень'
                   WHEN 6 THEN 'червень'
                   WHEN 7 THEN 'липень'
                   WHEN 8 THEN 'серпень'
                   WHEN 9 THEN 'вересень'
                   WHEN 10 THEN 'жовтень'
                   WHEN 11 THEN 'листопад'
                   WHEN 12 THEN 'грудень'
                   ELSE NULL
               END
          INTO l_mname
          FROM DUAL;

        RETURN l_mname;
    END getMonthName;

    FUNCTION getCntFMLbyPrsd (p_prsd NUMBER)
        RETURN NUMBER
    IS
        l_cnt   NUMBER;
    BEGIN
        SELECT COUNT (DISTINCT f.pdf_sc)
          INTO l_cnt
          FROM uss_esr.ac_detail    ad,
               uss_esr.pc_decision  pd,
               uss_esr.pd_family    f
         WHERE     ad.acd_pd = pd.pd_id
               AND pd.pd_id = f.pdf_pd
               AND ad.acd_prsd = p_prsd;

        RETURN l_cnt;
    END getCntFMLbyPrsd;

    FUNCTION getKaotCode (p_dh NUMBER)
        RETURN VARCHAR2
    IS
        l_kaot   VARCHAR2 (24);
    BEGIN
        SELECT MAX (k.kaot_code)
          INTO l_kaot
          FROM Uss_Doc.v_Doc_Attr2hist   h,
               Uss_Doc.v_Doc_Attributes  a,
               uss_ndi.v_ndi_katottg     k
         WHERE     p_dh = h.Da2h_Dh
               AND h.Da2h_Da = a.Da_Id
               AND a.da_val_id = k.kaot_id
               AND a.Da_Nda = 2292;

        RETURN l_kaot;
    END getKaotCode;

    FUNCTION getCntDistr (p_sum   IN NUMBER,
                          p_cnt   IN NUMBER,
                          p_for   IN NUMBER := 2,
                          p_pd    IN NUMBER := NULL,
                          p_dt    IN DATE := NULL)
        RETURN NUMBER
    IS
        l_cnt   NUMBER;
    BEGIN
        -- IC #107510
        SELECT COUNT (*)
          INTO l_cnt
          FROM uss_esr.pc_decision  d
               INNER JOIN uss_esr.pd_payment pp
                   ON pp.pdp_pd = d.pd_id AND pp.history_status = 'A'
               INNER JOIN uss_esr.pd_detail pd
                   ON     pd.pdd_pdp = pp.pdp_id
                      AND pd.pdd_value > 0                   --in (2000, 3000)
                      AND pd.pdd_ndp IN (290, 300)
         WHERE     d.pd_id = p_pd
               AND p_dt BETWEEN TRUNC (pp.pdp_start_dt, 'mm')
                            AND pp.pdp_stop_dt;

        IF l_cnt > 0
        THEN
            SELECT COUNT (*)
              INTO l_cnt
              FROM uss_esr.pc_decision  d
                   INNER JOIN uss_esr.pd_payment pp
                       ON pp.pdp_pd = d.pd_id AND pp.history_status = 'A'
                   INNER JOIN uss_esr.pd_detail pd
                       ON     pd.pdd_pdp = pp.pdp_id
                          AND pd.pdd_value = (1000 * p_for)
                          AND pd.pdd_ndp IN (290, 300)
             WHERE     d.pd_id = p_pd
                   AND p_dt BETWEEN TRUNC (pp.pdp_start_dt, 'mm')
                                AND pp.pdp_stop_dt;

            RETURN l_cnt;
        END IF;

        IF p_for = 2
        THEN
            SELECT CASE
                       WHEN p_sum = 2000
                       THEN
                           1
                       WHEN p_sum = 4000
                       THEN
                           2
                       WHEN p_sum = 5000
                       THEN
                           1
                       WHEN p_sum = 6000
                       THEN
                           CASE WHEN p_cnt >= 3 THEN 3 ELSE 0 END
                       WHEN p_sum = 7000
                       THEN
                           2
                       WHEN p_sum = 8000
                       THEN
                           CASE WHEN p_cnt >= 4 THEN 4 ELSE 1 END
                       WHEN p_sum = 9000
                       THEN
                           CASE WHEN p_cnt >= 4 THEN 3 ELSE 0 END
                       WHEN p_sum = 10000
                       THEN
                           CASE WHEN p_cnt >= 5 THEN 5 ELSE 2 END
                       WHEN p_sum = 11000
                       THEN
                           CASE WHEN p_cnt >= 5 THEN 4 ELSE 1 END
                       WHEN p_sum = 12000
                       THEN
                           CASE WHEN p_cnt >= 6 THEN 6 ELSE 3 END
                       WHEN p_sum = 13000
                       THEN
                           CASE WHEN p_cnt >= 6 THEN 5 ELSE 2 END
                       WHEN p_sum = 14000
                       THEN
                           CASE
                               WHEN p_cnt >= 7 THEN 7
                               WHEN p_cnt = 6 THEN 4
                               ELSE 1
                           END
                       WHEN p_sum = 15000
                       THEN
                           CASE
                               WHEN p_cnt >= 7 THEN 6
                               WHEN p_cnt = 6 THEN 3
                               ELSE 0
                           END
                       WHEN p_sum = 16000
                       THEN
                           CASE
                               WHEN p_cnt >= 8 THEN 8
                               WHEN p_cnt = 7 THEN 5
                               ELSE 2
                           END
                       WHEN p_sum = 17000
                       THEN
                           CASE
                               WHEN p_cnt >= 8 THEN 7
                               WHEN p_cnt = 6 THEN 4
                               ELSE 1
                           END
                       WHEN p_sum = 18000
                       THEN
                           CASE
                               WHEN p_cnt >= 9 THEN 9
                               WHEN p_cnt = 8 THEN 6
                               ELSE 3
                           END
                       WHEN p_sum = 19000
                       THEN
                           CASE
                               WHEN p_cnt >= 9 THEN 8
                               WHEN p_cnt = 8 THEN 5
                               ELSE 2
                           END
                       WHEN p_sum = 20000
                       THEN
                           CASE
                               WHEN p_cnt >= 10 THEN 10
                               WHEN p_cnt = 9 THEN 7
                               WHEN p_cnt = 8 THEN 4
                               ELSE 1
                           END
                       WHEN p_sum = 21000
                       THEN
                           CASE
                               WHEN p_cnt >= 10 THEN 9
                               WHEN p_cnt = 9 THEN 6
                               WHEN p_cnt = 8 THEN 3
                               ELSE 0
                           END
                       WHEN p_sum = 22000
                       THEN
                           CASE
                               WHEN p_cnt >= 11 THEN 11
                               WHEN p_cnt = 10 THEN 8
                               WHEN p_cnt = 9 THEN 5
                               ELSE 2
                           END
                       WHEN p_sum = 23000
                       THEN
                           CASE
                               WHEN p_cnt >= 11 THEN 10
                               WHEN p_cnt = 10 THEN 7
                               WHEN p_cnt = 9 THEN 4
                               ELSE 1
                           END
                       WHEN p_sum = 24000
                       THEN
                           CASE
                               WHEN p_cnt >= 12 THEN 12
                               WHEN p_cnt = 11 THEN 9
                               WHEN p_cnt = 10 THEN 6
                               WHEN p_cnt = 9 THEN 3
                               ELSE 0
                           END
                       WHEN p_sum = 25000
                       THEN
                           CASE
                               WHEN p_cnt >= 12 THEN 11
                               WHEN p_cnt = 11 THEN 8
                               WHEN p_cnt = 10 THEN 5
                               ELSE 2
                           END
                       WHEN p_sum = 26000
                       THEN
                           CASE
                               WHEN p_cnt >= 13 THEN 13
                               WHEN p_cnt = 12 THEN 10
                               WHEN p_cnt = 11 THEN 7
                               WHEN p_cnt = 10 THEN 4
                               ELSE 1
                           END
                       WHEN p_sum = 27000
                       THEN
                           CASE
                               WHEN p_cnt >= 13 THEN 12
                               WHEN p_cnt = 12 THEN 9
                               WHEN p_cnt = 11 THEN 6
                               WHEN p_cnt = 10 THEN 3
                               ELSE 0
                           END
                       WHEN p_sum = 28000
                       THEN
                           CASE
                               WHEN p_cnt >= 14 THEN 14
                               WHEN p_cnt = 13 THEN 11
                               WHEN p_cnt = 12 THEN 8
                               WHEN p_cnt = 11 THEN 5
                               ELSE 2
                           END
                       WHEN p_sum = 29000
                       THEN
                           CASE
                               WHEN p_cnt >= 14 THEN 13
                               WHEN p_cnt = 13 THEN 10
                               WHEN p_cnt = 12 THEN 7
                               WHEN p_cnt = 11 THEN 4
                               ELSE 1
                           END
                       WHEN p_sum = 30000
                       THEN
                           CASE
                               WHEN p_cnt >= 15 THEN 15
                               WHEN p_cnt = 14 THEN 12
                               WHEN p_cnt = 13 THEN 9
                               WHEN p_cnt = 12 THEN 6
                               WHEN p_cnt = 11 THEN 3
                               ELSE 0
                           END
                       ELSE
                           0
                   END
              INTO l_cnt
              FROM DUAL;
        ELSE
            SELECT CASE
                       WHEN p_sum = 3000
                       THEN
                           1
                       WHEN p_sum = 5000
                       THEN
                           1
                       WHEN p_sum = 6000
                       THEN
                           CASE WHEN p_cnt >= 3 THEN 0 ELSE 2 END
                       WHEN p_sum = 7000
                       THEN
                           1
                       WHEN p_sum = 8000
                       THEN
                           CASE WHEN p_cnt >= 4 THEN 0 ELSE 2 END
                       WHEN p_sum = 9000
                       THEN
                           CASE WHEN p_cnt >= 4 THEN 1 ELSE 3 END
                       WHEN p_sum = 10000
                       THEN
                           CASE WHEN p_cnt >= 5 THEN 0 ELSE 2 END
                       WHEN p_sum = 11000
                       THEN
                           CASE WHEN p_cnt >= 5 THEN 1 ELSE 3 END
                       WHEN p_sum = 12000
                       THEN
                           CASE WHEN p_cnt >= 6 THEN 0 ELSE 2 END
                       WHEN p_sum = 13000
                       THEN
                           CASE WHEN p_cnt >= 6 THEN 1 ELSE 3 END
                       WHEN p_sum = 14000
                       THEN
                           CASE
                               WHEN p_cnt >= 7 THEN 0
                               WHEN p_cnt = 6 THEN 2
                               ELSE 4
                           END
                       WHEN p_sum = 15000
                       THEN
                           CASE
                               WHEN p_cnt >= 7 THEN 1
                               WHEN p_cnt = 6 THEN 3
                               ELSE 5
                           END
                       WHEN p_sum = 16000
                       THEN
                           CASE
                               WHEN p_cnt >= 8 THEN 0
                               WHEN p_cnt = 7 THEN 2
                               ELSE 4
                           END
                       WHEN p_sum = 17000
                       THEN
                           CASE
                               WHEN p_cnt >= 8 THEN 1
                               WHEN p_cnt = 6 THEN 3
                               ELSE 5
                           END
                       WHEN p_sum = 18000
                       THEN
                           CASE
                               WHEN p_cnt >= 9 THEN 0
                               WHEN p_cnt = 8 THEN 2
                               ELSE 4
                           END
                       WHEN p_sum = 19000
                       THEN
                           CASE
                               WHEN p_cnt >= 9 THEN 1
                               WHEN p_cnt = 8 THEN 3
                               ELSE 5
                           END
                       WHEN p_sum = 20000
                       THEN
                           CASE
                               WHEN p_cnt >= 10 THEN 0
                               WHEN p_cnt = 9 THEN 2
                               WHEN p_cnt = 8 THEN 4
                               ELSE 6
                           END
                       WHEN p_sum = 21000
                       THEN
                           CASE
                               WHEN p_cnt >= 10 THEN 1
                               WHEN p_cnt = 9 THEN 3
                               WHEN p_cnt = 8 THEN 5
                               ELSE 7
                           END
                       WHEN p_sum = 22000
                       THEN
                           CASE
                               WHEN p_cnt >= 11 THEN 0
                               WHEN p_cnt = 10 THEN 2
                               WHEN p_cnt = 9 THEN 4
                               ELSE 6
                           END
                       WHEN p_sum = 23000
                       THEN
                           CASE
                               WHEN p_cnt >= 11 THEN 1
                               WHEN p_cnt = 10 THEN 3
                               WHEN p_cnt = 9 THEN 5
                               ELSE 7
                           END
                       WHEN p_sum = 24000
                       THEN
                           CASE
                               WHEN p_cnt >= 12 THEN 0
                               WHEN p_cnt = 11 THEN 3
                               WHEN p_cnt = 10 THEN 4
                               WHEN p_cnt = 9 THEN 6
                               ELSE 8
                           END
                       WHEN p_sum = 25000
                       THEN
                           CASE
                               WHEN p_cnt >= 12 THEN 1
                               WHEN p_cnt = 11 THEN 3
                               WHEN p_cnt = 10 THEN 5
                               ELSE 7
                           END
                       WHEN p_sum = 26000
                       THEN
                           CASE
                               WHEN p_cnt >= 13 THEN 0
                               WHEN p_cnt = 12 THEN 2
                               WHEN p_cnt = 11 THEN 4
                               WHEN p_cnt = 10 THEN 6
                               ELSE 8
                           END
                       WHEN p_sum = 27000
                       THEN
                           CASE
                               WHEN p_cnt >= 13 THEN 1
                               WHEN p_cnt = 12 THEN 3
                               WHEN p_cnt = 11 THEN 5
                               WHEN p_cnt = 10 THEN 7
                               ELSE 9
                           END
                       WHEN p_sum = 28000
                       THEN
                           CASE
                               WHEN p_cnt >= 14 THEN 0
                               WHEN p_cnt = 13 THEN 2
                               WHEN p_cnt = 12 THEN 4
                               WHEN p_cnt = 11 THEN 6
                               ELSE 8
                           END
                       WHEN p_sum = 29000
                       THEN
                           CASE
                               WHEN p_cnt >= 14 THEN 1
                               WHEN p_cnt = 13 THEN 3
                               WHEN p_cnt = 12 THEN 5
                               WHEN p_cnt = 11 THEN 7
                               ELSE 9
                           END
                       WHEN p_sum = 30000
                       THEN
                           CASE
                               WHEN p_cnt >= 15 THEN 0
                               WHEN p_cnt = 14 THEN 2
                               WHEN p_cnt = 13 THEN 4
                               WHEN p_cnt = 12 THEN 6
                               WHEN p_cnt = 11 THEN 8
                               ELSE 10
                           END
                       ELSE
                           0
                   END
              INTO l_cnt
              FROM DUAL;
        END IF;

        RETURN l_cnt;
    END getCntDistr;

    FUNCTION getCharMF (                                          -- IC #87199
                        p_val    IN VARCHAR2,
                        p_type   IN VARCHAR2 := '0',
                        p_def    IN VARCHAR2 := NULL)
        RETURN VARCHAR2
    IS
        l_val   VARCHAR2 (4000);
    BEGIN
        l_val := REGEXP_REPLACE (p_val, '[[:space:]]', ' '); -- ѕрибираЇмо символи що не друкуютьс€
        l_val := TRIM (l_val);          -- ѕрибираЇмо проб≥ли спереду ≥ позаду
        l_val := REGEXP_REPLACE (l_val, '[ ]{1}+', ' '); -- ѕрибираЇмо лишн≥ проб≥ли м≥ж словами

        IF REGEXP_COUNT (l_val, '"') = 2
        THEN
            l_val :=
                REGEXP_REPLACE (l_val,
                                '"',
                                CHR (171),
                                1,
                                1);                          -- ¬≥дкрит≥ лапки
            l_val :=
                REGEXP_REPLACE (l_val,
                                '"',
                                CHR (187),
                                2,
                                1);                           -- «акрит≥ лапки
        ELSIF REGEXP_COUNT (l_val, '"') = 1
        THEN
            l_val := REPLACE (l_val, '"', CHR (39));               -- јпостроф
        ELSE
            l_val := REPLACE (l_val, '"', ' '); -- просто зам≥н€ю на проб≥л (’« що робити) в цьому кейс≥
        END IF;

        IF p_type = 'PIB'
        THEN
            l_val :=
                REGEXP_REPLACE (UPPER (l_val),
                                '[^ј-я•≤ѓ™'' -]',
                                '',
                                1,
                                0,
                                'i');                      -- “≥льки кириличн≥ букви
        END IF;

        IF p_type = 'NUM'
        THEN
            l_val := REGEXP_REPLACE (l_val, '[^[:digit:]]', ''); -- “≥льки цифри

            IF l_val IS NULL
            THEN
                RETURN NULL;
            END IF;
        END IF;

        IF p_type = 'UNZR'
        THEN
            l_val := REGEXP_REPLACE (l_val, '[^[:digit:]]', ''); -- “≥льки цифри
            l_val := RPAD (l_val, 13, '0');
            RETURN l_val;
        END IF;

        l_val := NVL (l_val, p_def);

        l_val := '"' || l_val || '"';

        RETURN l_val;
    END getCharMF;

    /* serhii 12/09/2023 #91349: вар≥ант getCharMF п≥д в≥б≥рку дл€ ћ≥нф≥ну
        збер≥гаютьс€ деф≥си, апстрофи, подвоюютьс€ " , обогортаЇтьс€ в "" */
    FUNCTION getCharMF_q152 (p_val    IN VARCHAR2,
                             p_type   IN VARCHAR2 := '0',
                             p_def    IN VARCHAR2 := NULL)
        RETURN VARCHAR2
    IS
        l_val   VARCHAR2 (4000);
    BEGIN
        l_val := REGEXP_REPLACE (p_val, '[[:space:]]', ' ');
        l_val := TRIM (l_val);
        l_val := REGEXP_REPLACE (l_val, ' +', ' ');
        l_val := REPLACE (l_val, '"', '""');

        IF p_type = 'PIB'
        THEN
            --l_val := REGEXP_REPLACE(upper(l_val), '[^ј-я•≤ѓ™'' -]', '', 1, 0, 'i');
            l_val := UPPER (l_val);
        END IF;

        IF p_type = 'NUM'
        THEN
            l_val := REGEXP_REPLACE (l_val, '[^[:digit:]]', '');

            IF l_val IS NULL
            THEN
                RETURN NULL;
            END IF;
        END IF;

        IF p_type = 'UNZR'
        THEN
            l_val := REGEXP_REPLACE (l_val, '[^[:digit:]]', '');
            l_val := RPAD (l_val, 13, '0');
            RETURN l_val;
        END IF;

        l_val := NVL (l_val, p_def);
        l_val := '"' || l_val || '"';
        RETURN l_val;
    END getCharMF_q152;

    FUNCTION getFAddrMF (p_app_id   IN NUMBER,
                         p_ndt_id   IN NUMBER := 605,
                         p_nda_id   IN NUMBER := NULL)
        RETURN VARCHAR
    IS
        l_str   uss_esr.ap_document_attr.apda_val_string%TYPE;
        l_res   VARCHAR2 (4000);
    BEGIN
        SELECT MAX (da.apda_val_string)
          INTO l_str
          FROM uss_esr.ap_document d, uss_esr.ap_document_attr da
         WHERE     d.apd_app = p_app_id
               AND d.apd_id = da.apda_apd
               AND d.history_status = 'A'
               AND d.apd_ndt = 605
               AND da.apda_nda = 1782                                -- ≤ндекс
               AND NVL (p_nda_id, 0) IN (0, 1782);

        l_res :=
            l_res || CASE WHEN l_str IS NULL THEN '' ELSE l_str || ',' END;

        SELECT MAX (da.apda_val_string)
          INTO l_str
          FROM uss_esr.ap_document d, uss_esr.ap_document_attr da
         WHERE     d.apd_app = p_app_id
               AND d.apd_id = da.apda_apd
               AND d.history_status = 'A'
               AND d.apd_ndt = 605
               AND da.apda_nda = 1781                               --  ј“ќ““√
               AND NVL (p_nda_id, 0) IN (0, 1781);

        l_res :=
            l_res || CASE WHEN l_str IS NULL THEN '' ELSE l_str || ',' END;

        SELECT MAX (
                      CASE
                          WHEN p_nda_id = 1786 THEN ''
                          ELSE st.nsrt_name || ','
                      END
                   || z.ns_name)
          INTO l_str
          FROM uss_ndi.v_ndi_street  z
               LEFT JOIN uss_ndi.v_ndi_street_type st
                   ON (st.nsrt_id = z.ns_nsrt)
         WHERE z.ns_id IN
                   (SELECT da.apda_val_id
                      FROM uss_esr.ap_document d, uss_esr.ap_document_attr da
                     WHERE     d.apd_app = p_app_id
                           AND d.apd_id = da.apda_apd
                           AND d.history_status = 'A'
                           AND d.apd_ndt = 605
                           AND da.apda_nda = 1783    -- “ип Ќазва вулиц≥ (дов)
                           AND NVL (p_nda_id, 0) IN (0, 1783, 1786));

        l_res :=
            l_res || CASE WHEN l_str IS NULL THEN '' ELSE l_str || ',' END;

        SELECT MAX (da.apda_val_string)
          INTO l_str
          FROM uss_esr.ap_document d, uss_esr.ap_document_attr da
         WHERE     d.apd_app = p_app_id
               AND d.apd_id = da.apda_apd
               AND d.history_status = 'A'
               AND d.apd_ndt = 605
               AND da.apda_nda IN (1786)                 -- Ќазва вулиц≥ (руч)
               AND NVL (p_nda_id, 0) IN (0, 1786, 1783);

        l_res :=
            l_res || CASE WHEN l_str IS NULL THEN '' ELSE l_str || ',' END;

        SELECT MAX (da.apda_val_string)
          INTO l_str
          FROM uss_esr.ap_document d, uss_esr.ap_document_attr da
         WHERE     d.apd_app = p_app_id
               AND d.apd_id = da.apda_apd
               AND d.history_status = 'A'
               AND d.apd_ndt = 605
               AND da.apda_nda = 1784                         -- Ќомер будинку
               AND NVL (p_nda_id, 0) IN (0, 1784);

        l_res :=
            l_res || CASE WHEN l_str IS NULL THEN '' ELSE l_str || ',' END;

        SELECT MAX (da.apda_val_string)
          INTO l_str
          FROM uss_esr.ap_document d, uss_esr.ap_document_attr da
         WHERE     d.apd_app = p_app_id
               AND d.apd_id = da.apda_apd
               AND d.history_status = 'A'
               AND d.apd_ndt = 605
               AND da.apda_nda = 1787                         -- Ќомер корпусу
               AND NVL (p_nda_id, 0) IN (0, 1787);

        l_res :=
            l_res || CASE WHEN l_str IS NULL THEN '' ELSE l_str || ',' END;

        SELECT MAX (da.apda_val_string)
          INTO l_str
          FROM uss_esr.ap_document d, uss_esr.ap_document_attr da
         WHERE     d.apd_app = p_app_id
               AND d.apd_id = da.apda_apd
               AND d.history_status = 'A'
               AND d.apd_ndt = 605
               AND da.apda_nda = 1780                        -- Ќомер квартири
               AND NVL (p_nda_id, 0) IN (0, 1780);

        l_res :=
            l_res || CASE WHEN l_str IS NULL THEN '' ELSE l_str || ',' END;

        l_res := RTRIM (l_res, ',');
        RETURN l_res;
    END getFAddrMF;

    FUNCTION getRAddrMF (p_app_id   IN NUMBER,
                         p_ndt_id   IN NUMBER := 605,
                         p_nda_id   IN NUMBER := NULL)
        RETURN VARCHAR
    IS
        l_str   uss_esr.ap_document_attr.apda_val_string%TYPE;
        l_res   VARCHAR2 (4000);
    BEGIN
        SELECT MAX (da.apda_val_string)
          INTO l_str
          FROM uss_esr.ap_document d, uss_esr.ap_document_attr da
         WHERE     d.apd_app = p_app_id
               AND d.apd_id = da.apda_apd
               AND d.history_status = 'A'
               AND d.apd_ndt = 605
               AND da.apda_nda = 1776                                -- ≤ндекс
               AND NVL (p_nda_id, 0) IN (0, 1776);

        l_res :=
            l_res || CASE WHEN l_str IS NULL THEN '' ELSE l_str || ',' END;

        SELECT MAX (da.apda_val_string)
          INTO l_str
          FROM uss_esr.ap_document d, uss_esr.ap_document_attr da
         WHERE     d.apd_app = p_app_id
               AND d.apd_id = da.apda_apd
               AND d.history_status = 'A'
               AND d.apd_ndt = 605
               AND da.apda_nda = 1775                               --  ј“ќ““√
               AND NVL (p_nda_id, 0) IN (0, 1775);

        l_res :=
            l_res || CASE WHEN l_str IS NULL THEN '' ELSE l_str || ',' END;

        SELECT MAX (
                      CASE
                          WHEN p_nda_id = 1785 THEN ''
                          ELSE st.nsrt_name || ','
                      END
                   || z.ns_name)
          INTO l_str
          FROM uss_ndi.v_ndi_street  z
               LEFT JOIN uss_ndi.v_ndi_street_type st
                   ON (st.nsrt_id = z.ns_nsrt)
         WHERE z.ns_id IN
                   (SELECT da.apda_val_id
                      FROM uss_esr.ap_document d, uss_esr.ap_document_attr da
                     WHERE     d.apd_app = p_app_id
                           AND d.apd_id = da.apda_apd
                           AND d.history_status = 'A'
                           AND d.apd_ndt = 605
                           AND da.apda_nda = 1777    -- “ип Ќазва вулиц≥ (дов)
                           AND NVL (p_nda_id, 0) IN (0, 1777, 1785));

        l_res :=
            l_res || CASE WHEN l_str IS NULL THEN '' ELSE l_str || ',' END;

        SELECT MAX (da.apda_val_string)
          INTO l_str
          FROM uss_esr.ap_document d, uss_esr.ap_document_attr da
         WHERE     d.apd_app = p_app_id
               AND d.apd_id = da.apda_apd
               AND d.history_status = 'A'
               AND d.apd_ndt = 605
               AND da.apda_nda IN (1785)                 -- Ќазва вулиц≥ (руч)
               AND NVL (p_nda_id, 0) IN (0, 1785, 1777);

        l_res :=
            l_res || CASE WHEN l_str IS NULL THEN '' ELSE l_str || ',' END;

        SELECT MAX (da.apda_val_string)
          INTO l_str
          FROM uss_esr.ap_document d, uss_esr.ap_document_attr da
         WHERE     d.apd_app = p_app_id
               AND d.apd_id = da.apda_apd
               AND d.history_status = 'A'
               AND d.apd_ndt = 605
               AND da.apda_nda = 1778                         -- Ќомер будинку
               AND NVL (p_nda_id, 0) IN (0, 1778);

        l_res :=
            l_res || CASE WHEN l_str IS NULL THEN '' ELSE l_str || ',' END;

        SELECT MAX (da.apda_val_string)
          INTO l_str
          FROM uss_esr.ap_document d, uss_esr.ap_document_attr da
         WHERE     d.apd_app = p_app_id
               AND d.apd_id = da.apda_apd
               AND d.history_status = 'A'
               AND d.apd_ndt = 605
               AND da.apda_nda = 1779                         -- Ќомер корпусу
               AND NVL (p_nda_id, 0) IN (0, 1779);

        l_res :=
            l_res || CASE WHEN l_str IS NULL THEN '' ELSE l_str || ',' END;

        SELECT MAX (da.apda_val_string)
          INTO l_str
          FROM uss_esr.ap_document d, uss_esr.ap_document_attr da
         WHERE     d.apd_app = p_app_id
               AND d.apd_id = da.apda_apd
               AND d.history_status = 'A'
               AND d.apd_ndt = 605
               AND da.apda_nda = 1788                        -- Ќомер квартири
               AND NVL (p_nda_id, 0) IN (0, 1788);

        l_res :=
            l_res || CASE WHEN l_str IS NULL THEN '' ELSE l_str || ',' END;

        l_res := RTRIM (l_res, ',');
        RETURN l_res;
    END getRAddrMF;

    FUNCTION getCntFmlByPC (p_pc_id      IN NUMBER,
                            p_nst_id     IN NUMBER := 0,
                            p_date       IN DATE := NULL,
                            p_type_rep   IN NUMBER := 0)
        RETURN NUMBER
    IS
        l_cnt   NUMBER;
    BEGIN
        -- «агальна к≥льк≥сть
        IF p_type_rep = 0
        THEN
            SELECT COUNT (DISTINCT f.pdf_sc)
              INTO l_cnt
              FROM uss_esr.pc_decision  pd
                   INNER JOIN uss_esr.pd_family f
                       ON     f.pdf_pd = pd.pd_id
                          AND NOT EXISTS
                                  (SELECT 1
                                     FROM uss_esr.ap_person p
                                    WHERE     p.app_ap = pd.pd_ap
                                          AND p.app_sc = f.pdf_sc
                                          AND p.history_status = 'A'
                                          -- and p.app_sc = fml.pdf_sc and p.app_tp in ('Z', 'FM', 'FP'))
                                          AND p.app_tp = 'P') -- ѕредставник за€вника
             WHERE     (pd.pd_nst = p_nst_id OR p_nst_id = 0)
                   AND pd.pd_pc = p_pc_id;
        END IF;

        IF p_type_rep IN (2, --  ≥льк≥сть д≥тей, на €ких отримують допомогу (одиниць)
                             3) --  ≥льк≥сть д≥тей, на €ких отримують допомогу у максимальному розм≥р≥
        THEN
            SELECT COUNT (DISTINCT f.pdf_sc)
              INTO l_cnt
              FROM uss_esr.pc_decision  pd
                   INNER JOIN uss_esr.pd_family f
                       ON     f.pdf_pd = pd.pd_id
                          AND NOT EXISTS
                                  (SELECT 1
                                     FROM uss_esr.ap_person p
                                    WHERE     p.app_ap = pd.pd_ap
                                          AND p.app_sc = f.pdf_sc
                                          AND p.history_status = 'A'
                                          -- and p.app_sc = fml.pdf_sc and p.app_tp in ('Z', 'FM', 'FP'))
                                          AND p.app_tp = 'P') -- ѕредставник за€вника
             WHERE     (   f.pdf_birth_dt >
                           ADD_MONTHS (TRUNC (NVL (p_date, SYSDATE), 'MM'),
                                       -216)
                        OR (    f.pdf_birth_dt >
                                ADD_MONTHS (
                                    TRUNC (NVL (p_date, SYSDATE), 'MM'),
                                    -276)
                            AND EXISTS
                                    (SELECT 1 -- ƒов≥дка про денну ≥ дуальну форму навчанн€
                                       FROM uss_esr.ap_person         pp,
                                            uss_esr.ap_document       d,
                                            uss_esr.ap_document_attr  da
                                      WHERE     pp.app_ap = pd.pd_ap
                                            AND pp.app_sc = f.pdf_sc
                                            AND pp.app_ap = d.apd_ap
                                            AND pp.app_id = d.apd_app
                                            AND d.apd_id = da.apda_apd
                                            AND da.apda_nda = 690
                                            AND da.history_status = 'A'
                                            AND da.apda_val_string IN
                                                    ('D', 'U'))))
                   AND CASE
                           WHEN p_type_rep != 3
                           THEN
                               1
                           WHEN EXISTS
                                    (SELECT 1
                                       FROM uss_esr.pd_payment  pp,
                                            uss_esr.pd_detail   dd,
                                            uss_esr.pd_family   f
                                      WHERE     pp.pdp_pd = pd.pd_id
                                            AND f.pdf_pd = pd.pd_id
                                            AND pp.pdp_id = dd.pdd_pdp
                                            AND f.pdf_id = dd.pdd_key
                                            AND pp.history_status = 'A'
                                            AND (   TRUNC (dd.pdd_value) IN
                                                        (2272,
                                                         2833,
                                                         2684,
                                                         5680,
                                                         7952,
                                                         7082,
                                                         9915)
                                                 OR TRUNC (pp.pdp_sum) IN
                                                        (2272,
                                                         2833,
                                                         2684,
                                                         5680,
                                                         7952,
                                                         7082,
                                                         9915)))
                           THEN
                               1
                           ELSE
                               0
                       END =
                       1
                   AND (pd.pd_nst = p_nst_id OR p_nst_id = 0)
                   AND pd.pd_pc = p_pc_id;
        END IF;

        RETURN NVL (l_cnt, 0);
    END getCntFmlByPC;

    -- IC ќтриманн€ текстового параметру документу по учаснику
    FUNCTION get_doc_string (p_app   ap_document.apd_app%TYPE,
                             p_ap    ap_document.apd_ap%TYPE,
                             p_ndt   ap_document.apd_ndt%TYPE,
                             p_nda   ap_document_attr.apda_nda%TYPE)
        RETURN VARCHAR2
    IS
        l_rez   VARCHAR2 (4000);
    BEGIN
        SELECT MAX (apda_val_string)
          INTO l_rez
          FROM ap_document, ap_document_attr
         WHERE     apda_apd = apd_id
               AND ap_document.history_status = 'A'
               AND (apd_app = p_app OR p_app IS NULL) -- або шукати т≥льки по зверненню
               AND apd_ap = p_ap
               AND apd_ndt = p_ndt
               AND apda_nda = p_nda;

        RETURN l_rez;
    END get_doc_string;

    -- IC ќтриманн€ ID параметру документу по учаснику
    FUNCTION get_doc_id (p_app   ap_document.apd_app%TYPE,
                         p_ap    ap_document.apd_ap%TYPE,
                         p_ndt   ap_document.apd_ndt%TYPE,
                         p_nda   ap_document_attr.apda_nda%TYPE)
        RETURN NUMBER
    IS
        l_rez   NUMBER;
    BEGIN
        SELECT MAX (apda_val_id)
          INTO l_rez
          FROM ap_document, ap_document_attr
         WHERE     apda_apd = apd_id
               AND ap_document.history_status = 'A'
               AND (apd_app = p_app OR p_app IS NULL) -- або шукати т≥льки по зверненню
               AND apd_ap = p_ap
               AND apd_ndt = p_ndt
               AND apda_nda = p_nda;

        RETURN l_rez;
    END get_doc_id;

    -- IC ќтриманн€ параметру дати документу по учаснику
    FUNCTION get_doc_dt (p_app   ap_document.apd_app%TYPE,
                         p_ap    ap_document.apd_ap%TYPE,
                         p_ndt   ap_document.apd_ndt%TYPE,
                         p_nda   ap_document_attr.apda_nda%TYPE)
        RETURN DATE
    IS
        l_rez   DATE;
    BEGIN
        SELECT MAX (apda_val_dt)
          INTO l_rez
          FROM ap_document, ap_document_attr
         WHERE     apda_apd = apd_id
               AND ap_document.history_status = 'A'
               AND (apd_app = p_app OR p_app IS NULL) -- або шукати т≥льки по зверненню
               AND apd_ap = p_ap
               AND apd_ndt = p_ndt
               AND apda_nda = p_nda;

        RETURN l_rez;
    END get_doc_dt;

    FUNCTION phone_clear (p_text IN VARCHAR2)
        RETURN VARCHAR2
    IS
        l_result   VARCHAR2 (32767) := p_text;
    BEGIN
        --l_result := regexp_replace(l_result, '\,.*$', ''); --remove second number
        --l_result := regexp_replace(l_result, '[\(\)\+- ]', ''); --remove addition symbol
        --l_result := regexp_replace(l_result, ',.*$', ''); --remove second number
        --l_result := regexp_replace(l_result, '[\()+ -]', ''); --remove addition symbol

        --remove second number
        DECLARE
            l_index   NUMBER;
        BEGIN
            l_index := INSTR (l_result, ',');

            IF l_index > 0
            THEN
                l_result := SUBSTR (l_result, 0, l_index - 1);
            END IF;
        END;

        --remove addition symbol
        l_result := REPLACE (l_result, '\', '');
        l_result := REPLACE (l_result, '(', '');
        l_result := REPLACE (l_result, ')', '');
        l_result := REPLACE (l_result, '+', '');
        l_result := REPLACE (l_result, '-', '');
        l_result := REPLACE (l_result, ' ', '');

        l_result := LTRIM (l_result, '38');

        IF LENGTH (l_result) != 10
        THEN
            RETURN NULL;
        END IF;

        RETURN l_result;
    END phone_clear;

    FUNCTION Get_Attr_Val_Dt (p_Nda_Id IN NUMBER, p_Dh_Id IN NUMBER)
        RETURN DATE
    IS
        l_rez   DATE;
    BEGIN
        l_rez := uss_doc.Api$documents.Get_Attr_Val_Dt (p_Nda_Id, p_Dh_Id);
        RETURN l_rez;
    END Get_Attr_Val_Dt;

    FUNCTION Get_Attr_Val_Str (p_Nda_Id IN NUMBER, p_Dh_Id IN NUMBER)
        RETURN VARCHAR2
    IS
        l_rez   VARCHAR2 (1024);
    BEGIN
        l_rez := uss_doc.Api$documents.Get_Attr_Val_Str (p_Nda_Id, p_Dh_Id);
        RETURN l_rez;
    END Get_Attr_Val_Str;

    FUNCTION Get_Attr_Val_Id (p_Nda_Id IN NUMBER, p_Dh_Id IN NUMBER)
        RETURN NUMBER
    IS
        l_rez   NUMBER;
    BEGIN
        l_rez := uss_doc.Api$documents.Get_Attr_Val_Id (p_Nda_Id, p_Dh_Id);
        RETURN l_rez;
    END Get_Attr_Val_Id;
END DNET$PAYMENT_REPORTS;
/